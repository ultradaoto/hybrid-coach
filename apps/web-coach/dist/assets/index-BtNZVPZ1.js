function qT(s,t){for(var i=0;i<t.length;i++){const a=t[i];if(typeof a!="string"&&!Array.isArray(a)){for(const o in a)if(o!=="default"&&!(o in s)){const l=Object.getOwnPropertyDescriptor(a,o);l&&Object.defineProperty(s,o,l.get?l:{enumerable:!0,get:()=>a[o]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();function Cy(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var gd={exports:{}},Mr={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jg;function VT(){if(Jg)return Mr;Jg=1;var s=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(a,o,l){var u=null;if(l!==void 0&&(u=""+l),o.key!==void 0&&(u=""+o.key),"key"in o){l={};for(var d in o)d!=="key"&&(l[d]=o[d])}else l=o;return o=l.ref,{$$typeof:s,type:a,key:u,ref:o!==void 0?o:null,props:l}}return Mr.Fragment=t,Mr.jsx=i,Mr.jsxs=i,Mr}var Qg;function FT(){return Qg||(Qg=1,gd.exports=VT()),gd.exports}var N=FT(),vd={exports:{}},Te={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xg;function HT(){if(Xg)return Te;Xg=1;var s=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),b=Symbol.iterator;function C(E){return E===null||typeof E!="object"?null:(E=b&&E[b]||E["@@iterator"],typeof E=="function"?E:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O=Object.assign,B={};function w(E,F,ne){this.props=E,this.context=F,this.refs=B,this.updater=ne||M}w.prototype.isReactComponent={},w.prototype.setState=function(E,F){if(typeof E!="object"&&typeof E!="function"&&E!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,E,F,"setState")},w.prototype.forceUpdate=function(E){this.updater.enqueueForceUpdate(this,E,"forceUpdate")};function X(){}X.prototype=w.prototype;function K(E,F,ne){this.props=E,this.context=F,this.refs=B,this.updater=ne||M}var A=K.prototype=new X;A.constructor=K,O(A,w.prototype),A.isPureReactComponent=!0;var _=Array.isArray;function I(){}var q={H:null,A:null,T:null,S:null},W=Object.prototype.hasOwnProperty;function oe(E,F,ne){var ee=ne.ref;return{$$typeof:s,type:E,key:F,ref:ee!==void 0?ee:null,props:ne}}function re(E,F){return oe(E.type,F,E.props)}function ce(E){return typeof E=="object"&&E!==null&&E.$$typeof===s}function pe(E){var F={"=":"=0",":":"=2"};return"$"+E.replace(/[=:]/g,function(ne){return F[ne]})}var Ve=/\/+/g;function nt(E,F){return typeof E=="object"&&E!==null&&E.key!=null?pe(""+E.key):F.toString(36)}function ae(E){switch(E.status){case"fulfilled":return E.value;case"rejected":throw E.reason;default:switch(typeof E.status=="string"?E.then(I,I):(E.status="pending",E.then(function(F){E.status==="pending"&&(E.status="fulfilled",E.value=F)},function(F){E.status==="pending"&&(E.status="rejected",E.reason=F)})),E.status){case"fulfilled":return E.value;case"rejected":throw E.reason}}throw E}function x(E,F,ne,ee,he){var Se=typeof E;(Se==="undefined"||Se==="boolean")&&(E=null);var Le=!1;if(E===null)Le=!0;else switch(Se){case"bigint":case"string":case"number":Le=!0;break;case"object":switch(E.$$typeof){case s:case t:Le=!0;break;case g:return Le=E._init,x(Le(E._payload),F,ne,ee,he)}}if(Le)return he=he(E),Le=ee===""?"."+nt(E,0):ee,_(he)?(ne="",Le!=null&&(ne=Le.replace(Ve,"$&/")+"/"),x(he,F,ne,"",function(ea){return ea})):he!=null&&(ce(he)&&(he=re(he,ne+(he.key==null||E&&E.key===he.key?"":(""+he.key).replace(Ve,"$&/")+"/")+Le)),F.push(he)),1;Le=0;var Et=ee===""?".":ee+":";if(_(E))for(var tt=0;tt<E.length;tt++)ee=E[tt],Se=Et+nt(ee,tt),Le+=x(ee,F,ne,Se,he);else if(tt=C(E),typeof tt=="function")for(E=tt.call(E),tt=0;!(ee=E.next()).done;)ee=ee.value,Se=Et+nt(ee,tt++),Le+=x(ee,F,ne,Se,he);else if(Se==="object"){if(typeof E.then=="function")return x(ae(E),F,ne,ee,he);throw F=String(E),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.")}return Le}function $(E,F,ne){if(E==null)return E;var ee=[],he=0;return x(E,ee,"","",function(Se){return F.call(ne,Se,he++)}),ee}function ue(E){if(E._status===-1){var F=E._result;F=F(),F.then(function(ne){(E._status===0||E._status===-1)&&(E._status=1,E._result=ne)},function(ne){(E._status===0||E._status===-1)&&(E._status=2,E._result=ne)}),E._status===-1&&(E._status=0,E._result=F)}if(E._status===1)return E._result.default;throw E._result}var le=typeof reportError=="function"?reportError:function(E){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof E=="object"&&E!==null&&typeof E.message=="string"?String(E.message):String(E),error:E});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",E);return}console.error(E)},ye={map:$,forEach:function(E,F,ne){$(E,function(){F.apply(this,arguments)},ne)},count:function(E){var F=0;return $(E,function(){F++}),F},toArray:function(E){return $(E,function(F){return F})||[]},only:function(E){if(!ce(E))throw Error("React.Children.only expected to receive a single React element child.");return E}};return Te.Activity=v,Te.Children=ye,Te.Component=w,Te.Fragment=i,Te.Profiler=o,Te.PureComponent=K,Te.StrictMode=a,Te.Suspense=f,Te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=q,Te.__COMPILER_RUNTIME={__proto__:null,c:function(E){return q.H.useMemoCache(E)}},Te.cache=function(E){return function(){return E.apply(null,arguments)}},Te.cacheSignal=function(){return null},Te.cloneElement=function(E,F,ne){if(E==null)throw Error("The argument must be a React element, but you passed "+E+".");var ee=O({},E.props),he=E.key;if(F!=null)for(Se in F.key!==void 0&&(he=""+F.key),F)!W.call(F,Se)||Se==="key"||Se==="__self"||Se==="__source"||Se==="ref"&&F.ref===void 0||(ee[Se]=F[Se]);var Se=arguments.length-2;if(Se===1)ee.children=ne;else if(1<Se){for(var Le=Array(Se),Et=0;Et<Se;Et++)Le[Et]=arguments[Et+2];ee.children=Le}return oe(E.type,he,ee)},Te.createContext=function(E){return E={$$typeof:u,_currentValue:E,_currentValue2:E,_threadCount:0,Provider:null,Consumer:null},E.Provider=E,E.Consumer={$$typeof:l,_context:E},E},Te.createElement=function(E,F,ne){var ee,he={},Se=null;if(F!=null)for(ee in F.key!==void 0&&(Se=""+F.key),F)W.call(F,ee)&&ee!=="key"&&ee!=="__self"&&ee!=="__source"&&(he[ee]=F[ee]);var Le=arguments.length-2;if(Le===1)he.children=ne;else if(1<Le){for(var Et=Array(Le),tt=0;tt<Le;tt++)Et[tt]=arguments[tt+2];he.children=Et}if(E&&E.defaultProps)for(ee in Le=E.defaultProps,Le)he[ee]===void 0&&(he[ee]=Le[ee]);return oe(E,Se,he)},Te.createRef=function(){return{current:null}},Te.forwardRef=function(E){return{$$typeof:d,render:E}},Te.isValidElement=ce,Te.lazy=function(E){return{$$typeof:g,_payload:{_status:-1,_result:E},_init:ue}},Te.memo=function(E,F){return{$$typeof:m,type:E,compare:F===void 0?null:F}},Te.startTransition=function(E){var F=q.T,ne={};q.T=ne;try{var ee=E(),he=q.S;he!==null&&he(ne,ee),typeof ee=="object"&&ee!==null&&typeof ee.then=="function"&&ee.then(I,le)}catch(Se){le(Se)}finally{F!==null&&ne.types!==null&&(F.types=ne.types),q.T=F}},Te.unstable_useCacheRefresh=function(){return q.H.useCacheRefresh()},Te.use=function(E){return q.H.use(E)},Te.useActionState=function(E,F,ne){return q.H.useActionState(E,F,ne)},Te.useCallback=function(E,F){return q.H.useCallback(E,F)},Te.useContext=function(E){return q.H.useContext(E)},Te.useDebugValue=function(){},Te.useDeferredValue=function(E,F){return q.H.useDeferredValue(E,F)},Te.useEffect=function(E,F){return q.H.useEffect(E,F)},Te.useEffectEvent=function(E){return q.H.useEffectEvent(E)},Te.useId=function(){return q.H.useId()},Te.useImperativeHandle=function(E,F,ne){return q.H.useImperativeHandle(E,F,ne)},Te.useInsertionEffect=function(E,F){return q.H.useInsertionEffect(E,F)},Te.useLayoutEffect=function(E,F){return q.H.useLayoutEffect(E,F)},Te.useMemo=function(E,F){return q.H.useMemo(E,F)},Te.useOptimistic=function(E,F){return q.H.useOptimistic(E,F)},Te.useReducer=function(E,F,ne){return q.H.useReducer(E,F,ne)},Te.useRef=function(E){return q.H.useRef(E)},Te.useState=function(E){return q.H.useState(E)},Te.useSyncExternalStore=function(E,F,ne){return q.H.useSyncExternalStore(E,F,ne)},Te.useTransition=function(){return q.H.useTransition()},Te.version="19.2.3",Te}var Zg;function bh(){return Zg||(Zg=1,vd.exports=HT()),vd.exports}var z=bh();const ky=Cy(z),GT=qT({__proto__:null,default:ky},[z]);var yd={exports:{}},wr={},bd={exports:{}},Sd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wg;function KT(){return Wg||(Wg=1,(function(s){function t(x,$){var ue=x.length;x.push($);e:for(;0<ue;){var le=ue-1>>>1,ye=x[le];if(0<o(ye,$))x[le]=$,x[ue]=ye,ue=le;else break e}}function i(x){return x.length===0?null:x[0]}function a(x){if(x.length===0)return null;var $=x[0],ue=x.pop();if(ue!==$){x[0]=ue;e:for(var le=0,ye=x.length,E=ye>>>1;le<E;){var F=2*(le+1)-1,ne=x[F],ee=F+1,he=x[ee];if(0>o(ne,ue))ee<ye&&0>o(he,ne)?(x[le]=he,x[ee]=ue,le=ee):(x[le]=ne,x[F]=ue,le=F);else if(ee<ye&&0>o(he,ue))x[le]=he,x[ee]=ue,le=ee;else break e}}return $}function o(x,$){var ue=x.sortIndex-$.sortIndex;return ue!==0?ue:x.id-$.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;s.unstable_now=function(){return l.now()}}else{var u=Date,d=u.now();s.unstable_now=function(){return u.now()-d}}var f=[],m=[],g=1,v=null,b=3,C=!1,M=!1,O=!1,B=!1,w=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;function A(x){for(var $=i(m);$!==null;){if($.callback===null)a(m);else if($.startTime<=x)a(m),$.sortIndex=$.expirationTime,t(f,$);else break;$=i(m)}}function _(x){if(O=!1,A(x),!M)if(i(f)!==null)M=!0,I||(I=!0,pe());else{var $=i(m);$!==null&&ae(_,$.startTime-x)}}var I=!1,q=-1,W=5,oe=-1;function re(){return B?!0:!(s.unstable_now()-oe<W)}function ce(){if(B=!1,I){var x=s.unstable_now();oe=x;var $=!0;try{e:{M=!1,O&&(O=!1,X(q),q=-1),C=!0;var ue=b;try{t:{for(A(x),v=i(f);v!==null&&!(v.expirationTime>x&&re());){var le=v.callback;if(typeof le=="function"){v.callback=null,b=v.priorityLevel;var ye=le(v.expirationTime<=x);if(x=s.unstable_now(),typeof ye=="function"){v.callback=ye,A(x),$=!0;break t}v===i(f)&&a(f),A(x)}else a(f);v=i(f)}if(v!==null)$=!0;else{var E=i(m);E!==null&&ae(_,E.startTime-x),$=!1}}break e}finally{v=null,b=ue,C=!1}$=void 0}}finally{$?pe():I=!1}}}var pe;if(typeof K=="function")pe=function(){K(ce)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,nt=Ve.port2;Ve.port1.onmessage=ce,pe=function(){nt.postMessage(null)}}else pe=function(){w(ce,0)};function ae(x,$){q=w(function(){x(s.unstable_now())},$)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(x){x.callback=null},s.unstable_forceFrameRate=function(x){0>x||125<x?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<x?Math.floor(1e3/x):5},s.unstable_getCurrentPriorityLevel=function(){return b},s.unstable_next=function(x){switch(b){case 1:case 2:case 3:var $=3;break;default:$=b}var ue=b;b=$;try{return x()}finally{b=ue}},s.unstable_requestPaint=function(){B=!0},s.unstable_runWithPriority=function(x,$){switch(x){case 1:case 2:case 3:case 4:case 5:break;default:x=3}var ue=b;b=x;try{return $()}finally{b=ue}},s.unstable_scheduleCallback=function(x,$,ue){var le=s.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?le+ue:le):ue=le,x){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=ue+ye,x={id:g++,callback:$,priorityLevel:x,startTime:ue,expirationTime:ye,sortIndex:-1},ue>le?(x.sortIndex=ue,t(m,x),i(f)===null&&x===i(m)&&(O?(X(q),q=-1):O=!0,ae(_,ue-le))):(x.sortIndex=ye,t(f,x),M||C||(M=!0,I||(I=!0,pe()))),x},s.unstable_shouldYield=re,s.unstable_wrapCallback=function(x){var $=b;return function(){var ue=b;b=$;try{return x.apply(this,arguments)}finally{b=ue}}}})(Sd)),Sd}var $g;function YT(){return $g||($g=1,bd.exports=KT()),bd.exports}var Td={exports:{}},xt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ev;function JT(){if(ev)return xt;ev=1;var s=bh();function t(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");function l(f,m,g){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:f,containerInfo:m,implementation:g}}var u=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return xt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,xt.createPortal=function(f,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return l(f,m,null,g)},xt.flushSync=function(f){var m=u.T,g=a.p;try{if(u.T=null,a.p=2,f)return f()}finally{u.T=m,a.p=g,a.d.f()}},xt.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,a.d.C(f,m))},xt.prefetchDNS=function(f){typeof f=="string"&&a.d.D(f)},xt.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var g=m.as,v=d(g,m.crossOrigin),b=typeof m.integrity=="string"?m.integrity:void 0,C=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?a.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:b,fetchPriority:C}):g==="script"&&a.d.X(f,{crossOrigin:v,integrity:b,fetchPriority:C,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},xt.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=d(m.as,m.crossOrigin);a.d.M(f,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&a.d.M(f)},xt.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,v=d(g,m.crossOrigin);a.d.L(f,g,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},xt.preloadModule=function(f,m){if(typeof f=="string")if(m){var g=d(m.as,m.crossOrigin);a.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else a.d.m(f)},xt.requestFormReset=function(f){a.d.r(f)},xt.unstable_batchedUpdates=function(f,m){return f(m)},xt.useFormState=function(f,m,g){return u.H.useFormState(f,m,g)},xt.useFormStatus=function(){return u.H.useHostTransitionStatus()},xt.version="19.2.3",xt}var tv;function Ey(){if(tv)return Td.exports;tv=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(t){console.error(t)}}return s(),Td.exports=JT(),Td.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nv;function QT(){if(nv)return wr;nv=1;var s=YT(),t=bh(),i=Ey();function a(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)n+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function l(e){var n=e,r=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(r=n.return),e=n.return;while(e)}return n.tag===3?r:null}function u(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function d(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function f(e){if(l(e)!==e)throw Error(a(188))}function m(e){var n=e.alternate;if(!n){if(n=l(e),n===null)throw Error(a(188));return n!==e?null:e}for(var r=e,c=n;;){var h=r.return;if(h===null)break;var p=h.alternate;if(p===null){if(c=h.return,c!==null){r=c;continue}break}if(h.child===p.child){for(p=h.child;p;){if(p===r)return f(h),e;if(p===c)return f(h),n;p=p.sibling}throw Error(a(188))}if(r.return!==c.return)r=h,c=p;else{for(var y=!1,S=h.child;S;){if(S===r){y=!0,r=h,c=p;break}if(S===c){y=!0,c=h,r=p;break}S=S.sibling}if(!y){for(S=p.child;S;){if(S===r){y=!0,r=p,c=h;break}if(S===c){y=!0,c=p,r=h;break}S=S.sibling}if(!y)throw Error(a(189))}}if(r.alternate!==c)throw Error(a(190))}if(r.tag!==3)throw Error(a(188));return r.stateNode.current===r?e:n}function g(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=g(e),n!==null)return n;e=e.sibling}return null}var v=Object.assign,b=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),M=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),X=Symbol.for("react.consumer"),K=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),oe=Symbol.for("react.activity"),re=Symbol.for("react.memo_cache_sentinel"),ce=Symbol.iterator;function pe(e){return e===null||typeof e!="object"?null:(e=ce&&e[ce]||e["@@iterator"],typeof e=="function"?e:null)}var Ve=Symbol.for("react.client.reference");function nt(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Ve?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case O:return"Fragment";case w:return"Profiler";case B:return"StrictMode";case _:return"Suspense";case I:return"SuspenseList";case oe:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case M:return"Portal";case K:return e.displayName||"Context";case X:return(e._context.displayName||"Context")+".Consumer";case A:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case q:return n=e.displayName||null,n!==null?n:nt(e.type)||"Memo";case W:n=e._payload,e=e._init;try{return nt(e(n))}catch{}}return null}var ae=Array.isArray,x=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ue={pending:!1,data:null,method:null,action:null},le=[],ye=-1;function E(e){return{current:e}}function F(e){0>ye||(e.current=le[ye],le[ye]=null,ye--)}function ne(e,n){ye++,le[ye]=e.current,e.current=n}var ee=E(null),he=E(null),Se=E(null),Le=E(null);function Et(e,n){switch(ne(Se,n),ne(he,e),ne(ee,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?vg(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=vg(n),e=yg(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}F(ee),ne(ee,e)}function tt(){F(ee),F(he),F(Se)}function ea(e){e.memoizedState!==null&&ne(Le,e);var n=ee.current,r=yg(n,e.type);n!==r&&(ne(he,e),ne(ee,r))}function Oa(e){he.current===e&&(F(ee),F(he)),Le.current===e&&(F(Le),_r._currentValue=ue)}var Aa,ta;function zn(e){if(Aa===void 0)try{throw Error()}catch(r){var n=r.stack.trim().match(/\n( *(at )?)/);Aa=n&&n[1]||"",ta=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Aa+e+ta}var Ls=!1;function Da(e,n){if(!e||Ls)return"";Ls=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(n){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(V){var j=V}Reflect.construct(e,[],Y)}else{try{Y.call()}catch(V){j=V}e.call(Y.prototype)}}else{try{throw Error()}catch(V){j=V}(Y=e())&&typeof Y.catch=="function"&&Y.catch(function(){})}}catch(V){if(V&&j&&typeof V.stack=="string")return[V.stack,j.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var h=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");h&&h.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=c.DetermineComponentFrameRoot(),y=p[0],S=p[1];if(y&&S){var k=y.split(`
`),L=S.split(`
`);for(h=c=0;c<k.length&&!k[c].includes("DetermineComponentFrameRoot");)c++;for(;h<L.length&&!L[h].includes("DetermineComponentFrameRoot");)h++;if(c===k.length||h===L.length)for(c=k.length-1,h=L.length-1;1<=c&&0<=h&&k[c]!==L[h];)h--;for(;1<=c&&0<=h;c--,h--)if(k[c]!==L[h]){if(c!==1||h!==1)do if(c--,h--,0>h||k[c]!==L[h]){var H=`
`+k[c].replace(" at new "," at ");return e.displayName&&H.includes("<anonymous>")&&(H=H.replace("<anonymous>",e.displayName)),H}while(1<=c&&0<=h);break}}}finally{Ls=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?zn(r):""}function nl(e,n){switch(e.tag){case 26:case 27:case 5:return zn(e.type);case 16:return zn("Lazy");case 13:return e.child!==n&&n!==null?zn("Suspense Fallback"):zn("Suspense");case 19:return zn("SuspenseList");case 0:case 15:return Da(e.type,!1);case 11:return Da(e.type.render,!1);case 1:return Da(e.type,!0);case 31:return zn("Activity");default:return""}}function $r(e){try{var n="",r=null;do n+=nl(e,r),r=e,e=e.return;while(e);return n}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var Ma=Object.prototype.hasOwnProperty,Us=s.unstable_scheduleCallback,Is=s.unstable_cancelCallback,il=s.unstable_shouldYield,me=s.unstable_requestPaint,Ce=s.unstable_now,Jt=s.unstable_getCurrentPriorityLevel,qn=s.unstable_ImmediatePriority,wa=s.unstable_UserBlockingPriority,Ye=s.unstable_NormalPriority,eo=s.unstable_LowPriority,Xh=s.unstable_IdlePriority,kb=s.log,Eb=s.unstable_setDisableYieldValue,js=null,Qt=null;function mi(e){if(typeof kb=="function"&&Eb(e),Qt&&typeof Qt.setStrictMode=="function")try{Qt.setStrictMode(js,e)}catch{}}var Xt=Math.clz32?Math.clz32:Ob,Rb=Math.log,_b=Math.LN2;function Ob(e){return e>>>=0,e===0?32:31-(Rb(e)/_b|0)|0}var to=256,no=262144,io=4194304;function na(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ao(e,n,r){var c=e.pendingLanes;if(c===0)return 0;var h=0,p=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var S=c&134217727;return S!==0?(c=S&~p,c!==0?h=na(c):(y&=S,y!==0?h=na(y):r||(r=S&~e,r!==0&&(h=na(r))))):(S=c&~p,S!==0?h=na(S):y!==0?h=na(y):r||(r=c&~e,r!==0&&(h=na(r)))),h===0?0:n!==0&&n!==h&&(n&p)===0&&(p=h&-h,r=n&-n,p>=r||p===32&&(r&4194048)!==0)?n:h}function Bs(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function Ab(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zh(){var e=io;return io<<=1,(io&62914560)===0&&(io=4194304),e}function al(e){for(var n=[],r=0;31>r;r++)n.push(e);return n}function zs(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Db(e,n,r,c,h,p){var y=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var S=e.entanglements,k=e.expirationTimes,L=e.hiddenUpdates;for(r=y&~r;0<r;){var H=31-Xt(r),Y=1<<H;S[H]=0,k[H]=-1;var j=L[H];if(j!==null)for(L[H]=null,H=0;H<j.length;H++){var V=j[H];V!==null&&(V.lane&=-536870913)}r&=~Y}c!==0&&Wh(e,c,0),p!==0&&h===0&&e.tag!==0&&(e.suspendedLanes|=p&~(y&~n))}function Wh(e,n,r){e.pendingLanes|=n,e.suspendedLanes&=~n;var c=31-Xt(n);e.entangledLanes|=n,e.entanglements[c]=e.entanglements[c]|1073741824|r&261930}function $h(e,n){var r=e.entangledLanes|=n;for(e=e.entanglements;r;){var c=31-Xt(r),h=1<<c;h&n|e[c]&n&&(e[c]|=n),r&=~h}}function ef(e,n){var r=n&-n;return r=(r&42)!==0?1:sl(r),(r&(e.suspendedLanes|n))!==0?0:r}function sl(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function rl(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function tf(){var e=$.p;return e!==0?e:(e=window.event,e===void 0?32:qg(e.type))}function nf(e,n){var r=$.p;try{return $.p=e,n()}finally{$.p=r}}var pi=Math.random().toString(36).slice(2),Rt="__reactFiber$"+pi,jt="__reactProps$"+pi,xa="__reactContainer$"+pi,ol="__reactEvents$"+pi,Mb="__reactListeners$"+pi,wb="__reactHandles$"+pi,af="__reactResources$"+pi,qs="__reactMarker$"+pi;function cl(e){delete e[Rt],delete e[jt],delete e[ol],delete e[Mb],delete e[wb]}function Na(e){var n=e[Rt];if(n)return n;for(var r=e.parentNode;r;){if(n=r[xa]||r[Rt]){if(r=n.alternate,n.child!==null||r!==null&&r.child!==null)for(e=Rg(e);e!==null;){if(r=e[Rt])return r;e=Rg(e)}return n}e=r,r=e.parentNode}return null}function Pa(e){if(e=e[Rt]||e[xa]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function Vs(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(a(33))}function La(e){var n=e[af];return n||(n=e[af]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function St(e){e[qs]=!0}var sf=new Set,rf={};function ia(e,n){Ua(e,n),Ua(e+"Capture",n)}function Ua(e,n){for(rf[e]=n,e=0;e<n.length;e++)sf.add(n[e])}var xb=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),of={},cf={};function Nb(e){return Ma.call(cf,e)?!0:Ma.call(of,e)?!1:xb.test(e)?cf[e]=!0:(of[e]=!0,!1)}function so(e,n,r){if(Nb(n))if(r===null)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var c=n.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+r)}}function ro(e,n,r){if(r===null)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+r)}}function Vn(e,n,r,c){if(c===null)e.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttributeNS(n,r,""+c)}}function rn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function lf(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Pb(e,n,r){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var h=c.get,p=c.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return h.call(this)},set:function(y){r=""+y,p.call(this,y)}}),Object.defineProperty(e,n,{enumerable:c.enumerable}),{getValue:function(){return r},setValue:function(y){r=""+y},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function ll(e){if(!e._valueTracker){var n=lf(e)?"checked":"value";e._valueTracker=Pb(e,n,""+e[n])}}function uf(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var r=n.getValue(),c="";return e&&(c=lf(e)?e.checked?"true":"false":e.value),e=c,e!==r?(n.setValue(e),!0):!1}function oo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Lb=/[\n"\\]/g;function on(e){return e.replace(Lb,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function ul(e,n,r,c,h,p,y,S){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),n!=null?y==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+rn(n)):e.value!==""+rn(n)&&(e.value=""+rn(n)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),n!=null?dl(e,y,rn(n)):r!=null?dl(e,y,rn(r)):c!=null&&e.removeAttribute("value"),h==null&&p!=null&&(e.defaultChecked=!!p),h!=null&&(e.checked=h&&typeof h!="function"&&typeof h!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.name=""+rn(S):e.removeAttribute("name")}function df(e,n,r,c,h,p,y,S){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(e.type=p),n!=null||r!=null){if(!(p!=="submit"&&p!=="reset"||n!=null)){ll(e);return}r=r!=null?""+rn(r):"",n=n!=null?""+rn(n):r,S||n===e.value||(e.value=n),e.defaultValue=n}c=c??h,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=S?e.checked:!!c,e.defaultChecked=!!c,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y),ll(e)}function dl(e,n,r){n==="number"&&oo(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function Ia(e,n,r,c){if(e=e.options,n){n={};for(var h=0;h<r.length;h++)n["$"+r[h]]=!0;for(r=0;r<e.length;r++)h=n.hasOwnProperty("$"+e[r].value),e[r].selected!==h&&(e[r].selected=h),h&&c&&(e[r].defaultSelected=!0)}else{for(r=""+rn(r),n=null,h=0;h<e.length;h++){if(e[h].value===r){e[h].selected=!0,c&&(e[h].defaultSelected=!0);return}n!==null||e[h].disabled||(n=e[h])}n!==null&&(n.selected=!0)}}function hf(e,n,r){if(n!=null&&(n=""+rn(n),n!==e.value&&(e.value=n),r==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=r!=null?""+rn(r):""}function ff(e,n,r,c){if(n==null){if(c!=null){if(r!=null)throw Error(a(92));if(ae(c)){if(1<c.length)throw Error(a(93));c=c[0]}r=c}r==null&&(r=""),n=r}r=rn(n),e.defaultValue=r,c=e.textContent,c===r&&c!==""&&c!==null&&(e.value=c),ll(e)}function ja(e,n){if(n){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=n;return}}e.textContent=n}var Ub=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function mf(e,n,r){var c=n.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?c?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":c?e.setProperty(n,r):typeof r!="number"||r===0||Ub.has(n)?n==="float"?e.cssFloat=r:e[n]=(""+r).trim():e[n]=r+"px"}function pf(e,n,r){if(n!=null&&typeof n!="object")throw Error(a(62));if(e=e.style,r!=null){for(var c in r)!r.hasOwnProperty(c)||n!=null&&n.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var h in n)c=n[h],n.hasOwnProperty(h)&&r[h]!==c&&mf(e,h,c)}else for(var p in n)n.hasOwnProperty(p)&&mf(e,p,n[p])}function hl(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ib=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),jb=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function co(e){return jb.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Fn(){}var fl=null;function ml(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ba=null,za=null;function gf(e){var n=Pa(e);if(n&&(e=n.stateNode)){var r=e[jt]||null;e:switch(e=n.stateNode,n.type){case"input":if(ul(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),n=r.name,r.type==="radio"&&n!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+on(""+n)+'"][type="radio"]'),n=0;n<r.length;n++){var c=r[n];if(c!==e&&c.form===e.form){var h=c[jt]||null;if(!h)throw Error(a(90));ul(c,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name)}}for(n=0;n<r.length;n++)c=r[n],c.form===e.form&&uf(c)}break e;case"textarea":hf(e,r.value,r.defaultValue);break e;case"select":n=r.value,n!=null&&Ia(e,!!r.multiple,n,!1)}}}var pl=!1;function vf(e,n,r){if(pl)return e(n,r);pl=!0;try{var c=e(n);return c}finally{if(pl=!1,(Ba!==null||za!==null)&&(Xo(),Ba&&(n=Ba,e=za,za=Ba=null,gf(n),e)))for(n=0;n<e.length;n++)gf(e[n])}}function Fs(e,n){var r=e.stateNode;if(r===null)return null;var c=r[jt]||null;if(c===null)return null;r=c[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(a(231,n,typeof r));return r}var Hn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gl=!1;if(Hn)try{var Hs={};Object.defineProperty(Hs,"passive",{get:function(){gl=!0}}),window.addEventListener("test",Hs,Hs),window.removeEventListener("test",Hs,Hs)}catch{gl=!1}var gi=null,vl=null,lo=null;function yf(){if(lo)return lo;var e,n=vl,r=n.length,c,h="value"in gi?gi.value:gi.textContent,p=h.length;for(e=0;e<r&&n[e]===h[e];e++);var y=r-e;for(c=1;c<=y&&n[r-c]===h[p-c];c++);return lo=h.slice(e,1<c?1-c:void 0)}function uo(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function ho(){return!0}function bf(){return!1}function Bt(e){function n(r,c,h,p,y){this._reactName=r,this._targetInst=h,this.type=c,this.nativeEvent=p,this.target=y,this.currentTarget=null;for(var S in e)e.hasOwnProperty(S)&&(r=e[S],this[S]=r?r(p):p[S]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?ho:bf,this.isPropagationStopped=bf,this}return v(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=ho)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=ho)},persist:function(){},isPersistent:ho}),n}var aa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fo=Bt(aa),Gs=v({},aa,{view:0,detail:0}),Bb=Bt(Gs),yl,bl,Ks,mo=v({},Gs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tl,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ks&&(Ks&&e.type==="mousemove"?(yl=e.screenX-Ks.screenX,bl=e.screenY-Ks.screenY):bl=yl=0,Ks=e),yl)},movementY:function(e){return"movementY"in e?e.movementY:bl}}),Sf=Bt(mo),zb=v({},mo,{dataTransfer:0}),qb=Bt(zb),Vb=v({},Gs,{relatedTarget:0}),Sl=Bt(Vb),Fb=v({},aa,{animationName:0,elapsedTime:0,pseudoElement:0}),Hb=Bt(Fb),Gb=v({},aa,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Kb=Bt(Gb),Yb=v({},aa,{data:0}),Tf=Bt(Yb),Jb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Zb(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=Xb[e])?!!n[e]:!1}function Tl(){return Zb}var Wb=v({},Gs,{key:function(e){if(e.key){var n=Jb[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=uo(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Qb[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tl,charCode:function(e){return e.type==="keypress"?uo(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?uo(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),$b=Bt(Wb),eS=v({},mo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cf=Bt(eS),tS=v({},Gs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tl}),nS=Bt(tS),iS=v({},aa,{propertyName:0,elapsedTime:0,pseudoElement:0}),aS=Bt(iS),sS=v({},mo,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),rS=Bt(sS),oS=v({},aa,{newState:0,oldState:0}),cS=Bt(oS),lS=[9,13,27,32],Cl=Hn&&"CompositionEvent"in window,Ys=null;Hn&&"documentMode"in document&&(Ys=document.documentMode);var uS=Hn&&"TextEvent"in window&&!Ys,kf=Hn&&(!Cl||Ys&&8<Ys&&11>=Ys),Ef=" ",Rf=!1;function _f(e,n){switch(e){case"keyup":return lS.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Of(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var qa=!1;function dS(e,n){switch(e){case"compositionend":return Of(n);case"keypress":return n.which!==32?null:(Rf=!0,Ef);case"textInput":return e=n.data,e===Ef&&Rf?null:e;default:return null}}function hS(e,n){if(qa)return e==="compositionend"||!Cl&&_f(e,n)?(e=yf(),lo=vl=gi=null,qa=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return kf&&n.locale!=="ko"?null:n.data;default:return null}}var fS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Af(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!fS[e.type]:n==="textarea"}function Df(e,n,r,c){Ba?za?za.push(c):za=[c]:Ba=c,n=ic(n,"onChange"),0<n.length&&(r=new fo("onChange","change",null,r,c),e.push({event:r,listeners:n}))}var Js=null,Qs=null;function mS(e){dg(e,0)}function po(e){var n=Vs(e);if(uf(n))return e}function Mf(e,n){if(e==="change")return n}var wf=!1;if(Hn){var kl;if(Hn){var El="oninput"in document;if(!El){var xf=document.createElement("div");xf.setAttribute("oninput","return;"),El=typeof xf.oninput=="function"}kl=El}else kl=!1;wf=kl&&(!document.documentMode||9<document.documentMode)}function Nf(){Js&&(Js.detachEvent("onpropertychange",Pf),Qs=Js=null)}function Pf(e){if(e.propertyName==="value"&&po(Qs)){var n=[];Df(n,Qs,e,ml(e)),vf(mS,n)}}function pS(e,n,r){e==="focusin"?(Nf(),Js=n,Qs=r,Js.attachEvent("onpropertychange",Pf)):e==="focusout"&&Nf()}function gS(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return po(Qs)}function vS(e,n){if(e==="click")return po(n)}function yS(e,n){if(e==="input"||e==="change")return po(n)}function bS(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Zt=typeof Object.is=="function"?Object.is:bS;function Xs(e,n){if(Zt(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var r=Object.keys(e),c=Object.keys(n);if(r.length!==c.length)return!1;for(c=0;c<r.length;c++){var h=r[c];if(!Ma.call(n,h)||!Zt(e[h],n[h]))return!1}return!0}function Lf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Uf(e,n){var r=Lf(e);e=0;for(var c;r;){if(r.nodeType===3){if(c=e+r.textContent.length,e<=n&&c>=n)return{node:r,offset:n-e};e=c}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Lf(r)}}function If(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?If(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function jf(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=oo(e.document);n instanceof e.HTMLIFrameElement;){try{var r=typeof n.contentWindow.location.href=="string"}catch{r=!1}if(r)e=n.contentWindow;else break;n=oo(e.document)}return n}function Rl(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var SS=Hn&&"documentMode"in document&&11>=document.documentMode,Va=null,_l=null,Zs=null,Ol=!1;function Bf(e,n,r){var c=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Ol||Va==null||Va!==oo(c)||(c=Va,"selectionStart"in c&&Rl(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Zs&&Xs(Zs,c)||(Zs=c,c=ic(_l,"onSelect"),0<c.length&&(n=new fo("onSelect","select",null,n,r),e.push({event:n,listeners:c}),n.target=Va)))}function sa(e,n){var r={};return r[e.toLowerCase()]=n.toLowerCase(),r["Webkit"+e]="webkit"+n,r["Moz"+e]="moz"+n,r}var Fa={animationend:sa("Animation","AnimationEnd"),animationiteration:sa("Animation","AnimationIteration"),animationstart:sa("Animation","AnimationStart"),transitionrun:sa("Transition","TransitionRun"),transitionstart:sa("Transition","TransitionStart"),transitioncancel:sa("Transition","TransitionCancel"),transitionend:sa("Transition","TransitionEnd")},Al={},zf={};Hn&&(zf=document.createElement("div").style,"AnimationEvent"in window||(delete Fa.animationend.animation,delete Fa.animationiteration.animation,delete Fa.animationstart.animation),"TransitionEvent"in window||delete Fa.transitionend.transition);function ra(e){if(Al[e])return Al[e];if(!Fa[e])return e;var n=Fa[e],r;for(r in n)if(n.hasOwnProperty(r)&&r in zf)return Al[e]=n[r];return e}var qf=ra("animationend"),Vf=ra("animationiteration"),Ff=ra("animationstart"),TS=ra("transitionrun"),CS=ra("transitionstart"),kS=ra("transitioncancel"),Hf=ra("transitionend"),Gf=new Map,Dl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Dl.push("scrollEnd");function bn(e,n){Gf.set(e,n),ia(n,[e])}var go=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},cn=[],Ha=0,Ml=0;function vo(){for(var e=Ha,n=Ml=Ha=0;n<e;){var r=cn[n];cn[n++]=null;var c=cn[n];cn[n++]=null;var h=cn[n];cn[n++]=null;var p=cn[n];if(cn[n++]=null,c!==null&&h!==null){var y=c.pending;y===null?h.next=h:(h.next=y.next,y.next=h),c.pending=h}p!==0&&Kf(r,h,p)}}function yo(e,n,r,c){cn[Ha++]=e,cn[Ha++]=n,cn[Ha++]=r,cn[Ha++]=c,Ml|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function wl(e,n,r,c){return yo(e,n,r,c),bo(e)}function oa(e,n){return yo(e,null,null,n),bo(e)}function Kf(e,n,r){e.lanes|=r;var c=e.alternate;c!==null&&(c.lanes|=r);for(var h=!1,p=e.return;p!==null;)p.childLanes|=r,c=p.alternate,c!==null&&(c.childLanes|=r),p.tag===22&&(e=p.stateNode,e===null||e._visibility&1||(h=!0)),e=p,p=p.return;return e.tag===3?(p=e.stateNode,h&&n!==null&&(h=31-Xt(r),e=p.hiddenUpdates,c=e[h],c===null?e[h]=[n]:c.push(n),n.lane=r|536870912),p):null}function bo(e){if(50<br)throw br=0,zu=null,Error(a(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Ga={};function ES(e,n,r,c){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wt(e,n,r,c){return new ES(e,n,r,c)}function xl(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Gn(e,n){var r=e.alternate;return r===null?(r=Wt(e.tag,n,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=n,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&65011712,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,n=e.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function Yf(e,n){e.flags&=65011714;var r=e.alternate;return r===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,n=r.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function So(e,n,r,c,h,p){var y=0;if(c=e,typeof e=="function")xl(e)&&(y=1);else if(typeof e=="string")y=DT(e,r,ee.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case oe:return e=Wt(31,r,n,h),e.elementType=oe,e.lanes=p,e;case O:return ca(r.children,h,p,n);case B:y=8,h|=24;break;case w:return e=Wt(12,r,n,h|2),e.elementType=w,e.lanes=p,e;case _:return e=Wt(13,r,n,h),e.elementType=_,e.lanes=p,e;case I:return e=Wt(19,r,n,h),e.elementType=I,e.lanes=p,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case K:y=10;break e;case X:y=9;break e;case A:y=11;break e;case q:y=14;break e;case W:y=16,c=null;break e}y=29,r=Error(a(130,e===null?"null":typeof e,"")),c=null}return n=Wt(y,r,n,h),n.elementType=e,n.type=c,n.lanes=p,n}function ca(e,n,r,c){return e=Wt(7,e,c,n),e.lanes=r,e}function Nl(e,n,r){return e=Wt(6,e,null,n),e.lanes=r,e}function Jf(e){var n=Wt(18,null,null,0);return n.stateNode=e,n}function Pl(e,n,r){return n=Wt(4,e.children!==null?e.children:[],e.key,n),n.lanes=r,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Qf=new WeakMap;function ln(e,n){if(typeof e=="object"&&e!==null){var r=Qf.get(e);return r!==void 0?r:(n={value:e,source:n,stack:$r(n)},Qf.set(e,n),n)}return{value:e,source:n,stack:$r(n)}}var Ka=[],Ya=0,To=null,Ws=0,un=[],dn=0,vi=null,Dn=1,Mn="";function Kn(e,n){Ka[Ya++]=Ws,Ka[Ya++]=To,To=e,Ws=n}function Xf(e,n,r){un[dn++]=Dn,un[dn++]=Mn,un[dn++]=vi,vi=e;var c=Dn;e=Mn;var h=32-Xt(c)-1;c&=~(1<<h),r+=1;var p=32-Xt(n)+h;if(30<p){var y=h-h%5;p=(c&(1<<y)-1).toString(32),c>>=y,h-=y,Dn=1<<32-Xt(n)+h|r<<h|c,Mn=p+e}else Dn=1<<p|r<<h|c,Mn=e}function Ll(e){e.return!==null&&(Kn(e,1),Xf(e,1,0))}function Ul(e){for(;e===To;)To=Ka[--Ya],Ka[Ya]=null,Ws=Ka[--Ya],Ka[Ya]=null;for(;e===vi;)vi=un[--dn],un[dn]=null,Mn=un[--dn],un[dn]=null,Dn=un[--dn],un[dn]=null}function Zf(e,n){un[dn++]=Dn,un[dn++]=Mn,un[dn++]=vi,Dn=n.id,Mn=n.overflow,vi=e}var _t=null,Xe=null,Pe=!1,yi=null,hn=!1,Il=Error(a(519));function bi(e){var n=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw $s(ln(n,e)),Il}function Wf(e){var n=e.stateNode,r=e.type,c=e.memoizedProps;switch(n[Rt]=e,n[jt]=c,r){case"dialog":De("cancel",n),De("close",n);break;case"iframe":case"object":case"embed":De("load",n);break;case"video":case"audio":for(r=0;r<Tr.length;r++)De(Tr[r],n);break;case"source":De("error",n);break;case"img":case"image":case"link":De("error",n),De("load",n);break;case"details":De("toggle",n);break;case"input":De("invalid",n),df(n,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":De("invalid",n);break;case"textarea":De("invalid",n),ff(n,c.value,c.defaultValue,c.children)}r=c.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||n.textContent===""+r||c.suppressHydrationWarning===!0||pg(n.textContent,r)?(c.popover!=null&&(De("beforetoggle",n),De("toggle",n)),c.onScroll!=null&&De("scroll",n),c.onScrollEnd!=null&&De("scrollend",n),c.onClick!=null&&(n.onclick=Fn),n=!0):n=!1,n||bi(e,!0)}function $f(e){for(_t=e.return;_t;)switch(_t.tag){case 5:case 31:case 13:hn=!1;return;case 27:case 3:hn=!0;return;default:_t=_t.return}}function Ja(e){if(e!==_t)return!1;if(!Pe)return $f(e),Pe=!0,!1;var n=e.tag,r;if((r=n!==3&&n!==27)&&((r=n===5)&&(r=e.type,r=!(r!=="form"&&r!=="button")||td(e.type,e.memoizedProps)),r=!r),r&&Xe&&bi(e),$f(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));Xe=Eg(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));Xe=Eg(e)}else n===27?(n=Xe,Ni(e.type)?(e=rd,rd=null,Xe=e):Xe=n):Xe=_t?mn(e.stateNode.nextSibling):null;return!0}function la(){Xe=_t=null,Pe=!1}function jl(){var e=yi;return e!==null&&(Ft===null?Ft=e:Ft.push.apply(Ft,e),yi=null),e}function $s(e){yi===null?yi=[e]:yi.push(e)}var Bl=E(null),ua=null,Yn=null;function Si(e,n,r){ne(Bl,n._currentValue),n._currentValue=r}function Jn(e){e._currentValue=Bl.current,F(Bl)}function zl(e,n,r){for(;e!==null;){var c=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),e===r)break;e=e.return}}function ql(e,n,r,c){var h=e.child;for(h!==null&&(h.return=e);h!==null;){var p=h.dependencies;if(p!==null){var y=h.child;p=p.firstContext;e:for(;p!==null;){var S=p;p=h;for(var k=0;k<n.length;k++)if(S.context===n[k]){p.lanes|=r,S=p.alternate,S!==null&&(S.lanes|=r),zl(p.return,r,e),c||(y=null);break e}p=S.next}}else if(h.tag===18){if(y=h.return,y===null)throw Error(a(341));y.lanes|=r,p=y.alternate,p!==null&&(p.lanes|=r),zl(y,r,e),y=null}else y=h.child;if(y!==null)y.return=h;else for(y=h;y!==null;){if(y===e){y=null;break}if(h=y.sibling,h!==null){h.return=y.return,y=h;break}y=y.return}h=y}}function Qa(e,n,r,c){e=null;for(var h=n,p=!1;h!==null;){if(!p){if((h.flags&524288)!==0)p=!0;else if((h.flags&262144)!==0)break}if(h.tag===10){var y=h.alternate;if(y===null)throw Error(a(387));if(y=y.memoizedProps,y!==null){var S=h.type;Zt(h.pendingProps.value,y.value)||(e!==null?e.push(S):e=[S])}}else if(h===Le.current){if(y=h.alternate,y===null)throw Error(a(387));y.memoizedState.memoizedState!==h.memoizedState.memoizedState&&(e!==null?e.push(_r):e=[_r])}h=h.return}e!==null&&ql(n,e,r,c),n.flags|=262144}function Co(e){for(e=e.firstContext;e!==null;){if(!Zt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function da(e){ua=e,Yn=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Ot(e){return em(ua,e)}function ko(e,n){return ua===null&&da(e),em(e,n)}function em(e,n){var r=n._currentValue;if(n={context:n,memoizedValue:r,next:null},Yn===null){if(e===null)throw Error(a(308));Yn=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Yn=Yn.next=n;return r}var RS=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(r,c){e.push(c)}};this.abort=function(){n.aborted=!0,e.forEach(function(r){return r()})}},_S=s.unstable_scheduleCallback,OS=s.unstable_NormalPriority,ht={$$typeof:K,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Vl(){return{controller:new RS,data:new Map,refCount:0}}function er(e){e.refCount--,e.refCount===0&&_S(OS,function(){e.controller.abort()})}var tr=null,Fl=0,Xa=0,Za=null;function AS(e,n){if(tr===null){var r=tr=[];Fl=0,Xa=Ku(),Za={status:"pending",value:void 0,then:function(c){r.push(c)}}}return Fl++,n.then(tm,tm),n}function tm(){if(--Fl===0&&tr!==null){Za!==null&&(Za.status="fulfilled");var e=tr;tr=null,Xa=0,Za=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function DS(e,n){var r=[],c={status:"pending",value:null,reason:null,then:function(h){r.push(h)}};return e.then(function(){c.status="fulfilled",c.value=n;for(var h=0;h<r.length;h++)(0,r[h])(n)},function(h){for(c.status="rejected",c.reason=h,h=0;h<r.length;h++)(0,r[h])(void 0)}),c}var nm=x.S;x.S=function(e,n){Bp=Ce(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&AS(e,n),nm!==null&&nm(e,n)};var ha=E(null);function Hl(){var e=ha.current;return e!==null?e:Je.pooledCache}function Eo(e,n){n===null?ne(ha,ha.current):ne(ha,n.pool)}function im(){var e=Hl();return e===null?null:{parent:ht._currentValue,pool:e}}var Wa=Error(a(460)),Gl=Error(a(474)),Ro=Error(a(542)),_o={then:function(){}};function am(e){return e=e.status,e==="fulfilled"||e==="rejected"}function sm(e,n,r){switch(r=e[r],r===void 0?e.push(n):r!==n&&(n.then(Fn,Fn),n=r),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,om(e),e;default:if(typeof n.status=="string")n.then(Fn,Fn);else{if(e=Je,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=n,e.status="pending",e.then(function(c){if(n.status==="pending"){var h=n;h.status="fulfilled",h.value=c}},function(c){if(n.status==="pending"){var h=n;h.status="rejected",h.reason=c}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,om(e),e}throw ma=n,Wa}}function fa(e){try{var n=e._init;return n(e._payload)}catch(r){throw r!==null&&typeof r=="object"&&typeof r.then=="function"?(ma=r,Wa):r}}var ma=null;function rm(){if(ma===null)throw Error(a(459));var e=ma;return ma=null,e}function om(e){if(e===Wa||e===Ro)throw Error(a(483))}var $a=null,nr=0;function Oo(e){var n=nr;return nr+=1,$a===null&&($a=[]),sm($a,e,n)}function ir(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Ao(e,n){throw n.$$typeof===b?Error(a(525)):(e=Object.prototype.toString.call(n),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function cm(e){function n(D,R){if(e){var P=D.deletions;P===null?(D.deletions=[R],D.flags|=16):P.push(R)}}function r(D,R){if(!e)return null;for(;R!==null;)n(D,R),R=R.sibling;return null}function c(D){for(var R=new Map;D!==null;)D.key!==null?R.set(D.key,D):R.set(D.index,D),D=D.sibling;return R}function h(D,R){return D=Gn(D,R),D.index=0,D.sibling=null,D}function p(D,R,P){return D.index=P,e?(P=D.alternate,P!==null?(P=P.index,P<R?(D.flags|=67108866,R):P):(D.flags|=67108866,R)):(D.flags|=1048576,R)}function y(D){return e&&D.alternate===null&&(D.flags|=67108866),D}function S(D,R,P,G){return R===null||R.tag!==6?(R=Nl(P,D.mode,G),R.return=D,R):(R=h(R,P),R.return=D,R)}function k(D,R,P,G){var ge=P.type;return ge===O?H(D,R,P.props.children,G,P.key):R!==null&&(R.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===W&&fa(ge)===R.type)?(R=h(R,P.props),ir(R,P),R.return=D,R):(R=So(P.type,P.key,P.props,null,D.mode,G),ir(R,P),R.return=D,R)}function L(D,R,P,G){return R===null||R.tag!==4||R.stateNode.containerInfo!==P.containerInfo||R.stateNode.implementation!==P.implementation?(R=Pl(P,D.mode,G),R.return=D,R):(R=h(R,P.children||[]),R.return=D,R)}function H(D,R,P,G,ge){return R===null||R.tag!==7?(R=ca(P,D.mode,G,ge),R.return=D,R):(R=h(R,P),R.return=D,R)}function Y(D,R,P){if(typeof R=="string"&&R!==""||typeof R=="number"||typeof R=="bigint")return R=Nl(""+R,D.mode,P),R.return=D,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case C:return P=So(R.type,R.key,R.props,null,D.mode,P),ir(P,R),P.return=D,P;case M:return R=Pl(R,D.mode,P),R.return=D,R;case W:return R=fa(R),Y(D,R,P)}if(ae(R)||pe(R))return R=ca(R,D.mode,P,null),R.return=D,R;if(typeof R.then=="function")return Y(D,Oo(R),P);if(R.$$typeof===K)return Y(D,ko(D,R),P);Ao(D,R)}return null}function j(D,R,P,G){var ge=R!==null?R.key:null;if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return ge!==null?null:S(D,R,""+P,G);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case C:return P.key===ge?k(D,R,P,G):null;case M:return P.key===ge?L(D,R,P,G):null;case W:return P=fa(P),j(D,R,P,G)}if(ae(P)||pe(P))return ge!==null?null:H(D,R,P,G,null);if(typeof P.then=="function")return j(D,R,Oo(P),G);if(P.$$typeof===K)return j(D,R,ko(D,P),G);Ao(D,P)}return null}function V(D,R,P,G,ge){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return D=D.get(P)||null,S(R,D,""+G,ge);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case C:return D=D.get(G.key===null?P:G.key)||null,k(R,D,G,ge);case M:return D=D.get(G.key===null?P:G.key)||null,L(R,D,G,ge);case W:return G=fa(G),V(D,R,P,G,ge)}if(ae(G)||pe(G))return D=D.get(P)||null,H(R,D,G,ge,null);if(typeof G.then=="function")return V(D,R,P,Oo(G),ge);if(G.$$typeof===K)return V(D,R,P,ko(R,G),ge);Ao(R,G)}return null}function de(D,R,P,G){for(var ge=null,Ie=null,fe=R,Ee=R=0,Ne=null;fe!==null&&Ee<P.length;Ee++){fe.index>Ee?(Ne=fe,fe=null):Ne=fe.sibling;var je=j(D,fe,P[Ee],G);if(je===null){fe===null&&(fe=Ne);break}e&&fe&&je.alternate===null&&n(D,fe),R=p(je,R,Ee),Ie===null?ge=je:Ie.sibling=je,Ie=je,fe=Ne}if(Ee===P.length)return r(D,fe),Pe&&Kn(D,Ee),ge;if(fe===null){for(;Ee<P.length;Ee++)fe=Y(D,P[Ee],G),fe!==null&&(R=p(fe,R,Ee),Ie===null?ge=fe:Ie.sibling=fe,Ie=fe);return Pe&&Kn(D,Ee),ge}for(fe=c(fe);Ee<P.length;Ee++)Ne=V(fe,D,Ee,P[Ee],G),Ne!==null&&(e&&Ne.alternate!==null&&fe.delete(Ne.key===null?Ee:Ne.key),R=p(Ne,R,Ee),Ie===null?ge=Ne:Ie.sibling=Ne,Ie=Ne);return e&&fe.forEach(function(ji){return n(D,ji)}),Pe&&Kn(D,Ee),ge}function ve(D,R,P,G){if(P==null)throw Error(a(151));for(var ge=null,Ie=null,fe=R,Ee=R=0,Ne=null,je=P.next();fe!==null&&!je.done;Ee++,je=P.next()){fe.index>Ee?(Ne=fe,fe=null):Ne=fe.sibling;var ji=j(D,fe,je.value,G);if(ji===null){fe===null&&(fe=Ne);break}e&&fe&&ji.alternate===null&&n(D,fe),R=p(ji,R,Ee),Ie===null?ge=ji:Ie.sibling=ji,Ie=ji,fe=Ne}if(je.done)return r(D,fe),Pe&&Kn(D,Ee),ge;if(fe===null){for(;!je.done;Ee++,je=P.next())je=Y(D,je.value,G),je!==null&&(R=p(je,R,Ee),Ie===null?ge=je:Ie.sibling=je,Ie=je);return Pe&&Kn(D,Ee),ge}for(fe=c(fe);!je.done;Ee++,je=P.next())je=V(fe,D,Ee,je.value,G),je!==null&&(e&&je.alternate!==null&&fe.delete(je.key===null?Ee:je.key),R=p(je,R,Ee),Ie===null?ge=je:Ie.sibling=je,Ie=je);return e&&fe.forEach(function(zT){return n(D,zT)}),Pe&&Kn(D,Ee),ge}function Ge(D,R,P,G){if(typeof P=="object"&&P!==null&&P.type===O&&P.key===null&&(P=P.props.children),typeof P=="object"&&P!==null){switch(P.$$typeof){case C:e:{for(var ge=P.key;R!==null;){if(R.key===ge){if(ge=P.type,ge===O){if(R.tag===7){r(D,R.sibling),G=h(R,P.props.children),G.return=D,D=G;break e}}else if(R.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===W&&fa(ge)===R.type){r(D,R.sibling),G=h(R,P.props),ir(G,P),G.return=D,D=G;break e}r(D,R);break}else n(D,R);R=R.sibling}P.type===O?(G=ca(P.props.children,D.mode,G,P.key),G.return=D,D=G):(G=So(P.type,P.key,P.props,null,D.mode,G),ir(G,P),G.return=D,D=G)}return y(D);case M:e:{for(ge=P.key;R!==null;){if(R.key===ge)if(R.tag===4&&R.stateNode.containerInfo===P.containerInfo&&R.stateNode.implementation===P.implementation){r(D,R.sibling),G=h(R,P.children||[]),G.return=D,D=G;break e}else{r(D,R);break}else n(D,R);R=R.sibling}G=Pl(P,D.mode,G),G.return=D,D=G}return y(D);case W:return P=fa(P),Ge(D,R,P,G)}if(ae(P))return de(D,R,P,G);if(pe(P)){if(ge=pe(P),typeof ge!="function")throw Error(a(150));return P=ge.call(P),ve(D,R,P,G)}if(typeof P.then=="function")return Ge(D,R,Oo(P),G);if(P.$$typeof===K)return Ge(D,R,ko(D,P),G);Ao(D,P)}return typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint"?(P=""+P,R!==null&&R.tag===6?(r(D,R.sibling),G=h(R,P),G.return=D,D=G):(r(D,R),G=Nl(P,D.mode,G),G.return=D,D=G),y(D)):r(D,R)}return function(D,R,P,G){try{nr=0;var ge=Ge(D,R,P,G);return $a=null,ge}catch(fe){if(fe===Wa||fe===Ro)throw fe;var Ie=Wt(29,fe,null,D.mode);return Ie.lanes=G,Ie.return=D,Ie}finally{}}}var pa=cm(!0),lm=cm(!1),Ti=!1;function Kl(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yl(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ci(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ki(e,n,r){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(Be&2)!==0){var h=c.pending;return h===null?n.next=n:(n.next=h.next,h.next=n),c.pending=n,n=bo(e),Kf(e,null,r),n}return yo(e,c,n,r),bo(e)}function ar(e,n,r){if(n=n.updateQueue,n!==null&&(n=n.shared,(r&4194048)!==0)){var c=n.lanes;c&=e.pendingLanes,r|=c,n.lanes=r,$h(e,r)}}function Jl(e,n){var r=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,r===c)){var h=null,p=null;if(r=r.firstBaseUpdate,r!==null){do{var y={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};p===null?h=p=y:p=p.next=y,r=r.next}while(r!==null);p===null?h=p=n:p=p.next=n}else h=p=n;r={baseState:c.baseState,firstBaseUpdate:h,lastBaseUpdate:p,shared:c.shared,callbacks:c.callbacks},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=n:e.next=n,r.lastBaseUpdate=n}var Ql=!1;function sr(){if(Ql){var e=Za;if(e!==null)throw e}}function rr(e,n,r,c){Ql=!1;var h=e.updateQueue;Ti=!1;var p=h.firstBaseUpdate,y=h.lastBaseUpdate,S=h.shared.pending;if(S!==null){h.shared.pending=null;var k=S,L=k.next;k.next=null,y===null?p=L:y.next=L,y=k;var H=e.alternate;H!==null&&(H=H.updateQueue,S=H.lastBaseUpdate,S!==y&&(S===null?H.firstBaseUpdate=L:S.next=L,H.lastBaseUpdate=k))}if(p!==null){var Y=h.baseState;y=0,H=L=k=null,S=p;do{var j=S.lane&-536870913,V=j!==S.lane;if(V?(xe&j)===j:(c&j)===j){j!==0&&j===Xa&&(Ql=!0),H!==null&&(H=H.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var de=e,ve=S;j=n;var Ge=r;switch(ve.tag){case 1:if(de=ve.payload,typeof de=="function"){Y=de.call(Ge,Y,j);break e}Y=de;break e;case 3:de.flags=de.flags&-65537|128;case 0:if(de=ve.payload,j=typeof de=="function"?de.call(Ge,Y,j):de,j==null)break e;Y=v({},Y,j);break e;case 2:Ti=!0}}j=S.callback,j!==null&&(e.flags|=64,V&&(e.flags|=8192),V=h.callbacks,V===null?h.callbacks=[j]:V.push(j))}else V={lane:j,tag:S.tag,payload:S.payload,callback:S.callback,next:null},H===null?(L=H=V,k=Y):H=H.next=V,y|=j;if(S=S.next,S===null){if(S=h.shared.pending,S===null)break;V=S,S=V.next,V.next=null,h.lastBaseUpdate=V,h.shared.pending=null}}while(!0);H===null&&(k=Y),h.baseState=k,h.firstBaseUpdate=L,h.lastBaseUpdate=H,p===null&&(h.shared.lanes=0),Ai|=y,e.lanes=y,e.memoizedState=Y}}function um(e,n){if(typeof e!="function")throw Error(a(191,e));e.call(n)}function dm(e,n){var r=e.callbacks;if(r!==null)for(e.callbacks=null,e=0;e<r.length;e++)um(r[e],n)}var es=E(null),Do=E(0);function hm(e,n){e=ii,ne(Do,e),ne(es,n),ii=e|n.baseLanes}function Xl(){ne(Do,ii),ne(es,es.current)}function Zl(){ii=Do.current,F(es),F(Do)}var $t=E(null),fn=null;function Ei(e){var n=e.alternate;ne(ct,ct.current&1),ne($t,e),fn===null&&(n===null||es.current!==null||n.memoizedState!==null)&&(fn=e)}function Wl(e){ne(ct,ct.current),ne($t,e),fn===null&&(fn=e)}function fm(e){e.tag===22?(ne(ct,ct.current),ne($t,e),fn===null&&(fn=e)):Ri()}function Ri(){ne(ct,ct.current),ne($t,$t.current)}function en(e){F($t),fn===e&&(fn=null),F(ct)}var ct=E(0);function Mo(e){for(var n=e;n!==null;){if(n.tag===13){var r=n.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||ad(r)||sd(r)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Qn=0,ke=null,Fe=null,ft=null,wo=!1,ts=!1,ga=!1,xo=0,or=0,ns=null,MS=0;function it(){throw Error(a(321))}function $l(e,n){if(n===null)return!1;for(var r=0;r<n.length&&r<e.length;r++)if(!Zt(e[r],n[r]))return!1;return!0}function eu(e,n,r,c,h,p){return Qn=p,ke=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,x.H=e===null||e.memoizedState===null?Xm:pu,ga=!1,p=r(c,h),ga=!1,ts&&(p=pm(n,r,c,h)),mm(e),p}function mm(e){x.H=ur;var n=Fe!==null&&Fe.next!==null;if(Qn=0,ft=Fe=ke=null,wo=!1,or=0,ns=null,n)throw Error(a(300));e===null||mt||(e=e.dependencies,e!==null&&Co(e)&&(mt=!0))}function pm(e,n,r,c){ke=e;var h=0;do{if(ts&&(ns=null),or=0,ts=!1,25<=h)throw Error(a(301));if(h+=1,ft=Fe=null,e.updateQueue!=null){var p=e.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}x.H=Zm,p=n(r,c)}while(ts);return p}function wS(){var e=x.H,n=e.useState()[0];return n=typeof n.then=="function"?cr(n):n,e=e.useState()[0],(Fe!==null?Fe.memoizedState:null)!==e&&(ke.flags|=1024),n}function tu(){var e=xo!==0;return xo=0,e}function nu(e,n,r){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~r}function iu(e){if(wo){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}wo=!1}Qn=0,ft=Fe=ke=null,ts=!1,or=xo=0,ns=null}function Nt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ft===null?ke.memoizedState=ft=e:ft=ft.next=e,ft}function lt(){if(Fe===null){var e=ke.alternate;e=e!==null?e.memoizedState:null}else e=Fe.next;var n=ft===null?ke.memoizedState:ft.next;if(n!==null)ft=n,Fe=e;else{if(e===null)throw ke.alternate===null?Error(a(467)):Error(a(310));Fe=e,e={memoizedState:Fe.memoizedState,baseState:Fe.baseState,baseQueue:Fe.baseQueue,queue:Fe.queue,next:null},ft===null?ke.memoizedState=ft=e:ft=ft.next=e}return ft}function No(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function cr(e){var n=or;return or+=1,ns===null&&(ns=[]),e=sm(ns,e,n),n=ke,(ft===null?n.memoizedState:ft.next)===null&&(n=n.alternate,x.H=n===null||n.memoizedState===null?Xm:pu),e}function Po(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return cr(e);if(e.$$typeof===K)return Ot(e)}throw Error(a(438,String(e)))}function au(e){var n=null,r=ke.updateQueue;if(r!==null&&(n=r.memoCache),n==null){var c=ke.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(n={data:c.data.map(function(h){return h.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),r===null&&(r=No(),ke.updateQueue=r),r.memoCache=n,r=n.data[n.index],r===void 0)for(r=n.data[n.index]=Array(e),c=0;c<e;c++)r[c]=re;return n.index++,r}function Xn(e,n){return typeof n=="function"?n(e):n}function Lo(e){var n=lt();return su(n,Fe,e)}function su(e,n,r){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=r;var h=e.baseQueue,p=c.pending;if(p!==null){if(h!==null){var y=h.next;h.next=p.next,p.next=y}n.baseQueue=h=p,c.pending=null}if(p=e.baseState,h===null)e.memoizedState=p;else{n=h.next;var S=y=null,k=null,L=n,H=!1;do{var Y=L.lane&-536870913;if(Y!==L.lane?(xe&Y)===Y:(Qn&Y)===Y){var j=L.revertLane;if(j===0)k!==null&&(k=k.next={lane:0,revertLane:0,gesture:null,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null}),Y===Xa&&(H=!0);else if((Qn&j)===j){L=L.next,j===Xa&&(H=!0);continue}else Y={lane:0,revertLane:L.revertLane,gesture:null,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null},k===null?(S=k=Y,y=p):k=k.next=Y,ke.lanes|=j,Ai|=j;Y=L.action,ga&&r(p,Y),p=L.hasEagerState?L.eagerState:r(p,Y)}else j={lane:Y,revertLane:L.revertLane,gesture:L.gesture,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null},k===null?(S=k=j,y=p):k=k.next=j,ke.lanes|=Y,Ai|=Y;L=L.next}while(L!==null&&L!==n);if(k===null?y=p:k.next=S,!Zt(p,e.memoizedState)&&(mt=!0,H&&(r=Za,r!==null)))throw r;e.memoizedState=p,e.baseState=y,e.baseQueue=k,c.lastRenderedState=p}return h===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function ru(e){var n=lt(),r=n.queue;if(r===null)throw Error(a(311));r.lastRenderedReducer=e;var c=r.dispatch,h=r.pending,p=n.memoizedState;if(h!==null){r.pending=null;var y=h=h.next;do p=e(p,y.action),y=y.next;while(y!==h);Zt(p,n.memoizedState)||(mt=!0),n.memoizedState=p,n.baseQueue===null&&(n.baseState=p),r.lastRenderedState=p}return[p,c]}function gm(e,n,r){var c=ke,h=lt(),p=Pe;if(p){if(r===void 0)throw Error(a(407));r=r()}else r=n();var y=!Zt((Fe||h).memoizedState,r);if(y&&(h.memoizedState=r,mt=!0),h=h.queue,lu(bm.bind(null,c,h,e),[e]),h.getSnapshot!==n||y||ft!==null&&ft.memoizedState.tag&1){if(c.flags|=2048,is(9,{destroy:void 0},ym.bind(null,c,h,r,n),null),Je===null)throw Error(a(349));p||(Qn&127)!==0||vm(c,n,r)}return r}function vm(e,n,r){e.flags|=16384,e={getSnapshot:n,value:r},n=ke.updateQueue,n===null?(n=No(),ke.updateQueue=n,n.stores=[e]):(r=n.stores,r===null?n.stores=[e]:r.push(e))}function ym(e,n,r,c){n.value=r,n.getSnapshot=c,Sm(n)&&Tm(e)}function bm(e,n,r){return r(function(){Sm(n)&&Tm(e)})}function Sm(e){var n=e.getSnapshot;e=e.value;try{var r=n();return!Zt(e,r)}catch{return!0}}function Tm(e){var n=oa(e,2);n!==null&&Ht(n,e,2)}function ou(e){var n=Nt();if(typeof e=="function"){var r=e;if(e=r(),ga){mi(!0);try{r()}finally{mi(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:e},n}function Cm(e,n,r,c){return e.baseState=r,su(e,Fe,typeof c=="function"?c:Xn)}function xS(e,n,r,c,h){if(jo(e))throw Error(a(485));if(e=n.action,e!==null){var p={payload:h,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){p.listeners.push(y)}};x.T!==null?r(!0):p.isTransition=!1,c(p),r=n.pending,r===null?(p.next=n.pending=p,km(n,p)):(p.next=r.next,n.pending=r.next=p)}}function km(e,n){var r=n.action,c=n.payload,h=e.state;if(n.isTransition){var p=x.T,y={};x.T=y;try{var S=r(h,c),k=x.S;k!==null&&k(y,S),Em(e,n,S)}catch(L){cu(e,n,L)}finally{p!==null&&y.types!==null&&(p.types=y.types),x.T=p}}else try{p=r(h,c),Em(e,n,p)}catch(L){cu(e,n,L)}}function Em(e,n,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(c){Rm(e,n,c)},function(c){return cu(e,n,c)}):Rm(e,n,r)}function Rm(e,n,r){n.status="fulfilled",n.value=r,_m(n),e.state=r,n=e.pending,n!==null&&(r=n.next,r===n?e.pending=null:(r=r.next,n.next=r,km(e,r)))}function cu(e,n,r){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do n.status="rejected",n.reason=r,_m(n),n=n.next;while(n!==c)}e.action=null}function _m(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function Om(e,n){return n}function Am(e,n){if(Pe){var r=Je.formState;if(r!==null){e:{var c=ke;if(Pe){if(Xe){t:{for(var h=Xe,p=hn;h.nodeType!==8;){if(!p){h=null;break t}if(h=mn(h.nextSibling),h===null){h=null;break t}}p=h.data,h=p==="F!"||p==="F"?h:null}if(h){Xe=mn(h.nextSibling),c=h.data==="F!";break e}}bi(c)}c=!1}c&&(n=r[0])}}return r=Nt(),r.memoizedState=r.baseState=n,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Om,lastRenderedState:n},r.queue=c,r=Ym.bind(null,ke,c),c.dispatch=r,c=ou(!1),p=mu.bind(null,ke,!1,c.queue),c=Nt(),h={state:n,dispatch:null,action:e,pending:null},c.queue=h,r=xS.bind(null,ke,h,p,r),h.dispatch=r,c.memoizedState=e,[n,r,!1]}function Dm(e){var n=lt();return Mm(n,Fe,e)}function Mm(e,n,r){if(n=su(e,n,Om)[0],e=Lo(Xn)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var c=cr(n)}catch(y){throw y===Wa?Ro:y}else c=n;n=lt();var h=n.queue,p=h.dispatch;return r!==n.memoizedState&&(ke.flags|=2048,is(9,{destroy:void 0},NS.bind(null,h,r),null)),[c,p,e]}function NS(e,n){e.action=n}function wm(e){var n=lt(),r=Fe;if(r!==null)return Mm(n,r,e);lt(),n=n.memoizedState,r=lt();var c=r.queue.dispatch;return r.memoizedState=e,[n,c,!1]}function is(e,n,r,c){return e={tag:e,create:r,deps:c,inst:n,next:null},n=ke.updateQueue,n===null&&(n=No(),ke.updateQueue=n),r=n.lastEffect,r===null?n.lastEffect=e.next=e:(c=r.next,r.next=e,e.next=c,n.lastEffect=e),e}function xm(){return lt().memoizedState}function Uo(e,n,r,c){var h=Nt();ke.flags|=e,h.memoizedState=is(1|n,{destroy:void 0},r,c===void 0?null:c)}function Io(e,n,r,c){var h=lt();c=c===void 0?null:c;var p=h.memoizedState.inst;Fe!==null&&c!==null&&$l(c,Fe.memoizedState.deps)?h.memoizedState=is(n,p,r,c):(ke.flags|=e,h.memoizedState=is(1|n,p,r,c))}function Nm(e,n){Uo(8390656,8,e,n)}function lu(e,n){Io(2048,8,e,n)}function PS(e){ke.flags|=4;var n=ke.updateQueue;if(n===null)n=No(),ke.updateQueue=n,n.events=[e];else{var r=n.events;r===null?n.events=[e]:r.push(e)}}function Pm(e){var n=lt().memoizedState;return PS({ref:n,nextImpl:e}),function(){if((Be&2)!==0)throw Error(a(440));return n.impl.apply(void 0,arguments)}}function Lm(e,n){return Io(4,2,e,n)}function Um(e,n){return Io(4,4,e,n)}function Im(e,n){if(typeof n=="function"){e=e();var r=n(e);return function(){typeof r=="function"?r():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function jm(e,n,r){r=r!=null?r.concat([e]):null,Io(4,4,Im.bind(null,n,e),r)}function uu(){}function Bm(e,n){var r=lt();n=n===void 0?null:n;var c=r.memoizedState;return n!==null&&$l(n,c[1])?c[0]:(r.memoizedState=[e,n],e)}function zm(e,n){var r=lt();n=n===void 0?null:n;var c=r.memoizedState;if(n!==null&&$l(n,c[1]))return c[0];if(c=e(),ga){mi(!0);try{e()}finally{mi(!1)}}return r.memoizedState=[c,n],c}function du(e,n,r){return r===void 0||(Qn&1073741824)!==0&&(xe&261930)===0?e.memoizedState=n:(e.memoizedState=r,e=qp(),ke.lanes|=e,Ai|=e,r)}function qm(e,n,r,c){return Zt(r,n)?r:es.current!==null?(e=du(e,r,c),Zt(e,n)||(mt=!0),e):(Qn&42)===0||(Qn&1073741824)!==0&&(xe&261930)===0?(mt=!0,e.memoizedState=r):(e=qp(),ke.lanes|=e,Ai|=e,n)}function Vm(e,n,r,c,h){var p=$.p;$.p=p!==0&&8>p?p:8;var y=x.T,S={};x.T=S,mu(e,!1,n,r);try{var k=h(),L=x.S;if(L!==null&&L(S,k),k!==null&&typeof k=="object"&&typeof k.then=="function"){var H=DS(k,c);lr(e,n,H,an(e))}else lr(e,n,c,an(e))}catch(Y){lr(e,n,{then:function(){},status:"rejected",reason:Y},an())}finally{$.p=p,y!==null&&S.types!==null&&(y.types=S.types),x.T=y}}function LS(){}function hu(e,n,r,c){if(e.tag!==5)throw Error(a(476));var h=Fm(e).queue;Vm(e,h,n,ue,r===null?LS:function(){return Hm(e),r(c)})}function Fm(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:ue,baseState:ue,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:ue},next:null};var r={};return n.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:r},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function Hm(e){var n=Fm(e);n.next===null&&(n=e.alternate.memoizedState),lr(e,n.next.queue,{},an())}function fu(){return Ot(_r)}function Gm(){return lt().memoizedState}function Km(){return lt().memoizedState}function US(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var r=an();e=Ci(r);var c=ki(n,e,r);c!==null&&(Ht(c,n,r),ar(c,n,r)),n={cache:Vl()},e.payload=n;return}n=n.return}}function IS(e,n,r){var c=an();r={lane:c,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},jo(e)?Jm(n,r):(r=wl(e,n,r,c),r!==null&&(Ht(r,e,c),Qm(r,n,c)))}function Ym(e,n,r){var c=an();lr(e,n,r,c)}function lr(e,n,r,c){var h={lane:c,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null};if(jo(e))Jm(n,h);else{var p=e.alternate;if(e.lanes===0&&(p===null||p.lanes===0)&&(p=n.lastRenderedReducer,p!==null))try{var y=n.lastRenderedState,S=p(y,r);if(h.hasEagerState=!0,h.eagerState=S,Zt(S,y))return yo(e,n,h,0),Je===null&&vo(),!1}catch{}finally{}if(r=wl(e,n,h,c),r!==null)return Ht(r,e,c),Qm(r,n,c),!0}return!1}function mu(e,n,r,c){if(c={lane:2,revertLane:Ku(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},jo(e)){if(n)throw Error(a(479))}else n=wl(e,r,c,2),n!==null&&Ht(n,e,2)}function jo(e){var n=e.alternate;return e===ke||n!==null&&n===ke}function Jm(e,n){ts=wo=!0;var r=e.pending;r===null?n.next=n:(n.next=r.next,r.next=n),e.pending=n}function Qm(e,n,r){if((r&4194048)!==0){var c=n.lanes;c&=e.pendingLanes,r|=c,n.lanes=r,$h(e,r)}}var ur={readContext:Ot,use:Po,useCallback:it,useContext:it,useEffect:it,useImperativeHandle:it,useLayoutEffect:it,useInsertionEffect:it,useMemo:it,useReducer:it,useRef:it,useState:it,useDebugValue:it,useDeferredValue:it,useTransition:it,useSyncExternalStore:it,useId:it,useHostTransitionStatus:it,useFormState:it,useActionState:it,useOptimistic:it,useMemoCache:it,useCacheRefresh:it};ur.useEffectEvent=it;var Xm={readContext:Ot,use:Po,useCallback:function(e,n){return Nt().memoizedState=[e,n===void 0?null:n],e},useContext:Ot,useEffect:Nm,useImperativeHandle:function(e,n,r){r=r!=null?r.concat([e]):null,Uo(4194308,4,Im.bind(null,n,e),r)},useLayoutEffect:function(e,n){return Uo(4194308,4,e,n)},useInsertionEffect:function(e,n){Uo(4,2,e,n)},useMemo:function(e,n){var r=Nt();n=n===void 0?null:n;var c=e();if(ga){mi(!0);try{e()}finally{mi(!1)}}return r.memoizedState=[c,n],c},useReducer:function(e,n,r){var c=Nt();if(r!==void 0){var h=r(n);if(ga){mi(!0);try{r(n)}finally{mi(!1)}}}else h=n;return c.memoizedState=c.baseState=h,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:h},c.queue=e,e=e.dispatch=IS.bind(null,ke,e),[c.memoizedState,e]},useRef:function(e){var n=Nt();return e={current:e},n.memoizedState=e},useState:function(e){e=ou(e);var n=e.queue,r=Ym.bind(null,ke,n);return n.dispatch=r,[e.memoizedState,r]},useDebugValue:uu,useDeferredValue:function(e,n){var r=Nt();return du(r,e,n)},useTransition:function(){var e=ou(!1);return e=Vm.bind(null,ke,e.queue,!0,!1),Nt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,r){var c=ke,h=Nt();if(Pe){if(r===void 0)throw Error(a(407));r=r()}else{if(r=n(),Je===null)throw Error(a(349));(xe&127)!==0||vm(c,n,r)}h.memoizedState=r;var p={value:r,getSnapshot:n};return h.queue=p,Nm(bm.bind(null,c,p,e),[e]),c.flags|=2048,is(9,{destroy:void 0},ym.bind(null,c,p,r,n),null),r},useId:function(){var e=Nt(),n=Je.identifierPrefix;if(Pe){var r=Mn,c=Dn;r=(c&~(1<<32-Xt(c)-1)).toString(32)+r,n="_"+n+"R_"+r,r=xo++,0<r&&(n+="H"+r.toString(32)),n+="_"}else r=MS++,n="_"+n+"r_"+r.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:fu,useFormState:Am,useActionState:Am,useOptimistic:function(e){var n=Nt();n.memoizedState=n.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=r,n=mu.bind(null,ke,!0,r),r.dispatch=n,[e,n]},useMemoCache:au,useCacheRefresh:function(){return Nt().memoizedState=US.bind(null,ke)},useEffectEvent:function(e){var n=Nt(),r={impl:e};return n.memoizedState=r,function(){if((Be&2)!==0)throw Error(a(440));return r.impl.apply(void 0,arguments)}}},pu={readContext:Ot,use:Po,useCallback:Bm,useContext:Ot,useEffect:lu,useImperativeHandle:jm,useInsertionEffect:Lm,useLayoutEffect:Um,useMemo:zm,useReducer:Lo,useRef:xm,useState:function(){return Lo(Xn)},useDebugValue:uu,useDeferredValue:function(e,n){var r=lt();return qm(r,Fe.memoizedState,e,n)},useTransition:function(){var e=Lo(Xn)[0],n=lt().memoizedState;return[typeof e=="boolean"?e:cr(e),n]},useSyncExternalStore:gm,useId:Gm,useHostTransitionStatus:fu,useFormState:Dm,useActionState:Dm,useOptimistic:function(e,n){var r=lt();return Cm(r,Fe,e,n)},useMemoCache:au,useCacheRefresh:Km};pu.useEffectEvent=Pm;var Zm={readContext:Ot,use:Po,useCallback:Bm,useContext:Ot,useEffect:lu,useImperativeHandle:jm,useInsertionEffect:Lm,useLayoutEffect:Um,useMemo:zm,useReducer:ru,useRef:xm,useState:function(){return ru(Xn)},useDebugValue:uu,useDeferredValue:function(e,n){var r=lt();return Fe===null?du(r,e,n):qm(r,Fe.memoizedState,e,n)},useTransition:function(){var e=ru(Xn)[0],n=lt().memoizedState;return[typeof e=="boolean"?e:cr(e),n]},useSyncExternalStore:gm,useId:Gm,useHostTransitionStatus:fu,useFormState:wm,useActionState:wm,useOptimistic:function(e,n){var r=lt();return Fe!==null?Cm(r,Fe,e,n):(r.baseState=e,[e,r.queue.dispatch])},useMemoCache:au,useCacheRefresh:Km};Zm.useEffectEvent=Pm;function gu(e,n,r,c){n=e.memoizedState,r=r(c,n),r=r==null?n:v({},n,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var vu={enqueueSetState:function(e,n,r){e=e._reactInternals;var c=an(),h=Ci(c);h.payload=n,r!=null&&(h.callback=r),n=ki(e,h,c),n!==null&&(Ht(n,e,c),ar(n,e,c))},enqueueReplaceState:function(e,n,r){e=e._reactInternals;var c=an(),h=Ci(c);h.tag=1,h.payload=n,r!=null&&(h.callback=r),n=ki(e,h,c),n!==null&&(Ht(n,e,c),ar(n,e,c))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var r=an(),c=Ci(r);c.tag=2,n!=null&&(c.callback=n),n=ki(e,c,r),n!==null&&(Ht(n,e,r),ar(n,e,r))}};function Wm(e,n,r,c,h,p,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,p,y):n.prototype&&n.prototype.isPureReactComponent?!Xs(r,c)||!Xs(h,p):!0}function $m(e,n,r,c){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(r,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(r,c),n.state!==e&&vu.enqueueReplaceState(n,n.state,null)}function va(e,n){var r=n;if("ref"in n){r={};for(var c in n)c!=="ref"&&(r[c]=n[c])}if(e=e.defaultProps){r===n&&(r=v({},r));for(var h in e)r[h]===void 0&&(r[h]=e[h])}return r}function ep(e){go(e)}function tp(e){console.error(e)}function np(e){go(e)}function Bo(e,n){try{var r=e.onUncaughtError;r(n.value,{componentStack:n.stack})}catch(c){setTimeout(function(){throw c})}}function ip(e,n,r){try{var c=e.onCaughtError;c(r.value,{componentStack:r.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(h){setTimeout(function(){throw h})}}function yu(e,n,r){return r=Ci(r),r.tag=3,r.payload={element:null},r.callback=function(){Bo(e,n)},r}function ap(e){return e=Ci(e),e.tag=3,e}function sp(e,n,r,c){var h=r.type.getDerivedStateFromError;if(typeof h=="function"){var p=c.value;e.payload=function(){return h(p)},e.callback=function(){ip(n,r,c)}}var y=r.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){ip(n,r,c),typeof h!="function"&&(Di===null?Di=new Set([this]):Di.add(this));var S=c.stack;this.componentDidCatch(c.value,{componentStack:S!==null?S:""})})}function jS(e,n,r,c,h){if(r.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(n=r.alternate,n!==null&&Qa(n,r,h,!0),r=$t.current,r!==null){switch(r.tag){case 31:case 13:return fn===null?Zo():r.alternate===null&&at===0&&(at=3),r.flags&=-257,r.flags|=65536,r.lanes=h,c===_o?r.flags|=16384:(n=r.updateQueue,n===null?r.updateQueue=new Set([c]):n.add(c),Fu(e,c,h)),!1;case 22:return r.flags|=65536,c===_o?r.flags|=16384:(n=r.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([c])},r.updateQueue=n):(r=n.retryQueue,r===null?n.retryQueue=new Set([c]):r.add(c)),Fu(e,c,h)),!1}throw Error(a(435,r.tag))}return Fu(e,c,h),Zo(),!1}if(Pe)return n=$t.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=h,c!==Il&&(e=Error(a(422),{cause:c}),$s(ln(e,r)))):(c!==Il&&(n=Error(a(423),{cause:c}),$s(ln(n,r))),e=e.current.alternate,e.flags|=65536,h&=-h,e.lanes|=h,c=ln(c,r),h=yu(e.stateNode,c,h),Jl(e,h),at!==4&&(at=2)),!1;var p=Error(a(520),{cause:c});if(p=ln(p,r),yr===null?yr=[p]:yr.push(p),at!==4&&(at=2),n===null)return!0;c=ln(c,r),r=n;do{switch(r.tag){case 3:return r.flags|=65536,e=h&-h,r.lanes|=e,e=yu(r.stateNode,c,e),Jl(r,e),!1;case 1:if(n=r.type,p=r.stateNode,(r.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(Di===null||!Di.has(p))))return r.flags|=65536,h&=-h,r.lanes|=h,h=ap(h),sp(h,e,r,c),Jl(r,h),!1}r=r.return}while(r!==null);return!1}var bu=Error(a(461)),mt=!1;function At(e,n,r,c){n.child=e===null?lm(n,null,r,c):pa(n,e.child,r,c)}function rp(e,n,r,c,h){r=r.render;var p=n.ref;if("ref"in c){var y={};for(var S in c)S!=="ref"&&(y[S]=c[S])}else y=c;return da(n),c=eu(e,n,r,y,p,h),S=tu(),e!==null&&!mt?(nu(e,n,h),Zn(e,n,h)):(Pe&&S&&Ll(n),n.flags|=1,At(e,n,c,h),n.child)}function op(e,n,r,c,h){if(e===null){var p=r.type;return typeof p=="function"&&!xl(p)&&p.defaultProps===void 0&&r.compare===null?(n.tag=15,n.type=p,cp(e,n,p,c,h)):(e=So(r.type,null,c,n,n.mode,h),e.ref=n.ref,e.return=n,n.child=e)}if(p=e.child,!Ou(e,h)){var y=p.memoizedProps;if(r=r.compare,r=r!==null?r:Xs,r(y,c)&&e.ref===n.ref)return Zn(e,n,h)}return n.flags|=1,e=Gn(p,c),e.ref=n.ref,e.return=n,n.child=e}function cp(e,n,r,c,h){if(e!==null){var p=e.memoizedProps;if(Xs(p,c)&&e.ref===n.ref)if(mt=!1,n.pendingProps=c=p,Ou(e,h))(e.flags&131072)!==0&&(mt=!0);else return n.lanes=e.lanes,Zn(e,n,h)}return Su(e,n,r,c,h)}function lp(e,n,r,c){var h=c.children,p=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((n.flags&128)!==0){if(p=p!==null?p.baseLanes|r:r,e!==null){for(c=n.child=e.child,h=0;c!==null;)h=h|c.lanes|c.childLanes,c=c.sibling;c=h&~p}else c=0,n.child=null;return up(e,n,p,r,c)}if((r&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&Eo(n,p!==null?p.cachePool:null),p!==null?hm(n,p):Xl(),fm(n);else return c=n.lanes=536870912,up(e,n,p!==null?p.baseLanes|r:r,r,c)}else p!==null?(Eo(n,p.cachePool),hm(n,p),Ri(),n.memoizedState=null):(e!==null&&Eo(n,null),Xl(),Ri());return At(e,n,h,r),n.child}function dr(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function up(e,n,r,c,h){var p=Hl();return p=p===null?null:{parent:ht._currentValue,pool:p},n.memoizedState={baseLanes:r,cachePool:p},e!==null&&Eo(n,null),Xl(),fm(n),e!==null&&Qa(e,n,c,!0),n.childLanes=h,null}function zo(e,n){return n=Vo({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function dp(e,n,r){return pa(n,e.child,null,r),e=zo(n,n.pendingProps),e.flags|=2,en(n),n.memoizedState=null,e}function BS(e,n,r){var c=n.pendingProps,h=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(Pe){if(c.mode==="hidden")return e=zo(n,c),n.lanes=536870912,dr(null,e);if(Wl(n),(e=Xe)?(e=kg(e,hn),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:vi!==null?{id:Dn,overflow:Mn}:null,retryLane:536870912,hydrationErrors:null},r=Jf(e),r.return=n,n.child=r,_t=n,Xe=null)):e=null,e===null)throw bi(n);return n.lanes=536870912,null}return zo(n,c)}var p=e.memoizedState;if(p!==null){var y=p.dehydrated;if(Wl(n),h)if(n.flags&256)n.flags&=-257,n=dp(e,n,r);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(a(558));else if(mt||Qa(e,n,r,!1),h=(r&e.childLanes)!==0,mt||h){if(c=Je,c!==null&&(y=ef(c,r),y!==0&&y!==p.retryLane))throw p.retryLane=y,oa(e,y),Ht(c,e,y),bu;Zo(),n=dp(e,n,r)}else e=p.treeContext,Xe=mn(y.nextSibling),_t=n,Pe=!0,yi=null,hn=!1,e!==null&&Zf(n,e),n=zo(n,c),n.flags|=4096;return n}return e=Gn(e.child,{mode:c.mode,children:c.children}),e.ref=n.ref,n.child=e,e.return=n,e}function qo(e,n){var r=n.ref;if(r===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(a(284));(e===null||e.ref!==r)&&(n.flags|=4194816)}}function Su(e,n,r,c,h){return da(n),r=eu(e,n,r,c,void 0,h),c=tu(),e!==null&&!mt?(nu(e,n,h),Zn(e,n,h)):(Pe&&c&&Ll(n),n.flags|=1,At(e,n,r,h),n.child)}function hp(e,n,r,c,h,p){return da(n),n.updateQueue=null,r=pm(n,c,r,h),mm(e),c=tu(),e!==null&&!mt?(nu(e,n,p),Zn(e,n,p)):(Pe&&c&&Ll(n),n.flags|=1,At(e,n,r,p),n.child)}function fp(e,n,r,c,h){if(da(n),n.stateNode===null){var p=Ga,y=r.contextType;typeof y=="object"&&y!==null&&(p=Ot(y)),p=new r(c,p),n.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=vu,n.stateNode=p,p._reactInternals=n,p=n.stateNode,p.props=c,p.state=n.memoizedState,p.refs={},Kl(n),y=r.contextType,p.context=typeof y=="object"&&y!==null?Ot(y):Ga,p.state=n.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(gu(n,r,y,c),p.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(y=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),y!==p.state&&vu.enqueueReplaceState(p,p.state,null),rr(n,c,p,h),sr(),p.state=n.memoizedState),typeof p.componentDidMount=="function"&&(n.flags|=4194308),c=!0}else if(e===null){p=n.stateNode;var S=n.memoizedProps,k=va(r,S);p.props=k;var L=p.context,H=r.contextType;y=Ga,typeof H=="object"&&H!==null&&(y=Ot(H));var Y=r.getDerivedStateFromProps;H=typeof Y=="function"||typeof p.getSnapshotBeforeUpdate=="function",S=n.pendingProps!==S,H||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(S||L!==y)&&$m(n,p,c,y),Ti=!1;var j=n.memoizedState;p.state=j,rr(n,c,p,h),sr(),L=n.memoizedState,S||j!==L||Ti?(typeof Y=="function"&&(gu(n,r,Y,c),L=n.memoizedState),(k=Ti||Wm(n,r,k,c,j,L,y))?(H||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(n.flags|=4194308)):(typeof p.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=L),p.props=c,p.state=L,p.context=y,c=k):(typeof p.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{p=n.stateNode,Yl(e,n),y=n.memoizedProps,H=va(r,y),p.props=H,Y=n.pendingProps,j=p.context,L=r.contextType,k=Ga,typeof L=="object"&&L!==null&&(k=Ot(L)),S=r.getDerivedStateFromProps,(L=typeof S=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(y!==Y||j!==k)&&$m(n,p,c,k),Ti=!1,j=n.memoizedState,p.state=j,rr(n,c,p,h),sr();var V=n.memoizedState;y!==Y||j!==V||Ti||e!==null&&e.dependencies!==null&&Co(e.dependencies)?(typeof S=="function"&&(gu(n,r,S,c),V=n.memoizedState),(H=Ti||Wm(n,r,H,c,j,V,k)||e!==null&&e.dependencies!==null&&Co(e.dependencies))?(L||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(c,V,k),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(c,V,k)),typeof p.componentDidUpdate=="function"&&(n.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof p.componentDidUpdate!="function"||y===e.memoizedProps&&j===e.memoizedState||(n.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&j===e.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=V),p.props=c,p.state=V,p.context=k,c=H):(typeof p.componentDidUpdate!="function"||y===e.memoizedProps&&j===e.memoizedState||(n.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&j===e.memoizedState||(n.flags|=1024),c=!1)}return p=c,qo(e,n),c=(n.flags&128)!==0,p||c?(p=n.stateNode,r=c&&typeof r.getDerivedStateFromError!="function"?null:p.render(),n.flags|=1,e!==null&&c?(n.child=pa(n,e.child,null,h),n.child=pa(n,null,r,h)):At(e,n,r,h),n.memoizedState=p.state,e=n.child):e=Zn(e,n,h),e}function mp(e,n,r,c){return la(),n.flags|=256,At(e,n,r,c),n.child}var Tu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Cu(e){return{baseLanes:e,cachePool:im()}}function ku(e,n,r){return e=e!==null?e.childLanes&~r:0,n&&(e|=nn),e}function pp(e,n,r){var c=n.pendingProps,h=!1,p=(n.flags&128)!==0,y;if((y=p)||(y=e!==null&&e.memoizedState===null?!1:(ct.current&2)!==0),y&&(h=!0,n.flags&=-129),y=(n.flags&32)!==0,n.flags&=-33,e===null){if(Pe){if(h?Ei(n):Ri(),(e=Xe)?(e=kg(e,hn),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:vi!==null?{id:Dn,overflow:Mn}:null,retryLane:536870912,hydrationErrors:null},r=Jf(e),r.return=n,n.child=r,_t=n,Xe=null)):e=null,e===null)throw bi(n);return sd(e)?n.lanes=32:n.lanes=536870912,null}var S=c.children;return c=c.fallback,h?(Ri(),h=n.mode,S=Vo({mode:"hidden",children:S},h),c=ca(c,h,r,null),S.return=n,c.return=n,S.sibling=c,n.child=S,c=n.child,c.memoizedState=Cu(r),c.childLanes=ku(e,y,r),n.memoizedState=Tu,dr(null,c)):(Ei(n),Eu(n,S))}var k=e.memoizedState;if(k!==null&&(S=k.dehydrated,S!==null)){if(p)n.flags&256?(Ei(n),n.flags&=-257,n=Ru(e,n,r)):n.memoizedState!==null?(Ri(),n.child=e.child,n.flags|=128,n=null):(Ri(),S=c.fallback,h=n.mode,c=Vo({mode:"visible",children:c.children},h),S=ca(S,h,r,null),S.flags|=2,c.return=n,S.return=n,c.sibling=S,n.child=c,pa(n,e.child,null,r),c=n.child,c.memoizedState=Cu(r),c.childLanes=ku(e,y,r),n.memoizedState=Tu,n=dr(null,c));else if(Ei(n),sd(S)){if(y=S.nextSibling&&S.nextSibling.dataset,y)var L=y.dgst;y=L,c=Error(a(419)),c.stack="",c.digest=y,$s({value:c,source:null,stack:null}),n=Ru(e,n,r)}else if(mt||Qa(e,n,r,!1),y=(r&e.childLanes)!==0,mt||y){if(y=Je,y!==null&&(c=ef(y,r),c!==0&&c!==k.retryLane))throw k.retryLane=c,oa(e,c),Ht(y,e,c),bu;ad(S)||Zo(),n=Ru(e,n,r)}else ad(S)?(n.flags|=192,n.child=e.child,n=null):(e=k.treeContext,Xe=mn(S.nextSibling),_t=n,Pe=!0,yi=null,hn=!1,e!==null&&Zf(n,e),n=Eu(n,c.children),n.flags|=4096);return n}return h?(Ri(),S=c.fallback,h=n.mode,k=e.child,L=k.sibling,c=Gn(k,{mode:"hidden",children:c.children}),c.subtreeFlags=k.subtreeFlags&65011712,L!==null?S=Gn(L,S):(S=ca(S,h,r,null),S.flags|=2),S.return=n,c.return=n,c.sibling=S,n.child=c,dr(null,c),c=n.child,S=e.child.memoizedState,S===null?S=Cu(r):(h=S.cachePool,h!==null?(k=ht._currentValue,h=h.parent!==k?{parent:k,pool:k}:h):h=im(),S={baseLanes:S.baseLanes|r,cachePool:h}),c.memoizedState=S,c.childLanes=ku(e,y,r),n.memoizedState=Tu,dr(e.child,c)):(Ei(n),r=e.child,e=r.sibling,r=Gn(r,{mode:"visible",children:c.children}),r.return=n,r.sibling=null,e!==null&&(y=n.deletions,y===null?(n.deletions=[e],n.flags|=16):y.push(e)),n.child=r,n.memoizedState=null,r)}function Eu(e,n){return n=Vo({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function Vo(e,n){return e=Wt(22,e,null,n),e.lanes=0,e}function Ru(e,n,r){return pa(n,e.child,null,r),e=Eu(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function gp(e,n,r){e.lanes|=n;var c=e.alternate;c!==null&&(c.lanes|=n),zl(e.return,n,r)}function _u(e,n,r,c,h,p){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:r,tailMode:h,treeForkCount:p}:(y.isBackwards=n,y.rendering=null,y.renderingStartTime=0,y.last=c,y.tail=r,y.tailMode=h,y.treeForkCount=p)}function vp(e,n,r){var c=n.pendingProps,h=c.revealOrder,p=c.tail;c=c.children;var y=ct.current,S=(y&2)!==0;if(S?(y=y&1|2,n.flags|=128):y&=1,ne(ct,y),At(e,n,c,r),c=Pe?Ws:0,!S&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&gp(e,r,n);else if(e.tag===19)gp(e,r,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(h){case"forwards":for(r=n.child,h=null;r!==null;)e=r.alternate,e!==null&&Mo(e)===null&&(h=r),r=r.sibling;r=h,r===null?(h=n.child,n.child=null):(h=r.sibling,r.sibling=null),_u(n,!1,h,r,p,c);break;case"backwards":case"unstable_legacy-backwards":for(r=null,h=n.child,n.child=null;h!==null;){if(e=h.alternate,e!==null&&Mo(e)===null){n.child=h;break}e=h.sibling,h.sibling=r,r=h,h=e}_u(n,!0,r,null,p,c);break;case"together":_u(n,!1,null,null,void 0,c);break;default:n.memoizedState=null}return n.child}function Zn(e,n,r){if(e!==null&&(n.dependencies=e.dependencies),Ai|=n.lanes,(r&n.childLanes)===0)if(e!==null){if(Qa(e,n,r,!1),(r&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(a(153));if(n.child!==null){for(e=n.child,r=Gn(e,e.pendingProps),n.child=r,r.return=n;e.sibling!==null;)e=e.sibling,r=r.sibling=Gn(e,e.pendingProps),r.return=n;r.sibling=null}return n.child}function Ou(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&Co(e)))}function zS(e,n,r){switch(n.tag){case 3:Et(n,n.stateNode.containerInfo),Si(n,ht,e.memoizedState.cache),la();break;case 27:case 5:ea(n);break;case 4:Et(n,n.stateNode.containerInfo);break;case 10:Si(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,Wl(n),null;break;case 13:var c=n.memoizedState;if(c!==null)return c.dehydrated!==null?(Ei(n),n.flags|=128,null):(r&n.child.childLanes)!==0?pp(e,n,r):(Ei(n),e=Zn(e,n,r),e!==null?e.sibling:null);Ei(n);break;case 19:var h=(e.flags&128)!==0;if(c=(r&n.childLanes)!==0,c||(Qa(e,n,r,!1),c=(r&n.childLanes)!==0),h){if(c)return vp(e,n,r);n.flags|=128}if(h=n.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),ne(ct,ct.current),c)break;return null;case 22:return n.lanes=0,lp(e,n,r,n.pendingProps);case 24:Si(n,ht,e.memoizedState.cache)}return Zn(e,n,r)}function yp(e,n,r){if(e!==null)if(e.memoizedProps!==n.pendingProps)mt=!0;else{if(!Ou(e,r)&&(n.flags&128)===0)return mt=!1,zS(e,n,r);mt=(e.flags&131072)!==0}else mt=!1,Pe&&(n.flags&1048576)!==0&&Xf(n,Ws,n.index);switch(n.lanes=0,n.tag){case 16:e:{var c=n.pendingProps;if(e=fa(n.elementType),n.type=e,typeof e=="function")xl(e)?(c=va(e,c),n.tag=1,n=fp(null,n,e,c,r)):(n.tag=0,n=Su(null,n,e,c,r));else{if(e!=null){var h=e.$$typeof;if(h===A){n.tag=11,n=rp(null,n,e,c,r);break e}else if(h===q){n.tag=14,n=op(null,n,e,c,r);break e}}throw n=nt(e)||e,Error(a(306,n,""))}}return n;case 0:return Su(e,n,n.type,n.pendingProps,r);case 1:return c=n.type,h=va(c,n.pendingProps),fp(e,n,c,h,r);case 3:e:{if(Et(n,n.stateNode.containerInfo),e===null)throw Error(a(387));c=n.pendingProps;var p=n.memoizedState;h=p.element,Yl(e,n),rr(n,c,null,r);var y=n.memoizedState;if(c=y.cache,Si(n,ht,c),c!==p.cache&&ql(n,[ht],r,!0),sr(),c=y.element,p.isDehydrated)if(p={element:c,isDehydrated:!1,cache:y.cache},n.updateQueue.baseState=p,n.memoizedState=p,n.flags&256){n=mp(e,n,c,r);break e}else if(c!==h){h=ln(Error(a(424)),n),$s(h),n=mp(e,n,c,r);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Xe=mn(e.firstChild),_t=n,Pe=!0,yi=null,hn=!0,r=lm(n,null,c,r),n.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(la(),c===h){n=Zn(e,n,r);break e}At(e,n,c,r)}n=n.child}return n;case 26:return qo(e,n),e===null?(r=Dg(n.type,null,n.pendingProps,null))?n.memoizedState=r:Pe||(r=n.type,e=n.pendingProps,c=ac(Se.current).createElement(r),c[Rt]=n,c[jt]=e,Dt(c,r,e),St(c),n.stateNode=c):n.memoizedState=Dg(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return ea(n),e===null&&Pe&&(c=n.stateNode=_g(n.type,n.pendingProps,Se.current),_t=n,hn=!0,h=Xe,Ni(n.type)?(rd=h,Xe=mn(c.firstChild)):Xe=h),At(e,n,n.pendingProps.children,r),qo(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&Pe&&((h=c=Xe)&&(c=gT(c,n.type,n.pendingProps,hn),c!==null?(n.stateNode=c,_t=n,Xe=mn(c.firstChild),hn=!1,h=!0):h=!1),h||bi(n)),ea(n),h=n.type,p=n.pendingProps,y=e!==null?e.memoizedProps:null,c=p.children,td(h,p)?c=null:y!==null&&td(h,y)&&(n.flags|=32),n.memoizedState!==null&&(h=eu(e,n,wS,null,null,r),_r._currentValue=h),qo(e,n),At(e,n,c,r),n.child;case 6:return e===null&&Pe&&((e=r=Xe)&&(r=vT(r,n.pendingProps,hn),r!==null?(n.stateNode=r,_t=n,Xe=null,e=!0):e=!1),e||bi(n)),null;case 13:return pp(e,n,r);case 4:return Et(n,n.stateNode.containerInfo),c=n.pendingProps,e===null?n.child=pa(n,null,c,r):At(e,n,c,r),n.child;case 11:return rp(e,n,n.type,n.pendingProps,r);case 7:return At(e,n,n.pendingProps,r),n.child;case 8:return At(e,n,n.pendingProps.children,r),n.child;case 12:return At(e,n,n.pendingProps.children,r),n.child;case 10:return c=n.pendingProps,Si(n,n.type,c.value),At(e,n,c.children,r),n.child;case 9:return h=n.type._context,c=n.pendingProps.children,da(n),h=Ot(h),c=c(h),n.flags|=1,At(e,n,c,r),n.child;case 14:return op(e,n,n.type,n.pendingProps,r);case 15:return cp(e,n,n.type,n.pendingProps,r);case 19:return vp(e,n,r);case 31:return BS(e,n,r);case 22:return lp(e,n,r,n.pendingProps);case 24:return da(n),c=Ot(ht),e===null?(h=Hl(),h===null&&(h=Je,p=Vl(),h.pooledCache=p,p.refCount++,p!==null&&(h.pooledCacheLanes|=r),h=p),n.memoizedState={parent:c,cache:h},Kl(n),Si(n,ht,h)):((e.lanes&r)!==0&&(Yl(e,n),rr(n,null,null,r),sr()),h=e.memoizedState,p=n.memoizedState,h.parent!==c?(h={parent:c,cache:c},n.memoizedState=h,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=h),Si(n,ht,c)):(c=p.cache,Si(n,ht,c),c!==h.cache&&ql(n,[ht],r,!0))),At(e,n,n.pendingProps.children,r),n.child;case 29:throw n.pendingProps}throw Error(a(156,n.tag))}function Wn(e){e.flags|=4}function Au(e,n,r,c,h){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(h&335544128)===h)if(e.stateNode.complete)e.flags|=8192;else if(Gp())e.flags|=8192;else throw ma=_o,Gl}else e.flags&=-16777217}function bp(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Pg(n))if(Gp())e.flags|=8192;else throw ma=_o,Gl}function Fo(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Zh():536870912,e.lanes|=n,os|=n)}function hr(e,n){if(!Pe)switch(e.tailMode){case"hidden":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Ze(e){var n=e.alternate!==null&&e.alternate.child===e.child,r=0,c=0;if(n)for(var h=e.child;h!==null;)r|=h.lanes|h.childLanes,c|=h.subtreeFlags&65011712,c|=h.flags&65011712,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)r|=h.lanes|h.childLanes,c|=h.subtreeFlags,c|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=c,e.childLanes=r,n}function qS(e,n,r){var c=n.pendingProps;switch(Ul(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ze(n),null;case 1:return Ze(n),null;case 3:return r=n.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),n.memoizedState.cache!==c&&(n.flags|=2048),Jn(ht),tt(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Ja(n)?Wn(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,jl())),Ze(n),null;case 26:var h=n.type,p=n.memoizedState;return e===null?(Wn(n),p!==null?(Ze(n),bp(n,p)):(Ze(n),Au(n,h,null,c,r))):p?p!==e.memoizedState?(Wn(n),Ze(n),bp(n,p)):(Ze(n),n.flags&=-16777217):(e=e.memoizedProps,e!==c&&Wn(n),Ze(n),Au(n,h,e,c,r)),null;case 27:if(Oa(n),r=Se.current,h=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==c&&Wn(n);else{if(!c){if(n.stateNode===null)throw Error(a(166));return Ze(n),null}e=ee.current,Ja(n)?Wf(n):(e=_g(h,c,r),n.stateNode=e,Wn(n))}return Ze(n),null;case 5:if(Oa(n),h=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==c&&Wn(n);else{if(!c){if(n.stateNode===null)throw Error(a(166));return Ze(n),null}if(p=ee.current,Ja(n))Wf(n);else{var y=ac(Se.current);switch(p){case 1:p=y.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:p=y.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":p=y.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":p=y.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":p=y.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild);break;case"select":p=typeof c.is=="string"?y.createElement("select",{is:c.is}):y.createElement("select"),c.multiple?p.multiple=!0:c.size&&(p.size=c.size);break;default:p=typeof c.is=="string"?y.createElement(h,{is:c.is}):y.createElement(h)}}p[Rt]=n,p[jt]=c;e:for(y=n.child;y!==null;){if(y.tag===5||y.tag===6)p.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===n)break e;for(;y.sibling===null;){if(y.return===null||y.return===n)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}n.stateNode=p;e:switch(Dt(p,h,c),h){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Wn(n)}}return Ze(n),Au(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,r),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==c&&Wn(n);else{if(typeof c!="string"&&n.stateNode===null)throw Error(a(166));if(e=Se.current,Ja(n)){if(e=n.stateNode,r=n.memoizedProps,c=null,h=_t,h!==null)switch(h.tag){case 27:case 5:c=h.memoizedProps}e[Rt]=n,e=!!(e.nodeValue===r||c!==null&&c.suppressHydrationWarning===!0||pg(e.nodeValue,r)),e||bi(n,!0)}else e=ac(e).createTextNode(c),e[Rt]=n,n.stateNode=e}return Ze(n),null;case 31:if(r=n.memoizedState,e===null||e.memoizedState!==null){if(c=Ja(n),r!==null){if(e===null){if(!c)throw Error(a(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[Rt]=n}else la(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ze(n),e=!1}else r=jl(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=r),e=!0;if(!e)return n.flags&256?(en(n),n):(en(n),null);if((n.flags&128)!==0)throw Error(a(558))}return Ze(n),null;case 13:if(c=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(h=Ja(n),c!==null&&c.dehydrated!==null){if(e===null){if(!h)throw Error(a(318));if(h=n.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(a(317));h[Rt]=n}else la(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ze(n),h=!1}else h=jl(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=h),h=!0;if(!h)return n.flags&256?(en(n),n):(en(n),null)}return en(n),(n.flags&128)!==0?(n.lanes=r,n):(r=c!==null,e=e!==null&&e.memoizedState!==null,r&&(c=n.child,h=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(h=c.alternate.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==h&&(c.flags|=2048)),r!==e&&r&&(n.child.flags|=8192),Fo(n,n.updateQueue),Ze(n),null);case 4:return tt(),e===null&&Xu(n.stateNode.containerInfo),Ze(n),null;case 10:return Jn(n.type),Ze(n),null;case 19:if(F(ct),c=n.memoizedState,c===null)return Ze(n),null;if(h=(n.flags&128)!==0,p=c.rendering,p===null)if(h)hr(c,!1);else{if(at!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(p=Mo(e),p!==null){for(n.flags|=128,hr(c,!1),e=p.updateQueue,n.updateQueue=e,Fo(n,e),n.subtreeFlags=0,e=r,r=n.child;r!==null;)Yf(r,e),r=r.sibling;return ne(ct,ct.current&1|2),Pe&&Kn(n,c.treeForkCount),n.child}e=e.sibling}c.tail!==null&&Ce()>Jo&&(n.flags|=128,h=!0,hr(c,!1),n.lanes=4194304)}else{if(!h)if(e=Mo(p),e!==null){if(n.flags|=128,h=!0,e=e.updateQueue,n.updateQueue=e,Fo(n,e),hr(c,!0),c.tail===null&&c.tailMode==="hidden"&&!p.alternate&&!Pe)return Ze(n),null}else 2*Ce()-c.renderingStartTime>Jo&&r!==536870912&&(n.flags|=128,h=!0,hr(c,!1),n.lanes=4194304);c.isBackwards?(p.sibling=n.child,n.child=p):(e=c.last,e!==null?e.sibling=p:n.child=p,c.last=p)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=Ce(),e.sibling=null,r=ct.current,ne(ct,h?r&1|2:r&1),Pe&&Kn(n,c.treeForkCount),e):(Ze(n),null);case 22:case 23:return en(n),Zl(),c=n.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(n.flags|=8192):c&&(n.flags|=8192),c?(r&536870912)!==0&&(n.flags&128)===0&&(Ze(n),n.subtreeFlags&6&&(n.flags|=8192)):Ze(n),r=n.updateQueue,r!==null&&Fo(n,r.retryQueue),r=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==r&&(n.flags|=2048),e!==null&&F(ha),null;case 24:return r=null,e!==null&&(r=e.memoizedState.cache),n.memoizedState.cache!==r&&(n.flags|=2048),Jn(ht),Ze(n),null;case 25:return null;case 30:return null}throw Error(a(156,n.tag))}function VS(e,n){switch(Ul(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Jn(ht),tt(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return Oa(n),null;case 31:if(n.memoizedState!==null){if(en(n),n.alternate===null)throw Error(a(340));la()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(en(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(a(340));la()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return F(ct),null;case 4:return tt(),null;case 10:return Jn(n.type),null;case 22:case 23:return en(n),Zl(),e!==null&&F(ha),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Jn(ht),null;case 25:return null;default:return null}}function Sp(e,n){switch(Ul(n),n.tag){case 3:Jn(ht),tt();break;case 26:case 27:case 5:Oa(n);break;case 4:tt();break;case 31:n.memoizedState!==null&&en(n);break;case 13:en(n);break;case 19:F(ct);break;case 10:Jn(n.type);break;case 22:case 23:en(n),Zl(),e!==null&&F(ha);break;case 24:Jn(ht)}}function fr(e,n){try{var r=n.updateQueue,c=r!==null?r.lastEffect:null;if(c!==null){var h=c.next;r=h;do{if((r.tag&e)===e){c=void 0;var p=r.create,y=r.inst;c=p(),y.destroy=c}r=r.next}while(r!==h)}}catch(S){qe(n,n.return,S)}}function _i(e,n,r){try{var c=n.updateQueue,h=c!==null?c.lastEffect:null;if(h!==null){var p=h.next;c=p;do{if((c.tag&e)===e){var y=c.inst,S=y.destroy;if(S!==void 0){y.destroy=void 0,h=n;var k=r,L=S;try{L()}catch(H){qe(h,k,H)}}}c=c.next}while(c!==p)}}catch(H){qe(n,n.return,H)}}function Tp(e){var n=e.updateQueue;if(n!==null){var r=e.stateNode;try{dm(n,r)}catch(c){qe(e,e.return,c)}}}function Cp(e,n,r){r.props=va(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(c){qe(e,n,c)}}function mr(e,n){try{var r=e.ref;if(r!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof r=="function"?e.refCleanup=r(c):r.current=c}}catch(h){qe(e,n,h)}}function wn(e,n){var r=e.ref,c=e.refCleanup;if(r!==null)if(typeof c=="function")try{c()}catch(h){qe(e,n,h)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(h){qe(e,n,h)}else r.current=null}function kp(e){var n=e.type,r=e.memoizedProps,c=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":r.autoFocus&&c.focus();break e;case"img":r.src?c.src=r.src:r.srcSet&&(c.srcset=r.srcSet)}}catch(h){qe(e,e.return,h)}}function Du(e,n,r){try{var c=e.stateNode;uT(c,e.type,r,n),c[jt]=n}catch(h){qe(e,e.return,h)}}function Ep(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ni(e.type)||e.tag===4}function Mu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Ep(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ni(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function wu(e,n,r){var c=e.tag;if(c===5||c===6)e=e.stateNode,n?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(e,n):(n=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,n.appendChild(e),r=r._reactRootContainer,r!=null||n.onclick!==null||(n.onclick=Fn));else if(c!==4&&(c===27&&Ni(e.type)&&(r=e.stateNode,n=null),e=e.child,e!==null))for(wu(e,n,r),e=e.sibling;e!==null;)wu(e,n,r),e=e.sibling}function Ho(e,n,r){var c=e.tag;if(c===5||c===6)e=e.stateNode,n?r.insertBefore(e,n):r.appendChild(e);else if(c!==4&&(c===27&&Ni(e.type)&&(r=e.stateNode),e=e.child,e!==null))for(Ho(e,n,r),e=e.sibling;e!==null;)Ho(e,n,r),e=e.sibling}function Rp(e){var n=e.stateNode,r=e.memoizedProps;try{for(var c=e.type,h=n.attributes;h.length;)n.removeAttributeNode(h[0]);Dt(n,c,r),n[Rt]=e,n[jt]=r}catch(p){qe(e,e.return,p)}}var $n=!1,pt=!1,xu=!1,_p=typeof WeakSet=="function"?WeakSet:Set,Tt=null;function FS(e,n){if(e=e.containerInfo,$u=dc,e=jf(e),Rl(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var c=r.getSelection&&r.getSelection();if(c&&c.rangeCount!==0){r=c.anchorNode;var h=c.anchorOffset,p=c.focusNode;c=c.focusOffset;try{r.nodeType,p.nodeType}catch{r=null;break e}var y=0,S=-1,k=-1,L=0,H=0,Y=e,j=null;t:for(;;){for(var V;Y!==r||h!==0&&Y.nodeType!==3||(S=y+h),Y!==p||c!==0&&Y.nodeType!==3||(k=y+c),Y.nodeType===3&&(y+=Y.nodeValue.length),(V=Y.firstChild)!==null;)j=Y,Y=V;for(;;){if(Y===e)break t;if(j===r&&++L===h&&(S=y),j===p&&++H===c&&(k=y),(V=Y.nextSibling)!==null)break;Y=j,j=Y.parentNode}Y=V}r=S===-1||k===-1?null:{start:S,end:k}}else r=null}r=r||{start:0,end:0}}else r=null;for(ed={focusedElem:e,selectionRange:r},dc=!1,Tt=n;Tt!==null;)if(n=Tt,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,Tt=e;else for(;Tt!==null;){switch(n=Tt,p=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(r=0;r<e.length;r++)h=e[r],h.ref.impl=h.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&p!==null){e=void 0,r=n,h=p.memoizedProps,p=p.memoizedState,c=r.stateNode;try{var de=va(r.type,h);e=c.getSnapshotBeforeUpdate(de,p),c.__reactInternalSnapshotBeforeUpdate=e}catch(ve){qe(r,r.return,ve)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,r=e.nodeType,r===9)id(e);else if(r===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":id(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=n.sibling,e!==null){e.return=n.return,Tt=e;break}Tt=n.return}}function Op(e,n,r){var c=r.flags;switch(r.tag){case 0:case 11:case 15:ti(e,r),c&4&&fr(5,r);break;case 1:if(ti(e,r),c&4)if(e=r.stateNode,n===null)try{e.componentDidMount()}catch(y){qe(r,r.return,y)}else{var h=va(r.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(h,n,e.__reactInternalSnapshotBeforeUpdate)}catch(y){qe(r,r.return,y)}}c&64&&Tp(r),c&512&&mr(r,r.return);break;case 3:if(ti(e,r),c&64&&(e=r.updateQueue,e!==null)){if(n=null,r.child!==null)switch(r.child.tag){case 27:case 5:n=r.child.stateNode;break;case 1:n=r.child.stateNode}try{dm(e,n)}catch(y){qe(r,r.return,y)}}break;case 27:n===null&&c&4&&Rp(r);case 26:case 5:ti(e,r),n===null&&c&4&&kp(r),c&512&&mr(r,r.return);break;case 12:ti(e,r);break;case 31:ti(e,r),c&4&&Mp(e,r);break;case 13:ti(e,r),c&4&&wp(e,r),c&64&&(e=r.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(r=WS.bind(null,r),yT(e,r))));break;case 22:if(c=r.memoizedState!==null||$n,!c){n=n!==null&&n.memoizedState!==null||pt,h=$n;var p=pt;$n=c,(pt=n)&&!p?ni(e,r,(r.subtreeFlags&8772)!==0):ti(e,r),$n=h,pt=p}break;case 30:break;default:ti(e,r)}}function Ap(e){var n=e.alternate;n!==null&&(e.alternate=null,Ap(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&cl(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var $e=null,zt=!1;function ei(e,n,r){for(r=r.child;r!==null;)Dp(e,n,r),r=r.sibling}function Dp(e,n,r){if(Qt&&typeof Qt.onCommitFiberUnmount=="function")try{Qt.onCommitFiberUnmount(js,r)}catch{}switch(r.tag){case 26:pt||wn(r,n),ei(e,n,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:pt||wn(r,n);var c=$e,h=zt;Ni(r.type)&&($e=r.stateNode,zt=!1),ei(e,n,r),kr(r.stateNode),$e=c,zt=h;break;case 5:pt||wn(r,n);case 6:if(c=$e,h=zt,$e=null,ei(e,n,r),$e=c,zt=h,$e!==null)if(zt)try{($e.nodeType===9?$e.body:$e.nodeName==="HTML"?$e.ownerDocument.body:$e).removeChild(r.stateNode)}catch(p){qe(r,n,p)}else try{$e.removeChild(r.stateNode)}catch(p){qe(r,n,p)}break;case 18:$e!==null&&(zt?(e=$e,Tg(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,r.stateNode),ps(e)):Tg($e,r.stateNode));break;case 4:c=$e,h=zt,$e=r.stateNode.containerInfo,zt=!0,ei(e,n,r),$e=c,zt=h;break;case 0:case 11:case 14:case 15:_i(2,r,n),pt||_i(4,r,n),ei(e,n,r);break;case 1:pt||(wn(r,n),c=r.stateNode,typeof c.componentWillUnmount=="function"&&Cp(r,n,c)),ei(e,n,r);break;case 21:ei(e,n,r);break;case 22:pt=(c=pt)||r.memoizedState!==null,ei(e,n,r),pt=c;break;default:ei(e,n,r)}}function Mp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{ps(e)}catch(r){qe(n,n.return,r)}}}function wp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ps(e)}catch(r){qe(n,n.return,r)}}function HS(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new _p),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new _p),n;default:throw Error(a(435,e.tag))}}function Go(e,n){var r=HS(e);n.forEach(function(c){if(!r.has(c)){r.add(c);var h=$S.bind(null,e,c);c.then(h,h)}})}function qt(e,n){var r=n.deletions;if(r!==null)for(var c=0;c<r.length;c++){var h=r[c],p=e,y=n,S=y;e:for(;S!==null;){switch(S.tag){case 27:if(Ni(S.type)){$e=S.stateNode,zt=!1;break e}break;case 5:$e=S.stateNode,zt=!1;break e;case 3:case 4:$e=S.stateNode.containerInfo,zt=!0;break e}S=S.return}if($e===null)throw Error(a(160));Dp(p,y,h),$e=null,zt=!1,p=h.alternate,p!==null&&(p.return=null),h.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)xp(n,e),n=n.sibling}var Sn=null;function xp(e,n){var r=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:qt(n,e),Vt(e),c&4&&(_i(3,e,e.return),fr(3,e),_i(5,e,e.return));break;case 1:qt(n,e),Vt(e),c&512&&(pt||r===null||wn(r,r.return)),c&64&&$n&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=r===null?c:r.concat(c))));break;case 26:var h=Sn;if(qt(n,e),Vt(e),c&512&&(pt||r===null||wn(r,r.return)),c&4){var p=r!==null?r.memoizedState:null;if(c=e.memoizedState,r===null)if(c===null)if(e.stateNode===null){e:{c=e.type,r=e.memoizedProps,h=h.ownerDocument||h;t:switch(c){case"title":p=h.getElementsByTagName("title")[0],(!p||p[qs]||p[Rt]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=h.createElement(c),h.head.insertBefore(p,h.querySelector("head > title"))),Dt(p,c,r),p[Rt]=e,St(p),c=p;break e;case"link":var y=xg("link","href",h).get(c+(r.href||""));if(y){for(var S=0;S<y.length;S++)if(p=y[S],p.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&p.getAttribute("rel")===(r.rel==null?null:r.rel)&&p.getAttribute("title")===(r.title==null?null:r.title)&&p.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){y.splice(S,1);break t}}p=h.createElement(c),Dt(p,c,r),h.head.appendChild(p);break;case"meta":if(y=xg("meta","content",h).get(c+(r.content||""))){for(S=0;S<y.length;S++)if(p=y[S],p.getAttribute("content")===(r.content==null?null:""+r.content)&&p.getAttribute("name")===(r.name==null?null:r.name)&&p.getAttribute("property")===(r.property==null?null:r.property)&&p.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&p.getAttribute("charset")===(r.charSet==null?null:r.charSet)){y.splice(S,1);break t}}p=h.createElement(c),Dt(p,c,r),h.head.appendChild(p);break;default:throw Error(a(468,c))}p[Rt]=e,St(p),c=p}e.stateNode=c}else Ng(h,e.type,e.stateNode);else e.stateNode=wg(h,c,e.memoizedProps);else p!==c?(p===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):p.count--,c===null?Ng(h,e.type,e.stateNode):wg(h,c,e.memoizedProps)):c===null&&e.stateNode!==null&&Du(e,e.memoizedProps,r.memoizedProps)}break;case 27:qt(n,e),Vt(e),c&512&&(pt||r===null||wn(r,r.return)),r!==null&&c&4&&Du(e,e.memoizedProps,r.memoizedProps);break;case 5:if(qt(n,e),Vt(e),c&512&&(pt||r===null||wn(r,r.return)),e.flags&32){h=e.stateNode;try{ja(h,"")}catch(de){qe(e,e.return,de)}}c&4&&e.stateNode!=null&&(h=e.memoizedProps,Du(e,h,r!==null?r.memoizedProps:h)),c&1024&&(xu=!0);break;case 6:if(qt(n,e),Vt(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,r=e.stateNode;try{r.nodeValue=c}catch(de){qe(e,e.return,de)}}break;case 3:if(oc=null,h=Sn,Sn=sc(n.containerInfo),qt(n,e),Sn=h,Vt(e),c&4&&r!==null&&r.memoizedState.isDehydrated)try{ps(n.containerInfo)}catch(de){qe(e,e.return,de)}xu&&(xu=!1,Np(e));break;case 4:c=Sn,Sn=sc(e.stateNode.containerInfo),qt(n,e),Vt(e),Sn=c;break;case 12:qt(n,e),Vt(e);break;case 31:qt(n,e),Vt(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Go(e,c)));break;case 13:qt(n,e),Vt(e),e.child.flags&8192&&e.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(Yo=Ce()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Go(e,c)));break;case 22:h=e.memoizedState!==null;var k=r!==null&&r.memoizedState!==null,L=$n,H=pt;if($n=L||h,pt=H||k,qt(n,e),pt=H,$n=L,Vt(e),c&8192)e:for(n=e.stateNode,n._visibility=h?n._visibility&-2:n._visibility|1,h&&(r===null||k||$n||pt||ya(e)),r=null,n=e;;){if(n.tag===5||n.tag===26){if(r===null){k=r=n;try{if(p=k.stateNode,h)y=p.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{S=k.stateNode;var Y=k.memoizedProps.style,j=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;S.style.display=j==null||typeof j=="boolean"?"":(""+j).trim()}}catch(de){qe(k,k.return,de)}}}else if(n.tag===6){if(r===null){k=n;try{k.stateNode.nodeValue=h?"":k.memoizedProps}catch(de){qe(k,k.return,de)}}}else if(n.tag===18){if(r===null){k=n;try{var V=k.stateNode;h?Cg(V,!0):Cg(k.stateNode,!1)}catch(de){qe(k,k.return,de)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;r===n&&(r=null),n=n.return}r===n&&(r=null),n.sibling.return=n.return,n=n.sibling}c&4&&(c=e.updateQueue,c!==null&&(r=c.retryQueue,r!==null&&(c.retryQueue=null,Go(e,r))));break;case 19:qt(n,e),Vt(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Go(e,c)));break;case 30:break;case 21:break;default:qt(n,e),Vt(e)}}function Vt(e){var n=e.flags;if(n&2){try{for(var r,c=e.return;c!==null;){if(Ep(c)){r=c;break}c=c.return}if(r==null)throw Error(a(160));switch(r.tag){case 27:var h=r.stateNode,p=Mu(e);Ho(e,p,h);break;case 5:var y=r.stateNode;r.flags&32&&(ja(y,""),r.flags&=-33);var S=Mu(e);Ho(e,S,y);break;case 3:case 4:var k=r.stateNode.containerInfo,L=Mu(e);wu(e,L,k);break;default:throw Error(a(161))}}catch(H){qe(e,e.return,H)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function Np(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;Np(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function ti(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)Op(e,n.alternate,n),n=n.sibling}function ya(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:_i(4,n,n.return),ya(n);break;case 1:wn(n,n.return);var r=n.stateNode;typeof r.componentWillUnmount=="function"&&Cp(n,n.return,r),ya(n);break;case 27:kr(n.stateNode);case 26:case 5:wn(n,n.return),ya(n);break;case 22:n.memoizedState===null&&ya(n);break;case 30:ya(n);break;default:ya(n)}e=e.sibling}}function ni(e,n,r){for(r=r&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var c=n.alternate,h=e,p=n,y=p.flags;switch(p.tag){case 0:case 11:case 15:ni(h,p,r),fr(4,p);break;case 1:if(ni(h,p,r),c=p,h=c.stateNode,typeof h.componentDidMount=="function")try{h.componentDidMount()}catch(L){qe(c,c.return,L)}if(c=p,h=c.updateQueue,h!==null){var S=c.stateNode;try{var k=h.shared.hiddenCallbacks;if(k!==null)for(h.shared.hiddenCallbacks=null,h=0;h<k.length;h++)um(k[h],S)}catch(L){qe(c,c.return,L)}}r&&y&64&&Tp(p),mr(p,p.return);break;case 27:Rp(p);case 26:case 5:ni(h,p,r),r&&c===null&&y&4&&kp(p),mr(p,p.return);break;case 12:ni(h,p,r);break;case 31:ni(h,p,r),r&&y&4&&Mp(h,p);break;case 13:ni(h,p,r),r&&y&4&&wp(h,p);break;case 22:p.memoizedState===null&&ni(h,p,r),mr(p,p.return);break;case 30:break;default:ni(h,p,r)}n=n.sibling}}function Nu(e,n){var r=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==r&&(e!=null&&e.refCount++,r!=null&&er(r))}function Pu(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&er(e))}function Tn(e,n,r,c){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Pp(e,n,r,c),n=n.sibling}function Pp(e,n,r,c){var h=n.flags;switch(n.tag){case 0:case 11:case 15:Tn(e,n,r,c),h&2048&&fr(9,n);break;case 1:Tn(e,n,r,c);break;case 3:Tn(e,n,r,c),h&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&er(e)));break;case 12:if(h&2048){Tn(e,n,r,c),e=n.stateNode;try{var p=n.memoizedProps,y=p.id,S=p.onPostCommit;typeof S=="function"&&S(y,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(k){qe(n,n.return,k)}}else Tn(e,n,r,c);break;case 31:Tn(e,n,r,c);break;case 13:Tn(e,n,r,c);break;case 23:break;case 22:p=n.stateNode,y=n.alternate,n.memoizedState!==null?p._visibility&2?Tn(e,n,r,c):pr(e,n):p._visibility&2?Tn(e,n,r,c):(p._visibility|=2,as(e,n,r,c,(n.subtreeFlags&10256)!==0||!1)),h&2048&&Nu(y,n);break;case 24:Tn(e,n,r,c),h&2048&&Pu(n.alternate,n);break;default:Tn(e,n,r,c)}}function as(e,n,r,c,h){for(h=h&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var p=e,y=n,S=r,k=c,L=y.flags;switch(y.tag){case 0:case 11:case 15:as(p,y,S,k,h),fr(8,y);break;case 23:break;case 22:var H=y.stateNode;y.memoizedState!==null?H._visibility&2?as(p,y,S,k,h):pr(p,y):(H._visibility|=2,as(p,y,S,k,h)),h&&L&2048&&Nu(y.alternate,y);break;case 24:as(p,y,S,k,h),h&&L&2048&&Pu(y.alternate,y);break;default:as(p,y,S,k,h)}n=n.sibling}}function pr(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var r=e,c=n,h=c.flags;switch(c.tag){case 22:pr(r,c),h&2048&&Nu(c.alternate,c);break;case 24:pr(r,c),h&2048&&Pu(c.alternate,c);break;default:pr(r,c)}n=n.sibling}}var gr=8192;function ss(e,n,r){if(e.subtreeFlags&gr)for(e=e.child;e!==null;)Lp(e,n,r),e=e.sibling}function Lp(e,n,r){switch(e.tag){case 26:ss(e,n,r),e.flags&gr&&e.memoizedState!==null&&MT(r,Sn,e.memoizedState,e.memoizedProps);break;case 5:ss(e,n,r);break;case 3:case 4:var c=Sn;Sn=sc(e.stateNode.containerInfo),ss(e,n,r),Sn=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=gr,gr=16777216,ss(e,n,r),gr=c):ss(e,n,r));break;default:ss(e,n,r)}}function Up(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function vr(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var r=0;r<n.length;r++){var c=n[r];Tt=c,jp(c,e)}Up(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Ip(e),e=e.sibling}function Ip(e){switch(e.tag){case 0:case 11:case 15:vr(e),e.flags&2048&&_i(9,e,e.return);break;case 3:vr(e);break;case 12:vr(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Ko(e)):vr(e);break;default:vr(e)}}function Ko(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var r=0;r<n.length;r++){var c=n[r];Tt=c,jp(c,e)}Up(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:_i(8,n,n.return),Ko(n);break;case 22:r=n.stateNode,r._visibility&2&&(r._visibility&=-3,Ko(n));break;default:Ko(n)}e=e.sibling}}function jp(e,n){for(;Tt!==null;){var r=Tt;switch(r.tag){case 0:case 11:case 15:_i(8,r,n);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var c=r.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:er(r.memoizedState.cache)}if(c=r.child,c!==null)c.return=r,Tt=c;else e:for(r=e;Tt!==null;){c=Tt;var h=c.sibling,p=c.return;if(Ap(c),c===r){Tt=null;break e}if(h!==null){h.return=p,Tt=h;break e}Tt=p}}}var GS={getCacheForType:function(e){var n=Ot(ht),r=n.data.get(e);return r===void 0&&(r=e(),n.data.set(e,r)),r},cacheSignal:function(){return Ot(ht).controller.signal}},KS=typeof WeakMap=="function"?WeakMap:Map,Be=0,Je=null,Ae=null,xe=0,ze=0,tn=null,Oi=!1,rs=!1,Lu=!1,ii=0,at=0,Ai=0,ba=0,Uu=0,nn=0,os=0,yr=null,Ft=null,Iu=!1,Yo=0,Bp=0,Jo=1/0,Qo=null,Di=null,vt=0,Mi=null,cs=null,ai=0,ju=0,Bu=null,zp=null,br=0,zu=null;function an(){return(Be&2)!==0&&xe!==0?xe&-xe:x.T!==null?Ku():tf()}function qp(){if(nn===0)if((xe&536870912)===0||Pe){var e=no;no<<=1,(no&3932160)===0&&(no=262144),nn=e}else nn=536870912;return e=$t.current,e!==null&&(e.flags|=32),nn}function Ht(e,n,r){(e===Je&&(ze===2||ze===9)||e.cancelPendingCommit!==null)&&(ls(e,0),wi(e,xe,nn,!1)),zs(e,r),((Be&2)===0||e!==Je)&&(e===Je&&((Be&2)===0&&(ba|=r),at===4&&wi(e,xe,nn,!1)),xn(e))}function Vp(e,n,r){if((Be&6)!==0)throw Error(a(327));var c=!r&&(n&127)===0&&(n&e.expiredLanes)===0||Bs(e,n),h=c?QS(e,n):Vu(e,n,!0),p=c;do{if(h===0){rs&&!c&&wi(e,n,0,!1);break}else{if(r=e.current.alternate,p&&!YS(r)){h=Vu(e,n,!1),p=!1;continue}if(h===2){if(p=n,e.errorRecoveryDisabledLanes&p)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){n=y;e:{var S=e;h=yr;var k=S.current.memoizedState.isDehydrated;if(k&&(ls(S,y).flags|=256),y=Vu(S,y,!1),y!==2){if(Lu&&!k){S.errorRecoveryDisabledLanes|=p,ba|=p,h=4;break e}p=Ft,Ft=h,p!==null&&(Ft===null?Ft=p:Ft.push.apply(Ft,p))}h=y}if(p=!1,h!==2)continue}}if(h===1){ls(e,0),wi(e,n,0,!0);break}e:{switch(c=e,p=h,p){case 0:case 1:throw Error(a(345));case 4:if((n&4194048)!==n)break;case 6:wi(c,n,nn,!Oi);break e;case 2:Ft=null;break;case 3:case 5:break;default:throw Error(a(329))}if((n&62914560)===n&&(h=Yo+300-Ce(),10<h)){if(wi(c,n,nn,!Oi),ao(c,0,!0)!==0)break e;ai=n,c.timeoutHandle=bg(Fp.bind(null,c,r,Ft,Qo,Iu,n,nn,ba,os,Oi,p,"Throttled",-0,0),h);break e}Fp(c,r,Ft,Qo,Iu,n,nn,ba,os,Oi,p,null,-0,0)}}break}while(!0);xn(e)}function Fp(e,n,r,c,h,p,y,S,k,L,H,Y,j,V){if(e.timeoutHandle=-1,Y=n.subtreeFlags,Y&8192||(Y&16785408)===16785408){Y={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fn},Lp(n,p,Y);var de=(p&62914560)===p?Yo-Ce():(p&4194048)===p?Bp-Ce():0;if(de=wT(Y,de),de!==null){ai=p,e.cancelPendingCommit=de(Zp.bind(null,e,n,p,r,c,h,y,S,k,H,Y,null,j,V)),wi(e,p,y,!L);return}}Zp(e,n,p,r,c,h,y,S,k)}function YS(e){for(var n=e;;){var r=n.tag;if((r===0||r===11||r===15)&&n.flags&16384&&(r=n.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var c=0;c<r.length;c++){var h=r[c],p=h.getSnapshot;h=h.value;try{if(!Zt(p(),h))return!1}catch{return!1}}if(r=n.child,n.subtreeFlags&16384&&r!==null)r.return=n,n=r;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function wi(e,n,r,c){n&=~Uu,n&=~ba,e.suspendedLanes|=n,e.pingedLanes&=~n,c&&(e.warmLanes|=n),c=e.expirationTimes;for(var h=n;0<h;){var p=31-Xt(h),y=1<<p;c[p]=-1,h&=~y}r!==0&&Wh(e,r,n)}function Xo(){return(Be&6)===0?(Sr(0),!1):!0}function qu(){if(Ae!==null){if(ze===0)var e=Ae.return;else e=Ae,Yn=ua=null,iu(e),$a=null,nr=0,e=Ae;for(;e!==null;)Sp(e.alternate,e),e=e.return;Ae=null}}function ls(e,n){var r=e.timeoutHandle;r!==-1&&(e.timeoutHandle=-1,fT(r)),r=e.cancelPendingCommit,r!==null&&(e.cancelPendingCommit=null,r()),ai=0,qu(),Je=e,Ae=r=Gn(e.current,null),xe=n,ze=0,tn=null,Oi=!1,rs=Bs(e,n),Lu=!1,os=nn=Uu=ba=Ai=at=0,Ft=yr=null,Iu=!1,(n&8)!==0&&(n|=n&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=n;0<c;){var h=31-Xt(c),p=1<<h;n|=e[h],c&=~p}return ii=n,vo(),r}function Hp(e,n){ke=null,x.H=ur,n===Wa||n===Ro?(n=rm(),ze=3):n===Gl?(n=rm(),ze=4):ze=n===bu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,tn=n,Ae===null&&(at=1,Bo(e,ln(n,e.current)))}function Gp(){var e=$t.current;return e===null?!0:(xe&4194048)===xe?fn===null:(xe&62914560)===xe||(xe&536870912)!==0?e===fn:!1}function Kp(){var e=x.H;return x.H=ur,e===null?ur:e}function Yp(){var e=x.A;return x.A=GS,e}function Zo(){at=4,Oi||(xe&4194048)!==xe&&$t.current!==null||(rs=!0),(Ai&134217727)===0&&(ba&134217727)===0||Je===null||wi(Je,xe,nn,!1)}function Vu(e,n,r){var c=Be;Be|=2;var h=Kp(),p=Yp();(Je!==e||xe!==n)&&(Qo=null,ls(e,n)),n=!1;var y=at;e:do try{if(ze!==0&&Ae!==null){var S=Ae,k=tn;switch(ze){case 8:qu(),y=6;break e;case 3:case 2:case 9:case 6:$t.current===null&&(n=!0);var L=ze;if(ze=0,tn=null,us(e,S,k,L),r&&rs){y=0;break e}break;default:L=ze,ze=0,tn=null,us(e,S,k,L)}}JS(),y=at;break}catch(H){Hp(e,H)}while(!0);return n&&e.shellSuspendCounter++,Yn=ua=null,Be=c,x.H=h,x.A=p,Ae===null&&(Je=null,xe=0,vo()),y}function JS(){for(;Ae!==null;)Jp(Ae)}function QS(e,n){var r=Be;Be|=2;var c=Kp(),h=Yp();Je!==e||xe!==n?(Qo=null,Jo=Ce()+500,ls(e,n)):rs=Bs(e,n);e:do try{if(ze!==0&&Ae!==null){n=Ae;var p=tn;t:switch(ze){case 1:ze=0,tn=null,us(e,n,p,1);break;case 2:case 9:if(am(p)){ze=0,tn=null,Qp(n);break}n=function(){ze!==2&&ze!==9||Je!==e||(ze=7),xn(e)},p.then(n,n);break e;case 3:ze=7;break e;case 4:ze=5;break e;case 7:am(p)?(ze=0,tn=null,Qp(n)):(ze=0,tn=null,us(e,n,p,7));break;case 5:var y=null;switch(Ae.tag){case 26:y=Ae.memoizedState;case 5:case 27:var S=Ae;if(y?Pg(y):S.stateNode.complete){ze=0,tn=null;var k=S.sibling;if(k!==null)Ae=k;else{var L=S.return;L!==null?(Ae=L,Wo(L)):Ae=null}break t}}ze=0,tn=null,us(e,n,p,5);break;case 6:ze=0,tn=null,us(e,n,p,6);break;case 8:qu(),at=6;break e;default:throw Error(a(462))}}XS();break}catch(H){Hp(e,H)}while(!0);return Yn=ua=null,x.H=c,x.A=h,Be=r,Ae!==null?0:(Je=null,xe=0,vo(),at)}function XS(){for(;Ae!==null&&!il();)Jp(Ae)}function Jp(e){var n=yp(e.alternate,e,ii);e.memoizedProps=e.pendingProps,n===null?Wo(e):Ae=n}function Qp(e){var n=e,r=n.alternate;switch(n.tag){case 15:case 0:n=hp(r,n,n.pendingProps,n.type,void 0,xe);break;case 11:n=hp(r,n,n.pendingProps,n.type.render,n.ref,xe);break;case 5:iu(n);default:Sp(r,n),n=Ae=Yf(n,ii),n=yp(r,n,ii)}e.memoizedProps=e.pendingProps,n===null?Wo(e):Ae=n}function us(e,n,r,c){Yn=ua=null,iu(n),$a=null,nr=0;var h=n.return;try{if(jS(e,h,n,r,xe)){at=1,Bo(e,ln(r,e.current)),Ae=null;return}}catch(p){if(h!==null)throw Ae=h,p;at=1,Bo(e,ln(r,e.current)),Ae=null;return}n.flags&32768?(Pe||c===1?e=!0:rs||(xe&536870912)!==0?e=!1:(Oi=e=!0,(c===2||c===9||c===3||c===6)&&(c=$t.current,c!==null&&c.tag===13&&(c.flags|=16384))),Xp(n,e)):Wo(n)}function Wo(e){var n=e;do{if((n.flags&32768)!==0){Xp(n,Oi);return}e=n.return;var r=qS(n.alternate,n,ii);if(r!==null){Ae=r;return}if(n=n.sibling,n!==null){Ae=n;return}Ae=n=e}while(n!==null);at===0&&(at=5)}function Xp(e,n){do{var r=VS(e.alternate,e);if(r!==null){r.flags&=32767,Ae=r;return}if(r=e.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!n&&(e=e.sibling,e!==null)){Ae=e;return}Ae=e=r}while(e!==null);at=6,Ae=null}function Zp(e,n,r,c,h,p,y,S,k){e.cancelPendingCommit=null;do $o();while(vt!==0);if((Be&6)!==0)throw Error(a(327));if(n!==null){if(n===e.current)throw Error(a(177));if(p=n.lanes|n.childLanes,p|=Ml,Db(e,r,p,y,S,k),e===Je&&(Ae=Je=null,xe=0),cs=n,Mi=e,ai=r,ju=p,Bu=h,zp=c,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,eT(Ye,function(){return ng(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||c){c=x.T,x.T=null,h=$.p,$.p=2,y=Be,Be|=4;try{FS(e,n,r)}finally{Be=y,$.p=h,x.T=c}}vt=1,Wp(),$p(),eg()}}function Wp(){if(vt===1){vt=0;var e=Mi,n=cs,r=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||r){r=x.T,x.T=null;var c=$.p;$.p=2;var h=Be;Be|=4;try{xp(n,e);var p=ed,y=jf(e.containerInfo),S=p.focusedElem,k=p.selectionRange;if(y!==S&&S&&S.ownerDocument&&If(S.ownerDocument.documentElement,S)){if(k!==null&&Rl(S)){var L=k.start,H=k.end;if(H===void 0&&(H=L),"selectionStart"in S)S.selectionStart=L,S.selectionEnd=Math.min(H,S.value.length);else{var Y=S.ownerDocument||document,j=Y&&Y.defaultView||window;if(j.getSelection){var V=j.getSelection(),de=S.textContent.length,ve=Math.min(k.start,de),Ge=k.end===void 0?ve:Math.min(k.end,de);!V.extend&&ve>Ge&&(y=Ge,Ge=ve,ve=y);var D=Uf(S,ve),R=Uf(S,Ge);if(D&&R&&(V.rangeCount!==1||V.anchorNode!==D.node||V.anchorOffset!==D.offset||V.focusNode!==R.node||V.focusOffset!==R.offset)){var P=Y.createRange();P.setStart(D.node,D.offset),V.removeAllRanges(),ve>Ge?(V.addRange(P),V.extend(R.node,R.offset)):(P.setEnd(R.node,R.offset),V.addRange(P))}}}}for(Y=[],V=S;V=V.parentNode;)V.nodeType===1&&Y.push({element:V,left:V.scrollLeft,top:V.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<Y.length;S++){var G=Y[S];G.element.scrollLeft=G.left,G.element.scrollTop=G.top}}dc=!!$u,ed=$u=null}finally{Be=h,$.p=c,x.T=r}}e.current=n,vt=2}}function $p(){if(vt===2){vt=0;var e=Mi,n=cs,r=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||r){r=x.T,x.T=null;var c=$.p;$.p=2;var h=Be;Be|=4;try{Op(e,n.alternate,n)}finally{Be=h,$.p=c,x.T=r}}vt=3}}function eg(){if(vt===4||vt===3){vt=0,me();var e=Mi,n=cs,r=ai,c=zp;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?vt=5:(vt=0,cs=Mi=null,tg(e,e.pendingLanes));var h=e.pendingLanes;if(h===0&&(Di=null),rl(r),n=n.stateNode,Qt&&typeof Qt.onCommitFiberRoot=="function")try{Qt.onCommitFiberRoot(js,n,void 0,(n.current.flags&128)===128)}catch{}if(c!==null){n=x.T,h=$.p,$.p=2,x.T=null;try{for(var p=e.onRecoverableError,y=0;y<c.length;y++){var S=c[y];p(S.value,{componentStack:S.stack})}}finally{x.T=n,$.p=h}}(ai&3)!==0&&$o(),xn(e),h=e.pendingLanes,(r&261930)!==0&&(h&42)!==0?e===zu?br++:(br=0,zu=e):br=0,Sr(0)}}function tg(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,er(n)))}function $o(){return Wp(),$p(),eg(),ng()}function ng(){if(vt!==5)return!1;var e=Mi,n=ju;ju=0;var r=rl(ai),c=x.T,h=$.p;try{$.p=32>r?32:r,x.T=null,r=Bu,Bu=null;var p=Mi,y=ai;if(vt=0,cs=Mi=null,ai=0,(Be&6)!==0)throw Error(a(331));var S=Be;if(Be|=4,Ip(p.current),Pp(p,p.current,y,r),Be=S,Sr(0,!1),Qt&&typeof Qt.onPostCommitFiberRoot=="function")try{Qt.onPostCommitFiberRoot(js,p)}catch{}return!0}finally{$.p=h,x.T=c,tg(e,n)}}function ig(e,n,r){n=ln(r,n),n=yu(e.stateNode,n,2),e=ki(e,n,2),e!==null&&(zs(e,2),xn(e))}function qe(e,n,r){if(e.tag===3)ig(e,e,r);else for(;n!==null;){if(n.tag===3){ig(n,e,r);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Di===null||!Di.has(c))){e=ln(r,e),r=ap(2),c=ki(n,r,2),c!==null&&(sp(r,c,n,e),zs(c,2),xn(c));break}}n=n.return}}function Fu(e,n,r){var c=e.pingCache;if(c===null){c=e.pingCache=new KS;var h=new Set;c.set(n,h)}else h=c.get(n),h===void 0&&(h=new Set,c.set(n,h));h.has(r)||(Lu=!0,h.add(r),e=ZS.bind(null,e,n,r),n.then(e,e))}function ZS(e,n,r){var c=e.pingCache;c!==null&&c.delete(n),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,Je===e&&(xe&r)===r&&(at===4||at===3&&(xe&62914560)===xe&&300>Ce()-Yo?(Be&2)===0&&ls(e,0):Uu|=r,os===xe&&(os=0)),xn(e)}function ag(e,n){n===0&&(n=Zh()),e=oa(e,n),e!==null&&(zs(e,n),xn(e))}function WS(e){var n=e.memoizedState,r=0;n!==null&&(r=n.retryLane),ag(e,r)}function $S(e,n){var r=0;switch(e.tag){case 31:case 13:var c=e.stateNode,h=e.memoizedState;h!==null&&(r=h.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(n),ag(e,r)}function eT(e,n){return Us(e,n)}var ec=null,ds=null,Hu=!1,tc=!1,Gu=!1,xi=0;function xn(e){e!==ds&&e.next===null&&(ds===null?ec=ds=e:ds=ds.next=e),tc=!0,Hu||(Hu=!0,nT())}function Sr(e,n){if(!Gu&&tc){Gu=!0;do for(var r=!1,c=ec;c!==null;){if(e!==0){var h=c.pendingLanes;if(h===0)var p=0;else{var y=c.suspendedLanes,S=c.pingedLanes;p=(1<<31-Xt(42|e)+1)-1,p&=h&~(y&~S),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(r=!0,cg(c,p))}else p=xe,p=ao(c,c===Je?p:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(p&3)===0||Bs(c,p)||(r=!0,cg(c,p));c=c.next}while(r);Gu=!1}}function tT(){sg()}function sg(){tc=Hu=!1;var e=0;xi!==0&&hT()&&(e=xi);for(var n=Ce(),r=null,c=ec;c!==null;){var h=c.next,p=rg(c,n);p===0?(c.next=null,r===null?ec=h:r.next=h,h===null&&(ds=r)):(r=c,(e!==0||(p&3)!==0)&&(tc=!0)),c=h}vt!==0&&vt!==5||Sr(e),xi!==0&&(xi=0)}function rg(e,n){for(var r=e.suspendedLanes,c=e.pingedLanes,h=e.expirationTimes,p=e.pendingLanes&-62914561;0<p;){var y=31-Xt(p),S=1<<y,k=h[y];k===-1?((S&r)===0||(S&c)!==0)&&(h[y]=Ab(S,n)):k<=n&&(e.expiredLanes|=S),p&=~S}if(n=Je,r=xe,r=ao(e,e===n?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,r===0||e===n&&(ze===2||ze===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&Is(c),e.callbackNode=null,e.callbackPriority=0;if((r&3)===0||Bs(e,r)){if(n=r&-r,n===e.callbackPriority)return n;switch(c!==null&&Is(c),rl(r)){case 2:case 8:r=wa;break;case 32:r=Ye;break;case 268435456:r=Xh;break;default:r=Ye}return c=og.bind(null,e),r=Us(r,c),e.callbackPriority=n,e.callbackNode=r,n}return c!==null&&c!==null&&Is(c),e.callbackPriority=2,e.callbackNode=null,2}function og(e,n){if(vt!==0&&vt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var r=e.callbackNode;if($o()&&e.callbackNode!==r)return null;var c=xe;return c=ao(e,e===Je?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(Vp(e,c,n),rg(e,Ce()),e.callbackNode!=null&&e.callbackNode===r?og.bind(null,e):null)}function cg(e,n){if($o())return null;Vp(e,n,!0)}function nT(){mT(function(){(Be&6)!==0?Us(qn,tT):sg()})}function Ku(){if(xi===0){var e=Xa;e===0&&(e=to,to<<=1,(to&261888)===0&&(to=256)),xi=e}return xi}function lg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:co(""+e)}function ug(e,n){var r=n.ownerDocument.createElement("input");return r.name=n.name,r.value=n.value,e.id&&r.setAttribute("form",e.id),n.parentNode.insertBefore(r,n),e=new FormData(e),r.parentNode.removeChild(r),e}function iT(e,n,r,c,h){if(n==="submit"&&r&&r.stateNode===h){var p=lg((h[jt]||null).action),y=c.submitter;y&&(n=(n=y[jt]||null)?lg(n.formAction):y.getAttribute("formAction"),n!==null&&(p=n,y=null));var S=new fo("action","action",null,c,h);e.push({event:S,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(xi!==0){var k=y?ug(h,y):new FormData(h);hu(r,{pending:!0,data:k,method:h.method,action:p},null,k)}}else typeof p=="function"&&(S.preventDefault(),k=y?ug(h,y):new FormData(h),hu(r,{pending:!0,data:k,method:h.method,action:p},p,k))},currentTarget:h}]})}}for(var Yu=0;Yu<Dl.length;Yu++){var Ju=Dl[Yu],aT=Ju.toLowerCase(),sT=Ju[0].toUpperCase()+Ju.slice(1);bn(aT,"on"+sT)}bn(qf,"onAnimationEnd"),bn(Vf,"onAnimationIteration"),bn(Ff,"onAnimationStart"),bn("dblclick","onDoubleClick"),bn("focusin","onFocus"),bn("focusout","onBlur"),bn(TS,"onTransitionRun"),bn(CS,"onTransitionStart"),bn(kS,"onTransitionCancel"),bn(Hf,"onTransitionEnd"),Ua("onMouseEnter",["mouseout","mouseover"]),Ua("onMouseLeave",["mouseout","mouseover"]),Ua("onPointerEnter",["pointerout","pointerover"]),Ua("onPointerLeave",["pointerout","pointerover"]),ia("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ia("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ia("onBeforeInput",["compositionend","keypress","textInput","paste"]),ia("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ia("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ia("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Tr));function dg(e,n){n=(n&4)!==0;for(var r=0;r<e.length;r++){var c=e[r],h=c.event;c=c.listeners;e:{var p=void 0;if(n)for(var y=c.length-1;0<=y;y--){var S=c[y],k=S.instance,L=S.currentTarget;if(S=S.listener,k!==p&&h.isPropagationStopped())break e;p=S,h.currentTarget=L;try{p(h)}catch(H){go(H)}h.currentTarget=null,p=k}else for(y=0;y<c.length;y++){if(S=c[y],k=S.instance,L=S.currentTarget,S=S.listener,k!==p&&h.isPropagationStopped())break e;p=S,h.currentTarget=L;try{p(h)}catch(H){go(H)}h.currentTarget=null,p=k}}}}function De(e,n){var r=n[ol];r===void 0&&(r=n[ol]=new Set);var c=e+"__bubble";r.has(c)||(hg(n,e,2,!1),r.add(c))}function Qu(e,n,r){var c=0;n&&(c|=4),hg(r,e,c,n)}var nc="_reactListening"+Math.random().toString(36).slice(2);function Xu(e){if(!e[nc]){e[nc]=!0,sf.forEach(function(r){r!=="selectionchange"&&(rT.has(r)||Qu(r,!1,e),Qu(r,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[nc]||(n[nc]=!0,Qu("selectionchange",!1,n))}}function hg(e,n,r,c){switch(qg(n)){case 2:var h=PT;break;case 8:h=LT;break;default:h=dd}r=h.bind(null,n,r,e),h=void 0,!gl||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(h=!0),c?h!==void 0?e.addEventListener(n,r,{capture:!0,passive:h}):e.addEventListener(n,r,!0):h!==void 0?e.addEventListener(n,r,{passive:h}):e.addEventListener(n,r,!1)}function Zu(e,n,r,c,h){var p=c;if((n&1)===0&&(n&2)===0&&c!==null)e:for(;;){if(c===null)return;var y=c.tag;if(y===3||y===4){var S=c.stateNode.containerInfo;if(S===h)break;if(y===4)for(y=c.return;y!==null;){var k=y.tag;if((k===3||k===4)&&y.stateNode.containerInfo===h)return;y=y.return}for(;S!==null;){if(y=Na(S),y===null)return;if(k=y.tag,k===5||k===6||k===26||k===27){c=p=y;continue e}S=S.parentNode}}c=c.return}vf(function(){var L=p,H=ml(r),Y=[];e:{var j=Gf.get(e);if(j!==void 0){var V=fo,de=e;switch(e){case"keypress":if(uo(r)===0)break e;case"keydown":case"keyup":V=$b;break;case"focusin":de="focus",V=Sl;break;case"focusout":de="blur",V=Sl;break;case"beforeblur":case"afterblur":V=Sl;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":V=Sf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":V=qb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":V=nS;break;case qf:case Vf:case Ff:V=Hb;break;case Hf:V=aS;break;case"scroll":case"scrollend":V=Bb;break;case"wheel":V=rS;break;case"copy":case"cut":case"paste":V=Kb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":V=Cf;break;case"toggle":case"beforetoggle":V=cS}var ve=(n&4)!==0,Ge=!ve&&(e==="scroll"||e==="scrollend"),D=ve?j!==null?j+"Capture":null:j;ve=[];for(var R=L,P;R!==null;){var G=R;if(P=G.stateNode,G=G.tag,G!==5&&G!==26&&G!==27||P===null||D===null||(G=Fs(R,D),G!=null&&ve.push(Cr(R,G,P))),Ge)break;R=R.return}0<ve.length&&(j=new V(j,de,null,r,H),Y.push({event:j,listeners:ve}))}}if((n&7)===0){e:{if(j=e==="mouseover"||e==="pointerover",V=e==="mouseout"||e==="pointerout",j&&r!==fl&&(de=r.relatedTarget||r.fromElement)&&(Na(de)||de[xa]))break e;if((V||j)&&(j=H.window===H?H:(j=H.ownerDocument)?j.defaultView||j.parentWindow:window,V?(de=r.relatedTarget||r.toElement,V=L,de=de?Na(de):null,de!==null&&(Ge=l(de),ve=de.tag,de!==Ge||ve!==5&&ve!==27&&ve!==6)&&(de=null)):(V=null,de=L),V!==de)){if(ve=Sf,G="onMouseLeave",D="onMouseEnter",R="mouse",(e==="pointerout"||e==="pointerover")&&(ve=Cf,G="onPointerLeave",D="onPointerEnter",R="pointer"),Ge=V==null?j:Vs(V),P=de==null?j:Vs(de),j=new ve(G,R+"leave",V,r,H),j.target=Ge,j.relatedTarget=P,G=null,Na(H)===L&&(ve=new ve(D,R+"enter",de,r,H),ve.target=P,ve.relatedTarget=Ge,G=ve),Ge=G,V&&de)t:{for(ve=oT,D=V,R=de,P=0,G=D;G;G=ve(G))P++;G=0;for(var ge=R;ge;ge=ve(ge))G++;for(;0<P-G;)D=ve(D),P--;for(;0<G-P;)R=ve(R),G--;for(;P--;){if(D===R||R!==null&&D===R.alternate){ve=D;break t}D=ve(D),R=ve(R)}ve=null}else ve=null;V!==null&&fg(Y,j,V,ve,!1),de!==null&&Ge!==null&&fg(Y,Ge,de,ve,!0)}}e:{if(j=L?Vs(L):window,V=j.nodeName&&j.nodeName.toLowerCase(),V==="select"||V==="input"&&j.type==="file")var Ie=Mf;else if(Af(j))if(wf)Ie=yS;else{Ie=gS;var fe=pS}else V=j.nodeName,!V||V.toLowerCase()!=="input"||j.type!=="checkbox"&&j.type!=="radio"?L&&hl(L.elementType)&&(Ie=Mf):Ie=vS;if(Ie&&(Ie=Ie(e,L))){Df(Y,Ie,r,H);break e}fe&&fe(e,j,L),e==="focusout"&&L&&j.type==="number"&&L.memoizedProps.value!=null&&dl(j,"number",j.value)}switch(fe=L?Vs(L):window,e){case"focusin":(Af(fe)||fe.contentEditable==="true")&&(Va=fe,_l=L,Zs=null);break;case"focusout":Zs=_l=Va=null;break;case"mousedown":Ol=!0;break;case"contextmenu":case"mouseup":case"dragend":Ol=!1,Bf(Y,r,H);break;case"selectionchange":if(SS)break;case"keydown":case"keyup":Bf(Y,r,H)}var Ee;if(Cl)e:{switch(e){case"compositionstart":var Ne="onCompositionStart";break e;case"compositionend":Ne="onCompositionEnd";break e;case"compositionupdate":Ne="onCompositionUpdate";break e}Ne=void 0}else qa?_f(e,r)&&(Ne="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(Ne="onCompositionStart");Ne&&(kf&&r.locale!=="ko"&&(qa||Ne!=="onCompositionStart"?Ne==="onCompositionEnd"&&qa&&(Ee=yf()):(gi=H,vl="value"in gi?gi.value:gi.textContent,qa=!0)),fe=ic(L,Ne),0<fe.length&&(Ne=new Tf(Ne,e,null,r,H),Y.push({event:Ne,listeners:fe}),Ee?Ne.data=Ee:(Ee=Of(r),Ee!==null&&(Ne.data=Ee)))),(Ee=uS?dS(e,r):hS(e,r))&&(Ne=ic(L,"onBeforeInput"),0<Ne.length&&(fe=new Tf("onBeforeInput","beforeinput",null,r,H),Y.push({event:fe,listeners:Ne}),fe.data=Ee)),iT(Y,e,L,r,H)}dg(Y,n)})}function Cr(e,n,r){return{instance:e,listener:n,currentTarget:r}}function ic(e,n){for(var r=n+"Capture",c=[];e!==null;){var h=e,p=h.stateNode;if(h=h.tag,h!==5&&h!==26&&h!==27||p===null||(h=Fs(e,r),h!=null&&c.unshift(Cr(e,h,p)),h=Fs(e,n),h!=null&&c.push(Cr(e,h,p))),e.tag===3)return c;e=e.return}return[]}function oT(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function fg(e,n,r,c,h){for(var p=n._reactName,y=[];r!==null&&r!==c;){var S=r,k=S.alternate,L=S.stateNode;if(S=S.tag,k!==null&&k===c)break;S!==5&&S!==26&&S!==27||L===null||(k=L,h?(L=Fs(r,p),L!=null&&y.unshift(Cr(r,L,k))):h||(L=Fs(r,p),L!=null&&y.push(Cr(r,L,k)))),r=r.return}y.length!==0&&e.push({event:n,listeners:y})}var cT=/\r\n?/g,lT=/\u0000|\uFFFD/g;function mg(e){return(typeof e=="string"?e:""+e).replace(cT,`
`).replace(lT,"")}function pg(e,n){return n=mg(n),mg(e)===n}function He(e,n,r,c,h,p){switch(r){case"children":typeof c=="string"?n==="body"||n==="textarea"&&c===""||ja(e,c):(typeof c=="number"||typeof c=="bigint")&&n!=="body"&&ja(e,""+c);break;case"className":ro(e,"class",c);break;case"tabIndex":ro(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":ro(e,r,c);break;case"style":pf(e,c,p);break;case"data":if(n!=="object"){ro(e,"data",c);break}case"src":case"href":if(c===""&&(n!=="a"||r!=="href")){e.removeAttribute(r);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(r);break}c=co(""+c),e.setAttribute(r,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(r==="formAction"?(n!=="input"&&He(e,n,"name",h.name,h,null),He(e,n,"formEncType",h.formEncType,h,null),He(e,n,"formMethod",h.formMethod,h,null),He(e,n,"formTarget",h.formTarget,h,null)):(He(e,n,"encType",h.encType,h,null),He(e,n,"method",h.method,h,null),He(e,n,"target",h.target,h,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(r);break}c=co(""+c),e.setAttribute(r,c);break;case"onClick":c!=null&&(e.onclick=Fn);break;case"onScroll":c!=null&&De("scroll",e);break;case"onScrollEnd":c!=null&&De("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(r=c.__html,r!=null){if(h.children!=null)throw Error(a(60));e.innerHTML=r}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}r=co(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(r,""+c):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":c===!0?e.setAttribute(r,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(r,c):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(r,c):e.removeAttribute(r);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(r):e.setAttribute(r,c);break;case"popover":De("beforetoggle",e),De("toggle",e),so(e,"popover",c);break;case"xlinkActuate":Vn(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Vn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Vn(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Vn(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Vn(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Vn(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Vn(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Vn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Vn(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":so(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=Ib.get(r)||r,so(e,r,c))}}function Wu(e,n,r,c,h,p){switch(r){case"style":pf(e,c,p);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(r=c.__html,r!=null){if(h.children!=null)throw Error(a(60));e.innerHTML=r}}break;case"children":typeof c=="string"?ja(e,c):(typeof c=="number"||typeof c=="bigint")&&ja(e,""+c);break;case"onScroll":c!=null&&De("scroll",e);break;case"onScrollEnd":c!=null&&De("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Fn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!rf.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(h=r.endsWith("Capture"),n=r.slice(2,h?r.length-7:void 0),p=e[jt]||null,p=p!=null?p[r]:null,typeof p=="function"&&e.removeEventListener(n,p,h),typeof c=="function")){typeof p!="function"&&p!==null&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(n,c,h);break e}r in e?e[r]=c:c===!0?e.setAttribute(r,""):so(e,r,c)}}}function Dt(e,n,r){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":De("error",e),De("load",e);var c=!1,h=!1,p;for(p in r)if(r.hasOwnProperty(p)){var y=r[p];if(y!=null)switch(p){case"src":c=!0;break;case"srcSet":h=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:He(e,n,p,y,r,null)}}h&&He(e,n,"srcSet",r.srcSet,r,null),c&&He(e,n,"src",r.src,r,null);return;case"input":De("invalid",e);var S=p=y=h=null,k=null,L=null;for(c in r)if(r.hasOwnProperty(c)){var H=r[c];if(H!=null)switch(c){case"name":h=H;break;case"type":y=H;break;case"checked":k=H;break;case"defaultChecked":L=H;break;case"value":p=H;break;case"defaultValue":S=H;break;case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(a(137,n));break;default:He(e,n,c,H,r,null)}}df(e,p,S,k,L,y,h,!1);return;case"select":De("invalid",e),c=y=p=null;for(h in r)if(r.hasOwnProperty(h)&&(S=r[h],S!=null))switch(h){case"value":p=S;break;case"defaultValue":y=S;break;case"multiple":c=S;default:He(e,n,h,S,r,null)}n=p,r=y,e.multiple=!!c,n!=null?Ia(e,!!c,n,!1):r!=null&&Ia(e,!!c,r,!0);return;case"textarea":De("invalid",e),p=h=c=null;for(y in r)if(r.hasOwnProperty(y)&&(S=r[y],S!=null))switch(y){case"value":c=S;break;case"defaultValue":h=S;break;case"children":p=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(a(91));break;default:He(e,n,y,S,r,null)}ff(e,c,h,p);return;case"option":for(k in r)if(r.hasOwnProperty(k)&&(c=r[k],c!=null))switch(k){case"selected":e.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:He(e,n,k,c,r,null)}return;case"dialog":De("beforetoggle",e),De("toggle",e),De("cancel",e),De("close",e);break;case"iframe":case"object":De("load",e);break;case"video":case"audio":for(c=0;c<Tr.length;c++)De(Tr[c],e);break;case"image":De("error",e),De("load",e);break;case"details":De("toggle",e);break;case"embed":case"source":case"link":De("error",e),De("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(L in r)if(r.hasOwnProperty(L)&&(c=r[L],c!=null))switch(L){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:He(e,n,L,c,r,null)}return;default:if(hl(n)){for(H in r)r.hasOwnProperty(H)&&(c=r[H],c!==void 0&&Wu(e,n,H,c,r,void 0));return}}for(S in r)r.hasOwnProperty(S)&&(c=r[S],c!=null&&He(e,n,S,c,r,null))}function uT(e,n,r,c){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var h=null,p=null,y=null,S=null,k=null,L=null,H=null;for(V in r){var Y=r[V];if(r.hasOwnProperty(V)&&Y!=null)switch(V){case"checked":break;case"value":break;case"defaultValue":k=Y;default:c.hasOwnProperty(V)||He(e,n,V,null,c,Y)}}for(var j in c){var V=c[j];if(Y=r[j],c.hasOwnProperty(j)&&(V!=null||Y!=null))switch(j){case"type":p=V;break;case"name":h=V;break;case"checked":L=V;break;case"defaultChecked":H=V;break;case"value":y=V;break;case"defaultValue":S=V;break;case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(a(137,n));break;default:V!==Y&&He(e,n,j,V,c,Y)}}ul(e,y,S,k,L,H,p,h);return;case"select":V=y=S=j=null;for(p in r)if(k=r[p],r.hasOwnProperty(p)&&k!=null)switch(p){case"value":break;case"multiple":V=k;default:c.hasOwnProperty(p)||He(e,n,p,null,c,k)}for(h in c)if(p=c[h],k=r[h],c.hasOwnProperty(h)&&(p!=null||k!=null))switch(h){case"value":j=p;break;case"defaultValue":S=p;break;case"multiple":y=p;default:p!==k&&He(e,n,h,p,c,k)}n=S,r=y,c=V,j!=null?Ia(e,!!r,j,!1):!!c!=!!r&&(n!=null?Ia(e,!!r,n,!0):Ia(e,!!r,r?[]:"",!1));return;case"textarea":V=j=null;for(S in r)if(h=r[S],r.hasOwnProperty(S)&&h!=null&&!c.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:He(e,n,S,null,c,h)}for(y in c)if(h=c[y],p=r[y],c.hasOwnProperty(y)&&(h!=null||p!=null))switch(y){case"value":j=h;break;case"defaultValue":V=h;break;case"children":break;case"dangerouslySetInnerHTML":if(h!=null)throw Error(a(91));break;default:h!==p&&He(e,n,y,h,c,p)}hf(e,j,V);return;case"option":for(var de in r)if(j=r[de],r.hasOwnProperty(de)&&j!=null&&!c.hasOwnProperty(de))switch(de){case"selected":e.selected=!1;break;default:He(e,n,de,null,c,j)}for(k in c)if(j=c[k],V=r[k],c.hasOwnProperty(k)&&j!==V&&(j!=null||V!=null))switch(k){case"selected":e.selected=j&&typeof j!="function"&&typeof j!="symbol";break;default:He(e,n,k,j,c,V)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ve in r)j=r[ve],r.hasOwnProperty(ve)&&j!=null&&!c.hasOwnProperty(ve)&&He(e,n,ve,null,c,j);for(L in c)if(j=c[L],V=r[L],c.hasOwnProperty(L)&&j!==V&&(j!=null||V!=null))switch(L){case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(a(137,n));break;default:He(e,n,L,j,c,V)}return;default:if(hl(n)){for(var Ge in r)j=r[Ge],r.hasOwnProperty(Ge)&&j!==void 0&&!c.hasOwnProperty(Ge)&&Wu(e,n,Ge,void 0,c,j);for(H in c)j=c[H],V=r[H],!c.hasOwnProperty(H)||j===V||j===void 0&&V===void 0||Wu(e,n,H,j,c,V);return}}for(var D in r)j=r[D],r.hasOwnProperty(D)&&j!=null&&!c.hasOwnProperty(D)&&He(e,n,D,null,c,j);for(Y in c)j=c[Y],V=r[Y],!c.hasOwnProperty(Y)||j===V||j==null&&V==null||He(e,n,Y,j,c,V)}function gg(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function dT(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,r=performance.getEntriesByType("resource"),c=0;c<r.length;c++){var h=r[c],p=h.transferSize,y=h.initiatorType,S=h.duration;if(p&&S&&gg(y)){for(y=0,S=h.responseEnd,c+=1;c<r.length;c++){var k=r[c],L=k.startTime;if(L>S)break;var H=k.transferSize,Y=k.initiatorType;H&&gg(Y)&&(k=k.responseEnd,y+=H*(k<S?1:(S-L)/(k-L)))}if(--c,n+=8*(p+y)/(h.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var $u=null,ed=null;function ac(e){return e.nodeType===9?e:e.ownerDocument}function vg(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yg(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function td(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var nd=null;function hT(){var e=window.event;return e&&e.type==="popstate"?e===nd?!1:(nd=e,!0):(nd=null,!1)}var bg=typeof setTimeout=="function"?setTimeout:void 0,fT=typeof clearTimeout=="function"?clearTimeout:void 0,Sg=typeof Promise=="function"?Promise:void 0,mT=typeof queueMicrotask=="function"?queueMicrotask:typeof Sg<"u"?function(e){return Sg.resolve(null).then(e).catch(pT)}:bg;function pT(e){setTimeout(function(){throw e})}function Ni(e){return e==="head"}function Tg(e,n){var r=n,c=0;do{var h=r.nextSibling;if(e.removeChild(r),h&&h.nodeType===8)if(r=h.data,r==="/$"||r==="/&"){if(c===0){e.removeChild(h),ps(n);return}c--}else if(r==="$"||r==="$?"||r==="$~"||r==="$!"||r==="&")c++;else if(r==="html")kr(e.ownerDocument.documentElement);else if(r==="head"){r=e.ownerDocument.head,kr(r);for(var p=r.firstChild;p;){var y=p.nextSibling,S=p.nodeName;p[qs]||S==="SCRIPT"||S==="STYLE"||S==="LINK"&&p.rel.toLowerCase()==="stylesheet"||r.removeChild(p),p=y}}else r==="body"&&kr(e.ownerDocument.body);r=h}while(r);ps(n)}function Cg(e,n){var r=e;e=0;do{var c=r.nextSibling;if(r.nodeType===1?n?(r._stashedDisplay=r.style.display,r.style.display="none"):(r.style.display=r._stashedDisplay||"",r.getAttribute("style")===""&&r.removeAttribute("style")):r.nodeType===3&&(n?(r._stashedText=r.nodeValue,r.nodeValue=""):r.nodeValue=r._stashedText||""),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(e===0)break;e--}else r!=="$"&&r!=="$?"&&r!=="$~"&&r!=="$!"||e++;r=c}while(r)}function id(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var r=n;switch(n=n.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":id(r),cl(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}e.removeChild(r)}}function gT(e,n,r,c){for(;e.nodeType===1;){var h=r;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[qs])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(p=e.getAttribute("rel"),p==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(p!==h.rel||e.getAttribute("href")!==(h.href==null||h.href===""?null:h.href)||e.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin)||e.getAttribute("title")!==(h.title==null?null:h.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(p=e.getAttribute("src"),(p!==(h.src==null?null:h.src)||e.getAttribute("type")!==(h.type==null?null:h.type)||e.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin))&&p&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var p=h.name==null?null:""+h.name;if(h.type==="hidden"&&e.getAttribute("name")===p)return e}else return e;if(e=mn(e.nextSibling),e===null)break}return null}function vT(e,n,r){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=mn(e.nextSibling),e===null))return null;return e}function kg(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=mn(e.nextSibling),e===null))return null;return e}function ad(e){return e.data==="$?"||e.data==="$~"}function sd(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function yT(e,n){var r=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||r.readyState!=="loading")n();else{var c=function(){n(),r.removeEventListener("DOMContentLoaded",c)};r.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function mn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var rd=null;function Eg(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"||r==="/&"){if(n===0)return mn(e.nextSibling);n--}else r!=="$"&&r!=="$!"&&r!=="$?"&&r!=="$~"&&r!=="&"||n++}e=e.nextSibling}return null}function Rg(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"){if(n===0)return e;n--}else r!=="/$"&&r!=="/&"||n++}e=e.previousSibling}return null}function _g(e,n,r){switch(n=ac(r),e){case"html":if(e=n.documentElement,!e)throw Error(a(452));return e;case"head":if(e=n.head,!e)throw Error(a(453));return e;case"body":if(e=n.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function kr(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);cl(e)}var pn=new Map,Og=new Set;function sc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var si=$.d;$.d={f:bT,r:ST,D:TT,C:CT,L:kT,m:ET,X:_T,S:RT,M:OT};function bT(){var e=si.f(),n=Xo();return e||n}function ST(e){var n=Pa(e);n!==null&&n.tag===5&&n.type==="form"?Hm(n):si.r(e)}var hs=typeof document>"u"?null:document;function Ag(e,n,r){var c=hs;if(c&&typeof n=="string"&&n){var h=on(n);h='link[rel="'+e+'"][href="'+h+'"]',typeof r=="string"&&(h+='[crossorigin="'+r+'"]'),Og.has(h)||(Og.add(h),e={rel:e,crossOrigin:r,href:n},c.querySelector(h)===null&&(n=c.createElement("link"),Dt(n,"link",e),St(n),c.head.appendChild(n)))}}function TT(e){si.D(e),Ag("dns-prefetch",e,null)}function CT(e,n){si.C(e,n),Ag("preconnect",e,n)}function kT(e,n,r){si.L(e,n,r);var c=hs;if(c&&e&&n){var h='link[rel="preload"][as="'+on(n)+'"]';n==="image"&&r&&r.imageSrcSet?(h+='[imagesrcset="'+on(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(h+='[imagesizes="'+on(r.imageSizes)+'"]')):h+='[href="'+on(e)+'"]';var p=h;switch(n){case"style":p=fs(e);break;case"script":p=ms(e)}pn.has(p)||(e=v({rel:"preload",href:n==="image"&&r&&r.imageSrcSet?void 0:e,as:n},r),pn.set(p,e),c.querySelector(h)!==null||n==="style"&&c.querySelector(Er(p))||n==="script"&&c.querySelector(Rr(p))||(n=c.createElement("link"),Dt(n,"link",e),St(n),c.head.appendChild(n)))}}function ET(e,n){si.m(e,n);var r=hs;if(r&&e){var c=n&&typeof n.as=="string"?n.as:"script",h='link[rel="modulepreload"][as="'+on(c)+'"][href="'+on(e)+'"]',p=h;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=ms(e)}if(!pn.has(p)&&(e=v({rel:"modulepreload",href:e},n),pn.set(p,e),r.querySelector(h)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Rr(p)))return}c=r.createElement("link"),Dt(c,"link",e),St(c),r.head.appendChild(c)}}}function RT(e,n,r){si.S(e,n,r);var c=hs;if(c&&e){var h=La(c).hoistableStyles,p=fs(e);n=n||"default";var y=h.get(p);if(!y){var S={loading:0,preload:null};if(y=c.querySelector(Er(p)))S.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":n},r),(r=pn.get(p))&&od(e,r);var k=y=c.createElement("link");St(k),Dt(k,"link",e),k._p=new Promise(function(L,H){k.onload=L,k.onerror=H}),k.addEventListener("load",function(){S.loading|=1}),k.addEventListener("error",function(){S.loading|=2}),S.loading|=4,rc(y,n,c)}y={type:"stylesheet",instance:y,count:1,state:S},h.set(p,y)}}}function _T(e,n){si.X(e,n);var r=hs;if(r&&e){var c=La(r).hoistableScripts,h=ms(e),p=c.get(h);p||(p=r.querySelector(Rr(h)),p||(e=v({src:e,async:!0},n),(n=pn.get(h))&&cd(e,n),p=r.createElement("script"),St(p),Dt(p,"link",e),r.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},c.set(h,p))}}function OT(e,n){si.M(e,n);var r=hs;if(r&&e){var c=La(r).hoistableScripts,h=ms(e),p=c.get(h);p||(p=r.querySelector(Rr(h)),p||(e=v({src:e,async:!0,type:"module"},n),(n=pn.get(h))&&cd(e,n),p=r.createElement("script"),St(p),Dt(p,"link",e),r.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},c.set(h,p))}}function Dg(e,n,r,c){var h=(h=Se.current)?sc(h):null;if(!h)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(n=fs(r.href),r=La(h).hoistableStyles,c=r.get(n),c||(c={type:"style",instance:null,count:0,state:null},r.set(n,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){e=fs(r.href);var p=La(h).hoistableStyles,y=p.get(e);if(y||(h=h.ownerDocument||h,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(e,y),(p=h.querySelector(Er(e)))&&!p._p&&(y.instance=p,y.state.loading=5),pn.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},pn.set(e,r),p||AT(h,e,r,y.state))),n&&c===null)throw Error(a(528,""));return y}if(n&&c!==null)throw Error(a(529,""));return null;case"script":return n=r.async,r=r.src,typeof r=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=ms(r),r=La(h).hoistableScripts,c=r.get(n),c||(c={type:"script",instance:null,count:0,state:null},r.set(n,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function fs(e){return'href="'+on(e)+'"'}function Er(e){return'link[rel="stylesheet"]['+e+"]"}function Mg(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function AT(e,n,r,c){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?c.loading=1:(n=e.createElement("link"),c.preload=n,n.addEventListener("load",function(){return c.loading|=1}),n.addEventListener("error",function(){return c.loading|=2}),Dt(n,"link",r),St(n),e.head.appendChild(n))}function ms(e){return'[src="'+on(e)+'"]'}function Rr(e){return"script[async]"+e}function wg(e,n,r){if(n.count++,n.instance===null)switch(n.type){case"style":var c=e.querySelector('style[data-href~="'+on(r.href)+'"]');if(c)return n.instance=c,St(c),c;var h=v({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),St(c),Dt(c,"style",h),rc(c,r.precedence,e),n.instance=c;case"stylesheet":h=fs(r.href);var p=e.querySelector(Er(h));if(p)return n.state.loading|=4,n.instance=p,St(p),p;c=Mg(r),(h=pn.get(h))&&od(c,h),p=(e.ownerDocument||e).createElement("link"),St(p);var y=p;return y._p=new Promise(function(S,k){y.onload=S,y.onerror=k}),Dt(p,"link",c),n.state.loading|=4,rc(p,r.precedence,e),n.instance=p;case"script":return p=ms(r.src),(h=e.querySelector(Rr(p)))?(n.instance=h,St(h),h):(c=r,(h=pn.get(p))&&(c=v({},r),cd(c,h)),e=e.ownerDocument||e,h=e.createElement("script"),St(h),Dt(h,"link",c),e.head.appendChild(h),n.instance=h);case"void":return null;default:throw Error(a(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(c=n.instance,n.state.loading|=4,rc(c,r.precedence,e));return n.instance}function rc(e,n,r){for(var c=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),h=c.length?c[c.length-1]:null,p=h,y=0;y<c.length;y++){var S=c[y];if(S.dataset.precedence===n)p=S;else if(p!==h)break}p?p.parentNode.insertBefore(e,p.nextSibling):(n=r.nodeType===9?r.head:r,n.insertBefore(e,n.firstChild))}function od(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function cd(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var oc=null;function xg(e,n,r){if(oc===null){var c=new Map,h=oc=new Map;h.set(r,c)}else h=oc,c=h.get(r),c||(c=new Map,h.set(r,c));if(c.has(e))return c;for(c.set(e,null),r=r.getElementsByTagName(e),h=0;h<r.length;h++){var p=r[h];if(!(p[qs]||p[Rt]||e==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var y=p.getAttribute(n)||"";y=e+y;var S=c.get(y);S?S.push(p):c.set(y,[p])}}return c}function Ng(e,n,r){e=e.ownerDocument||e,e.head.insertBefore(r,n==="title"?e.querySelector("head > title"):null)}function DT(e,n,r){if(r===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function Pg(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function MT(e,n,r,c){if(r.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var h=fs(c.href),p=n.querySelector(Er(h));if(p){n=p._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=cc.bind(e),n.then(e,e)),r.state.loading|=4,r.instance=p,St(p);return}p=n.ownerDocument||n,c=Mg(c),(h=pn.get(h))&&od(c,h),p=p.createElement("link"),St(p);var y=p;y._p=new Promise(function(S,k){y.onload=S,y.onerror=k}),Dt(p,"link",c),r.instance=p}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(r,n),(n=r.state.preload)&&(r.state.loading&3)===0&&(e.count++,r=cc.bind(e),n.addEventListener("load",r),n.addEventListener("error",r))}}var ld=0;function wT(e,n){return e.stylesheets&&e.count===0&&uc(e,e.stylesheets),0<e.count||0<e.imgCount?function(r){var c=setTimeout(function(){if(e.stylesheets&&uc(e,e.stylesheets),e.unsuspend){var p=e.unsuspend;e.unsuspend=null,p()}},6e4+n);0<e.imgBytes&&ld===0&&(ld=62500*dT());var h=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&uc(e,e.stylesheets),e.unsuspend)){var p=e.unsuspend;e.unsuspend=null,p()}},(e.imgBytes>ld?50:800)+n);return e.unsuspend=r,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(h)}}:null}function cc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)uc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var lc=null;function uc(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,lc=new Map,n.forEach(xT,e),lc=null,cc.call(e))}function xT(e,n){if(!(n.state.loading&4)){var r=lc.get(e);if(r)var c=r.get(null);else{r=new Map,lc.set(e,r);for(var h=e.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<h.length;p++){var y=h[p];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(r.set(y.dataset.precedence,y),c=y)}c&&r.set(null,c)}h=n.instance,y=h.getAttribute("data-precedence"),p=r.get(y)||c,p===c&&r.set(null,h),r.set(y,h),this.count++,c=cc.bind(this),h.addEventListener("load",c),h.addEventListener("error",c),p?p.parentNode.insertBefore(h,p.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(h,e.firstChild)),n.state.loading|=4}}var _r={$$typeof:K,Provider:null,Consumer:null,_currentValue:ue,_currentValue2:ue,_threadCount:0};function NT(e,n,r,c,h,p,y,S,k){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=al(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=al(0),this.hiddenUpdates=al(null),this.identifierPrefix=c,this.onUncaughtError=h,this.onCaughtError=p,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=k,this.incompleteTransitions=new Map}function Lg(e,n,r,c,h,p,y,S,k,L,H,Y){return e=new NT(e,n,r,y,k,L,H,Y,S),n=1,p===!0&&(n|=24),p=Wt(3,null,null,n),e.current=p,p.stateNode=e,n=Vl(),n.refCount++,e.pooledCache=n,n.refCount++,p.memoizedState={element:c,isDehydrated:r,cache:n},Kl(p),e}function Ug(e){return e?(e=Ga,e):Ga}function Ig(e,n,r,c,h,p){h=Ug(h),c.context===null?c.context=h:c.pendingContext=h,c=Ci(n),c.payload={element:r},p=p===void 0?null:p,p!==null&&(c.callback=p),r=ki(e,c,n),r!==null&&(Ht(r,e,n),ar(r,e,n))}function jg(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<n?r:n}}function ud(e,n){jg(e,n),(e=e.alternate)&&jg(e,n)}function Bg(e){if(e.tag===13||e.tag===31){var n=oa(e,67108864);n!==null&&Ht(n,e,67108864),ud(e,67108864)}}function zg(e){if(e.tag===13||e.tag===31){var n=an();n=sl(n);var r=oa(e,n);r!==null&&Ht(r,e,n),ud(e,n)}}var dc=!0;function PT(e,n,r,c){var h=x.T;x.T=null;var p=$.p;try{$.p=2,dd(e,n,r,c)}finally{$.p=p,x.T=h}}function LT(e,n,r,c){var h=x.T;x.T=null;var p=$.p;try{$.p=8,dd(e,n,r,c)}finally{$.p=p,x.T=h}}function dd(e,n,r,c){if(dc){var h=hd(c);if(h===null)Zu(e,n,c,hc,r),Vg(e,c);else if(IT(h,e,n,r,c))c.stopPropagation();else if(Vg(e,c),n&4&&-1<UT.indexOf(e)){for(;h!==null;){var p=Pa(h);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var y=na(p.pendingLanes);if(y!==0){var S=p;for(S.pendingLanes|=2,S.entangledLanes|=2;y;){var k=1<<31-Xt(y);S.entanglements[1]|=k,y&=~k}xn(p),(Be&6)===0&&(Jo=Ce()+500,Sr(0))}}break;case 31:case 13:S=oa(p,2),S!==null&&Ht(S,p,2),Xo(),ud(p,2)}if(p=hd(c),p===null&&Zu(e,n,c,hc,r),p===h)break;h=p}h!==null&&c.stopPropagation()}else Zu(e,n,c,null,r)}}function hd(e){return e=ml(e),fd(e)}var hc=null;function fd(e){if(hc=null,e=Na(e),e!==null){var n=l(e);if(n===null)e=null;else{var r=n.tag;if(r===13){if(e=u(n),e!==null)return e;e=null}else if(r===31){if(e=d(n),e!==null)return e;e=null}else if(r===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return hc=e,null}function qg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Jt()){case qn:return 2;case wa:return 8;case Ye:case eo:return 32;case Xh:return 268435456;default:return 32}default:return 32}}var md=!1,Pi=null,Li=null,Ui=null,Or=new Map,Ar=new Map,Ii=[],UT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Vg(e,n){switch(e){case"focusin":case"focusout":Pi=null;break;case"dragenter":case"dragleave":Li=null;break;case"mouseover":case"mouseout":Ui=null;break;case"pointerover":case"pointerout":Or.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ar.delete(n.pointerId)}}function Dr(e,n,r,c,h,p){return e===null||e.nativeEvent!==p?(e={blockedOn:n,domEventName:r,eventSystemFlags:c,nativeEvent:p,targetContainers:[h]},n!==null&&(n=Pa(n),n!==null&&Bg(n)),e):(e.eventSystemFlags|=c,n=e.targetContainers,h!==null&&n.indexOf(h)===-1&&n.push(h),e)}function IT(e,n,r,c,h){switch(n){case"focusin":return Pi=Dr(Pi,e,n,r,c,h),!0;case"dragenter":return Li=Dr(Li,e,n,r,c,h),!0;case"mouseover":return Ui=Dr(Ui,e,n,r,c,h),!0;case"pointerover":var p=h.pointerId;return Or.set(p,Dr(Or.get(p)||null,e,n,r,c,h)),!0;case"gotpointercapture":return p=h.pointerId,Ar.set(p,Dr(Ar.get(p)||null,e,n,r,c,h)),!0}return!1}function Fg(e){var n=Na(e.target);if(n!==null){var r=l(n);if(r!==null){if(n=r.tag,n===13){if(n=u(r),n!==null){e.blockedOn=n,nf(e.priority,function(){zg(r)});return}}else if(n===31){if(n=d(r),n!==null){e.blockedOn=n,nf(e.priority,function(){zg(r)});return}}else if(n===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function fc(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var r=hd(e.nativeEvent);if(r===null){r=e.nativeEvent;var c=new r.constructor(r.type,r);fl=c,r.target.dispatchEvent(c),fl=null}else return n=Pa(r),n!==null&&Bg(n),e.blockedOn=r,!1;n.shift()}return!0}function Hg(e,n,r){fc(e)&&r.delete(n)}function jT(){md=!1,Pi!==null&&fc(Pi)&&(Pi=null),Li!==null&&fc(Li)&&(Li=null),Ui!==null&&fc(Ui)&&(Ui=null),Or.forEach(Hg),Ar.forEach(Hg)}function mc(e,n){e.blockedOn===n&&(e.blockedOn=null,md||(md=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,jT)))}var pc=null;function Gg(e){pc!==e&&(pc=e,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){pc===e&&(pc=null);for(var n=0;n<e.length;n+=3){var r=e[n],c=e[n+1],h=e[n+2];if(typeof c!="function"){if(fd(c||r)===null)continue;break}var p=Pa(r);p!==null&&(e.splice(n,3),n-=3,hu(p,{pending:!0,data:h,method:r.method,action:c},c,h))}}))}function ps(e){function n(k){return mc(k,e)}Pi!==null&&mc(Pi,e),Li!==null&&mc(Li,e),Ui!==null&&mc(Ui,e),Or.forEach(n),Ar.forEach(n);for(var r=0;r<Ii.length;r++){var c=Ii[r];c.blockedOn===e&&(c.blockedOn=null)}for(;0<Ii.length&&(r=Ii[0],r.blockedOn===null);)Fg(r),r.blockedOn===null&&Ii.shift();if(r=(e.ownerDocument||e).$$reactFormReplay,r!=null)for(c=0;c<r.length;c+=3){var h=r[c],p=r[c+1],y=h[jt]||null;if(typeof p=="function")y||Gg(r);else if(y){var S=null;if(p&&p.hasAttribute("formAction")){if(h=p,y=p[jt]||null)S=y.formAction;else if(fd(h)!==null)continue}else S=y.action;typeof S=="function"?r[c+1]=S:(r.splice(c,3),c-=3),Gg(r)}}}function Kg(){function e(p){p.canIntercept&&p.info==="react-transition"&&p.intercept({handler:function(){return new Promise(function(y){return h=y})},focusReset:"manual",scroll:"manual"})}function n(){h!==null&&(h(),h=null),c||setTimeout(r,20)}function r(){if(!c&&!navigation.transition){var p=navigation.currentEntry;p&&p.url!=null&&navigation.navigate(p.url,{state:p.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,h=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(r,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),h!==null&&(h(),h=null)}}}function pd(e){this._internalRoot=e}gc.prototype.render=pd.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(a(409));var r=n.current,c=an();Ig(r,c,e,n,null,null)},gc.prototype.unmount=pd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;Ig(e.current,2,null,e,null,null),Xo(),n[xa]=null}};function gc(e){this._internalRoot=e}gc.prototype.unstable_scheduleHydration=function(e){if(e){var n=tf();e={blockedOn:null,target:e,priority:n};for(var r=0;r<Ii.length&&n!==0&&n<Ii[r].priority;r++);Ii.splice(r,0,e),r===0&&Fg(e)}};var Yg=t.version;if(Yg!=="19.2.3")throw Error(a(527,Yg,"19.2.3"));$.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=m(n),e=e!==null?g(e):null,e=e===null?null:e.stateNode,e};var BT={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:x,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vc.isDisabled&&vc.supportsFiber)try{js=vc.inject(BT),Qt=vc}catch{}}return wr.createRoot=function(e,n){if(!o(e))throw Error(a(299));var r=!1,c="",h=ep,p=tp,y=np;return n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onUncaughtError!==void 0&&(h=n.onUncaughtError),n.onCaughtError!==void 0&&(p=n.onCaughtError),n.onRecoverableError!==void 0&&(y=n.onRecoverableError)),n=Lg(e,1,!1,null,null,r,c,null,h,p,y,Kg),e[xa]=n.current,Xu(e),new pd(n)},wr.hydrateRoot=function(e,n,r){if(!o(e))throw Error(a(299));var c=!1,h="",p=ep,y=tp,S=np,k=null;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(y=r.onCaughtError),r.onRecoverableError!==void 0&&(S=r.onRecoverableError),r.formState!==void 0&&(k=r.formState)),n=Lg(e,1,!0,n,r??null,c,h,k,p,y,S,Kg),n.context=Ug(null),r=n.current,c=an(),c=sl(c),h=Ci(c),h.callback=null,ki(r,h,c),r=c,n.current.lanes=r,zs(n,r),xn(n),e[xa]=n.current,Xu(e),new gc(n)},wr.version="19.2.3",wr}var iv;function XT(){if(iv)return yd.exports;iv=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(t){console.error(t)}}return s(),yd.exports=QT(),yd.exports}var ZT=XT();const WT=Cy(ZT);Ey();/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gr(){return Gr=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(s[a]=i[a])}return s},Gr.apply(this,arguments)}var Fi;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(Fi||(Fi={}));const av="popstate";function $T(s){s===void 0&&(s={});function t(a,o){let{pathname:l,search:u,hash:d}=a.location;return Fd("",{pathname:l,search:u,hash:d},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function i(a,o){return typeof o=="string"?o:Pc(o)}return tC(t,i,null,s)}function dt(s,t){if(s===!1||s===null||typeof s>"u")throw new Error(t)}function Sh(s,t){if(!s){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function eC(){return Math.random().toString(36).substr(2,8)}function sv(s,t){return{usr:s.state,key:s.key,idx:t}}function Fd(s,t,i,a){return i===void 0&&(i=null),Gr({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof t=="string"?ws(t):t,{state:i,key:t&&t.key||a||eC()})}function Pc(s){let{pathname:t="/",search:i="",hash:a=""}=s;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),a&&a!=="#"&&(t+=a.charAt(0)==="#"?a:"#"+a),t}function ws(s){let t={};if(s){let i=s.indexOf("#");i>=0&&(t.hash=s.substr(i),s=s.substr(0,i));let a=s.indexOf("?");a>=0&&(t.search=s.substr(a),s=s.substr(0,a)),s&&(t.pathname=s)}return t}function tC(s,t,i,a){a===void 0&&(a={});let{window:o=document.defaultView,v5Compat:l=!1}=a,u=o.history,d=Fi.Pop,f=null,m=g();m==null&&(m=0,u.replaceState(Gr({},u.state,{idx:m}),""));function g(){return(u.state||{idx:null}).idx}function v(){d=Fi.Pop;let B=g(),w=B==null?null:B-m;m=B,f&&f({action:d,location:O.location,delta:w})}function b(B,w){d=Fi.Push;let X=Fd(O.location,B,w);m=g()+1;let K=sv(X,m),A=O.createHref(X);try{u.pushState(K,"",A)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;o.location.assign(A)}l&&f&&f({action:d,location:O.location,delta:1})}function C(B,w){d=Fi.Replace;let X=Fd(O.location,B,w);m=g();let K=sv(X,m),A=O.createHref(X);u.replaceState(K,"",A),l&&f&&f({action:d,location:O.location,delta:0})}function M(B){let w=o.location.origin!=="null"?o.location.origin:o.location.href,X=typeof B=="string"?B:Pc(B);return X=X.replace(/ $/,"%20"),dt(w,"No window.location.(origin|href) available to create URL for href: "+X),new URL(X,w)}let O={get action(){return d},get location(){return s(o,u)},listen(B){if(f)throw new Error("A history only accepts one active listener");return o.addEventListener(av,v),f=B,()=>{o.removeEventListener(av,v),f=null}},createHref(B){return t(o,B)},createURL:M,encodeLocation(B){let w=M(B);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:b,replace:C,go(B){return u.go(B)}};return O}var rv;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(rv||(rv={}));function nC(s,t,i){return i===void 0&&(i="/"),iC(s,t,i)}function iC(s,t,i,a){let o=typeof t=="string"?ws(t):t,l=Th(o.pathname||"/",i);if(l==null)return null;let u=Ry(s);aC(u);let d=null;for(let f=0;d==null&&f<u.length;++f){let m=gC(l);d=fC(u[f],m)}return d}function Ry(s,t,i,a){t===void 0&&(t=[]),i===void 0&&(i=[]),a===void 0&&(a="");let o=(l,u,d)=>{let f={relativePath:d===void 0?l.path||"":d,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};f.relativePath.startsWith("/")&&(dt(f.relativePath.startsWith(a),'Absolute route path "'+f.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),f.relativePath=f.relativePath.slice(a.length));let m=Gi([a,f.relativePath]),g=i.concat(f);l.children&&l.children.length>0&&(dt(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+m+'".')),Ry(l.children,t,g,m)),!(l.path==null&&!l.index)&&t.push({path:m,score:dC(m,l.index),routesMeta:g})};return s.forEach((l,u)=>{var d;if(l.path===""||!((d=l.path)!=null&&d.includes("?")))o(l,u);else for(let f of _y(l.path))o(l,u,f)}),t}function _y(s){let t=s.split("/");if(t.length===0)return[];let[i,...a]=t,o=i.endsWith("?"),l=i.replace(/\?$/,"");if(a.length===0)return o?[l,""]:[l];let u=_y(a.join("/")),d=[];return d.push(...u.map(f=>f===""?l:[l,f].join("/"))),o&&d.push(...u),d.map(f=>s.startsWith("/")&&f===""?"/":f)}function aC(s){s.sort((t,i)=>t.score!==i.score?i.score-t.score:hC(t.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}const sC=/^:[\w-]+$/,rC=3,oC=2,cC=1,lC=10,uC=-2,ov=s=>s==="*";function dC(s,t){let i=s.split("/"),a=i.length;return i.some(ov)&&(a+=uC),t&&(a+=oC),i.filter(o=>!ov(o)).reduce((o,l)=>o+(sC.test(l)?rC:l===""?cC:lC),a)}function hC(s,t){return s.length===t.length&&s.slice(0,-1).every((a,o)=>a===t[o])?s[s.length-1]-t[t.length-1]:0}function fC(s,t,i){let{routesMeta:a}=s,o={},l="/",u=[];for(let d=0;d<a.length;++d){let f=a[d],m=d===a.length-1,g=l==="/"?t:t.slice(l.length)||"/",v=mC({path:f.relativePath,caseSensitive:f.caseSensitive,end:m},g),b=f.route;if(!v)return null;Object.assign(o,v.params),u.push({params:o,pathname:Gi([l,v.pathname]),pathnameBase:TC(Gi([l,v.pathnameBase])),route:b}),v.pathnameBase!=="/"&&(l=Gi([l,v.pathnameBase]))}return u}function mC(s,t){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[i,a]=pC(s.path,s.caseSensitive,s.end),o=t.match(i);if(!o)return null;let l=o[0],u=l.replace(/(.)\/+$/,"$1"),d=o.slice(1);return{params:a.reduce((m,g,v)=>{let{paramName:b,isOptional:C}=g;if(b==="*"){let O=d[v]||"";u=l.slice(0,l.length-O.length).replace(/(.)\/+$/,"$1")}const M=d[v];return C&&!M?m[b]=void 0:m[b]=(M||"").replace(/%2F/g,"/"),m},{}),pathname:l,pathnameBase:u,pattern:s}}function pC(s,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),Sh(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let a=[],o="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,d,f)=>(a.push({paramName:d,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(a.push({paramName:"*"}),o+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?o+="\\/*$":s!==""&&s!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),a]}function gC(s){try{return s.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Sh(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),s}}function Th(s,t){if(t==="/")return s;if(!s.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,a=s.charAt(i);return a&&a!=="/"?null:s.slice(i)||"/"}const vC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,yC=s=>vC.test(s);function bC(s,t){t===void 0&&(t="/");let{pathname:i,search:a="",hash:o=""}=typeof s=="string"?ws(s):s,l;if(i)if(yC(i))l=i;else{if(i.includes("//")){let u=i;i=i.replace(/\/\/+/g,"/"),Sh(!1,"Pathnames cannot have embedded double slashes - normalizing "+(u+" -> "+i))}i.startsWith("/")?l=cv(i.substring(1),"/"):l=cv(i,t)}else l=t;return{pathname:l,search:CC(a),hash:kC(o)}}function cv(s,t){let i=t.replace(/\/+$/,"").split("/");return s.split("/").forEach(o=>{o===".."?i.length>1&&i.pop():o!=="."&&i.push(o)}),i.length>1?i.join("/"):"/"}function Cd(s,t,i,a){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function SC(s){return s.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function Ch(s,t){let i=SC(s);return t?i.map((a,o)=>o===i.length-1?a.pathname:a.pathnameBase):i.map(a=>a.pathnameBase)}function kh(s,t,i,a){a===void 0&&(a=!1);let o;typeof s=="string"?o=ws(s):(o=Gr({},s),dt(!o.pathname||!o.pathname.includes("?"),Cd("?","pathname","search",o)),dt(!o.pathname||!o.pathname.includes("#"),Cd("#","pathname","hash",o)),dt(!o.search||!o.search.includes("#"),Cd("#","search","hash",o)));let l=s===""||o.pathname==="",u=l?"/":o.pathname,d;if(u==null)d=i;else{let v=t.length-1;if(!a&&u.startsWith("..")){let b=u.split("/");for(;b[0]==="..";)b.shift(),v-=1;o.pathname=b.join("/")}d=v>=0?t[v]:"/"}let f=bC(o,d),m=u&&u!=="/"&&u.endsWith("/"),g=(l||u===".")&&i.endsWith("/");return!f.pathname.endsWith("/")&&(m||g)&&(f.pathname+="/"),f}const Gi=s=>s.join("/").replace(/\/\/+/g,"/"),TC=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),CC=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,kC=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function EC(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const Oy=["post","put","patch","delete"];new Set(Oy);const RC=["get",...Oy];new Set(RC);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Kr(){return Kr=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(s[a]=i[a])}return s},Kr.apply(this,arguments)}const Eh=z.createContext(null),_C=z.createContext(null),Zi=z.createContext(null),Kc=z.createContext(null),fi=z.createContext({outlet:null,matches:[],isDataRoute:!1}),Ay=z.createContext(null);function OC(s,t){let{relative:i}=t===void 0?{}:t;xs()||dt(!1);let{basename:a,navigator:o}=z.useContext(Zi),{hash:l,pathname:u,search:d}=My(s,{relative:i}),f=u;return a!=="/"&&(f=u==="/"?a:Gi([a,u])),o.createHref({pathname:f,search:d,hash:l})}function xs(){return z.useContext(Kc)!=null}function Ns(){return xs()||dt(!1),z.useContext(Kc).location}function Dy(s){z.useContext(Zi).static||z.useLayoutEffect(s)}function Ps(){let{isDataRoute:s}=z.useContext(fi);return s?qC():AC()}function AC(){xs()||dt(!1);let s=z.useContext(Eh),{basename:t,future:i,navigator:a}=z.useContext(Zi),{matches:o}=z.useContext(fi),{pathname:l}=Ns(),u=JSON.stringify(Ch(o,i.v7_relativeSplatPath)),d=z.useRef(!1);return Dy(()=>{d.current=!0}),z.useCallback(function(m,g){if(g===void 0&&(g={}),!d.current)return;if(typeof m=="number"){a.go(m);return}let v=kh(m,JSON.parse(u),l,g.relative==="path");s==null&&t!=="/"&&(v.pathname=v.pathname==="/"?t:Gi([t,v.pathname])),(g.replace?a.replace:a.push)(v,g.state,g)},[t,a,u,l,s])}function DC(){let{matches:s}=z.useContext(fi),t=s[s.length-1];return t?t.params:{}}function My(s,t){let{relative:i}=t===void 0?{}:t,{future:a}=z.useContext(Zi),{matches:o}=z.useContext(fi),{pathname:l}=Ns(),u=JSON.stringify(Ch(o,a.v7_relativeSplatPath));return z.useMemo(()=>kh(s,JSON.parse(u),l,i==="path"),[s,u,l,i])}function MC(s,t){return wC(s,t)}function wC(s,t,i,a){xs()||dt(!1);let{navigator:o}=z.useContext(Zi),{matches:l}=z.useContext(fi),u=l[l.length-1],d=u?u.params:{};u&&u.pathname;let f=u?u.pathnameBase:"/";u&&u.route;let m=Ns(),g;if(t){var v;let B=typeof t=="string"?ws(t):t;f==="/"||(v=B.pathname)!=null&&v.startsWith(f)||dt(!1),g=B}else g=m;let b=g.pathname||"/",C=b;if(f!=="/"){let B=f.replace(/^\//,"").split("/");C="/"+b.replace(/^\//,"").split("/").slice(B.length).join("/")}let M=nC(s,{pathname:C}),O=UC(M&&M.map(B=>Object.assign({},B,{params:Object.assign({},d,B.params),pathname:Gi([f,o.encodeLocation?o.encodeLocation(B.pathname).pathname:B.pathname]),pathnameBase:B.pathnameBase==="/"?f:Gi([f,o.encodeLocation?o.encodeLocation(B.pathnameBase).pathname:B.pathnameBase])})),l,i,a);return t&&O?z.createElement(Kc.Provider,{value:{location:Kr({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:Fi.Pop}},O):O}function xC(){let s=zC(),t=EC(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),i=s instanceof Error?s.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return z.createElement(z.Fragment,null,z.createElement("h2",null,"Unexpected Application Error!"),z.createElement("h3",{style:{fontStyle:"italic"}},t),i?z.createElement("pre",{style:o},i):null,null)}const NC=z.createElement(xC,null);class PC extends z.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?z.createElement(fi.Provider,{value:this.props.routeContext},z.createElement(Ay.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function LC(s){let{routeContext:t,match:i,children:a}=s,o=z.useContext(Eh);return o&&o.static&&o.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=i.route.id),z.createElement(fi.Provider,{value:t},a)}function UC(s,t,i,a){var o;if(t===void 0&&(t=[]),i===void 0&&(i=null),a===void 0&&(a=null),s==null){var l;if(!i)return null;if(i.errors)s=i.matches;else if((l=a)!=null&&l.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)s=i.matches;else return null}let u=s,d=(o=i)==null?void 0:o.errors;if(d!=null){let g=u.findIndex(v=>v.route.id&&(d==null?void 0:d[v.route.id])!==void 0);g>=0||dt(!1),u=u.slice(0,Math.min(u.length,g+1))}let f=!1,m=-1;if(i&&a&&a.v7_partialHydration)for(let g=0;g<u.length;g++){let v=u[g];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(m=g),v.route.id){let{loaderData:b,errors:C}=i,M=v.route.loader&&b[v.route.id]===void 0&&(!C||C[v.route.id]===void 0);if(v.route.lazy||M){f=!0,m>=0?u=u.slice(0,m+1):u=[u[0]];break}}}return u.reduceRight((g,v,b)=>{let C,M=!1,O=null,B=null;i&&(C=d&&v.route.id?d[v.route.id]:void 0,O=v.route.errorElement||NC,f&&(m<0&&b===0?(VC("route-fallback"),M=!0,B=null):m===b&&(M=!0,B=v.route.hydrateFallbackElement||null)));let w=t.concat(u.slice(0,b+1)),X=()=>{let K;return C?K=O:M?K=B:v.route.Component?K=z.createElement(v.route.Component,null):v.route.element?K=v.route.element:K=g,z.createElement(LC,{match:v,routeContext:{outlet:g,matches:w,isDataRoute:i!=null},children:K})};return i&&(v.route.ErrorBoundary||v.route.errorElement||b===0)?z.createElement(PC,{location:i.location,revalidation:i.revalidation,component:O,error:C,children:X(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):X()},null)}var wy=(function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s})(wy||{}),xy=(function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s})(xy||{});function IC(s){let t=z.useContext(Eh);return t||dt(!1),t}function jC(s){let t=z.useContext(_C);return t||dt(!1),t}function BC(s){let t=z.useContext(fi);return t||dt(!1),t}function Ny(s){let t=BC(),i=t.matches[t.matches.length-1];return i.route.id||dt(!1),i.route.id}function zC(){var s;let t=z.useContext(Ay),i=jC(),a=Ny();return t!==void 0?t:(s=i.errors)==null?void 0:s[a]}function qC(){let{router:s}=IC(wy.UseNavigateStable),t=Ny(xy.UseNavigateStable),i=z.useRef(!1);return Dy(()=>{i.current=!0}),z.useCallback(function(o,l){l===void 0&&(l={}),i.current&&(typeof o=="number"?s.navigate(o):s.navigate(o,Kr({fromRouteId:t},l)))},[s,t])}const lv={};function VC(s,t,i){lv[s]||(lv[s]=!0)}function FC(s,t){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function uv(s){let{to:t,replace:i,state:a,relative:o}=s;xs()||dt(!1);let{future:l,static:u}=z.useContext(Zi),{matches:d}=z.useContext(fi),{pathname:f}=Ns(),m=Ps(),g=kh(t,Ch(d,l.v7_relativeSplatPath),f,o==="path"),v=JSON.stringify(g);return z.useEffect(()=>m(JSON.parse(v),{replace:i,state:a,relative:o}),[m,v,o,i,a]),null}function Sa(s){dt(!1)}function HC(s){let{basename:t="/",children:i=null,location:a,navigationType:o=Fi.Pop,navigator:l,static:u=!1,future:d}=s;xs()&&dt(!1);let f=t.replace(/^\/*/,"/"),m=z.useMemo(()=>({basename:f,navigator:l,static:u,future:Kr({v7_relativeSplatPath:!1},d)}),[f,d,l,u]);typeof a=="string"&&(a=ws(a));let{pathname:g="/",search:v="",hash:b="",state:C=null,key:M="default"}=a,O=z.useMemo(()=>{let B=Th(g,f);return B==null?null:{location:{pathname:B,search:v,hash:b,state:C,key:M},navigationType:o}},[f,g,v,b,C,M,o]);return O==null?null:z.createElement(Zi.Provider,{value:m},z.createElement(Kc.Provider,{children:i,value:O}))}function GC(s){let{children:t,location:i}=s;return MC(Hd(t),i)}new Promise(()=>{});function Hd(s,t){t===void 0&&(t=[]);let i=[];return z.Children.forEach(s,(a,o)=>{if(!z.isValidElement(a))return;let l=[...t,o];if(a.type===z.Fragment){i.push.apply(i,Hd(a.props.children,l));return}a.type!==Sa&&dt(!1),!a.props.index||!a.props.children||dt(!1);let u={id:a.props.id||l.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(u.children=Hd(a.props.children,l)),i.push(u)}),i}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gd(){return Gd=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(s[a]=i[a])}return s},Gd.apply(this,arguments)}function KC(s,t){if(s==null)return{};var i={},a=Object.keys(s),o,l;for(l=0;l<a.length;l++)o=a[l],!(t.indexOf(o)>=0)&&(i[o]=s[o]);return i}function YC(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function JC(s,t){return s.button===0&&(!t||t==="_self")&&!YC(s)}function Kd(s){return s===void 0&&(s=""),new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((t,i)=>{let a=s[i];return t.concat(Array.isArray(a)?a.map(o=>[i,o]):[[i,a]])},[]))}function QC(s,t){let i=Kd(s);return t&&t.forEach((a,o)=>{i.has(o)||t.getAll(o).forEach(l=>{i.append(o,l)})}),i}const XC=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ZC="6";try{window.__reactRouterVersion=ZC}catch{}const WC="startTransition",dv=GT[WC];function $C(s){let{basename:t,children:i,future:a,window:o}=s,l=z.useRef();l.current==null&&(l.current=$T({window:o,v5Compat:!0}));let u=l.current,[d,f]=z.useState({action:u.action,location:u.location}),{v7_startTransition:m}=a||{},g=z.useCallback(v=>{m&&dv?dv(()=>f(v)):f(v)},[f,m]);return z.useLayoutEffect(()=>u.listen(g),[u,g]),z.useEffect(()=>FC(a),[a]),z.createElement(HC,{basename:t,children:i,location:d.location,navigationType:d.action,navigator:u,future:a})}const ek=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",tk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hv=z.forwardRef(function(t,i){let{onClick:a,relative:o,reloadDocument:l,replace:u,state:d,target:f,to:m,preventScrollReset:g,viewTransition:v}=t,b=KC(t,XC),{basename:C}=z.useContext(Zi),M,O=!1;if(typeof m=="string"&&tk.test(m)&&(M=m,ek))try{let K=new URL(window.location.href),A=m.startsWith("//")?new URL(K.protocol+m):new URL(m),_=Th(A.pathname,C);A.origin===K.origin&&_!=null?m=_+A.search+A.hash:O=!0}catch{}let B=OC(m,{relative:o}),w=nk(m,{replace:u,state:d,target:f,preventScrollReset:g,relative:o,viewTransition:v});function X(K){a&&a(K),K.defaultPrevented||w(K)}return z.createElement("a",Gd({},b,{href:M||B,onClick:O||l?a:X,ref:i,target:f}))});var fv;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(fv||(fv={}));var mv;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(mv||(mv={}));function nk(s,t){let{target:i,replace:a,state:o,preventScrollReset:l,relative:u,viewTransition:d}=t===void 0?{}:t,f=Ps(),m=Ns(),g=My(s,{relative:u});return z.useCallback(v=>{if(JC(v,i)){v.preventDefault();let b=a!==void 0?a:Pc(m)===Pc(g);f(s,{replace:b,state:o,preventScrollReset:l,relative:u,viewTransition:d})}},[m,f,g,a,o,i,s,l,u,d])}function ik(s){let t=z.useRef(Kd(s)),i=z.useRef(!1),a=Ns(),o=z.useMemo(()=>QC(a.search,i.current?null:t.current),[a.search]),l=Ps(),u=z.useCallback((d,f)=>{const m=Kd(typeof d=="function"?d(o):d);i.current=!0,l("?"+m,f)},[l,o]);return[o,u]}function ak(s){const t=s.split(".");if(t.length!==3)return null;const a=t[1].replace(/-/g,"+").replace(/_/g,"/"),o=a.length%4===0?"":"=".repeat(4-a.length%4);try{const l=atob(a+o);return JSON.parse(l)}catch{return null}}function Sc(s){const t=localStorage.getItem("auth_token");if(!t)return null;const i=ak(t);return!i||i.role!==s||typeof i.exp=="number"&&Math.floor(Date.now()/1e3)>=i.exp?null:t}async function sk(s,t=2500){const i=Date.now();for(;Date.now()-i<t;){const a=Sc(s);if(a)return a;await new Promise(o=>window.setTimeout(o,75))}return null}function pv(){const{protocol:s,hostname:t}=window.location;return`${s}//${t}:3700/login`}function rk(){const[s]=ik(),t=Ps(),[i,a]=z.useState(null);return z.useEffect(()=>{if(Sc("coach")){t("/dashboard",{replace:!0});return}const o=s.get("grant");if(!o){a("No auth grant provided.");return}const l=`auth_exchange_started:${o}`;if(sessionStorage.getItem(l)==="1"){let d=!1;return(async()=>{const f=await sk("coach");if(!d){if(f){t("/dashboard",{replace:!0});return}a("Failed to authenticate. Please login again."),window.setTimeout(()=>{window.location.href=pv()},1500)}})(),()=>{d=!0}}sessionStorage.setItem(l,"1");let u=!1;return(async()=>{try{const d=await fetch("/api/auth/exchange",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({grant:o})}),f=await d.json().catch(()=>null);if(!d.ok||!f||!f.success)throw new Error("Failed to authenticate. Please login again.");localStorage.setItem("auth_token",f.data.token),u||t("/dashboard",{replace:!0})}catch(d){if(u)return;if(Sc("coach")){t("/dashboard",{replace:!0});return}a(d instanceof Error?d.message:"Authentication error"),window.setTimeout(()=>{window.location.href=pv()},1500)}finally{if(!Sc("coach"))try{sessionStorage.removeItem(l)}catch{}}})(),()=>{u=!0}},[t,s]),i?N.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:N.jsxs("div",{style:{maxWidth:520,padding:24},children:[N.jsx("h1",{style:{margin:0},children:"Authentication Failed"}),N.jsx("p",{style:{marginTop:12},children:i})]})}):N.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:N.jsx("div",{style:{maxWidth:520,padding:24},children:"Authenticating"})})}function ok(s){const t=new Date(s);return Number.isNaN(t.getTime())?s:t.toLocaleString()}function ck(){const s=localStorage.getItem("theme");return s==="light"||s==="dark"?s:null}function lk(){const s=new Date().getHours();return s<6||s>18?"dark":"light"}function uk(s){document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s)}function xr(){const{protocol:s,hostname:t}=window.location;return`${s}//${t}:3700/login`}function kd(){return localStorage.getItem("auth_token")}function dk(){var X,K,A;const[s,t]=z.useState(()=>typeof window>"u"?"light":ck()??lk()),[i,a]=z.useState(null),[o,l]=z.useState(!0),[u,d]=z.useState(null),[f,m]=z.useState(null),[g,v]=z.useState(null),b=z.useMemo(()=>{const _=new URL(window.location.href);return _.searchParams.get("calendar")==="connected"?"Calendar connected successfully!":_.searchParams.get("availability")==="updated"?"Availability status updated!":_.searchParams.get("reassigned")==="success"?"Appointment returned to coach pool.":(i==null?void 0:i.message)??null},[i==null?void 0:i.message]);z.useEffect(()=>{uk(s)},[s]);async function C(){l(!0),d(null),m(null);const _=kd();if(!_){l(!1),d("You are not authenticated."),m(xr()),a(null);return}try{const I=await fetch("/api/coach/dashboard",{headers:{Accept:"application/json",Authorization:`Bearer ${_}`}});if(!I.ok){let W=null;try{W=await I.json()}catch{}if(I.status===401){m((W==null?void 0:W.loginUrl)??xr()),d("You are not authenticated."),a(null);return}d((W==null?void 0:W.error)??`Failed to load dashboard (HTTP ${I.status})`),a(null);return}const q=await I.json();if(!(q!=null&&q.success)){d("Failed to load dashboard"),a(null);return}a(q.data)}catch(I){d(I instanceof Error?I.message:"Failed to load dashboard"),a(null)}finally{l(!1)}}z.useEffect(()=>{C();const _={threshold:.1,rootMargin:"0px 0px -50px 0px"},I=new IntersectionObserver(q=>{q.forEach(W=>{W.isIntersecting&&W.target.classList.add("visible")})},_);return document.querySelectorAll(".card, .alert, .hero-section").forEach(q=>{q.classList.contains("fade-in")||q.classList.add("fade-in"),I.observe(q)}),()=>{I.disconnect()}},[]),z.useEffect(()=>{if(!(i!=null&&i.user)||i.user.role!=="coach")return;const _=window.setInterval(()=>{C()},1e4);return()=>{window.clearInterval(_)}},[(X=i==null?void 0:i.user)==null?void 0:X.role]);async function M(){v("toggle-availability"),d(null);const _=kd();if(!_){m(xr()),d("You are not authenticated."),v(null);return}try{const I=await fetch("/api/coach/toggle-availability",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${_}`},body:JSON.stringify({})});if(!I.ok){const q=await I.json().catch(()=>null);throw new Error((q==null?void 0:q.error)??`Failed to toggle availability (HTTP ${I.status})`)}await C()}catch(I){d(I instanceof Error?I.message:"Failed to toggle availability")}finally{v(null)}}async function O(_){if(!window.confirm("Send this call back to the coach pool?"))return;v(`reassign:${_}`),d(null);const I=kd();if(!I){m(xr()),d("You are not authenticated."),v(null);return}try{const q=await fetch("/api/coach/reassign-appointment",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${I}`},body:JSON.stringify({appointmentId:_})});if(!q.ok){const W=await q.json().catch(()=>null);throw new Error((W==null?void 0:W.error)??`Failed to reassign appointment (HTTP ${q.status})`)}await C()}catch(q){d(q instanceof Error?q.message:"Failed to reassign appointment")}finally{v(null)}}const B=s==="dark"?"":"",w=i==null?void 0:i.user;return N.jsxs(N.Fragment,{children:[N.jsx("button",{className:"theme-toggle",type:"button",onClick:()=>t(_=>_==="dark"?"light":"dark"),"aria-label":"Toggle theme",children:B}),N.jsxs("div",{className:"dashboard-container",children:[N.jsxs("header",{className:"header",children:[N.jsx("div",{className:"logo",children:"MyUltra.Coach"}),N.jsxs("p",{className:"welcome-text",children:["Welcome back, ",(w==null?void 0:w.displayName)??""]}),N.jsx("div",{className:"user-info",children:(w==null?void 0:w.email)??"N/A"})]}),b?N.jsx("div",{className:"alert alert-success",children:b}):null,u?N.jsxs("div",{className:"alert alert-error",children:[N.jsx("strong",{children:"Error"}),N.jsx("div",{style:{marginTop:"0.5rem"},children:u}),f?N.jsx("div",{style:{marginTop:"1rem"},children:N.jsx("a",{href:f,className:"btn btn-primary",children:"Log in"})}):null]}):null,N.jsx("div",{className:"hero-section",style:{display:"block",visibility:"visible",opacity:1},children:N.jsxs("div",{className:"hero-content",children:[N.jsx("h1",{className:"hero-title",children:" Coach Dashboard"}),N.jsx("p",{className:"hero-subtitle",children:"Manage your availability, upcoming meetings, and scheduled coaching calls."}),N.jsxs(hv,{to:"/room/create",className:"btn-hero",children:[" Launch Test / AI Room",N.jsx("span",{className:"btn-hero-subtitle",children:"Create an instant room"})]})]})}),o?N.jsx("div",{className:"card fade-in visible",children:N.jsxs("div",{className:"card-header",children:[N.jsx("h3",{className:"card-title",children:"Loading"}),N.jsx("p",{className:"card-subtitle",children:"Fetching your coach dashboard data"})]})}):null,(w==null?void 0:w.role)==="coach"?N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"card fade-in",children:[N.jsxs("div",{className:"card-header",children:[N.jsx("h3",{className:"card-title",children:" Coach Tools"}),N.jsx("p",{className:"card-subtitle",children:"Manage your coaching availability and settings"})]}),N.jsxs("div",{className:"availability-section",children:[N.jsxs("div",{children:[N.jsx("strong",{className:"availability-title",children:" Availability Status"}),N.jsx("br",{}),N.jsx("small",{className:"availability-subtitle",children:w.isAvailable?"You are currently accepting new client bookings":"You are not accepting new client bookings"})]}),N.jsxs("label",{className:"availability-toggle",children:[N.jsx("input",{type:"checkbox",checked:!!w.isAvailable,onChange:()=>void M(),disabled:g==="toggle-availability"}),N.jsx("span",{className:"availability-status "+(w.isAvailable?"available":"unavailable"),children:w.isAvailable?"Available":"Unavailable"})]})]})]}),i!=null&&i.calendarConnected?N.jsxs("div",{className:"alert alert-success",children:[N.jsx("strong",{children:" Calendar connected"}),N.jsx("br",{}),"Your Google Calendar is successfully connected and synced."]}):N.jsxs("div",{className:"alert alert-warning",children:[N.jsx("strong",{children:" Calendar not connected"}),N.jsx("br",{}),"Calendar integration will be re-added during the LiveKit/room-manager build-out."]}),N.jsxs("div",{className:"card fade-in",children:[N.jsx("div",{className:"card-header",children:N.jsx("h4",{className:"card-title",children:" Upcoming Meetings"})}),(K=i==null?void 0:i.meetings)!=null&&K.length?N.jsx("ul",{style:{listStyle:"none",padding:0},children:i.meetings.map((_,I)=>N.jsxs("li",{style:{padding:"0.75rem 0",borderBottom:"1px solid var(--border)"},children:[N.jsx("strong",{children:_.start}),"  ",_.summary]},`${_.start}-${I}`))}):N.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:"2rem"},children:"No upcoming meetings."})]}),N.jsxs("div",{className:"card fade-in",children:[N.jsx("div",{className:"card-header",children:N.jsxs("h3",{className:"card-title",children:[" Upcoming Appointments",N.jsx("span",{style:{fontSize:"0.8em",color:"var(--text-secondary)",fontWeight:"normal",marginLeft:"0.5rem"},children:"(Auto-refreshing every 10 seconds)"})]})}),(A=i==null?void 0:i.appointments)!=null&&A.length?N.jsx("div",{style:{listStyle:"none",padding:0},children:i.appointments.map(_=>{var q;const I=_.status==="cancelled";return N.jsxs("div",{className:"appointment-item coach",children:[N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[N.jsxs("div",{style:{flex:1},children:[N.jsxs("strong",{style:{color:"var(--text-primary)"},children:[" ",ok(_.scheduledFor)]}),I?N.jsx("span",{className:"status-badge status-cancelled",children:"CANCELLED"}):null,_.client?N.jsxs(N.Fragment,{children:[N.jsx("br",{})," Client: ",_.client.displayName||_.client.email||""]}):null,N.jsx("br",{}),N.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.9em"},children:["Room ID: ",(q=_.roomId)==null?void 0:q.slice(0,8),"..."]})]}),I?null:N.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginLeft:"1rem"},children:N.jsx("button",{type:"button",className:"btn btn-warning",onClick:()=>void O(_.id),disabled:g===`reassign:${_.id}`,children:" Return to Pool"})})]}),I?null:N.jsx("div",{style:{marginTop:"1rem"},children:N.jsx(hv,{to:`/room/${_.roomId}`,className:"btn btn-success",children:" Join Room"})})]},_.id)})}):N.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:"2rem"},children:"No upcoming appointments."})]})]}):null,N.jsx("div",{style:{textAlign:"center",marginTop:"3rem",padding:"2rem"},children:N.jsx("a",{href:xr(),style:{color:"var(--text-secondary)",textDecoration:"none",fontSize:"0.9rem"},onClick:()=>localStorage.removeItem("auth_token"),children:" Logout"})})]})]})}var gv={};function hk(s,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(a){if(a!=="default"&&!(a in s)){var o=Object.getOwnPropertyDescriptor(i,a);Object.defineProperty(s,a,o.get?o:{enumerable:!0,get:function(){return i[a]}})}})}),Object.freeze(s)}var fk=Object.defineProperty,mk=(s,t,i)=>t in s?fk(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,vv=(s,t,i)=>mk(s,typeof t!="symbol"?t+"":t,i);class Ut{constructor(){vv(this,"_locking"),vv(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const i=new Promise(o=>t=()=>{this._locks-=1,o()}),a=this._locking.then(()=>t);return this._locking=this._locking.then(()=>i),a}}function rt(s,t){if(!s)throw new Error(t)}const pk=34028234663852886e22,gk=-34028234663852886e22,vk=4294967295,yk=2147483647,bk=-2147483648;function Tc(s){if(typeof s!="number")throw new Error("invalid int 32: "+typeof s);if(!Number.isInteger(s)||s>yk||s<bk)throw new Error("invalid int 32: "+s)}function Yd(s){if(typeof s!="number")throw new Error("invalid uint 32: "+typeof s);if(!Number.isInteger(s)||s>vk||s<0)throw new Error("invalid uint 32: "+s)}function Py(s){if(typeof s!="number")throw new Error("invalid float 32: "+typeof s);if(Number.isFinite(s)&&(s>pk||s<gk))throw new Error("invalid float 32: "+s)}const Ly=Symbol("@bufbuild/protobuf/enum-type");function Sk(s){const t=s[Ly];return rt(t,"missing enum type on enum object"),t}function Uy(s,t,i,a){s[Ly]=Iy(t,i.map(o=>({no:o.no,name:o.name,localName:s[o.no]})))}function Iy(s,t,i){const a=Object.create(null),o=Object.create(null),l=[];for(const u of t){const d=jy(u);l.push(d),a[u.name]=d,o[u.no]=d}return{typeName:s,values:l,findName(u){return a[u]},findNumber(u){return o[u]}}}function Tk(s,t,i){const a={};for(const o of t){const l=jy(o);a[l.localName]=l.no,a[l.no]=l.localName}return Uy(a,s,t),a}function jy(s){return"localName"in s?s:Object.assign(Object.assign({},s),{localName:s.name})}class Rh{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,i){const a=this.getType(),o=a.runtime.bin,l=o.makeReadOptions(i);return o.readMessage(this,l.readerFactory(t),t.byteLength,l),this}fromJson(t,i){const a=this.getType(),o=a.runtime.json,l=o.makeReadOptions(i);return o.readMessage(a,t,l,this),this}fromJsonString(t,i){let a;try{a=JSON.parse(t)}catch(o){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(o instanceof Error?o.message:String(o)))}return this.fromJson(a,i)}toBinary(t){const i=this.getType(),a=i.runtime.bin,o=a.makeWriteOptions(t),l=o.writerFactory();return a.writeMessage(this,l,o),l.finish()}toJson(t){const i=this.getType(),a=i.runtime.json,o=a.makeWriteOptions(t);return a.writeMessage(this,o)}toJsonString(t){var i;const a=this.toJson(t);return JSON.stringify(a,null,(i=t==null?void 0:t.prettySpaces)!==null&&i!==void 0?i:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Ck(s,t,i,a){var o;const l=(o=a==null?void 0:a.localName)!==null&&o!==void 0?o:t.substring(t.lastIndexOf(".")+1),u={[l]:function(d){s.util.initFields(this),s.util.initPartial(d,this)}}[l];return Object.setPrototypeOf(u.prototype,new Rh),Object.assign(u,{runtime:s,typeName:t,fields:s.util.newFieldList(i),fromBinary(d,f){return new u().fromBinary(d,f)},fromJson(d,f){return new u().fromJson(d,f)},fromJsonString(d,f){return new u().fromJsonString(d,f)},equals(d,f){return s.util.equals(u,d,f)}}),u}function kk(){let s=0,t=0;for(let a=0;a<28;a+=7){let o=this.buf[this.pos++];if(s|=(o&127)<<a,(o&128)==0)return this.assertBounds(),[s,t]}let i=this.buf[this.pos++];if(s|=(i&15)<<28,t=(i&112)>>4,(i&128)==0)return this.assertBounds(),[s,t];for(let a=3;a<=31;a+=7){let o=this.buf[this.pos++];if(t|=(o&127)<<a,(o&128)==0)return this.assertBounds(),[s,t]}throw new Error("invalid varint")}function Ed(s,t,i){for(let l=0;l<28;l=l+7){const u=s>>>l,d=!(!(u>>>7)&&t==0),f=(d?u|128:u)&255;if(i.push(f),!d)return}const a=s>>>28&15|(t&7)<<4,o=t>>3!=0;if(i.push((o?a|128:a)&255),!!o){for(let l=3;l<31;l=l+7){const u=t>>>l,d=!!(u>>>7),f=(d?u|128:u)&255;if(i.push(f),!d)return}i.push(t>>>31&1)}}const Cc=4294967296;function yv(s){const t=s[0]==="-";t&&(s=s.slice(1));const i=1e6;let a=0,o=0;function l(u,d){const f=Number(s.slice(u,d));o*=i,a=a*i+f,a>=Cc&&(o=o+(a/Cc|0),a=a%Cc)}return l(-24,-18),l(-18,-12),l(-12,-6),l(-6),t?zy(a,o):_h(a,o)}function Ek(s,t){let i=_h(s,t);const a=i.hi&2147483648;a&&(i=zy(i.lo,i.hi));const o=By(i.lo,i.hi);return a?"-"+o:o}function By(s,t){if({lo:s,hi:t}=Rk(s,t),t<=2097151)return String(Cc*t+s);const i=s&16777215,a=(s>>>24|t<<8)&16777215,o=t>>16&65535;let l=i+a*6777216+o*6710656,u=a+o*8147497,d=o*2;const f=1e7;return l>=f&&(u+=Math.floor(l/f),l%=f),u>=f&&(d+=Math.floor(u/f),u%=f),d.toString()+bv(u)+bv(l)}function Rk(s,t){return{lo:s>>>0,hi:t>>>0}}function _h(s,t){return{lo:s|0,hi:t|0}}function zy(s,t){return t=~t,s?s=~s+1:t+=1,_h(s,t)}const bv=s=>{const t=String(s);return"0000000".slice(t.length)+t};function Sv(s,t){if(s>=0){for(;s>127;)t.push(s&127|128),s=s>>>7;t.push(s)}else{for(let i=0;i<9;i++)t.push(s&127|128),s=s>>7;t.push(1)}}function _k(){let s=this.buf[this.pos++],t=s&127;if((s&128)==0)return this.assertBounds(),t;if(s=this.buf[this.pos++],t|=(s&127)<<7,(s&128)==0)return this.assertBounds(),t;if(s=this.buf[this.pos++],t|=(s&127)<<14,(s&128)==0)return this.assertBounds(),t;if(s=this.buf[this.pos++],t|=(s&127)<<21,(s&128)==0)return this.assertBounds(),t;s=this.buf[this.pos++],t|=(s&15)<<28;for(let i=5;(s&128)!==0&&i<10;i++)s=this.buf[this.pos++];if((s&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function Ok(){const s=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof s.getBigInt64=="function"&&typeof s.getBigUint64=="function"&&typeof s.setBigInt64=="function"&&typeof s.setBigUint64=="function"&&(typeof process!="object"||typeof gv!="object"||gv.BUF_BIGINT_DISABLE!=="1")){const o=BigInt("-9223372036854775808"),l=BigInt("9223372036854775807"),u=BigInt("0"),d=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(f){const m=typeof f=="bigint"?f:BigInt(f);if(m>l||m<o)throw new Error("int64 invalid: ".concat(f));return m},uParse(f){const m=typeof f=="bigint"?f:BigInt(f);if(m>d||m<u)throw new Error("uint64 invalid: ".concat(f));return m},enc(f){return s.setBigInt64(0,this.parse(f),!0),{lo:s.getInt32(0,!0),hi:s.getInt32(4,!0)}},uEnc(f){return s.setBigInt64(0,this.uParse(f),!0),{lo:s.getInt32(0,!0),hi:s.getInt32(4,!0)}},dec(f,m){return s.setInt32(0,f,!0),s.setInt32(4,m,!0),s.getBigInt64(0,!0)},uDec(f,m){return s.setInt32(0,f,!0),s.setInt32(4,m,!0),s.getBigUint64(0,!0)}}}const i=o=>rt(/^-?[0-9]+$/.test(o),"int64 invalid: ".concat(o)),a=o=>rt(/^[0-9]+$/.test(o),"uint64 invalid: ".concat(o));return{zero:"0",supported:!1,parse(o){return typeof o!="string"&&(o=o.toString()),i(o),o},uParse(o){return typeof o!="string"&&(o=o.toString()),a(o),o},enc(o){return typeof o!="string"&&(o=o.toString()),i(o),yv(o)},uEnc(o){return typeof o!="string"&&(o=o.toString()),a(o),yv(o)},dec(o,l){return Ek(o,l)},uDec(o,l){return By(o,l)}}}const et=Ok();var Q;(function(s){s[s.DOUBLE=1]="DOUBLE",s[s.FLOAT=2]="FLOAT",s[s.INT64=3]="INT64",s[s.UINT64=4]="UINT64",s[s.INT32=5]="INT32",s[s.FIXED64=6]="FIXED64",s[s.FIXED32=7]="FIXED32",s[s.BOOL=8]="BOOL",s[s.STRING=9]="STRING",s[s.BYTES=12]="BYTES",s[s.UINT32=13]="UINT32",s[s.SFIXED32=15]="SFIXED32",s[s.SFIXED64=16]="SFIXED64",s[s.SINT32=17]="SINT32",s[s.SINT64=18]="SINT64"})(Q||(Q={}));var Qi;(function(s){s[s.BIGINT=0]="BIGINT",s[s.STRING=1]="STRING"})(Qi||(Qi={}));function Bi(s,t,i){if(t===i)return!0;if(s==Q.BYTES){if(!(t instanceof Uint8Array)||!(i instanceof Uint8Array)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==i[a])return!1;return!0}switch(s){case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return t==i}return!1}function As(s,t){switch(s){case Q.BOOL:return!1;case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return t==0?et.zero:"0";case Q.DOUBLE:case Q.FLOAT:return 0;case Q.BYTES:return new Uint8Array(0);case Q.STRING:return"";default:return 0}}function qy(s,t){switch(s){case Q.BOOL:return t===!1;case Q.STRING:return t==="";case Q.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var ut;(function(s){s[s.Varint=0]="Varint",s[s.Bit64=1]="Bit64",s[s.LengthDelimited=2]="LengthDelimited",s[s.StartGroup=3]="StartGroup",s[s.EndGroup=4]="EndGroup",s[s.Bit32=5]="Bit32"})(ut||(ut={}));class Ak{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let o=0;o<this.chunks.length;o++)t+=this.chunks[o].length;let i=new Uint8Array(t),a=0;for(let o=0;o<this.chunks.length;o++)i.set(this.chunks[o],a),a+=this.chunks[o].length;return this.chunks=[],i}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),i=this.stack.pop();if(!i)throw new Error("invalid state, fork stack empty");return this.chunks=i.chunks,this.buf=i.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,i){return this.uint32((t<<3|i)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(Yd(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return Tc(t),Sv(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let i=this.textEncoder.encode(t);return this.uint32(i.byteLength),this.raw(i)}float(t){Py(t);let i=new Uint8Array(4);return new DataView(i.buffer).setFloat32(0,t,!0),this.raw(i)}double(t){let i=new Uint8Array(8);return new DataView(i.buffer).setFloat64(0,t,!0),this.raw(i)}fixed32(t){Yd(t);let i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,t,!0),this.raw(i)}sfixed32(t){Tc(t);let i=new Uint8Array(4);return new DataView(i.buffer).setInt32(0,t,!0),this.raw(i)}sint32(t){return Tc(t),t=(t<<1^t>>31)>>>0,Sv(t,this.buf),this}sfixed64(t){let i=new Uint8Array(8),a=new DataView(i.buffer),o=et.enc(t);return a.setInt32(0,o.lo,!0),a.setInt32(4,o.hi,!0),this.raw(i)}fixed64(t){let i=new Uint8Array(8),a=new DataView(i.buffer),o=et.uEnc(t);return a.setInt32(0,o.lo,!0),a.setInt32(4,o.hi,!0),this.raw(i)}int64(t){let i=et.enc(t);return Ed(i.lo,i.hi,this.buf),this}sint64(t){let i=et.enc(t),a=i.hi>>31,o=i.lo<<1^a,l=(i.hi<<1|i.lo>>>31)^a;return Ed(o,l,this.buf),this}uint64(t){let i=et.uEnc(t);return Ed(i.lo,i.hi,this.buf),this}}class Dk{constructor(t,i){this.varint64=kk,this.uint32=_k,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=i??new TextDecoder}tag(){let t=this.uint32(),i=t>>>3,a=t&7;if(i<=0||a<0||a>5)throw new Error("illegal tag: field no "+i+" wire type "+a);return[i,a]}skip(t,i){let a=this.pos;switch(t){case ut.Varint:for(;this.buf[this.pos++]&128;);break;case ut.Bit64:this.pos+=4;case ut.Bit32:this.pos+=4;break;case ut.LengthDelimited:let o=this.uint32();this.pos+=o;break;case ut.StartGroup:for(;;){const[l,u]=this.tag();if(u===ut.EndGroup){if(i!==void 0&&l!==i)throw new Error("invalid end group tag");break}this.skip(u,l)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(a,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return et.dec(...this.varint64())}uint64(){return et.uDec(...this.varint64())}sint64(){let[t,i]=this.varint64(),a=-(t&1);return t=(t>>>1|(i&1)<<31)^a,i=i>>>1^a,et.dec(t,i)}bool(){let[t,i]=this.varint64();return t!==0||i!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return et.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return et.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),i=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(i,i+t)}string(){return this.textDecoder.decode(this.bytes())}}function Mk(s,t,i,a){let o;return{typeName:t,extendee:i,get field(){if(!o){const l=typeof a=="function"?a():a;l.name=t.split(".").pop(),l.jsonName="[".concat(t,"]"),o=s.util.newFieldList([l]).list()[0]}return o},runtime:s}}function Vy(s){const t=s.field.localName,i=Object.create(null);return i[t]=wk(s),[i,()=>i[t]]}function wk(s){const t=s.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return As(t.T,t.L);case"message":const i=t.T,a=new i;return i.fieldWrapper?i.fieldWrapper.unwrapField(a):a;case"map":throw"map fields are not allowed to be extensions"}}function xk(s,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let i=s.length-1;i>=0;--i)if(s[i].no==t.no)return[s[i]];return[]}return s.filter(i=>i.no===t.no)}let ci="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Yc=[];for(let s=0;s<ci.length;s++)Yc[ci[s].charCodeAt(0)]=s;Yc[45]=ci.indexOf("+");Yc[95]=ci.indexOf("/");const Fy={dec(s){let t=s.length*3/4;s[s.length-2]=="="?t-=2:s[s.length-1]=="="&&(t-=1);let i=new Uint8Array(t),a=0,o=0,l,u=0;for(let d=0;d<s.length;d++){if(l=Yc[s.charCodeAt(d)],l===void 0)switch(s[d]){case"=":o=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:u=l,o=1;break;case 1:i[a++]=u<<2|(l&48)>>4,u=l,o=2;break;case 2:i[a++]=(u&15)<<4|(l&60)>>2,u=l,o=3;break;case 3:i[a++]=(u&3)<<6|l,o=0;break}}if(o==1)throw Error("invalid base64 string.");return i.subarray(0,a)},enc(s){let t="",i=0,a,o=0;for(let l=0;l<s.length;l++)switch(a=s[l],i){case 0:t+=ci[a>>2],o=(a&3)<<4,i=1;break;case 1:t+=ci[o|a>>4],o=(a&15)<<2,i=2;break;case 2:t+=ci[o|a>>6],t+=ci[a&63],i=0;break}return i&&(t+=ci[o],t+="=",i==1&&(t+="=")),t}};function Nk(s,t,i){Gy(t,s);const a=t.runtime.bin.makeReadOptions(i),o=xk(s.getType().runtime.bin.listUnknownFields(s),t.field),[l,u]=Vy(t);for(const d of o)t.runtime.bin.readField(l,a.readerFactory(d.data),t.field,d.wireType,a);return u()}function Pk(s,t,i,a){Gy(t,s);const o=t.runtime.bin.makeReadOptions(a),l=t.runtime.bin.makeWriteOptions(a);if(Hy(s,t)){const m=s.getType().runtime.bin.listUnknownFields(s).filter(g=>g.no!=t.field.no);s.getType().runtime.bin.discardUnknownFields(s);for(const g of m)s.getType().runtime.bin.onUnknownField(s,g.no,g.wireType,g.data)}const u=l.writerFactory();let d=t.field;!d.opt&&!d.repeated&&(d.kind=="enum"||d.kind=="scalar")&&(d=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(d,i,u,l);const f=o.readerFactory(u.finish());for(;f.pos<f.len;){const[m,g]=f.tag(),v=f.skip(g,m);s.getType().runtime.bin.onUnknownField(s,m,g,v)}}function Hy(s,t){const i=s.getType();return t.extendee.typeName===i.typeName&&!!i.runtime.bin.listUnknownFields(s).find(a=>a.no==t.field.no)}function Gy(s,t){rt(s.extendee.typeName==t.getType().typeName,"extension ".concat(s.typeName," can only be applied to message ").concat(s.extendee.typeName))}function Ky(s,t){const i=s.localName;if(s.repeated)return t[i].length>0;if(s.oneof)return t[s.oneof.localName].case===i;switch(s.kind){case"enum":case"scalar":return s.opt||s.req?t[i]!==void 0:s.kind=="enum"?t[i]!==s.T.values[0].no:!qy(s.T,t[i]);case"message":return t[i]!==void 0;case"map":return Object.keys(t[i]).length>0}}function Tv(s,t){const i=s.localName,a=!s.opt&&!s.req;if(s.repeated)t[i]=[];else if(s.oneof)t[s.oneof.localName]={case:void 0};else switch(s.kind){case"map":t[i]={};break;case"enum":t[i]=a?s.T.values[0].no:void 0;break;case"scalar":t[i]=a?As(s.T,s.L):void 0;break;case"message":t[i]=void 0;break}}function li(s,t){if(s===null||typeof s!="object"||!Object.getOwnPropertyNames(Rh.prototype).every(a=>a in s&&typeof s[a]=="function"))return!1;const i=s.getType();return i===null||typeof i!="function"||!("typeName"in i)||typeof i.typeName!="string"?!1:t===void 0?!0:i.typeName==t.typeName}function Yy(s,t){return li(t)||!s.fieldWrapper?t:s.fieldWrapper.wrapField(t)}Q.DOUBLE,Q.FLOAT,Q.INT64,Q.UINT64,Q.INT32,Q.UINT32,Q.BOOL,Q.STRING,Q.BYTES;const Cv={ignoreUnknownFields:!1},kv={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Lk(s){return s?Object.assign(Object.assign({},Cv),s):Cv}function Uk(s){return s?Object.assign(Object.assign({},kv),s):kv}const Lc=Symbol(),kc=Symbol();function Ik(){return{makeReadOptions:Lk,makeWriteOptions:Uk,readMessage(s,t,i,a){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(s.typeName," from JSON: ").concat(Pn(t)));a=a??new s;const o=new Map,l=i.typeRegistry;for(const[u,d]of Object.entries(t)){const f=s.fields.findJsonName(u);if(f){if(f.oneof){if(d===null&&f.kind=="scalar")continue;const m=o.get(f.oneof);if(m!==void 0)throw new Error("cannot decode message ".concat(s.typeName,' from JSON: multiple keys for oneof "').concat(f.oneof.name,'" present: "').concat(m,'", "').concat(u,'"'));o.set(f.oneof,u)}Ev(a,d,f,i,s)}else{let m=!1;if(l!=null&&l.findExtension&&u.startsWith("[")&&u.endsWith("]")){const g=l.findExtension(u.substring(1,u.length-1));if(g&&g.extendee.typeName==s.typeName){m=!0;const[v,b]=Vy(g);Ev(v,d,g.field,i,g),Pk(a,g,b(),i)}}if(!m&&!i.ignoreUnknownFields)throw new Error("cannot decode message ".concat(s.typeName,' from JSON: key "').concat(u,'" is unknown'))}}return a},writeMessage(s,t){const i=s.getType(),a={};let o;try{for(o of i.fields.byNumber()){if(!Ky(o,s)){if(o.req)throw"required field not set";if(!t.emitDefaultValues||!Bk(o))continue}const u=o.oneof?s[o.oneof.localName].value:s[o.localName],d=Rv(o,u,t);d!==void 0&&(a[t.useProtoFieldName?o.name:o.jsonName]=d)}const l=t.typeRegistry;if(l!=null&&l.findExtensionFor)for(const u of i.runtime.bin.listUnknownFields(s)){const d=l.findExtensionFor(i.typeName,u.no);if(d&&Hy(s,d)){const f=Nk(s,d,t),m=Rv(d.field,f,t);m!==void 0&&(a[d.field.jsonName]=m)}}}catch(l){const u=o?"cannot encode field ".concat(i.typeName,".").concat(o.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),d=l instanceof Error?l.message:String(l);throw new Error(u+(d.length>0?": ".concat(d):""))}return a},readScalar(s,t,i){return qr(s,t,i??Qi.BIGINT,!0)},writeScalar(s,t,i){if(t!==void 0&&(i||qy(s,t)))return Ec(s,t)},debug:Pn}}function Pn(s){if(s===null)return"null";switch(typeof s){case"object":return Array.isArray(s)?"array":"object";case"string":return s.length>100?"string":'"'.concat(s.split('"').join('\\"'),'"');default:return String(s)}}function Ev(s,t,i,a,o){let l=i.localName;if(i.repeated){if(rt(i.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(Pn(t)));const u=s[l];for(const d of t){if(d===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(Pn(d)));switch(i.kind){case"message":u.push(i.T.fromJson(d,a));break;case"enum":const f=Rd(i.T,d,a.ignoreUnknownFields,!0);f!==kc&&u.push(f);break;case"scalar":try{u.push(qr(i.T,d,i.L,!0))}catch(m){let g="cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(Pn(d));throw m instanceof Error&&m.message.length>0&&(g+=": ".concat(m.message)),new Error(g)}break}}}else if(i.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(Pn(t)));const u=s[l];for(const[d,f]of Object.entries(t)){if(f===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: map value null"));let m;try{m=jk(i.K,d)}catch(g){let v="cannot decode map key for field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(Pn(t));throw g instanceof Error&&g.message.length>0&&(v+=": ".concat(g.message)),new Error(v)}switch(i.V.kind){case"message":u[m]=i.V.T.fromJson(f,a);break;case"enum":const g=Rd(i.V.T,f,a.ignoreUnknownFields,!0);g!==kc&&(u[m]=g);break;case"scalar":try{u[m]=qr(i.V.T,f,Qi.BIGINT,!0)}catch(v){let b="cannot decode map value for field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(Pn(t));throw v instanceof Error&&v.message.length>0&&(b+=": ".concat(v.message)),new Error(b)}break}}}else switch(i.oneof&&(s=s[i.oneof.localName]={case:l},l="value"),i.kind){case"message":const u=i.T;if(t===null&&u.typeName!="google.protobuf.Value")return;let d=s[l];li(d)?d.fromJson(t,a):(s[l]=d=u.fromJson(t,a),u.fieldWrapper&&!i.oneof&&(s[l]=u.fieldWrapper.unwrapField(d)));break;case"enum":const f=Rd(i.T,t,a.ignoreUnknownFields,!1);switch(f){case Lc:Tv(i,s);break;case kc:break;default:s[l]=f;break}break;case"scalar":try{const m=qr(i.T,t,i.L,!1);switch(m){case Lc:Tv(i,s);break;default:s[l]=m;break}}catch(m){let g="cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(Pn(t));throw m instanceof Error&&m.message.length>0&&(g+=": ".concat(m.message)),new Error(g)}break}}function jk(s,t){if(s===Q.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return qr(s,t,Qi.BIGINT,!0).toString()}function qr(s,t,i,a){if(t===null)return a?As(s,i):Lc;switch(s){case Q.DOUBLE:case Q.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const o=Number(t);if(Number.isNaN(o)||!Number.isFinite(o))break;return s==Q.FLOAT&&Py(o),o;case Q.INT32:case Q.FIXED32:case Q.SFIXED32:case Q.SINT32:case Q.UINT32:let l;if(typeof t=="number"?l=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(l=Number(t)),l===void 0)break;return s==Q.UINT32||s==Q.FIXED32?Yd(l):Tc(l),l;case Q.INT64:case Q.SFIXED64:case Q.SINT64:if(typeof t!="number"&&typeof t!="string")break;const u=et.parse(t);return i?u.toString():u;case Q.FIXED64:case Q.UINT64:if(typeof t!="number"&&typeof t!="string")break;const d=et.uParse(t);return i?d.toString():d;case Q.BOOL:if(typeof t!="boolean")break;return t;case Q.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case Q.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return Fy.dec(t)}throw new Error}function Rd(s,t,i,a){if(t===null)return s.typeName=="google.protobuf.NullValue"?0:a?s.values[0].no:Lc;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const o=s.findName(t);if(o!==void 0)return o.no;if(i)return kc;break}throw new Error("cannot decode enum ".concat(s.typeName," from JSON: ").concat(Pn(t)))}function Bk(s){return s.repeated||s.kind=="map"?!0:!(s.oneof||s.kind=="message"||s.opt||s.req)}function Rv(s,t,i){if(s.kind=="map"){rt(typeof t=="object"&&t!=null);const a={},o=Object.entries(t);switch(s.V.kind){case"scalar":for(const[u,d]of o)a[u.toString()]=Ec(s.V.T,d);break;case"message":for(const[u,d]of o)a[u.toString()]=d.toJson(i);break;case"enum":const l=s.V.T;for(const[u,d]of o)a[u.toString()]=_d(l,d,i.enumAsInteger);break}return i.emitDefaultValues||o.length>0?a:void 0}if(s.repeated){rt(Array.isArray(t));const a=[];switch(s.kind){case"scalar":for(let o=0;o<t.length;o++)a.push(Ec(s.T,t[o]));break;case"enum":for(let o=0;o<t.length;o++)a.push(_d(s.T,t[o],i.enumAsInteger));break;case"message":for(let o=0;o<t.length;o++)a.push(t[o].toJson(i));break}return i.emitDefaultValues||a.length>0?a:void 0}switch(s.kind){case"scalar":return Ec(s.T,t);case"enum":return _d(s.T,t,i.enumAsInteger);case"message":return Yy(s.T,t).toJson(i)}}function _d(s,t,i){var a;if(rt(typeof t=="number"),s.typeName=="google.protobuf.NullValue")return null;if(i)return t;const o=s.findNumber(t);return(a=o==null?void 0:o.name)!==null&&a!==void 0?a:t}function Ec(s,t){switch(s){case Q.INT32:case Q.SFIXED32:case Q.SINT32:case Q.FIXED32:case Q.UINT32:return rt(typeof t=="number"),t;case Q.FLOAT:case Q.DOUBLE:return rt(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case Q.STRING:return rt(typeof t=="string"),t;case Q.BOOL:return rt(typeof t=="boolean"),t;case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return rt(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case Q.BYTES:return rt(t instanceof Uint8Array),Fy.enc(t)}}const gs=Symbol("@bufbuild/protobuf/unknown-fields"),_v={readUnknownFields:!0,readerFactory:s=>new Dk(s)},Ov={writeUnknownFields:!0,writerFactory:()=>new Ak};function zk(s){return s?Object.assign(Object.assign({},_v),s):_v}function qk(s){return s?Object.assign(Object.assign({},Ov),s):Ov}function Vk(){return{makeReadOptions:zk,makeWriteOptions:qk,listUnknownFields(s){var t;return(t=s[gs])!==null&&t!==void 0?t:[]},discardUnknownFields(s){delete s[gs]},writeUnknownFields(s,t){const a=s[gs];if(a)for(const o of a)t.tag(o.no,o.wireType).raw(o.data)},onUnknownField(s,t,i,a){const o=s;Array.isArray(o[gs])||(o[gs]=[]),o[gs].push({no:t,wireType:i,data:a})},readMessage(s,t,i,a,o){const l=s.getType(),u=o?t.len:t.pos+i;let d,f;for(;t.pos<u&&([d,f]=t.tag(),!(o===!0&&f==ut.EndGroup));){const m=l.fields.find(d);if(!m){const g=t.skip(f,d);a.readUnknownFields&&this.onUnknownField(s,d,f,g);continue}Av(s,t,m,f,a)}if(o&&(f!=ut.EndGroup||d!==i))throw new Error("invalid end group tag")},readField:Av,writeMessage(s,t,i){const a=s.getType();for(const o of a.fields.byNumber()){if(!Ky(o,s)){if(o.req)throw new Error("cannot encode field ".concat(a.typeName,".").concat(o.name," to binary: required field not set"));continue}const l=o.oneof?s[o.oneof.localName].value:s[o.localName];Dv(o,l,t,i)}return i.writeUnknownFields&&this.writeUnknownFields(s,t),t},writeField(s,t,i,a){t!==void 0&&Dv(s,t,i,a)}}}function Av(s,t,i,a,o){let{repeated:l,localName:u}=i;switch(i.oneof&&(s=s[i.oneof.localName],s.case!=u&&delete s.value,s.case=u,u="value"),i.kind){case"scalar":case"enum":const d=i.kind=="enum"?Q.INT32:i.T;let f=Uc;if(i.kind=="scalar"&&i.L>0&&(f=Hk),l){let b=s[u];if(a==ut.LengthDelimited&&d!=Q.STRING&&d!=Q.BYTES){let M=t.uint32()+t.pos;for(;t.pos<M;)b.push(f(t,d))}else b.push(f(t,d))}else s[u]=f(t,d);break;case"message":const m=i.T;l?s[u].push(Rc(t,new m,o,i)):li(s[u])?Rc(t,s[u],o,i):(s[u]=Rc(t,new m,o,i),m.fieldWrapper&&!i.oneof&&!i.repeated&&(s[u]=m.fieldWrapper.unwrapField(s[u])));break;case"map":let[g,v]=Fk(i,t,o);s[u][g]=v;break}}function Rc(s,t,i,a){const o=t.getType().runtime.bin,l=a==null?void 0:a.delimited;return o.readMessage(t,s,l?a.no:s.uint32(),i,l),t}function Fk(s,t,i){const a=t.uint32(),o=t.pos+a;let l,u;for(;t.pos<o;){const[d]=t.tag();switch(d){case 1:l=Uc(t,s.K);break;case 2:switch(s.V.kind){case"scalar":u=Uc(t,s.V.T);break;case"enum":u=t.int32();break;case"message":u=Rc(t,new s.V.T,i,void 0);break}break}}if(l===void 0&&(l=As(s.K,Qi.BIGINT)),typeof l!="string"&&typeof l!="number"&&(l=l.toString()),u===void 0)switch(s.V.kind){case"scalar":u=As(s.V.T,Qi.BIGINT);break;case"enum":u=s.V.T.values[0].no;break;case"message":u=new s.V.T;break}return[l,u]}function Hk(s,t){const i=Uc(s,t);return typeof i=="bigint"?i.toString():i}function Uc(s,t){switch(t){case Q.STRING:return s.string();case Q.BOOL:return s.bool();case Q.DOUBLE:return s.double();case Q.FLOAT:return s.float();case Q.INT32:return s.int32();case Q.INT64:return s.int64();case Q.UINT64:return s.uint64();case Q.FIXED64:return s.fixed64();case Q.BYTES:return s.bytes();case Q.FIXED32:return s.fixed32();case Q.SFIXED32:return s.sfixed32();case Q.SFIXED64:return s.sfixed64();case Q.SINT64:return s.sint64();case Q.UINT32:return s.uint32();case Q.SINT32:return s.sint32()}}function Dv(s,t,i,a){rt(t!==void 0);const o=s.repeated;switch(s.kind){case"scalar":case"enum":let l=s.kind=="enum"?Q.INT32:s.T;if(o)if(rt(Array.isArray(t)),s.packed)Kk(i,l,s.no,t);else for(const u of t)Vr(i,l,s.no,u);else Vr(i,l,s.no,t);break;case"message":if(o){rt(Array.isArray(t));for(const u of t)Mv(i,a,s,u)}else Mv(i,a,s,t);break;case"map":rt(typeof t=="object"&&t!=null);for(const[u,d]of Object.entries(t))Gk(i,a,s,u,d);break}}function Gk(s,t,i,a,o){s.tag(i.no,ut.LengthDelimited),s.fork();let l=a;switch(i.K){case Q.INT32:case Q.FIXED32:case Q.UINT32:case Q.SFIXED32:case Q.SINT32:l=Number.parseInt(a);break;case Q.BOOL:rt(a=="true"||a=="false"),l=a=="true";break}switch(Vr(s,i.K,1,l),i.V.kind){case"scalar":Vr(s,i.V.T,2,o);break;case"enum":Vr(s,Q.INT32,2,o);break;case"message":rt(o!==void 0),s.tag(2,ut.LengthDelimited).bytes(o.toBinary(t));break}s.join()}function Mv(s,t,i,a){const o=Yy(i.T,a);i.delimited?s.tag(i.no,ut.StartGroup).raw(o.toBinary(t)).tag(i.no,ut.EndGroup):s.tag(i.no,ut.LengthDelimited).bytes(o.toBinary(t))}function Vr(s,t,i,a){rt(a!==void 0);let[o,l]=Jy(t);s.tag(i,o)[l](a)}function Kk(s,t,i,a){if(!a.length)return;s.tag(i,ut.LengthDelimited).fork();let[,o]=Jy(t);for(let l=0;l<a.length;l++)s[o](a[l]);s.join()}function Jy(s){let t=ut.Varint;switch(s){case Q.BYTES:case Q.STRING:t=ut.LengthDelimited;break;case Q.DOUBLE:case Q.FIXED64:case Q.SFIXED64:t=ut.Bit64;break;case Q.FIXED32:case Q.SFIXED32:case Q.FLOAT:t=ut.Bit32;break}const i=Q[s].toLowerCase();return[t,i]}function Yk(){return{setEnumType:Uy,initPartial(s,t){if(s===void 0)return;const i=t.getType();for(const a of i.fields.byMember()){const o=a.localName,l=t,u=s;if(u[o]!=null)switch(a.kind){case"oneof":const d=u[o].case;if(d===void 0)continue;const f=a.findField(d);let m=u[o].value;f&&f.kind=="message"&&!li(m,f.T)?m=new f.T(m):f&&f.kind==="scalar"&&f.T===Q.BYTES&&(m=Nr(m)),l[o]={case:d,value:m};break;case"scalar":case"enum":let g=u[o];a.T===Q.BYTES&&(g=a.repeated?g.map(Nr):Nr(g)),l[o]=g;break;case"map":switch(a.V.kind){case"scalar":case"enum":if(a.V.T===Q.BYTES)for(const[C,M]of Object.entries(u[o]))l[o][C]=Nr(M);else Object.assign(l[o],u[o]);break;case"message":const b=a.V.T;for(const C of Object.keys(u[o])){let M=u[o][C];b.fieldWrapper||(M=new b(M)),l[o][C]=M}break}break;case"message":const v=a.T;if(a.repeated)l[o]=u[o].map(b=>li(b,v)?b:new v(b));else{const b=u[o];v.fieldWrapper?v.typeName==="google.protobuf.BytesValue"?l[o]=Nr(b):l[o]=b:l[o]=li(b,v)?b:new v(b)}break}}},equals(s,t,i){return t===i?!0:!t||!i?!1:s.fields.byMember().every(a=>{const o=t[a.localName],l=i[a.localName];if(a.repeated){if(o.length!==l.length)return!1;switch(a.kind){case"message":return o.every((u,d)=>a.T.equals(u,l[d]));case"scalar":return o.every((u,d)=>Bi(a.T,u,l[d]));case"enum":return o.every((u,d)=>Bi(Q.INT32,u,l[d]))}throw new Error("repeated cannot contain ".concat(a.kind))}switch(a.kind){case"message":let u=o,d=l;return a.T.fieldWrapper&&(u!==void 0&&!li(u)&&(u=a.T.fieldWrapper.wrapField(u)),d!==void 0&&!li(d)&&(d=a.T.fieldWrapper.wrapField(d))),a.T.equals(u,d);case"enum":return Bi(Q.INT32,o,l);case"scalar":return Bi(a.T,o,l);case"oneof":if(o.case!==l.case)return!1;const f=a.findField(o.case);if(f===void 0)return!0;switch(f.kind){case"message":return f.T.equals(o.value,l.value);case"enum":return Bi(Q.INT32,o.value,l.value);case"scalar":return Bi(f.T,o.value,l.value)}throw new Error("oneof cannot contain ".concat(f.kind));case"map":const m=Object.keys(o).concat(Object.keys(l));switch(a.V.kind){case"message":const g=a.V.T;return m.every(b=>g.equals(o[b],l[b]));case"enum":return m.every(b=>Bi(Q.INT32,o[b],l[b]));case"scalar":const v=a.V.T;return m.every(b=>Bi(v,o[b],l[b]))}break}})},clone(s){const t=s.getType(),i=new t,a=i;for(const o of t.fields.byMember()){const l=s[o.localName];let u;if(o.repeated)u=l.map(yc);else if(o.kind=="map"){u=a[o.localName];for(const[d,f]of Object.entries(l))u[d]=yc(f)}else o.kind=="oneof"?u=o.findField(l.case)?{case:l.case,value:yc(l.value)}:{case:void 0}:u=yc(l);a[o.localName]=u}for(const o of t.runtime.bin.listUnknownFields(s))t.runtime.bin.onUnknownField(a,o.no,o.wireType,o.data);return i}}}function yc(s){if(s===void 0)return s;if(li(s))return s.clone();if(s instanceof Uint8Array){const t=new Uint8Array(s.byteLength);return t.set(s),t}return s}function Nr(s){return s instanceof Uint8Array?s:new Uint8Array(s)}function Jk(s,t,i){return{syntax:s,json:Ik(),bin:Vk(),util:Object.assign(Object.assign({},Yk()),{newFieldList:t,initFields:i}),makeMessageType(a,o,l){return Ck(this,a,o,l)},makeEnum:Tk,makeEnumType:Iy,getEnumType:Sk,makeExtension(a,o,l){return Mk(this,a,o,l)}}}class Qk{constructor(t,i){this._fields=t,this._normalizer=i}findJsonName(t){if(!this.jsonNames){const i={};for(const a of this.list())i[a.jsonName]=i[a.name]=a;this.jsonNames=i}return this.jsonNames[t]}find(t){if(!this.numbers){const i={};for(const a of this.list())i[a.no]=a;this.numbers=i}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,i)=>t.no-i.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let i;for(const a of this.list())a.oneof?a.oneof!==i&&(i=a.oneof,t.push(i)):t.push(a)}return this.members}}function Qy(s,t){const i=Xy(s);return t?i:tE(eE(i))}function Xk(s){return Qy(s,!1)}const Zk=Xy;function Xy(s){let t=!1;const i=[];for(let a=0;a<s.length;a++){let o=s.charAt(a);switch(o){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(o),t=!1;break;default:t&&(t=!1,o=o.toUpperCase()),i.push(o);break}}return i.join("")}const Wk=new Set(["constructor","toString","toJSON","valueOf"]),$k=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Zy=s=>"".concat(s,"$"),eE=s=>$k.has(s)?Zy(s):s,tE=s=>Wk.has(s)?Zy(s):s;class nE{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=Xk(t)}addField(t){rt(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let i=0;i<this.fields.length;i++)this._lookup[this.fields[i].localName]=this.fields[i]}return this._lookup[t]}}function iE(s,t){var i,a,o,l,u,d;const f=[];let m;for(const g of typeof s=="function"?s():s){const v=g;if(v.localName=Qy(g.name,g.oneof!==void 0),v.jsonName=(i=g.jsonName)!==null&&i!==void 0?i:Zk(g.name),v.repeated=(a=g.repeated)!==null&&a!==void 0?a:!1,g.kind=="scalar"&&(v.L=(o=g.L)!==null&&o!==void 0?o:Qi.BIGINT),v.delimited=(l=g.delimited)!==null&&l!==void 0?l:!1,v.req=(u=g.req)!==null&&u!==void 0?u:!1,v.opt=(d=g.opt)!==null&&d!==void 0?d:!1,g.packed===void 0&&(v.packed=g.kind=="enum"||g.kind=="scalar"&&g.T!=Q.BYTES&&g.T!=Q.STRING),g.oneof!==void 0){const b=typeof g.oneof=="string"?g.oneof:g.oneof.name;(!m||m.name!=b)&&(m=new nE(b)),v.oneof=m,m.addField(v)}f.push(v)}return f}const U=Jk("proto3",s=>new Qk(s,t=>iE(t)),s=>{for(const t of s.getType().fields.byMember()){if(t.opt)continue;const i=t.localName,a=s;if(t.repeated){a[i]=[];continue}switch(t.kind){case"oneof":a[i]={case:void 0};break;case"enum":a[i]=0;break;case"map":a[i]={};break;case"scalar":a[i]=As(t.T,t.L);break}}});class Gt extends Rh{constructor(t){super(),this.seconds=et.zero,this.nanos=0,U.util.initPartial(t,this)}fromJson(t,i){if(typeof t!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(U.json.debug(t)));const a=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!a)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const o=Date.parse(a[1]+"-"+a[2]+"-"+a[3]+"T"+a[4]+":"+a[5]+":"+a[6]+(a[8]?a[8]:"Z"));if(Number.isNaN(o))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(o<Date.parse("0001-01-01T00:00:00Z")||o>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=et.parse(o/1e3),this.nanos=0,a[7]&&(this.nanos=parseInt("1"+a[7]+"0".repeat(9-a[7].length))-1e9),this}toJson(t){const i=Number(this.seconds)*1e3;if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let a="Z";if(this.nanos>0){const o=(this.nanos+1e9).toString().substring(1);o.substring(3)==="000000"?a="."+o.substring(0,3)+"Z":o.substring(6)==="000"?a="."+o.substring(0,6)+"Z":a="."+o+"Z"}return new Date(i).toISOString().replace(".000Z",a)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Gt.fromDate(new Date)}static fromDate(t){const i=t.getTime();return new Gt({seconds:et.parse(Math.floor(i/1e3)),nanos:i%1e3*1e6})}static fromBinary(t,i){return new Gt().fromBinary(t,i)}static fromJson(t,i){return new Gt().fromJson(t,i)}static fromJsonString(t,i){return new Gt().fromJsonString(t,i)}static equals(t,i){return U.util.equals(Gt,t,i)}}Gt.runtime=U;Gt.typeName="google.protobuf.Timestamp";Gt.fields=U.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const aE=U.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Gt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:sE,repeated:!0},{no:5,name:"events",kind:"message",T:oE,repeated:!0}]),sE=U.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:rE,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),rE=U.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Gt},{no:3,name:"value",kind:"scalar",T:2}]),oE=U.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Gt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Gt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Wy=U.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),En=U.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),gt=U.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Oh=U.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Br=U.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Yr=U.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),On=U.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Ta=U.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),cE=U.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ct=U.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Jc=U.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ic,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:d0}]),Ic=U.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),lE=U.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:U.getEnumType(gt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),ka=U.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:U.getEnumType(Ts)},{no:4,name:"tracks",kind:"message",T:ys,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:lE},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:U.getEnumType(Jr)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:U.getEnumType(On)},{no:18,name:"kind_details",kind:"enum",T:U.getEnumType(uE),repeated:!0}]),Ts=U.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Jr=U.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),uE=U.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),bt=U.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),dE=U.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Ki,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:U.getEnumType($y)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),ys=U.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:U.getEnumType(En)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:U.getEnumType(gt)},{no:10,name:"layers",kind:"message",T:Ki,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:dE,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:U.getEnumType(bt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:d0},{no:19,name:"audio_features",kind:"enum",T:U.getEnumType(Ct),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:U.getEnumType(Wy)}]),Ki=U.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:U.getEnumType(Oh)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),$y=U.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Lt=U.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:U.getEnumType(Oe)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Ah,oneof:"value"},{no:3,name:"speaker",kind:"message",T:hE,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:i0,oneof:"value"},{no:7,name:"transcription",kind:"message",T:fE,oneof:"value"},{no:8,name:"metrics",kind:"message",T:aE,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:jc,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Dh,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Mh,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:wh,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Bc,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:zc,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:qc,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:e0,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Oe=U.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),e0=U.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:U.getEnumType(bt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),t0=U.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Ah,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:jc,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Dh,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Mh,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:wh,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Bc,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:zc,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:qc,oneof:"value"}]),hE=U.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:n0,repeated:!0}]),n0=U.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Ah=U.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),i0=U.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),fE=U.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:mE,repeated:!0}]),mE=U.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),jc=U.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Dh=U.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Mh=U.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),wh=U.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:a0,oneof:"value"}]),a0=U.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),s0=U.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),r0=U.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:U.getEnumType(o0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),o0=U.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),c0=U.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:U.getEnumType(l0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),l0=U.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),u0=U.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:wv},{no:2,name:"screen",kind:"message",T:wv},{no:3,name:"resume_connection",kind:"enum",T:U.getEnumType(Yr)},{no:4,name:"disabled_codecs",kind:"message",T:pE},{no:5,name:"force_relay",kind:"enum",T:U.getEnumType(Yr)}]),wv=U.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:U.getEnumType(Yr)}]),pE=U.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ic,repeated:!0},{no:2,name:"publish",kind:"message",T:Ic,repeated:!0}]),d0=U.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Jd=U.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),h0=U.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:U.getEnumType(Jd)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),f0=U.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Bc=U.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:U.getEnumType(bt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:h0,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:f0,oneof:"content_header"}],{localName:"DataStream_Header"}),zc=U.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),qc=U.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),gE=U.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Rn=U.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Qd=U.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),vE=U.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),yE=U.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Xi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Xi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Qc,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Qr,oneof:"message"},{no:5,name:"mute",kind:"message",T:Xc,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Zc,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:m0,oneof:"message"},{no:8,name:"leave",kind:"message",T:Wc,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:g0,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:b0,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Uh,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Nn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Ph,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:C0,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Nh,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:p0,oneof:"message"}]),xv=U.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:bE,oneof:"message"},{no:2,name:"answer",kind:"message",T:Xi,oneof:"message"},{no:3,name:"offer",kind:"message",T:Xi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Qc,oneof:"message"},{no:5,name:"update",kind:"message",T:CE,oneof:"message"},{no:6,name:"track_published",kind:"message",T:xh,oneof:"message"},{no:8,name:"leave",kind:"message",T:Wc,oneof:"message"},{no:9,name:"mute",kind:"message",T:Xc,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:kE,oneof:"message"},{no:11,name:"room_update",kind:"message",T:EE,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:_E,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:AE,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:ME,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:xE,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:TE,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:SE,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:PE,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:IE,oneof:"message"},{no:22,name:"request_response",kind:"message",T:jE,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:BE,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:NE,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:FE,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:wE,oneof:"message"}]),Xd=U.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Ki,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:U.getEnumType($y)}]),Qr=U.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:U.getEnumType(En)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:U.getEnumType(gt)},{no:9,name:"layers",kind:"message",T:Ki,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Xd,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:U.getEnumType(bt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:U.getEnumType(Wy)},{no:17,name:"audio_features",kind:"enum",T:U.getEnumType(Ct),repeated:!0}]),Qc=U.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:U.getEnumType(Rn)},{no:3,name:"final",kind:"scalar",T:8}]),Xc=U.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),bE=U.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Jc},{no:2,name:"participant",kind:"message",T:ka},{no:3,name:"other_participants",kind:"message",T:ka,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:v0,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:u0},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:r0},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ic,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),SE=U.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:v0,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:u0},{no:3,name:"server_info",kind:"message",T:r0},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),xh=U.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ys}]),TE=U.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Xi=U.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),CE=U.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:ka,repeated:!0}]),Zc=U.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:s0,repeated:!0}]),m0=U.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:U.getEnumType(Oh)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Nh=U.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:U.getEnumType(Ct),repeated:!0}]),p0=U.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Wc=U.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:U.getEnumType(On)},{no:3,name:"action",kind:"enum",T:U.getEnumType(Cs)},{no:4,name:"regions",kind:"message",T:LE}]),Cs=U.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),g0=U.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Ki,repeated:!0}]),Ph=U.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),v0=U.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),kE=U.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:n0,repeated:!0}]),EE=U.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Jc}]),RE=U.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:U.getEnumType(Br)},{no:3,name:"score",kind:"scalar",T:2}]),_E=U.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:RE,repeated:!0}]),OE=U.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:U.getEnumType(Qd)}]),AE=U.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:OE,repeated:!0}]),Lh=U.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:U.getEnumType(Oh)},{no:2,name:"enabled",kind:"scalar",T:8}]),DE=U.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Lh,repeated:!0}]),ME=U.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Lh,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:DE,repeated:!0}]),wE=U.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:gE,repeated:!0}]),y0=U.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),b0=U.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:y0,repeated:!0}]),xE=U.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),NE=U.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Jc},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:ka},{no:4,name:"other_participants",kind:"message",T:ka,repeated:!0}]),Uh=U.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Xi},{no:2,name:"subscription",kind:"message",T:Zc},{no:3,name:"publish_tracks",kind:"message",T:xh,repeated:!0},{no:4,name:"data_channels",kind:"message",T:T0,repeated:!0},{no:5,name:"offer",kind:"message",T:Xi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:S0,repeated:!0}]),S0=U.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),T0=U.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:U.getEnumType(Rn)}]),Nn=U.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:U.getEnumType(vE),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),C0=U.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),PE=U.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),LE=U.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:UE,repeated:!0}]),UE=U.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),IE=U.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:U.getEnumType(cE)}]),jE=U.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:U.getEnumType(Ih)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Qc,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Qr,oneof:"request"},{no:6,name:"mute",kind:"message",T:Xc,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Ph,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Nh,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:p0,oneof:"request"}]),Ih=U.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),BE=U.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),k0=U.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),zE=U.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:c0},{no:2,name:"connection_settings",kind:"message",T:k0},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Qr,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Xi},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:U.getEnumType(Ta)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Uh}]),qE=U.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:U.getEnumType(VE)},{no:2,name:"join_request",kind:"scalar",T:12}]),VE=U.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),FE=U.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function HE(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var _c={exports:{}},GE=_c.exports,Nv;function KE(){return Nv||(Nv=1,(function(s){(function(t,i){s.exports?s.exports=i():t.log=i()})(GE,function(){var t=function(){},i="undefined",a=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},u=null;function d(O,B){var w=O[B];if(typeof w.bind=="function")return w.bind(O);try{return Function.prototype.bind.call(w,O)}catch{return function(){return Function.prototype.apply.apply(w,[O,arguments])}}}function f(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function m(O){return O==="debug"&&(O="log"),typeof console===i?!1:O==="trace"&&a?f:console[O]!==void 0?d(console,O):console.log!==void 0?d(console,"log"):t}function g(){for(var O=this.getLevel(),B=0;B<o.length;B++){var w=o[B];this[w]=B<O?t:this.methodFactory(w,O,this.name)}if(this.log=this.debug,typeof console===i&&O<this.levels.SILENT)return"No console available for logging"}function v(O){return function(){typeof console!==i&&(g.call(this),this[O].apply(this,arguments))}}function b(O,B,w){return m(O)||v.apply(this,arguments)}function C(O,B){var w=this,X,K,A,_="loglevel";typeof O=="string"?_+=":"+O:typeof O=="symbol"&&(_=void 0);function I(ce){var pe=(o[ce]||"silent").toUpperCase();if(!(typeof window===i||!_)){try{window.localStorage[_]=pe;return}catch{}try{window.document.cookie=encodeURIComponent(_)+"="+pe+";"}catch{}}}function q(){var ce;if(!(typeof window===i||!_)){try{ce=window.localStorage[_]}catch{}if(typeof ce===i)try{var pe=window.document.cookie,Ve=encodeURIComponent(_),nt=pe.indexOf(Ve+"=");nt!==-1&&(ce=/^([^;]+)/.exec(pe.slice(nt+Ve.length+1))[1])}catch{}return w.levels[ce]===void 0&&(ce=void 0),ce}}function W(){if(!(typeof window===i||!_)){try{window.localStorage.removeItem(_)}catch{}try{window.document.cookie=encodeURIComponent(_)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function oe(ce){var pe=ce;if(typeof pe=="string"&&w.levels[pe.toUpperCase()]!==void 0&&(pe=w.levels[pe.toUpperCase()]),typeof pe=="number"&&pe>=0&&pe<=w.levels.SILENT)return pe;throw new TypeError("log.setLevel() called with invalid level: "+ce)}w.name=O,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=B||b,w.getLevel=function(){return A??K??X},w.setLevel=function(ce,pe){return A=oe(ce),pe!==!1&&I(A),g.call(w)},w.setDefaultLevel=function(ce){K=oe(ce),q()||w.setLevel(ce,!1)},w.resetLevel=function(){A=null,W(),g.call(w)},w.enableAll=function(ce){w.setLevel(w.levels.TRACE,ce)},w.disableAll=function(ce){w.setLevel(w.levels.SILENT,ce)},w.rebuild=function(){if(u!==w&&(X=oe(u.getLevel())),g.call(w),u===w)for(var ce in l)l[ce].rebuild()},X=oe(u?u.getLevel():"WARN");var re=q();re!=null&&(A=oe(re)),g.call(w)}u=new C,u.getLogger=function(B){if(typeof B!="symbol"&&typeof B!="string"||B==="")throw new TypeError("You must supply a name when creating a logger.");var w=l[B];return w||(w=l[B]=new C(B,u.methodFactory)),w};var M=typeof window!==i?window.log:void 0;return u.noConflict=function(){return typeof window!==i&&window.log===u&&(window.log=M),u},u.getLoggers=function(){return l},u.default=u,u})})(_c)),_c.exports}var $c=KE(),Zd;(function(s){s[s.trace=0]="trace",s[s.debug=1]="debug",s[s.info=2]="info",s[s.warn=3]="warn",s[s.error=4]="error",s[s.silent=5]="silent"})(Zd||(Zd={}));var An;(function(s){s.Default="livekit",s.Room="livekit-room",s.TokenSource="livekit-token-source",s.Participant="livekit-participant",s.Track="livekit-track",s.Publication="livekit-track-publication",s.Engine="livekit-engine",s.Signal="livekit-signal",s.PCManager="livekit-pc-manager",s.PCTransport="livekit-pc-transport",s.E2EE="lk-e2ee"})(An||(An={}));let Re=$c.getLogger("livekit");Object.values(An).map(s=>$c.getLogger(s));Re.setDefaultLevel(Zd.info);function hi(s){const t=$c.getLogger(s);return t.setDefaultLevel(Re.getLevel()),t}const YE=$c.getLogger("lk-e2ee"),Pr=7e3,JE=[0,300,4*300,9*300,16*300,Pr,Pr,Pr,Pr,Pr];class QE{constructor(t){this._retryDelays=t!==void 0?[...t]:JE}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const i=this._retryDelays[t.retryCount];return t.retryCount<=1?i:i+Math.random()*1e3}}function XE(s,t){var i={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&t.indexOf(a)<0&&(i[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(s);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(s,a[o])&&(i[a[o]]=s[a[o]]);return i}function T(s,t,i,a){function o(l){return l instanceof i?l:new i(function(u){u(l)})}return new(i||(i=Promise))(function(l,u){function d(g){try{m(a.next(g))}catch(v){u(v)}}function f(g){try{m(a.throw(g))}catch(v){u(v)}}function m(g){g.done?l(g.value):o(g.value).then(d,f)}m((a=a.apply(s,t||[])).next())})}function Pv(s){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&s[t],a=0;if(i)return i.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ui(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],i;return t?t.call(s):(s=typeof Pv=="function"?Pv(s):s[Symbol.iterator](),i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i);function a(l){i[l]=s[l]&&function(u){return new Promise(function(d,f){u=s[l](u),o(d,f,u.done,u.value)})}}function o(l,u,d,f){Promise.resolve(f).then(function(m){l({value:m,done:d})},u)}}var bc={exports:{}},Lv;function ZE(){if(Lv)return bc.exports;Lv=1;var s=typeof Reflect=="object"?Reflect:null,t=s&&typeof s.apply=="function"?s.apply:function(_,I,q){return Function.prototype.apply.call(_,I,q)},i;s&&typeof s.ownKeys=="function"?i=s.ownKeys:Object.getOwnPropertySymbols?i=function(_){return Object.getOwnPropertyNames(_).concat(Object.getOwnPropertySymbols(_))}:i=function(_){return Object.getOwnPropertyNames(_)};function a(A){console&&console.warn&&console.warn(A)}var o=Number.isNaN||function(_){return _!==_};function l(){l.init.call(this)}bc.exports=l,bc.exports.once=w,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var u=10;function d(A){if(typeof A!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof A)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(A){if(typeof A!="number"||A<0||o(A))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+A+".");u=A}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(_){if(typeof _!="number"||_<0||o(_))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+_+".");return this._maxListeners=_,this};function f(A){return A._maxListeners===void 0?l.defaultMaxListeners:A._maxListeners}l.prototype.getMaxListeners=function(){return f(this)},l.prototype.emit=function(_){for(var I=[],q=1;q<arguments.length;q++)I.push(arguments[q]);var W=_==="error",oe=this._events;if(oe!==void 0)W=W&&oe.error===void 0;else if(!W)return!1;if(W){var re;if(I.length>0&&(re=I[0]),re instanceof Error)throw re;var ce=new Error("Unhandled error."+(re?" ("+re.message+")":""));throw ce.context=re,ce}var pe=oe[_];if(pe===void 0)return!1;if(typeof pe=="function")t(pe,this,I);else for(var Ve=pe.length,nt=M(pe,Ve),q=0;q<Ve;++q)t(nt[q],this,I);return!0};function m(A,_,I,q){var W,oe,re;if(d(I),oe=A._events,oe===void 0?(oe=A._events=Object.create(null),A._eventsCount=0):(oe.newListener!==void 0&&(A.emit("newListener",_,I.listener?I.listener:I),oe=A._events),re=oe[_]),re===void 0)re=oe[_]=I,++A._eventsCount;else if(typeof re=="function"?re=oe[_]=q?[I,re]:[re,I]:q?re.unshift(I):re.push(I),W=f(A),W>0&&re.length>W&&!re.warned){re.warned=!0;var ce=new Error("Possible EventEmitter memory leak detected. "+re.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");ce.name="MaxListenersExceededWarning",ce.emitter=A,ce.type=_,ce.count=re.length,a(ce)}return A}l.prototype.addListener=function(_,I){return m(this,_,I,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(_,I){return m(this,_,I,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(A,_,I){var q={fired:!1,wrapFn:void 0,target:A,type:_,listener:I},W=g.bind(q);return W.listener=I,q.wrapFn=W,W}l.prototype.once=function(_,I){return d(I),this.on(_,v(this,_,I)),this},l.prototype.prependOnceListener=function(_,I){return d(I),this.prependListener(_,v(this,_,I)),this},l.prototype.removeListener=function(_,I){var q,W,oe,re,ce;if(d(I),W=this._events,W===void 0)return this;if(q=W[_],q===void 0)return this;if(q===I||q.listener===I)--this._eventsCount===0?this._events=Object.create(null):(delete W[_],W.removeListener&&this.emit("removeListener",_,q.listener||I));else if(typeof q!="function"){for(oe=-1,re=q.length-1;re>=0;re--)if(q[re]===I||q[re].listener===I){ce=q[re].listener,oe=re;break}if(oe<0)return this;oe===0?q.shift():O(q,oe),q.length===1&&(W[_]=q[0]),W.removeListener!==void 0&&this.emit("removeListener",_,ce||I)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(_){var I,q,W;if(q=this._events,q===void 0)return this;if(q.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):q[_]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete q[_]),this;if(arguments.length===0){var oe=Object.keys(q),re;for(W=0;W<oe.length;++W)re=oe[W],re!=="removeListener"&&this.removeAllListeners(re);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(I=q[_],typeof I=="function")this.removeListener(_,I);else if(I!==void 0)for(W=I.length-1;W>=0;W--)this.removeListener(_,I[W]);return this};function b(A,_,I){var q=A._events;if(q===void 0)return[];var W=q[_];return W===void 0?[]:typeof W=="function"?I?[W.listener||W]:[W]:I?B(W):M(W,W.length)}l.prototype.listeners=function(_){return b(this,_,!0)},l.prototype.rawListeners=function(_){return b(this,_,!1)},l.listenerCount=function(A,_){return typeof A.listenerCount=="function"?A.listenerCount(_):C.call(A,_)},l.prototype.listenerCount=C;function C(A){var _=this._events;if(_!==void 0){var I=_[A];if(typeof I=="function")return 1;if(I!==void 0)return I.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};function M(A,_){for(var I=new Array(_),q=0;q<_;++q)I[q]=A[q];return I}function O(A,_){for(;_+1<A.length;_++)A[_]=A[_+1];A.pop()}function B(A){for(var _=new Array(A.length),I=0;I<_.length;++I)_[I]=A[I].listener||A[I];return _}function w(A,_){return new Promise(function(I,q){function W(re){A.removeListener(_,oe),q(re)}function oe(){typeof A.removeListener=="function"&&A.removeListener("error",W),I([].slice.call(arguments))}K(A,_,oe,{once:!0}),_!=="error"&&X(A,W,{once:!0})})}function X(A,_,I){typeof A.on=="function"&&K(A,"error",_,I)}function K(A,_,I,q){if(typeof A.on=="function")q.once?A.once(_,I):A.on(_,I);else if(typeof A.addEventListener=="function")A.addEventListener(_,function W(oe){q.once&&A.removeEventListener(_,W),I(oe)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof A)}return bc.exports}var jn=ZE();let E0=!0,R0=!0;function zr(s,t,i){const a=s.match(t);return a&&a.length>=i&&parseFloat(a[i],10)}function _a(s,t,i){if(!s.RTCPeerConnection)return;const a=s.RTCPeerConnection.prototype,o=a.addEventListener;a.addEventListener=function(u,d){if(u!==t)return o.apply(this,arguments);const f=m=>{const g=i(m);g&&(d.handleEvent?d.handleEvent(g):d(g))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(d,f),o.apply(this,[u,f])};const l=a.removeEventListener;a.removeEventListener=function(u,d){if(u!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(d))return l.apply(this,arguments);const f=this._eventMap[t].get(d);return this._eventMap[t].delete(d),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[u,f])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(u){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),u&&this.addEventListener(t,this["_on"+t]=u)},enumerable:!0,configurable:!0})}function WE(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(E0=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function $E(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(R0=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function _0(){if(typeof window=="object"){if(E0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function jh(s,t){R0&&console.warn(s+" is deprecated, please use "+t+" instead.")}function eR(s){const t={browser:null,version:null};if(typeof s>"u"||!s.navigator||!s.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=s;if(i.userAgentData&&i.userAgentData.brands){const a=i.userAgentData.brands.find(o=>o.brand==="Chromium");if(a)return{browser:"chrome",version:parseInt(a.version,10)}}if(i.mozGetUserMedia)t.browser="firefox",t.version=parseInt(zr(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(zr(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(s.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(zr(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype,t._safariVersion=zr(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function Uv(s){return Object.prototype.toString.call(s)==="[object Object]"}function O0(s){return Uv(s)?Object.keys(s).reduce(function(t,i){const a=Uv(s[i]),o=a?O0(s[i]):s[i],l=a&&!Object.keys(o).length;return o===void 0||l?t:Object.assign(t,{[i]:o})},{}):s}function Wd(s,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(a=>{a.endsWith("Id")?Wd(s,s.get(t[a]),i):a.endsWith("Ids")&&t[a].forEach(o=>{Wd(s,s.get(o),i)})}))}function Iv(s,t,i){const a=i?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const l=[];return s.forEach(u=>{u.type==="track"&&u.trackIdentifier===t.id&&l.push(u)}),l.forEach(u=>{s.forEach(d=>{d.type===a&&d.trackId===u.id&&Wd(s,d,o)})}),o}const jv=_0;function A0(s,t){const i=s&&s.navigator;if(!i.mediaDevices)return;const a=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const f={};return Object.keys(d).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const g=typeof d[m]=="object"?d[m]:{ideal:d[m]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const v=function(b,C){return b?b+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(g.ideal!==void 0){f.optional=f.optional||[];let b={};typeof g.ideal=="number"?(b[v("min",m)]=g.ideal,f.optional.push(b),b={},b[v("max",m)]=g.ideal,f.optional.push(b)):(b[v("",m)]=g.ideal,f.optional.push(b))}g.exact!==void 0&&typeof g.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[v("",m)]=g.exact):["min","max"].forEach(b=>{g[b]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[v(b,m)]=g[b])})}),d.advanced&&(f.optional=(f.optional||[]).concat(d.advanced)),f},o=function(d,f){if(t.version>=61)return f(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const m=function(g,v,b){v in g&&!(b in g)&&(g[b]=g[v],delete g[v])};d=JSON.parse(JSON.stringify(d)),m(d.audio,"autoGainControl","googAutoGainControl"),m(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=a(d.audio)}if(d&&typeof d.video=="object"){let m=d.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const g=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete d.video.facingMode;let v;if(m.exact==="environment"||m.ideal==="environment"?v=["back","rear"]:(m.exact==="user"||m.ideal==="user")&&(v=["front"]),v)return i.mediaDevices.enumerateDevices().then(b=>{b=b.filter(M=>M.kind==="videoinput");let C=b.find(M=>v.some(O=>M.label.toLowerCase().includes(O)));return!C&&b.length&&v.includes("back")&&(C=b[b.length-1]),C&&(d.video.deviceId=m.exact?{exact:C.deviceId}:{ideal:C.deviceId}),d.video=a(d.video),jv("chrome: "+JSON.stringify(d)),f(d)})}d.video=a(d.video)}return jv("chrome: "+JSON.stringify(d)),f(d)},l=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},u=function(d,f,m){o(d,g=>{i.webkitGetUserMedia(g,f,v=>{m&&m(l(v))})})};if(i.getUserMedia=u.bind(i),i.mediaDevices.getUserMedia){const d=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(f){return o(f,m=>d(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(l(g))))}}}function D0(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function M0(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=a=>{a.stream.addEventListener("addtrack",o=>{let l;s.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(d=>d.track&&d.track.id===o.track.id):l={track:o.track};const u=new Event("track");u.track=o.track,u.receiver=l,u.transceiver={receiver:l},u.streams=[a.stream],this.dispatchEvent(u)}),a.stream.getTracks().forEach(o=>{let l;s.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(d=>d.track&&d.track.id===o.id):l={track:o};const u=new Event("track");u.track=o,u.receiver=l,u.transceiver={receiver:l},u.streams=[a.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else _a(s,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function w0(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const t=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(d,f){let m=o.apply(this,arguments);return m||(m=t(this,d),this._senders.push(m)),m};const l=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(d){l.apply(this,arguments);const f=this._senders.indexOf(d);f!==-1&&this._senders.splice(f,1)}}const i=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],i.apply(this,[l]),l.getTracks().forEach(u=>{this._senders.push(t(this,u))})};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(u=>{const d=this._senders.find(f=>f.track===u);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function x0(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const i=s.RTCPeerConnection.prototype.getSenders;i&&(s.RTCPeerConnection.prototype.getSenders=function(){const l=i.apply(this,[]);return l.forEach(u=>u._pc=this),l});const a=s.RTCPeerConnection.prototype.addTrack;a&&(s.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),s.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(u=>Iv(u,l.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const i=s.RTCPeerConnection.prototype.getReceivers;i&&(s.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(l=>l._pc=this),o}),_a(s,"track",a=>(a.receiver._pc=a.srcElement,a)),s.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>Iv(l,o.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const t=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const a=arguments[0];let o,l,u;return this.getSenders().forEach(d=>{d.track===a&&(o?u=!0:o=d)}),this.getReceivers().forEach(d=>(d.track===a&&(l?u=!0:l=d),d.track===a)),u||o&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function N0(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const t=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(u,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(f)===-1&&this._shimmedLocalStreams[d.id].push(f):this._shimmedLocalStreams[d.id]=[d,f],f};const i=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(m=>{if(this.getSenders().find(v=>v.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();i.apply(this,arguments);const f=this.getSenders().filter(m=>d.indexOf(m)===-1);this._shimmedLocalStreams[u.id]=[u].concat(f)};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],a.apply(this,arguments)};const o=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const f=this._shimmedLocalStreams[d].indexOf(u);f!==-1&&this._shimmedLocalStreams[d].splice(f,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),o.apply(this,arguments)}}function P0(s,t){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&t.version>=65)return N0(s);const i=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(v=>this._reverseStreams[v.id])};const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(v=>{if(this.getSenders().find(C=>C.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const v=new s.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}a.apply(this,[g])};const o=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},s.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(O=>O===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(O=>O.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const M=this._streams[v.id];if(M)M.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const O=new s.MediaStream([g]);this._streams[v.id]=O,this._reverseStreams[O.id]=v,this.addStream(O)}return this.getSenders().find(O=>O.track===g)};function l(m,g){let v=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(b=>{const C=m._reverseStreams[b],M=m._streams[C.id];v=v.replace(new RegExp(M.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:v})}function u(m,g){let v=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(b=>{const C=m._reverseStreams[b],M=m._streams[C.id];v=v.replace(new RegExp(C.id,"g"),M.id)}),new RTCSessionDescription({type:g.type,sdp:v})}["createOffer","createAnswer"].forEach(function(m){const g=s.RTCPeerConnection.prototype[m],v={[m](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[M=>{const O=l(this,M);b[0].apply(null,[O])},M=>{b[1]&&b[1].apply(null,M)},arguments[2]]):g.apply(this,arguments).then(M=>l(this,M))}};s.RTCPeerConnection.prototype[m]=v[m]});const d=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=u(this,arguments[0]),d.apply(this,arguments))};const f=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const m=f.get.apply(this);return m.type===""?m:l(this,m)}}),s.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(C=>{this._streams[C].getTracks().find(O=>g.track===O)&&(b=this._streams[C])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $d(s,t){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=s.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};s.RTCPeerConnection.prototype[i]=o[i]})}function L0(s,t){_a(s,"negotiationneeded",i=>{const a=i.target;if(!((t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")&&a.signalingState!=="stable"))return i})}var Bv=Object.freeze({__proto__:null,fixNegotiationNeeded:L0,shimAddTrackRemoveTrack:P0,shimAddTrackRemoveTrackWithNative:N0,shimGetSendersWithDtmf:w0,shimGetUserMedia:A0,shimMediaStream:D0,shimOnTrack:M0,shimPeerConnection:$d,shimSenderReceiverGetStats:x0});function U0(s,t){const i=s&&s.navigator,a=s&&s.MediaStreamTrack;if(i.getUserMedia=function(o,l,u){jh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(o).then(l,u)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const o=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])},l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u.audio,"autoGainControl","mozAutoGainControl"),o(u.audio,"noiseSuppression","mozNoiseSuppression")),l(u)},a&&a.prototype.getSettings){const u=a.prototype.getSettings;a.prototype.getSettings=function(){const d=u.apply(this,arguments);return o(d,"mozAutoGainControl","autoGainControl"),o(d,"mozNoiseSuppression","noiseSuppression"),d}}if(a&&a.prototype.applyConstraints){const u=a.prototype.applyConstraints;a.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),o(d,"autoGainControl","mozAutoGainControl"),o(d,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[d])}}}}function tR(s,t){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(a){if(!(a&&a.video)){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return a.video===!0?a.video={mediaSource:t}:a.video.mediaSource=t,s.navigator.mediaDevices.getUserMedia(a)})}function I0(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function eh(s,t){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=s.RTCPeerConnection.prototype[o],u={[o](){return arguments[0]=new(o==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};s.RTCPeerConnection.prototype[o]=u[o]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[l,u,d]=arguments;return a.apply(this,[l||null]).then(f=>{if(t.version<53&&!u)try{f.forEach(m=>{m.type=i[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;f.forEach((g,v)=>{f.set(v,Object.assign({},g,{type:i[g.type]||g.type}))})}return f}).then(u,d)}}function j0(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(l=>l._pc=this),o});const i=s.RTCPeerConnection.prototype.addTrack;i&&(s.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function B0(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a}),_a(s,"track",i=>(i.receiver._pc=i.srcElement,i)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function z0(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(i){jh("removeStream","removeTrack"),this.getSenders().forEach(a=>{a.track&&i.getTracks().includes(a.track)&&this.removeTrack(a)})})}function q0(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function V0(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.addTransceiver;t&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;a===void 0&&(a=[]),a=[...a];const o=a.length>0;o&&a.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=t.apply(this,arguments);if(o){const{sender:u}=l,d=u.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=a,u.sendEncodings=a,this.setParametersPromises.push(u.setParameters(d).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return l})}function F0(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const t=s.RTCRtpSender.prototype.getParameters;t&&(s.RTCRtpSender.prototype.getParameters=function(){const a=t.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function H0(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function G0(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var zv=Object.freeze({__proto__:null,shimAddTransceiver:V0,shimCreateAnswer:G0,shimCreateOffer:H0,shimGetDisplayMedia:tR,shimGetParameters:F0,shimGetUserMedia:U0,shimOnTrack:I0,shimPeerConnection:eh,shimRTCDataChannel:q0,shimReceiverGetStats:B0,shimRemoveStream:z0,shimSenderGetStats:j0});function K0(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const t=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(o=>t.call(this,o,a)),a.getVideoTracks().forEach(o=>t.call(this,o,a))},s.RTCPeerConnection.prototype.addTrack=function(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];return l&&l.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const a=this._localStreams.indexOf(i);if(a===-1)return;this._localStreams.splice(a,1);const o=i.getTracks();this.getSenders().forEach(l=>{o.includes(l.track)&&this.removeTrack(l)})})}}function Y0(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,this.dispatchEvent(l)})})}});const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(l=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(l)>=0)return;a._remoteStreams.push(l);const u=new Event("addstream");u.stream=l,a.dispatchEvent(u)})}),t.apply(a,arguments)}}}function J0(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const t=s.RTCPeerConnection.prototype,i=t.createOffer,a=t.createAnswer,o=t.setLocalDescription,l=t.setRemoteDescription,u=t.addIceCandidate;t.createOffer=function(m,g){const v=arguments.length>=2?arguments[2]:arguments[0],b=i.apply(this,[v]);return g?(b.then(m,g),Promise.resolve()):b},t.createAnswer=function(m,g){const v=arguments.length>=2?arguments[2]:arguments[0],b=a.apply(this,[v]);return g?(b.then(m,g),Promise.resolve()):b};let d=function(f,m,g){const v=o.apply(this,[f]);return g?(v.then(m,g),Promise.resolve()):v};t.setLocalDescription=d,d=function(f,m,g){const v=l.apply(this,[f]);return g?(v.then(m,g),Promise.resolve()):v},t.setRemoteDescription=d,d=function(f,m,g){const v=u.apply(this,[f]);return g?(v.then(m,g),Promise.resolve()):v},t.addIceCandidate=d}function Q0(s){const t=s&&s.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,a=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=o=>a(X0(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(a,o,l){t.mediaDevices.getUserMedia(a).then(o,l)}).bind(t))}function X0(s){return s&&s.video!==void 0?Object.assign({},s,{video:O0(s.video)}):s}function Z0(s){if(!s.RTCPeerConnection)return;const t=s.RTCPeerConnection;s.RTCPeerConnection=function(a,o){if(a&&a.iceServers){const l=[];for(let u=0;u<a.iceServers.length;u++){let d=a.iceServers[u];d.urls===void 0&&d.url?(jh("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,l.push(d)):l.push(a.iceServers[u])}a.iceServers=l}return new t(a,o)},s.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function W0(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $0(s){const t=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(a){if(a){typeof a.offerToReceiveAudio<"u"&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");a.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):a.offerToReceiveAudio===!0&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof a.offerToReceiveVideo<"u"&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);const l=this.getTransceivers().find(u=>u.receiver.track.kind==="video");a.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):a.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function eb(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var qv=Object.freeze({__proto__:null,shimAudioContext:eb,shimCallbacksAPI:J0,shimConstraints:X0,shimCreateOfferLegacy:$0,shimGetUserMedia:Q0,shimLocalStreamsAPI:K0,shimRTCIceServerUrls:Z0,shimRemoteStreamsAPI:Y0,shimTrackEventTransceiver:W0}),Od={exports:{}},Vv;function nR(){return Vv||(Vv=1,(function(s){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(a=>a.trim())},t.splitSections=function(i){return i.split(`
m=`).map((o,l)=>(l>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(i){const a=t.splitSections(i);return a&&a[0]},t.getMediaSections=function(i){const a=t.splitSections(i);return a.shift(),a},t.matchPrefix=function(i,a){return t.splitLines(i).filter(o=>o.indexOf(a)===0)},t.parseCandidate=function(i){let a;i.indexOf("a=candidate:")===0?a=i.substring(12).split(" "):a=i.substring(10).split(" ");const o={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let l=8;l<a.length;l+=2)switch(a[l]){case"raddr":o.relatedAddress=a[l+1];break;case"rport":o.relatedPort=parseInt(a[l+1],10);break;case"tcptype":o.tcpType=a[l+1];break;case"ufrag":o.ufrag=a[l+1],o.usernameFragment=a[l+1];break;default:o[a[l]]===void 0&&(o[a[l]]=a[l+1]);break}return o},t.writeCandidate=function(i){const a=[];a.push(i.foundation);const o=i.component;o==="rtp"?a.push(1):o==="rtcp"?a.push(2):a.push(o),a.push(i.protocol.toUpperCase()),a.push(i.priority),a.push(i.address||i.ip),a.push(i.port);const l=i.type;return a.push("typ"),a.push(l),l!=="host"&&i.relatedAddress&&i.relatedPort&&(a.push("raddr"),a.push(i.relatedAddress),a.push("rport"),a.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(a.push("ufrag"),a.push(i.usernameFragment||i.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let a=i.substring(9).split(" ");const o={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),o.name=a[0],o.clockRate=parseInt(a[1],10),o.channels=a.length===3?parseInt(a[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(i){let a=i.payloadType;i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType);const o=i.channels||i.numChannels||1;return"a=rtpmap:"+a+" "+i.name+"/"+i.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(i){const a=i.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){const a={};let o;const l=i.substring(i.indexOf(" ")+1).split(";");for(let u=0;u<l.length;u++)o=l[u].trim().split("="),a[o[0].trim()]=o[1];return a},t.writeFmtp=function(i){let a="",o=i.payloadType;if(i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const l=[];Object.keys(i.parameters).forEach(u=>{i.parameters[u]!==void 0?l.push(u+"="+i.parameters[u]):l.push(u)}),a+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return a},t.parseRtcpFb=function(i){const a=i.substring(i.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(i){let a="",o=i.payloadType;return i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(l=>{a+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),a},t.parseSsrcMedia=function(i){const a=i.indexOf(" "),o={ssrc:parseInt(i.substring(7,a),10)},l=i.indexOf(":",a);return l>-1?(o.attribute=i.substring(a+1,l),o.value=i.substring(l+1)):o.attribute=i.substring(a+1),o},t.parseSsrcGroup=function(i){const a=i.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(o=>parseInt(o,10))}},t.getMid=function(i){const a=t.matchPrefix(i,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(i){const a=i.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(i,a){return{role:"auto",fingerprints:t.matchPrefix(i+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,a){let o="a=setup:"+a+`\r
`;return i.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},t.parseCryptoLine=function(i){const a=i.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const a=i.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,a){return t.matchPrefix(i+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,a){const o=t.matchPrefix(i+a,"a=ice-ufrag:")[0],l=t.matchPrefix(i+a,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(i){let a="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(i){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=t.splitLines(i)[0].split(" ");a.profile=l[2];for(let d=3;d<l.length;d++){const f=l[d],m=t.matchPrefix(i,"a=rtpmap:"+f+" ")[0];if(m){const g=t.parseRtpMap(m),v=t.matchPrefix(i,"a=fmtp:"+f+" ");switch(g.parameters=v.length?t.parseFmtp(v[0]):{},g.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase());break}}}t.matchPrefix(i,"a=extmap:").forEach(d=>{a.headerExtensions.push(t.parseExtmap(d))});const u=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach(d=>{u.forEach(f=>{d.rtcpFeedback.find(g=>g.type===f.type&&g.parameter===f.parameter)||d.rtcpFeedback.push(f)})}),a},t.writeRtpDescription=function(i,a){let o="";o+="m="+i+" ",o+=a.codecs.length>0?"9":"0",o+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=a.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(u=>{o+=t.writeRtpMap(u),o+=t.writeFmtp(u),o+=t.writeRtcpFb(u)});let l=0;return a.codecs.forEach(u=>{u.maxptime>l&&(l=u.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(u=>{o+=t.writeExtmap(u)}),o},t.parseRtpEncodingParameters=function(i){const a=[],o=t.parseRtpParameters(i),l=o.fecMechanisms.indexOf("RED")!==-1,u=o.fecMechanisms.indexOf("ULPFEC")!==-1,d=t.matchPrefix(i,"a=ssrc:").map(b=>t.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),f=d.length>0&&d[0].ssrc;let m;const g=t.matchPrefix(i,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(M=>parseInt(M,10)));g.length>0&&g[0].length>1&&g[0][0]===f&&(m=g[0][1]),o.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let C={ssrc:f,codecPayloadType:parseInt(b.parameters.apt,10)};f&&m&&(C.rtx={ssrc:m}),a.push(C),l&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:f,mechanism:u?"red+ulpfec":"red"},a.push(C))}}),a.length===0&&f&&a.push({ssrc:f});let v=t.matchPrefix(i,"b=");return v.length&&(v[0].indexOf("b=TIAS:")===0?v=parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?v=parseInt(v[0].substring(5),10)*1e3*.95-2e3*8:v=void 0,a.forEach(b=>{b.maxBitrate=v})),a},t.parseRtcpParameters=function(i){const a={},o=t.matchPrefix(i,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];o&&(a.cname=o.value,a.ssrc=o.ssrc);const l=t.matchPrefix(i,"a=rtcp-rsize");a.reducedSize=l.length>0,a.compound=l.length===0;const u=t.matchPrefix(i,"a=rtcp-mux");return a.mux=u.length>0,a},t.writeRtcpParameters=function(i){let a="";return i.reducedSize&&(a+=`a=rtcp-rsize\r
`),i.mux&&(a+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(a+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),a},t.parseMsid=function(i){let a;const o=t.matchPrefix(i,"a=msid:");if(o.length===1)return a=o[0].substring(7).split(" "),{stream:a[0],track:a[1]};const l=t.matchPrefix(i,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");if(l.length>0)return a=l[0].value.split(" "),{stream:a[0],track:a[1]}},t.parseSctpDescription=function(i){const a=t.parseMLine(i),o=t.matchPrefix(i,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const u=t.matchPrefix(i,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:a.fmt,maxMessageSize:l};const d=t.matchPrefix(i,"a=sctpmap:");if(d.length>0){const f=d[0].substring(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:l}}},t.writeSctpDescription=function(i,a){let o=[];return i.protocol!=="DTLS/SCTP"?o=["m="+i.kind+" 9 "+i.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:o=["m="+i.kind+" 9 "+i.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&o.push("a=max-message-size:"+a.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,a,o){let l;const u=a!==void 0?a:2;return i?l=i:l=t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,a){const o=t.splitLines(i);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const o=t.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(i){const o=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const a=t.splitLines(i);for(let o=0;o<a.length;o++)if(a[o].length<2||a[o].charAt(1)!=="=")return!1;return!0},s.exports=t})(Od)),Od.exports}var tb=nR(),ks=HE(tb),iR=hk({__proto__:null,default:ks},[tb]);function Oc(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const t=s.RTCIceCandidate;s.RTCIceCandidate=function(a){if(typeof a=="object"&&a.candidate&&a.candidate.indexOf("a=")===0&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substring(2)),a.candidate&&a.candidate.length){const o=new t(a),l=ks.parseCandidate(a.candidate);for(const u in l)u in o||Object.defineProperty(o,u,{value:l[u]});return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(a)},s.RTCIceCandidate.prototype=t.prototype,_a(s,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new s.RTCIceCandidate(i.candidate),writable:"false"}),i))}function th(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||_a(s,"icecandidate",t=>{if(t.candidate){const i=ks.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function Ac(s,t){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(d){if(!d||!d.sdp)return!1;const f=ks.splitSections(d.sdp);return f.shift(),f.some(m=>{const g=ks.parseMLine(m);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},a=function(d){const f=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const m=parseInt(f[1],10);return m!==m?-1:m},o=function(d){let f=65536;return t.browser==="firefox"&&(t.version<57?d===-1?f=16384:f=2147483637:t.version<60?f=t.version===57?65535:65536:f=2147483637),f},l=function(d,f){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);const g=ks.matchPrefix(d.sdp,"a=max-message-size:");return g.length>0?m=parseInt(g[0].substring(19),10):t.browser==="firefox"&&f!==-1&&(m=2147483637),m},u=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const f=a(arguments[0]),m=o(f),g=l(arguments[0],f);let v;m===0&&g===0?v=Number.POSITIVE_INFINITY:m===0||g===0?v=Math.max(m,g):v=Math.min(m,g);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return v}}),this._sctp=b}return u.apply(this,arguments)}}function Dc(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function t(a,o){const l=a.send;a.send=function(){const d=arguments[0],f=d.length||d.size||d.byteLength;if(a.readyState==="open"&&o.sctp&&f>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(a,arguments)}}const i=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return t(o,this),o},_a(s,"datachannel",a=>(t(a.channel,a.target),a))}function nh(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const t=s.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const a=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const u=new Event("connectionstatechange",o);l.dispatchEvent(u)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function ih(s,t){if(!s.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=o.sdp.split(`
`).filter(u=>u.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&o instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:o.type,sdp:l}):o.sdp=l}return i.apply(this,arguments)}}function Mc(s,t){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const i=s.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function wc(s,t){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const i=s.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(s.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer";break}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(u=>i.apply(this,[u]))})}var aR=Object.freeze({__proto__:null,removeExtmapAllowMixed:ih,shimAddIceCandidateNullOrEmpty:Mc,shimConnectionState:nh,shimMaxMessageSize:Ac,shimParameterlessSetLocalDescription:wc,shimRTCIceCandidate:Oc,shimRTCIceCandidateRelayProtocol:th,shimSendThrowTypeError:Dc});function sR(){let{window:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=_0,a=eR(s),o={browserDetails:a,commonShim:aR,extractVersion:zr,disableLog:WE,disableWarnings:$E,sdp:iR};switch(a.browser){case"chrome":if(!Bv||!$d||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),o;if(a.version===null)return i("Chrome shim can not determine version, not shimming."),o;i("adapter.js shimming chrome."),o.browserShim=Bv,Mc(s,a),wc(s),A0(s,a),D0(s),$d(s,a),M0(s),P0(s,a),w0(s),x0(s),L0(s,a),Oc(s),th(s),nh(s),Ac(s,a),Dc(s),ih(s,a);break;case"firefox":if(!zv||!eh||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),o;i("adapter.js shimming firefox."),o.browserShim=zv,Mc(s,a),wc(s),U0(s,a),eh(s,a),I0(s),z0(s),j0(s),B0(s),q0(s),V0(s),F0(s),H0(s),G0(s),Oc(s),nh(s),Ac(s,a),Dc(s);break;case"safari":if(!qv||!t.shimSafari)return i("Safari shim is not included in this adapter release."),o;i("adapter.js shimming safari."),o.browserShim=qv,Mc(s,a),wc(s),Z0(s),$0(s),J0(s),K0(s),Y0(s),W0(s),Q0(s),eb(s),Oc(s),th(s),Ac(s,a),Dc(s),ih(s,a);break;default:i("Unsupported browser!");break}return o}sR({window:typeof window>"u"?void 0:window});const rR=/version\/(\d+(\.?_?\d+)+)/i;let Ad;function Yt(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const i=navigator.userAgent.toLowerCase();if(Ad===void 0||t){const a=oR.find(o=>{let{test:l}=o;return l.test(i)});Ad=a==null?void 0:a.describe(i)}return Ad}const oR=[{test:/firefox|iceweasel|fxios/i,describe(s){return{name:"Firefox",version:xc(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,s),os:s.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Dd(s)}}},{test:/chrom|crios|crmo/i,describe(s){return{name:"Chrome",version:xc(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,s),os:s.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Dd(s)}}},{test:/safari|applewebkit/i,describe(s){return{name:"Safari",version:xc(rR,s),os:s.includes("mobile/")?"iOS":"macOS",osVersion:Dd(s)}}}];function xc(s,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const a=t.match(s);return a&&a.length>=i&&a[i]||""}function Dd(s){return s.includes("mac os")?xc(/\(.+?(\d+_\d+(:?_\d+)?)/,s,1).replace(/_/g,"."):void 0}var cR="2.16.1";const lR=cR,uR=16;class Bn extends Error{constructor(t,i){super(i||"an error has occured"),this.name="LiveKitError",this.code=t}}var We;(function(s){s[s.NotAllowed=0]="NotAllowed",s[s.ServerUnreachable=1]="ServerUnreachable",s[s.InternalError=2]="InternalError",s[s.Cancelled=3]="Cancelled",s[s.LeaveRequest=4]="LeaveRequest",s[s.Timeout=5]="Timeout",s[s.WebSocket=6]="WebSocket"})(We||(We={}));class be extends Bn{constructor(t,i,a,o){super(1,t),this.name="ConnectionError",this.status=a,this.reason=i,this.context=o,this.reasonName=We[i]}static notAllowed(t,i,a){return new be(t,We.NotAllowed,i,a)}static timeout(t){return new be(t,We.Timeout)}static leaveRequest(t,i){return new be(t,We.LeaveRequest,void 0,i)}static internal(t,i){return new be(t,We.InternalError,void 0,i)}static cancelled(t){return new be(t,We.Cancelled)}static serverUnreachable(t,i){return new be(t,We.ServerUnreachable,i)}static websocket(t,i,a){return new be(t,We.WebSocket,i,a)}}class Bh extends Bn{constructor(t){super(21,t??"device is unsupported"),this.name="DeviceUnsupportedError"}}class di extends Bn{constructor(t){super(20,t??"track is invalid"),this.name="TrackInvalidError"}}class dR extends Bn{constructor(t){super(10,t??"unsupported server"),this.name="UnsupportedServer"}}class yt extends Bn{constructor(t){super(12,t??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class ah extends Bn{constructor(t){super(13,t??"unable to negotiate"),this.name="NegotiationError"}}class Fv extends Bn{constructor(t,i){super(15,t),this.name="PublishTrackError",this.status=i}}class Hv extends Bn{constructor(t,i){super(15,t),this.name="SignalRequestError",this.reason=i,this.reasonName=typeof i=="string"?i:Ih[i]}}var Pt;(function(s){s[s.AlreadyOpened=0]="AlreadyOpened",s[s.AbnormalEnd=1]="AbnormalEnd",s[s.DecodeFailed=2]="DecodeFailed",s[s.LengthExceeded=3]="LengthExceeded",s[s.Incomplete=4]="Incomplete",s[s.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",s[s.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Pt||(Pt={}));class vn extends Bn{constructor(t,i){super(16,t),this.name="DataStreamError",this.reason=i,this.reasonName=Pt[i]}}class vs extends Bn{constructor(t){super(18,t),this.name="SignalReconnectError"}}var Vc;(function(s){s.PermissionDenied="PermissionDenied",s.NotFound="NotFound",s.DeviceInUse="DeviceInUse",s.Other="Other"})(Vc||(Vc={}));(function(s){function t(i){if(i&&"name"in i)return i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?s.NotFound:i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?s.PermissionDenied:i.name==="NotReadableError"||i.name==="TrackStartError"?s.DeviceInUse:s.Other}s.getFailure=t})(Vc||(Vc={}));class Mt{}Mt.setTimeout=function(){return setTimeout(...arguments)};Mt.setInterval=function(){return setInterval(...arguments)};Mt.clearTimeout=function(){return clearTimeout(...arguments)};Mt.clearInterval=function(){return clearInterval(...arguments)};var Z;(function(s){s.Connected="connected",s.Reconnecting="reconnecting",s.SignalReconnecting="signalReconnecting",s.Reconnected="reconnected",s.Disconnected="disconnected",s.ConnectionStateChanged="connectionStateChanged",s.Moved="moved",s.MediaDevicesChanged="mediaDevicesChanged",s.ParticipantConnected="participantConnected",s.ParticipantDisconnected="participantDisconnected",s.TrackPublished="trackPublished",s.TrackSubscribed="trackSubscribed",s.TrackSubscriptionFailed="trackSubscriptionFailed",s.TrackUnpublished="trackUnpublished",s.TrackUnsubscribed="trackUnsubscribed",s.TrackMuted="trackMuted",s.TrackUnmuted="trackUnmuted",s.LocalTrackPublished="localTrackPublished",s.LocalTrackUnpublished="localTrackUnpublished",s.LocalAudioSilenceDetected="localAudioSilenceDetected",s.ActiveSpeakersChanged="activeSpeakersChanged",s.ParticipantMetadataChanged="participantMetadataChanged",s.ParticipantNameChanged="participantNameChanged",s.ParticipantAttributesChanged="participantAttributesChanged",s.ParticipantActive="participantActive",s.RoomMetadataChanged="roomMetadataChanged",s.DataReceived="dataReceived",s.SipDTMFReceived="sipDTMFReceived",s.TranscriptionReceived="transcriptionReceived",s.ConnectionQualityChanged="connectionQualityChanged",s.TrackStreamStateChanged="trackStreamStateChanged",s.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",s.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",s.AudioPlaybackStatusChanged="audioPlaybackChanged",s.VideoPlaybackStatusChanged="videoPlaybackChanged",s.MediaDevicesError="mediaDevicesError",s.ParticipantPermissionsChanged="participantPermissionsChanged",s.SignalConnected="signalConnected",s.RecordingStatusChanged="recordingStatusChanged",s.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",s.EncryptionError="encryptionError",s.DCBufferStatusChanged="dcBufferStatusChanged",s.ActiveDeviceChanged="activeDeviceChanged",s.ChatMessage="chatMessage",s.LocalTrackSubscribed="localTrackSubscribed",s.MetricsReceived="metricsReceived"})(Z||(Z={}));var se;(function(s){s.TrackPublished="trackPublished",s.TrackSubscribed="trackSubscribed",s.TrackSubscriptionFailed="trackSubscriptionFailed",s.TrackUnpublished="trackUnpublished",s.TrackUnsubscribed="trackUnsubscribed",s.TrackMuted="trackMuted",s.TrackUnmuted="trackUnmuted",s.LocalTrackPublished="localTrackPublished",s.LocalTrackUnpublished="localTrackUnpublished",s.LocalTrackCpuConstrained="localTrackCpuConstrained",s.LocalSenderCreated="localSenderCreated",s.ParticipantMetadataChanged="participantMetadataChanged",s.ParticipantNameChanged="participantNameChanged",s.DataReceived="dataReceived",s.SipDTMFReceived="sipDTMFReceived",s.TranscriptionReceived="transcriptionReceived",s.IsSpeakingChanged="isSpeakingChanged",s.ConnectionQualityChanged="connectionQualityChanged",s.TrackStreamStateChanged="trackStreamStateChanged",s.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",s.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",s.TrackCpuConstrained="trackCpuConstrained",s.MediaDevicesError="mediaDevicesError",s.AudioStreamAcquired="audioStreamAcquired",s.ParticipantPermissionsChanged="participantPermissionsChanged",s.PCTrackAdded="pcTrackAdded",s.AttributesChanged="attributesChanged",s.LocalTrackSubscribed="localTrackSubscribed",s.ChatMessage="chatMessage",s.Active="active"})(se||(se={}));var ie;(function(s){s.TransportsCreated="transportsCreated",s.Connected="connected",s.Disconnected="disconnected",s.Resuming="resuming",s.Resumed="resumed",s.Restarting="restarting",s.Restarted="restarted",s.SignalResumed="signalResumed",s.SignalRestarted="signalRestarted",s.Closing="closing",s.MediaTrackAdded="mediaTrackAdded",s.ActiveSpeakersUpdate="activeSpeakersUpdate",s.DataPacketReceived="dataPacketReceived",s.RTPVideoMapUpdate="rtpVideoMapUpdate",s.DCBufferStatusChanged="dcBufferStatusChanged",s.ParticipantUpdate="participantUpdate",s.RoomUpdate="roomUpdate",s.SpeakersChanged="speakersChanged",s.StreamStateChanged="streamStateChanged",s.ConnectionQualityUpdate="connectionQualityUpdate",s.SubscriptionError="subscriptionError",s.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",s.RemoteMute="remoteMute",s.SubscribedQualityUpdate="subscribedQualityUpdate",s.LocalTrackUnpublished="localTrackUnpublished",s.LocalTrackSubscribed="localTrackSubscribed",s.Offline="offline",s.SignalRequestResponse="signalRequestResponse",s.SignalConnected="signalConnected",s.RoomMoved="roomMoved"})(ie||(ie={}));var te;(function(s){s.Message="message",s.Muted="muted",s.Unmuted="unmuted",s.Restarted="restarted",s.Ended="ended",s.Subscribed="subscribed",s.Unsubscribed="unsubscribed",s.CpuConstrained="cpuConstrained",s.UpdateSettings="updateSettings",s.UpdateSubscription="updateSubscription",s.AudioPlaybackStarted="audioPlaybackStarted",s.AudioPlaybackFailed="audioPlaybackFailed",s.AudioSilenceDetected="audioSilenceDetected",s.VisibilityChanged="visibilityChanged",s.VideoDimensionsChanged="videoDimensionsChanged",s.VideoPlaybackStarted="videoPlaybackStarted",s.VideoPlaybackFailed="videoPlaybackFailed",s.ElementAttached="elementAttached",s.ElementDetached="elementDetached",s.UpstreamPaused="upstreamPaused",s.UpstreamResumed="upstreamResumed",s.SubscriptionPermissionChanged="subscriptionPermissionChanged",s.SubscriptionStatusChanged="subscriptionStatusChanged",s.SubscriptionFailed="subscriptionFailed",s.TrackProcessorUpdate="trackProcessorUpdate",s.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",s.TranscriptionReceived="transcriptionReceived",s.TimeSyncUpdate="timeSyncUpdate",s.PreConnectBufferFlushed="preConnectBufferFlushed"})(te||(te={}));function hR(s){return typeof s>"u"?s:typeof structuredClone=="function"?typeof s=="object"&&s!==null?structuredClone(Object.assign({},s)):structuredClone(s):JSON.parse(JSON.stringify(s))}class Ke{constructor(t,i,a,o,l){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(i!==void 0&&a!==void 0)this.width=t,this.height=i,this.aspectRatio=t/i,this.encoding={maxBitrate:a,maxFramerate:o,priority:l};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const fR=["vp8","h264"],mR=["vp8","h264","vp9","av1","h265"];function pR(s){return!!fR.find(t=>t===s)}const gR=pR;var Gv;(function(s){s[s.PREFER_REGRESSION=0]="PREFER_REGRESSION",s[s.SIMULCAST=1]="SIMULCAST",s[s.REGRESSION=2]="REGRESSION"})(Gv||(Gv={}));var sh;(function(s){s.telephone={maxBitrate:12e3},s.speech={maxBitrate:24e3},s.music={maxBitrate:48e3},s.musicStereo={maxBitrate:64e3},s.musicHighQuality={maxBitrate:96e3},s.musicHighQualityStereo={maxBitrate:128e3}})(sh||(sh={}));const Xr={h90:new Ke(160,90,9e4,20),h180:new Ke(320,180,16e4,20),h216:new Ke(384,216,18e4,20),h360:new Ke(640,360,45e4,20),h540:new Ke(960,540,8e5,25),h720:new Ke(1280,720,17e5,30),h1080:new Ke(1920,1080,3e6,30),h1440:new Ke(2560,1440,5e6,30),h2160:new Ke(3840,2160,8e6,30)},rh={h120:new Ke(160,120,7e4,20),h180:new Ke(240,180,125e3,20),h240:new Ke(320,240,14e4,20),h360:new Ke(480,360,33e4,20),h480:new Ke(640,480,5e5,20),h540:new Ke(720,540,6e5,25),h720:new Ke(960,720,13e5,30),h1080:new Ke(1440,1080,23e5,30),h1440:new Ke(1920,1440,38e5,30)},zh={h360fps3:new Ke(640,360,2e5,3,"medium"),h360fps15:new Ke(640,360,4e5,15,"medium"),h720fps5:new Ke(1280,720,8e5,5,"medium"),h720fps15:new Ke(1280,720,15e5,15,"medium"),h720fps30:new Ke(1280,720,2e6,30,"medium"),h1080fps15:new Ke(1920,1080,25e5,15,"medium"),h1080fps30:new Ke(1920,1080,5e6,30,"medium"),original:new Ke(0,0,7e6,30,"medium")};function nb(s,t,i){var a,o,l,u;const{optionsWithoutProcessor:d,audioProcessor:f,videoProcessor:m}=sb(s??{}),g=t==null?void 0:t.processor,v=i==null?void 0:i.processor,b=d??{};return b.audio===!0&&(b.audio={}),b.video===!0&&(b.video={}),b.audio&&(oh(b.audio,t),(a=(l=b.audio).deviceId)!==null&&a!==void 0||(l.deviceId={ideal:"default"}),(f||g)&&(b.audio.processor=f??g)),b.video&&(oh(b.video,i),(o=(u=b.video).deviceId)!==null&&o!==void 0||(u.deviceId={ideal:"default"}),(m||v)&&(b.video.processor=m??v)),b}function oh(s,t){return Object.keys(t).forEach(i=>{s[i]===void 0&&(s[i]=t[i])}),s}function qh(s){var t,i,a,o;const l={};if(s.video)if(typeof s.video=="object"){const u={},d=u,f=s.video;Object.keys(f).forEach(m=>{switch(m){case"resolution":oh(d,f.resolution);break;default:d[m]=f[m]}}),l.video=u,(t=(a=l.video).deviceId)!==null&&t!==void 0||(a.deviceId={ideal:"default"})}else l.video=s.video?{deviceId:{ideal:"default"}}:!1;else l.video=!1;return s.audio?typeof s.audio=="object"?(l.audio=s.audio,(i=(o=l.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"})):l.audio={deviceId:{ideal:"default"}}:l.audio=!1,l}function ib(s){return T(this,arguments,void 0,function(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const a=ab();if(a){const o=a.createAnalyser();o.fftSize=2048;const l=o.frequencyBinCount,u=new Uint8Array(l);a.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(o),yield wt(i),o.getByteTimeDomainData(u);const f=u.some(m=>m!==128&&m!==0);return a.close(),!f}return!1})()})}function ab(){var s;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const i=new t({latencyHint:"interactive"});if(i.state==="suspended"&&typeof window<"u"&&(!((s=window.document)===null||s===void 0)&&s.body)){const a=()=>T(this,void 0,void 0,function*(){var o;try{i.state==="suspended"&&(yield i.resume())}catch(l){console.warn("Error trying to auto-resume audio context",l)}finally{(o=window.document.body)===null||o===void 0||o.removeEventListener("click",a)}});i.addEventListener("statechange",()=>{var o;i.state==="closed"&&((o=window.document.body)===null||o===void 0||o.removeEventListener("click",a))}),window.document.body.addEventListener("click",a)}return i}}function vR(s){return s==="audioinput"?J.Source.Microphone:s==="videoinput"?J.Source.Camera:J.Source.Unknown}function ch(s){return s===J.Source.Microphone?"audioinput":s===J.Source.Camera?"videoinput":void 0}function yR(s){var t,i;let a=(t=s.video)!==null&&t!==void 0?t:!0;return s.resolution&&s.resolution.width>0&&s.resolution.height>0&&(a=typeof a=="boolean"?{}:a,Ra()?a=Object.assign(Object.assign({},a),{width:{max:s.resolution.width},height:{max:s.resolution.height},frameRate:s.resolution.frameRate}):a=Object.assign(Object.assign({},a),{width:{ideal:s.resolution.width},height:{ideal:s.resolution.height},frameRate:s.resolution.frameRate})),{audio:(i=s.audio)!==null&&i!==void 0?i:!1,video:a,controller:s.controller,selfBrowserSurface:s.selfBrowserSurface,surfaceSwitching:s.surfaceSwitching,systemAudio:s.systemAudio,preferCurrentTab:s.preferCurrentTab}}function Fr(s){return s.split("/")[1].toLowerCase()}function bR(s){const t=[];return s.forEach(i=>{i.track!==void 0&&t.push(new xh({cid:i.track.mediaStreamID,track:i.trackInfo}))}),t}function Me(s){return"mediaStreamTrack"in s?{trackID:s.sid,source:s.source,muted:s.isMuted,enabled:s.mediaStreamTrack.enabled,kind:s.kind,streamID:s.mediaStreamID,streamTrackID:s.mediaStreamTrack.id}:{trackID:s.trackSid,enabled:s.isEnabled,muted:s.isMuted,trackInfo:Object.assign({mimeType:s.mimeType,name:s.trackName,encrypted:s.isEncrypted,kind:s.kind,source:s.source},s.track?Me(s.track):{})}}function SR(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function TR(s,t){var i;s===void 0&&(s={}),t===void 0&&(t={});const a=[...Object.keys(t),...Object.keys(s)],o={};for(const l of a)s[l]!==t[l]&&(o[l]=(i=t[l])!==null&&i!==void 0?i:"");return o}function sb(s){const t=Object.assign({},s);let i,a;return typeof t.audio=="object"&&t.audio.processor&&(i=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),typeof t.video=="object"&&t.video.processor&&(a=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:hR(t)}}function CR(s){switch(s){case gt.CAMERA:return J.Source.Camera;case gt.MICROPHONE:return J.Source.Microphone;case gt.SCREEN_SHARE:return J.Source.ScreenShare;case gt.SCREEN_SHARE_AUDIO:return J.Source.ScreenShareAudio;default:return J.Source.Unknown}}function Kv(s,t){return s.width*s.height<t.width*t.height}function kR(s,t){var i;return(i=s.layers)===null||i===void 0?void 0:i.find(a=>a.quality===t)}const ER=5e3,Lr=[];var sn;(function(s){s[s.LOW=0]="LOW",s[s.MEDIUM=1]="MEDIUM",s[s.HIGH=2]="HIGH"})(sn||(sn={}));class J extends jn.EventEmitter{get streamState(){return this._streamState}setStreamState(t){this._streamState=t}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var o;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=J.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Re,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),ER):this.handleAppVisibilityChanged()},this.log=hi((o=a.loggerName)!==null&&o!==void 0?o:An.Track),this.loggerContextCb=a.loggerContextCb,this.setMaxListeners(100),this.kind=i,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=J.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),Me(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let i="audio";this.kind===J.Kind.Video&&(i="video"),this.attachedElements.length===0&&this.kind===J.Kind.Video&&this.addAppVisibilityListener(),t||(i==="audio"&&(Lr.forEach(l=>{l.parentElement===null&&!t&&(t=l)}),t&&Lr.splice(Lr.indexOf(t),1)),t||(t=document.createElement(i))),this.attachedElements.includes(t)||this.attachedElements.push(t),bs(this.mediaStreamTrack,t);const a=t.srcObject.getTracks(),o=a.some(l=>l.kind==="audio");return t.play().then(()=>{this.emit(o?te.AudioPlaybackStarted:te.VideoPlaybackStarted)}).catch(l=>{l.name==="NotAllowedError"?this.emit(o?te.AudioPlaybackFailed:te.VideoPlaybackFailed,l):l.name==="AbortError"?Re.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):Re.warn("could not playback ".concat(o?"audio":"video"),l),o&&t&&a.some(u=>u.kind==="video")&&l.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(te.ElementAttached,t),t}detach(t){try{if(t){Es(this.mediaStreamTrack,t);const a=this.attachedElements.indexOf(t);return a>=0&&(this.attachedElements.splice(a,1),this.recycleElement(t),this.emit(te.ElementDetached,t)),t}const i=[];return this.attachedElements.forEach(a=>{Es(this.mediaStreamTrack,a),i.push(a),this.recycleElement(a),this.emit(te.ElementDetached,a)}),this.attachedElements=[],i}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=hi(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let i=!0;t.pause(),Lr.forEach(a=>{a.parentElement||(i=!1)}),i&&Lr.push(t)}}handleAppVisibilityChanged(){return T(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===J.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){Kt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Kt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function bs(s,t){let i;t.srcObject instanceof MediaStream?i=t.srcObject:i=new MediaStream;let a;s.kind==="audio"?a=i.getAudioTracks():a=i.getVideoTracks(),a.includes(s)||(a.forEach(o=>{i.removeTrack(o)}),i.addTrack(s)),(!Ra()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=i.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==i&&(t.srcObject=i,(Ra()||Ea())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=i,t.play().catch(()=>{})},0))}function Es(s,t){if(t.srcObject instanceof MediaStream){const i=t.srcObject;i.removeTrack(s),i.getTracks().length>0?t.srcObject=i:t.srcObject=null}}(function(s){let t;(function(m){m.Audio="audio",m.Video="video",m.Unknown="unknown"})(t=s.Kind||(s.Kind={}));let i;(function(m){m.Camera="camera",m.Microphone="microphone",m.ScreenShare="screen_share",m.ScreenShareAudio="screen_share_audio",m.Unknown="unknown"})(i=s.Source||(s.Source={}));let a;(function(m){m.Active="active",m.Paused="paused",m.Unknown="unknown"})(a=s.StreamState||(s.StreamState={}));function o(m){switch(m){case t.Audio:return En.AUDIO;case t.Video:return En.VIDEO;default:return En.DATA}}s.kindToProto=o;function l(m){switch(m){case En.AUDIO:return t.Audio;case En.VIDEO:return t.Video;default:return t.Unknown}}s.kindFromProto=l;function u(m){switch(m){case i.Camera:return gt.CAMERA;case i.Microphone:return gt.MICROPHONE;case i.ScreenShare:return gt.SCREEN_SHARE;case i.ScreenShareAudio:return gt.SCREEN_SHARE_AUDIO;default:return gt.UNKNOWN}}s.sourceToProto=u;function d(m){switch(m){case gt.CAMERA:return i.Camera;case gt.MICROPHONE:return i.Microphone;case gt.SCREEN_SHARE:return i.ScreenShare;case gt.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}}s.sourceFromProto=d;function f(m){switch(m){case Qd.ACTIVE:return a.Active;case Qd.PAUSED:return a.Paused;default:return a.Unknown}}s.streamStateFromProto=f})(J||(J={}));const RR="|",Yv="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function _R(s){const t=s.split(RR);return t.length>1?[t[0],s.substr(t[0].length+1)]:[s,""]}function wt(s){return T(this,void 0,void 0,function*(){return new Promise(t=>Mt.setTimeout(t,s))})}function lh(){return"addTransceiver"in RTCPeerConnection.prototype}function uh(){return"addTrack"in RTCPeerConnection.prototype}function OR(){if(!("getCapabilities"in RTCRtpSender)||Ra()||Ea())return!1;const s=RTCRtpSender.getCapabilities("video");let t=!1;if(s){for(const i of s.codecs)if(i.mimeType.toLowerCase()==="video/av1"){t=!0;break}}return t}function AR(){if(!("getCapabilities"in RTCRtpSender)||Ea())return!1;if(Ra()){const i=Yt();if(i!=null&&i.version&&In(i.version,"16")<0||(i==null?void 0:i.os)==="iOS"&&(i!=null&&i.osVersion)&&In(i.osVersion,"16")<0)return!1}const s=RTCRtpSender.getCapabilities("video");let t=!1;if(s){for(const i of s.codecs)if(i.mimeType.toLowerCase()==="video/vp9"){t=!0;break}}return t}function _n(s){return s==="av1"||s==="vp9"}function dh(s){return!document||Zr()?!1:(s||(s=document.createElement("audio")),"setSinkId"in s)}function DR(){return typeof RTCPeerConnection>"u"?!1:lh()||uh()}function Ea(){var s;return((s=Yt())===null||s===void 0?void 0:s.name)==="Firefox"}function Jv(){const s=Yt();return!!s&&s.name==="Chrome"&&s.os!=="iOS"}function Ra(){var s;return((s=Yt())===null||s===void 0?void 0:s.name)==="Safari"}function Zr(){const s=Yt();return(s==null?void 0:s.name)==="Safari"||(s==null?void 0:s.os)==="iOS"}function MR(){const s=Yt();return(s==null?void 0:s.name)==="Safari"&&s.version.startsWith("17.")||(s==null?void 0:s.os)==="iOS"&&!!(s!=null&&s.osVersion)&&In(s.osVersion,"17")>=0}function wR(s){return s||(s=Yt()),(s==null?void 0:s.name)==="Safari"&&In(s.version,"18.3")>0||(s==null?void 0:s.os)==="iOS"&&!!(s!=null&&s.osVersion)&&In(s.osVersion,"18.3")>0}function rb(){var s,t;return Kt()?(t=(s=navigator.userAgentData)===null||s===void 0?void 0:s.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function xR(){const s=Yt(),t="17.2";if(s)return s.name!=="Safari"&&s.os!=="iOS"||s.os==="iOS"&&s.osVersion&&In(s.osVersion,t)>=0?!0:s.name==="Safari"&&In(s.version,t)>=0}function Kt(){return typeof document<"u"}function Un(){return navigator.product=="ReactNative"}function Ds(s){return s.hostname.endsWith(".livekit.cloud")||s.hostname.endsWith(".livekit.run")}function Md(s){return Ds(s)?s.hostname.split(".")[0]:null}function ob(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function cb(){if(!Un())return;let s=ob();if(s)return s.platform}function Qv(){if(Kt())return window.devicePixelRatio;if(Un()){let s=ob();if(s)return s.devicePixelRatio}return 1}function In(s,t){const i=s.split("."),a=t.split("."),o=Math.min(i.length,a.length);for(let l=0;l<o;++l){const u=parseInt(i[l],10),d=parseInt(a[l],10);if(u>d)return 1;if(u<d)return-1;if(l===o-1&&u===d)return 0}return s===""&&t!==""?-1:t===""?1:i.length==a.length?0:i.length<a.length?-1:1}function NR(s){for(const t of s)t.target.handleResize(t)}function PR(s){for(const t of s)t.target.handleVisibilityChanged(t)}let wd=null;const Xv=()=>(wd||(wd=new ResizeObserver(NR)),wd);let xd=null;const Zv=()=>(xd||(xd=new IntersectionObserver(PR,{root:null,rootMargin:"0px"})),xd);function LR(){var s;const t=new c0({sdk:l0.JS,protocol:uR,version:lR});return Un()&&(t.os=(s=cb())!==null&&s!==void 0?s:""),t}function Wv(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=document.createElement("canvas");o.width=s,o.height=t;const l=o.getContext("2d");l==null||l.fillRect(0,0,o.width,o.height),a&&l&&(l.beginPath(),l.arc(s/2,t/2,50,0,Math.PI*2,!0),l.closePath(),l.fillStyle="grey",l.fill());const u=o.captureStream(),[d]=u.getTracks();if(!d)throw Error("Could not get empty media stream video track");return d.enabled=i,d}let Ur;function Nd(){if(!Ur){const s=new AudioContext,t=s.createOscillator(),i=s.createGain();i.gain.setValueAtTime(0,0);const a=s.createMediaStreamDestination();if(t.connect(i),i.connect(a),t.start(),[Ur]=a.stream.getAudioTracks(),!Ur)throw Error("Could not get empty media stream audio track");Ur.enabled=!1}return Ur.clone()}class yn{get isResolved(){return this._isResolved}constructor(t,i){this._isResolved=!1,this.onFinally=i,this.promise=new Promise((a,o)=>T(this,void 0,void 0,function*(){this.resolve=a,this.reject=o,t&&(yield t(a,o))})).finally(()=>{var a;this._isResolved=!0,(a=this.onFinally)===null||a===void 0||a.call(this)})}}function UR(s){return mR.includes(s)}function Yi(s){if(typeof s=="string"||typeof s=="number")return s;if(Array.isArray(s))return s[0];if(s.exact!==void 0)return Array.isArray(s.exact)?s.exact[0]:s.exact;if(s.ideal!==void 0)return Array.isArray(s.ideal)?s.ideal[0]:s.ideal;throw Error("could not unwrap constraint")}function IR(s){return s.startsWith("http")?s.replace(/^(http)/,"ws"):s}function Wr(s){return s.startsWith("ws")?s.replace(/^(ws)/,"http"):s}function jR(s,t){return s.segments.map(i=>{let{id:a,text:o,language:l,startTime:u,endTime:d,final:f}=i;var m;const g=(m=t.get(a))!==null&&m!==void 0?m:Date.now(),v=Date.now();return f?t.delete(a):t.set(a,g),{id:a,text:o,startTime:Number.parseInt(u.toString()),endTime:Number.parseInt(d.toString()),final:f,language:l,firstReceivedTime:g,lastReceivedTime:v}})}function BR(s){const{id:t,timestamp:i,message:a,editTimestamp:o}=s;return{id:t,timestamp:Number.parseInt(i.toString()),editTimestamp:o?Number.parseInt(o.toString()):void 0,message:a}}function $v(s){switch(s.reason){case We.LeaveRequest:return s.context;case We.Cancelled:return On.CLIENT_INITIATED;case We.NotAllowed:return On.USER_REJECTED;case We.ServerUnreachable:return On.JOIN_FAILURE;default:return On.UNKNOWN_REASON}}function Nc(s){return s!==void 0?Number(s):void 0}function Ca(s){return s!==void 0?BigInt(s):void 0}function Rs(s){return!!s&&!(s instanceof MediaStreamTrack)&&s.isLocal}function Ln(s){return!!s&&s.kind==J.Kind.Audio}function Wi(s){return!!s&&s.kind==J.Kind.Video}function zi(s){return Rs(s)&&Wi(s)}function ri(s){return Rs(s)&&Ln(s)}function hh(s){return!!s&&!s.isLocal}function zR(s){return!!s&&!s.isLocal}function Pd(s){return hh(s)&&Wi(s)}function qR(s){return s.isLocal}function VR(s,t){const i=[];let a=new TextEncoder().encode(s);for(;a.length>t;){let o=t;for(;o>0;){const l=a[o];if(l!==void 0&&(l&192)!==128)break;o--}i.push(a.slice(0,o)),a=a.slice(o)}return a.length>0&&i.push(a),i}function FR(s){var t;const i=s.get("Cache-Control");if(i){const a=(t=i.match(/(?:^|[,\s])max-age=(\d+)/))===null||t===void 0?void 0:t[1];if(a)return parseInt(a,10)}}function HR(s,t){const i=new URL(IR(s));return t.forEach((a,o)=>{i.searchParams.set(o,a)}),ub(i,"rtc")}function GR(s){const t=new URL(Wr(s));return ub(t,"validate")}function lb(s){return s.endsWith("/")?s:"".concat(s,"/")}function ub(s,t){return s.pathname="".concat(lb(s.pathname)).concat(t),s.toString()}function ey(s){if(typeof s=="string")return xv.fromJson(JSON.parse(s),{ignoreUnknownFields:!0});if(s instanceof ArrayBuffer)return xv.fromBinary(new Uint8Array(s));throw new Error("could not decode websocket message: ".concat(typeof s))}function KR(s){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(s instanceof AbortSignal))return t;const i=s.reason;switch(typeof i){case"string":return i;case"object":return i instanceof Error?i.message:t;default:return"toString"in i?i.toString():t}}const YR=10,Ir="lk_e2ee",JR="LKFrameEncryptionKey",QR={sharedKey:!1,ratchetSalt:JR,ratchetWindowSize:8,failureTolerance:YR,keyringSize:16};var Ji;(function(s){s.SetKey="setKey",s.RatchetRequest="ratchetRequest",s.KeyRatcheted="keyRatcheted"})(Ji||(Ji={}));var ty;(function(s){s.KeyRatcheted="keyRatcheted"})(ty||(ty={}));var Hi;(function(s){s.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",s.EncryptionError="encryptionError"})(Hi||(Hi={}));var ny;(function(s){s.Error="cryptorError"})(ny||(ny={}));function XR(){return ZR()||fh()}function fh(){return typeof window.RTCRtpScriptTransform<"u"}function ZR(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function WR(s){var t,i,a,o,l;if(((t=s.value)===null||t===void 0?void 0:t.case)!=="sipDtmf"&&((i=s.value)===null||i===void 0?void 0:i.case)!=="metrics"&&((a=s.value)===null||a===void 0?void 0:a.case)!=="speaker"&&((o=s.value)===null||o===void 0?void 0:o.case)!=="transcription"&&((l=s.value)===null||l===void 0?void 0:l.case)!=="encryptedPacket")return new t0({value:s.value})}class G1 extends jn.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(i,a,o)=>{Re.debug("key ratcheted event received",{ratchetResult:i,participantId:a,keyIndex:o})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},QR),t),this.on(Ji.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,i,a){const o={key:t,participantIdentity:i,keyIndex:a};if(!this.options.sharedKey&&!i)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(i??"shared","-").concat(a??0),o),this.emit(Ji.SetKey,o)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,i){this.emit(Ji.RatchetRequest,t,i)}}var iy;(function(s){s[s.InvalidKey=0]="InvalidKey",s[s.MissingKey=1]="MissingKey",s[s.InternalError=2]="InternalError"})(iy||(iy={}));class $R extends jn.EventEmitter{constructor(t,i){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=a=>{var o,l;const{kind:u,data:d}=a.data;switch(u){case"error":if(Re.error(d.error.message),d.uuid){const g=this.decryptDataRequests.get(d.uuid);if(g!=null&&g.reject){g.reject(d.error);break}const v=this.encryptDataRequests.get(d.uuid);if(v!=null&&v.reject){v.reject(d.error);break}}this.emit(Hi.EncryptionError,d.error,d.participantIdentity);break;case"initAck":d.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)});break;case"enable":if(d.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)}),this.encryptionEnabled!==d.enabled&&d.participantIdentity===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity))this.emit(Hi.ParticipantEncryptionStatusChanged,d.enabled,this.room.localParticipant),this.encryptionEnabled=d.enabled;else if(d.participantIdentity){const g=(l=this.room)===null||l===void 0?void 0:l.getParticipantByIdentity(d.participantIdentity);if(!g)throw TypeError("couldn't set encryption status, participant not found".concat(d.participantIdentity));this.emit(Hi.ParticipantEncryptionStatusChanged,d.enabled,g)}break;case"ratchetKey":this.keyProvider.emit(Ji.KeyRatcheted,d.ratchetResult,d.participantIdentity,d.keyIndex);break;case"decryptDataResponse":const f=this.decryptDataRequests.get(d.uuid);f!=null&&f.resolve&&f.resolve(d);break;case"encryptDataResponse":const m=this.encryptDataRequests.get(d.uuid);m!=null&&m.resolve&&m.resolve(d);break}},this.onWorkerError=a=>{Re.error("e2ee worker encountered an error:",{error:a.error}),this.emit(Hi.EncryptionError,a.error,void 0)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=i}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(t){if(!XR())throw new Bh("tried to setup end-to-end encryption on an unsupported browser");if(Re.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const i={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:YE.getLevel()}};this.worker&&(Re.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(i))}}setParticipantCryptorEnabled(t,i){Re.debug("set e2ee to ".concat(t," for participant ").concat(i)),this.postEnable(t,i)}setSifTrailer(t){!t||t.length===0?Re.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on(ie.RTPVideoMapUpdate,i=>{this.postRTPMap(i)})}setupEventListeners(t,i){t.on(Z.TrackPublished,(a,o)=>this.setParticipantCryptorEnabled(a.trackInfo.encryption!==bt.NONE,o.identity)),t.on(Z.ConnectionStateChanged,a=>{a===_e.Connected&&t.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{this.setParticipantCryptorEnabled(l.trackInfo.encryption!==bt.NONE,o.identity)})})}).on(Z.TrackUnsubscribed,(a,o,l)=>{var u;const d={kind:"removeTransform",data:{participantIdentity:l.identity,trackId:a.mediaStreamID}};(u=this.worker)===null||u===void 0||u.postMessage(d)}).on(Z.TrackSubscribed,(a,o,l)=>{this.setupE2EEReceiver(a,l.identity,o.trackInfo)}).on(Z.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");i.getKeys().forEach(a=>{this.postKey(a)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),t.localParticipant.on(se.LocalSenderCreated,(a,o)=>T(this,void 0,void 0,function*(){this.setupE2EESender(o,a)})),t.localParticipant.on(se.LocalTrackPublished,a=>{if(!Wi(a.track)||!Zr())return;const o={kind:"updateCodec",data:{trackId:a.track.mediaStreamID,codec:Fr(a.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o)}),i.on(Ji.SetKey,a=>this.postKey(a)).on(Ji.RatchetRequest,(a,o)=>this.postRatchetRequest(a,o))}encryptData(t){return T(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const i=crypto.randomUUID(),a={kind:"encryptDataRequest",data:{uuid:i,payload:t,participantIdentity:this.room.localParticipant.identity}},o=new yn;return o.onFinally=()=>{this.encryptDataRequests.delete(i)},this.encryptDataRequests.set(i,o),this.worker.postMessage(a),o.promise})}handleEncryptedData(t,i,a,o){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const l=crypto.randomUUID(),u={kind:"decryptDataRequest",data:{uuid:l,payload:t,iv:i,participantIdentity:a,keyIndex:o}},d=new yn;return d.onFinally=()=>{this.decryptDataRequests.delete(l)},this.decryptDataRequests.set(l,d),this.worker.postMessage(u),d.promise}postRatchetRequest(t,i){if(!this.worker)throw Error("could not ratchet key, worker is missing");const a={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:i}};this.worker.postMessage(a)}postKey(t){let{key:i,participantIdentity:a,keyIndex:o}=t;var l;if(!this.worker)throw Error("could not set key, worker is missing");const u={kind:"setKey",data:{participantIdentity:a,isPublisher:a===((l=this.room)===null||l===void 0?void 0:l.localParticipant.identity),key:i,keyIndex:o}};this.worker.postMessage(u)}postEnable(t,i){if(this.worker){const a={kind:"enable",data:{enabled:t,participantIdentity:i}};this.worker.postMessage(a)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var i;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const a={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const i={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(i)}setupE2EEReceiver(t,i,a){if(t.receiver){if(!(a!=null&&a.mimeType)||a.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,i,t.kind==="video"?Fr(a.mimeType):void 0)}}setupE2EESender(t,i){if(!Rs(t)||!i){i||Re.warn("early return because sender is not ready");return}this.handleSender(i,t.mediaStreamID,void 0)}handleReceiver(t,i,a,o){return T(this,void 0,void 0,function*(){if(this.worker){if(fh()&&!Jv()){const l={kind:"decode",participantIdentity:a,trackId:i,codec:o};t.transform=new RTCRtpScriptTransform(this.worker,l)}else{if(Ir in t&&o){const f={kind:"updateCodec",data:{trackId:i,codec:o,participantIdentity:a}};this.worker.postMessage(f);return}let l=t.writableStream,u=t.readableStream;if(!l||!u){const f=t.createEncodedStreams();t.writableStream=f.writable,l=f.writable,t.readableStream=f.readable,u=f.readable}const d={kind:"decode",data:{readableStream:u,writableStream:l,trackId:i,codec:o,participantIdentity:a,isReuse:Ir in t}};this.worker.postMessage(d,[u,l])}t[Ir]=!0}})}handleSender(t,i,a){var o;if(!(Ir in t||!this.worker)){if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(fh()&&!Jv()){Re.info("initialize script transform");const l={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:i,codec:a};t.transform=new RTCRtpScriptTransform(this.worker,l)}else{Re.info("initialize encoded streams");const l=t.createEncodedStreams(),u={kind:"encode",data:{readableStream:l.readable,writableStream:l.writable,codec:a,trackId:i,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(u,[l.readable,l.writable])}t[Ir]=!0}}}const e_=500,t_=15e3;class _s{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new _s),this._instance}addFailedConnectionAttempt(t){var i;const a=new URL(t),o=Md(a);if(!o)return;let l=(i=this.failedConnectionAttempts.get(o))!==null&&i!==void 0?i:0;this.failedConnectionAttempts.set(o,l+1),this.backOffPromises.set(o,wt(Math.min(e_*Math.pow(2,l),t_)))}getBackOffPromise(t){const i=new URL(t),a=i&&Md(i);return a&&this.backOffPromises.get(a)||Promise.resolve()}resetFailedConnectionAttempts(t){const i=new URL(t),a=i&&Md(i);a&&(this.failedConnectionAttempts.set(a,0),this.backOffPromises.set(a,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}_s._instance=null;const Ld="default";class kt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new kt),this.instance}get previousDevices(){return this._previousDevices}getDevices(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;if(((l=kt.userMediaPromiseMap)===null||l===void 0?void 0:l.size)>0){Re.debug("awaiting getUserMedia promise");try{i?yield kt.userMediaPromiseMap.get(i):yield Promise.all(kt.userMediaPromiseMap.values())}catch{Re.warn("error waiting for media permissons")}}let u=yield navigator.mediaDevices.enumerateDevices();if(o&&!(Ra()&&a.hasDeviceInUse(i))&&(u.filter(f=>f.kind===i).length===0||u.some(f=>{const m=f.label==="",g=i?f.kind===i:!0;return m&&g}))){const f={video:i!=="audioinput"&&i!=="audiooutput",audio:i!=="videoinput"&&{deviceId:{ideal:"default"}}},m=yield navigator.mediaDevices.getUserMedia(f);u=yield navigator.mediaDevices.enumerateDevices(),m.getTracks().forEach(g=>{g.stop()})}return a._previousDevices=u,i&&(u=u.filter(d=>d.kind===i)),u})()})}normalizeDeviceId(t,i,a){return T(this,void 0,void 0,function*(){if(i!==Ld)return i;const o=yield this.getDevices(t),l=o.find(d=>d.deviceId===Ld);if(!l){Re.warn("could not reliably determine default device");return}const u=o.find(d=>d.deviceId!==Ld&&d.groupId===(a??l.groupId));if(!u){Re.warn("could not reliably determine default device");return}return u==null?void 0:u.deviceId})}hasDeviceInUse(t){return t?kt.userMediaPromiseMap.has(t):kt.userMediaPromiseMap.size>0}}kt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];kt.userMediaPromiseMap=new Map;var Hr;(function(s){s[s.WAITING=0]="WAITING",s[s.RUNNING=1]="RUNNING",s[s.COMPLETED=2]="COMPLETED"})(Hr||(Hr={}));class n_{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ut,this.nextTaskIndex=0}run(t){return T(this,void 0,void 0,function*(){const i={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Hr.WAITING};this.pendingTasks.set(i.id,i);const a=yield this.taskMutex.lock();try{return i.executedAt=Date.now(),i.status=Hr.RUNNING,yield t()}finally{i.status=Hr.COMPLETED,this.pendingTasks.delete(i.id),a()}})}flush(){return T(this,void 0,void 0,function*(){return this.run(()=>T(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class i_{get readyState(){return this.ws.readyState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a,o;if(!((a=i.signal)===null||a===void 0)&&a.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=t;const l=new WebSocket(t,(o=i.protocols)!==null&&o!==void 0?o:[]);l.binaryType="arraybuffer",this.ws=l;const u=function(){let{closeCode:d,reason:f}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return l.close(d,f)};this.opened=new Promise((d,f)=>{l.onopen=()=>{d({readable:new ReadableStream({start(m){l.onmessage=g=>{let{data:v}=g;return m.enqueue(v)},l.onerror=g=>m.error(g)},cancel:u}),writable:new WritableStream({write(m){l.send(m)},abort(){l.close()},close:u}),protocol:l.protocol,extensions:l.extensions}),l.removeEventListener("error",f)},l.addEventListener("error",f)}),this.closed=new Promise((d,f)=>{const m=()=>T(this,void 0,void 0,function*(){const g=new Promise(b=>{l.readyState!==WebSocket.CLOSED&&l.addEventListener("close",C=>{b(C)},{once:!0})}),v=yield Promise.race([wt(250),g]);v?d(v):f(new Error("Encountered unspecified websocket error without a timely close event"))});l.onclose=g=>{let{code:v,reason:b}=g;d({closeCode:v,reason:b}),l.removeEventListener("error",m)},l.addEventListener("error",m)}),i.signal&&(i.signal.onabort=()=>l.close()),this.close=u}}const a_=["syncState","trickle","offer","answer","simulate","leave"];function s_(s){const t=a_.indexOf(s.case)>=0;return Re.trace("request allowed to bypass queue:",{canPass:t,req:s}),t}var Qe;(function(s){s[s.CONNECTING=0]="CONNECTING",s[s.CONNECTED=1]="CONNECTED",s[s.RECONNECTING=2]="RECONNECTING",s[s.DISCONNECTING=3]="DISCONNECTING",s[s.DISCONNECTED=4]="DISCONNECTED"})(Qe||(Qe={}));const r_=250;class Vh{get currentState(){return this.state}get isDisconnected(){return this.state===Qe.DISCONNECTING||this.state===Qe.DISCONNECTED}get isEstablishingConnection(){return this.state===Qe.CONNECTING||this.state===Qe.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;this.rtt=0,this.state=Qe.DISCONNECTED,this.log=Re,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=hi((a=i.loggerName)!==null&&a!==void 0?a:An.Signal),this.loggerContextCb=i.loggerContextCb,this.useJSON=t,this.requestQueue=new n_,this.queuedRequests=[],this.closingLock=new Ut,this.connectionLock=new Ut,this.state=Qe.DISCONNECTED}get logContext(){var t,i;return(i=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&i!==void 0?i:{}}join(t,i,a,o){return T(this,void 0,void 0,function*(){return this.state=Qe.CONNECTING,this.options=a,yield this.connect(t,i,a,o)})}reconnect(t,i,a,o){return T(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Qe.RECONNECTING,this.clearPingInterval(),yield this.connect(t,i,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:a,reconnectReason:o}))})}connect(t,i,a,o){return T(this,void 0,void 0,function*(){const l=yield this.connectionLock.lock();this.connectOptions=a;const u=LR(),d=a.singlePeerConnection?c_(i,u,a):o_(i,u,a),f=HR(t,d),m=GR(f);return new Promise((g,v)=>T(this,void 0,void 0,function*(){var b,C;try{let M=!1;const O=A=>T(this,void 0,void 0,function*(){if(M)return;M=!0;const _=A instanceof Event?A.currentTarget:A,I=KR(_,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(I)).catch(q=>{this.log.error(q),this.close()}):this.close(),B(),v(be.cancelled(I))});o==null||o.addEventListener("abort",O);const B=()=>{clearTimeout(w),o==null||o.removeEventListener("abort",O)},w=setTimeout(()=>{O(be.timeout("room connection has timed out (signal)"))},a.websocketTimeout),X=(A,_)=>{this.handleSignalConnected(A,w,_)},K=new URL(f);K.searchParams.has("access_token")&&K.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(K),Object.assign({reconnect:a.reconnect,reconnectReason:a.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new i_(f);try{this.ws.closed.then(re=>{var ce;this.isEstablishingConnection&&v(be.internal("Websocket got closed during a (re)connection attempt: ".concat(re.reason))),re.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:re.reason,code:re.closeCode,wasClean:re.closeCode===1e3,state:this.state})),this.state===Qe.CONNECTED&&this.handleOnClose((ce=re.reason)!==null&&ce!==void 0?ce:"Unexpected WS error"))}).catch(re=>{this.isEstablishingConnection&&v(be.internal("Websocket error during a (re)connection attempt: ".concat(re)))});const A=yield this.ws.opened.catch(re=>T(this,void 0,void 0,function*(){if(this.state!==Qe.CONNECTED){this.state=Qe.DISCONNECTED,clearTimeout(w);const ce=yield this.handleConnectionError(re,m);v(ce);return}this.handleWSError(re),v(re)}));if(clearTimeout(w),!A)return;const _=A.readable.getReader();this.streamWriter=A.writable.getWriter();const I=yield _.read();if(_.releaseLock(),!I.value)throw be.internal("no message received as first message");const q=ey(I.value),W=this.validateFirstMessage(q,(b=a.reconnect)!==null&&b!==void 0?b:!1);if(!W.isValid){v(W.error);return}((C=q.message)===null||C===void 0?void 0:C.case)==="join"&&(this.pingTimeoutDuration=q.message.value.pingTimeout,this.pingIntervalDuration=q.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const oe=W.shouldProcessFirstMessage?q:void 0;X(A,oe),g(W.response)}catch(A){v(A)}finally{B()}}finally{l()}}))})}startReadingLoop(t,i){return T(this,void 0,void 0,function*(){for(i&&this.handleSignalResponse(i);;){this.signalLatency&&(yield wt(this.signalLatency));const{done:a,value:o}=yield t.read();if(a)break;const l=ey(o);this.handleSignalResponse(l)}})}close(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Qe.DISCONNECTING||Qe.DISCONNECTED].includes(t.state)){t.log.debug("ignoring signal close as it's already in disconnecting state");return}const o=yield t.closingLock.lock();try{if(t.clearPingInterval(),i&&(t.state=Qe.DISCONNECTING),t.ws){t.ws.close({closeCode:1e3,reason:a});const l=t.ws.closed;t.ws=void 0,t.streamWriter=void 0,yield Promise.race([l,wt(r_)])}}catch(l){t.log.debug("websocket error while closing",Object.assign(Object.assign({},t.logContext),{error:l}))}finally{i&&(t.state=Qe.DISCONNECTED),o()}})()})}sendOffer(t,i){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:Ss(t,i)})}sendAnswer(t,i){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:Ss(t,i)})}sendIceCandidate(t,i){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new Qc({candidateInit:JSON.stringify(t),target:i})})}sendMuteTrack(t,i){return this.sendRequest({case:"mute",value:new Xc({sid:t,muted:i})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const d=l.getNextRequestId();return yield l.sendRequest({case:"updateMetadata",value:new Ph({requestId:d,metadata:a,name:o,attributes:u})}),d})()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,i){return this.sendRequest({case:"updateLayers",value:new g0({trackSid:t,layers:i})})}sendUpdateSubscriptionPermissions(t,i){return this.sendRequest({case:"subscriptionPermission",value:new b0({allParticipants:t,trackPermissions:i})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:et.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new C0({timestamp:et.parse(Date.now()),rtt:et.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,i){return this.sendRequest({case:"updateAudioTrack",value:new Nh({trackSid:t,features:i})})}sendLeave(){return this.sendRequest({case:"leave",value:new Wc({reason:On.CLIENT_INITIATED,action:Cs.DISCONNECT})})}sendRequest(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!o&&!s_(i)&&a.state===Qe.RECONNECTING){a.queuedRequests.push(()=>T(a,void 0,void 0,function*(){yield this.sendRequest(i,!0)}));return}if(o||(yield a.requestQueue.flush()),a.signalLatency&&(yield wt(a.signalLatency)),a.isDisconnected){a.log.debug("skipping signal request (type: ".concat(i.case,") - SignalClient disconnected"));return}if(!a.streamWriter){a.log.error("cannot send signal request before connected, type: ".concat(i==null?void 0:i.case),a.logContext);return}const u=new yE({message:i});try{a.useJSON?yield a.streamWriter.write(u.toJsonString()):yield a.streamWriter.write(u.toBinary())}catch(d){a.log.error("error sending signal message",Object.assign(Object.assign({},a.logContext),{error:d}))}})()})}handleSignalResponse(t){var i,a;const o=t.message;if(o==null){this.log.debug("received unsupported message",this.logContext);return}let l=!1;if(o.case==="answer"){const u=ay(o.value);this.onAnswer&&this.onAnswer(u,o.value.id,o.value.midToTrackId)}else if(o.case==="offer"){const u=ay(o.value);this.onOffer&&this.onOffer(u,o.value.id,o.value.midToTrackId)}else if(o.case==="trickle"){const u=JSON.parse(o.value.candidateInit);this.onTrickle&&this.onTrickle(u,o.value.target)}else o.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((i=o.value.participants)!==null&&i!==void 0?i:[]):o.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(o.value):o.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((a=o.value.speakers)!==null&&a!==void 0?a:[]):o.case==="leave"?this.onLeave&&this.onLeave(o.value):o.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(o.value.sid,o.value.muted):o.case==="roomUpdate"?this.onRoomUpdate&&o.value.room&&this.onRoomUpdate(o.value.room):o.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(o.value):o.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(o.value):o.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(o.value):o.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(o.value):o.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(o.value):o.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(o.value):o.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(o.value):o.case==="pong"||(o.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(o.value.lastPingTimestamp.toString()),this.resetPingTimeout(),l=!0):o.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(o.value):o.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(o.value.trackSid):o.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(o.value.token),this.onRoomMoved&&this.onRoomMoved(o.value)):o.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(o.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:o.case})));l||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return T(this,void 0,void 0,function*(){if(this.state===Qe.DISCONNECTED)return;const i=this.onClose;yield this.close(void 0,t),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),i&&i(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Mt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Mt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Mt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Mt.clearInterval(this.pingInterval)}handleSignalConnected(t,i,a){this.state=Qe.CONNECTED,clearTimeout(i),this.startPingInterval(),this.startReadingLoop(t.readable.getReader(),a)}validateFirstMessage(t,i){var a,o,l,u,d;return((a=t.message)===null||a===void 0?void 0:a.case)==="join"?{isValid:!0,response:t.message.value}:this.state===Qe.RECONNECTING&&((o=t.message)===null||o===void 0?void 0:o.case)!=="leave"?((l=t.message)===null||l===void 0?void 0:l.case)==="reconnect"?{isValid:!0,response:t.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((u=t.message)===null||u===void 0?void 0:u.case)==="leave"?{isValid:!1,error:be.leaveRequest("Received leave request while trying to (re)connect",t.message.value.reason)}:i?{isValid:!1,error:be.internal("Unexpected first message")}:{isValid:!1,error:be.internal("did not receive join response, got ".concat((d=t.message)===null||d===void 0?void 0:d.case," instead"))}}handleConnectionError(t,i){return T(this,void 0,void 0,function*(){try{const a=yield fetch(i);if(a.status.toFixed(0).startsWith("4")){const o=yield a.text();return be.notAllowed(o,a.status)}else return t instanceof be?t:be.internal("Encountered unknown websocket error during connection: ".concat(t),{status:a.status,statusText:a.statusText})}catch(a){return a instanceof be?a:be.serverUnreachable(a instanceof Error?a.message:"server was not reachable")}})}}function ay(s){const t={type:"offer",sdp:s.sdp};switch(s.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=s.type;break}return t}function Ss(s,t){return new Xi({sdp:s.sdp,type:s.type,id:t})}function o_(s,t,i){var a;const o=new URLSearchParams;return o.set("access_token",s),i.reconnect&&(o.set("reconnect","1"),i.sid&&o.set("sid",i.sid)),o.set("auto_subscribe",i.autoSubscribe?"1":"0"),o.set("sdk",Un()?"reactnative":"js"),o.set("version",t.version),o.set("protocol",t.protocol.toString()),t.deviceModel&&o.set("device_model",t.deviceModel),t.os&&o.set("os",t.os),t.osVersion&&o.set("os_version",t.osVersion),t.browser&&o.set("browser",t.browser),t.browserVersion&&o.set("browser_version",t.browserVersion),i.adaptiveStream&&o.set("adaptive_stream","1"),i.reconnectReason&&o.set("reconnect_reason",i.reconnectReason.toString()),!((a=navigator.connection)===null||a===void 0)&&a.type&&o.set("network",navigator.connection.type),o}function c_(s,t,i){const a=new URLSearchParams;a.set("access_token",s);const o=new zE({clientInfo:t,connectionSettings:new k0({autoSubscribe:!!i.autoSubscribe,adaptiveStream:!!i.adaptiveStream}),reconnect:!!i.reconnect,participantSid:i.sid?i.sid:void 0});i.reconnectReason&&(o.reconnectReason=i.reconnectReason);const l=new qE({joinRequest:o.toBinary()});return a.set("join_request",btoa(new TextDecoder("utf-8").decode(l.toBinary()))),a}class sy{constructor(){this.buffer=[],this._totalSize=0}push(t){this.buffer.push(t),this._totalSize+=t.data.byteLength}pop(){const t=this.buffer.shift();return t&&(this._totalSize-=t.data.byteLength),t}getAll(){return this.buffer.slice()}popToSequence(t){for(;this.buffer.length>0&&this.buffer[0].sequence<=t;)this.pop()}alignBufferedAmount(t){for(;this.buffer.length>0;){const i=this.buffer[0];if(this._totalSize-i.data.byteLength<=t)break;this.pop()}}get length(){return this.buffer.length}}class l_{constructor(t){this._map=new Map,this._lastCleanup=0,this.ttl=t}set(t,i){const a=Date.now();a-this._lastCleanup>this.ttl/2&&this.cleanup();const o=a+this.ttl;return this._map.set(t,{value:i,expiresAt:o}),this}get(t){const i=this._map.get(t);if(i){if(i.expiresAt<Date.now()){this._map.delete(t);return}return i.value}}has(t){const i=this._map.get(t);return i?i.expiresAt<Date.now()?(this._map.delete(t),!1):!0:!1}delete(t){return this._map.delete(t)}clear(){this._map.clear()}cleanup(){const t=Date.now();for(const[i,a]of this._map.entries())a.expiresAt<t&&this._map.delete(i);this._lastCleanup=t}get size(){return this.cleanup(),this._map.size}forEach(t){this.cleanup();for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&t(a.value,i,this.asValueMap())}map(t){this.cleanup();const i=[],a=this.asValueMap();for(const[o,l]of a.entries())i.push(t(l,o,a));return i}asValueMap(){const t=new Map;for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&t.set(i,a.value);return t}}var Cn={},Ud={},Id={exports:{}},ry;function Fh(){if(ry)return Id.exports;ry=1;var s=Id.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var i="candidate:%s %d %s %d %s %d typ %s";return i+=t.raddr!=null?" raddr %s rport %d":"%v%v",i+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(i+=" generation %d"),i+=t["network-id"]!=null?" network-id %d":"%v",i+=t["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var i="ssrc:%d";return t.attribute!=null&&(i+=" %s",t.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var i="mediaclk:";return i+=t.id!=null?"id=%s %s":"%v%s",i+=t.mediaClockValue!=null?"=%s":"",i+=t.rateNumerator!=null?" rate=%s":"",i+=t.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(s).forEach(function(t){var i=s[t];i.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})}),Id.exports}var oy;function u_(){return oy||(oy=1,(function(s){var t=function(d){return String(Number(d))===d?Number(d):d},i=function(d,f,m,g){if(g&&!m)f[g]=t(d[1]);else for(var v=0;v<m.length;v+=1)d[v+1]!=null&&(f[m[v]]=t(d[v+1]))},a=function(d,f,m){var g=d.name&&d.names;d.push&&!f[d.push]?f[d.push]=[]:g&&!f[d.name]&&(f[d.name]={});var v=d.push?{}:g?f[d.name]:f;i(m.match(d.reg),v,d.names,d.name),d.push&&f[d.push].push(v)},o=Fh(),l=RegExp.prototype.test.bind(/^([a-z])=(.*)/);s.parse=function(d){var f={},m=[],g=f;return d.split(/(\r\n|\r|\n)/).filter(l).forEach(function(v){var b=v[0],C=v.slice(2);b==="m"&&(m.push({rtp:[],fmtp:[]}),g=m[m.length-1]);for(var M=0;M<(o[b]||[]).length;M+=1){var O=o[b][M];if(O.reg.test(C))return a(O,g,C)}}),f.media=m,f};var u=function(d,f){var m=f.split(/=(.+)/,2);return m.length===2?d[m[0]]=t(m[1]):m.length===1&&f.length>1&&(d[m[0]]=void 0),d};s.parseParams=function(d){return d.split(/;\s?/).reduce(u,{})},s.parseFmtpConfig=s.parseParams,s.parsePayloads=function(d){return d.toString().split(" ").map(Number)},s.parseRemoteCandidates=function(d){for(var f=[],m=d.split(" ").map(t),g=0;g<m.length;g+=3)f.push({component:m[g],ip:m[g+1],port:m[g+2]});return f},s.parseImageAttributes=function(d){return d.split(" ").map(function(f){return f.substring(1,f.length-1).split(",").reduce(u,{})})},s.parseSimulcastStreamList=function(d){return d.split(";").map(function(f){return f.split(",").map(function(m){var g,v=!1;return m[0]!=="~"?g=t(m):(g=t(m.substring(1,m.length)),v=!0),{scid:g,paused:v}})})}})(Ud)),Ud}var jd,cy;function d_(){if(cy)return jd;cy=1;var s=Fh(),t=/%[sdv%]/g,i=function(u){var d=1,f=arguments,m=f.length;return u.replace(t,function(g){if(d>=m)return g;var v=f[d];switch(d+=1,g){case"%%":return"%";case"%s":return String(v);case"%d":return Number(v);case"%v":return""}})},a=function(u,d,f){var m=d.format instanceof Function?d.format(d.push?f:f[d.name]):d.format,g=[u+"="+m];if(d.names)for(var v=0;v<d.names.length;v+=1){var b=d.names[v];d.name?g.push(f[d.name][b]):g.push(f[d.names[v]])}else g.push(f[d.name]);return i.apply(null,g)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];return jd=function(u,d){d=d||{},u.version==null&&(u.version=0),u.name==null&&(u.name=" "),u.media.forEach(function(v){v.payloads==null&&(v.payloads="")});var f=d.outerOrder||o,m=d.innerOrder||l,g=[];return f.forEach(function(v){s[v].forEach(function(b){b.name in u&&u[b.name]!=null?g.push(a(v,b,u)):b.push in u&&u[b.push]!=null&&u[b.push].forEach(function(C){g.push(a(v,b,C))})})}),u.media.forEach(function(v){g.push(a("m",s.m[0],v)),m.forEach(function(b){s[b].forEach(function(C){C.name in v&&v[C.name]!=null?g.push(a(b,C,v)):C.push in v&&v[C.push]!=null&&v[C.push].forEach(function(M){g.push(a(b,C,M))})})})}),g.join(`\r
`)+`\r
`},jd}var ly;function h_(){if(ly)return Cn;ly=1;var s=u_(),t=d_(),i=Fh();return Cn.grammar=i,Cn.write=t,Cn.parse=s.parse,Cn.parseParams=s.parseParams,Cn.parseFmtpConfig=s.parseFmtpConfig,Cn.parsePayloads=s.parsePayloads,Cn.parseRemoteCandidates=s.parseRemoteCandidates,Cn.parseImageAttributes=s.parseImageAttributes,Cn.parseSimulcastStreamList=s.parseSimulcastStreamList,Cn}var qi=h_();function Hh(s,t,i){var a,o,l;t===void 0&&(t=50),i===void 0&&(i={});var u=(a=i.isImmediate)!=null&&a,d=(o=i.callback)!=null&&o,f=i.maxWait,m=Date.now(),g=[];function v(){if(f!==void 0){var C=Date.now()-m;if(C+t>=f)return f-C}return t}var b=function(){var C=[].slice.call(arguments),M=this;return new Promise(function(O,B){var w=u&&l===void 0;if(l!==void 0&&clearTimeout(l),l=setTimeout(function(){if(l=void 0,m=Date.now(),!u){var K=s.apply(M,C);d&&d(K),g.forEach(function(A){return(0,A.resolve)(K)}),g=[]}},v()),w){var X=s.apply(M,C);return d&&d(X),O(X)}g.push({resolve:O,reject:B})})};return b.cancel=function(C){l!==void 0&&clearTimeout(l),g.forEach(function(M){return(0,M.reject)(C)}),g=[]},b}const f_=.7,m_=20,Os={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class uy extends jn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;super(),this.log=Re,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Hh(o=>T(this,void 0,void 0,function*(){this.emit(Os.NegotiationStarted);try{yield this.createAndSendOffer()}catch(l){if(o)o(l);else throw l}}),m_),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=hi((a=i.loggerName)!==null&&a!==void 0?a:An.PCTransport),this.loggerOptions=i,this.config=t,this._pc=this.createPC(),this.offerLock=new Ut}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=i=>{var a;i.candidate&&((a=this.onIceCandidate)===null||a===void 0||a.call(this,i.candidate))},t.onicecandidateerror=i=>{var a;(a=this.onIceCandidateError)===null||a===void 0||a.call(this,i)},t.oniceconnectionstatechange=()=>{var i;(i=this.onIceConnectionStateChange)===null||i===void 0||i.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var i;(i=this.onSignalingStatechange)===null||i===void 0||i.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,t.connectionState)},t.ondatachannel=i=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,i)},t.ontrack=i=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,i)},t}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return T(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t,i){return T(this,void 0,void 0,function*(){var a;if(t.type==="answer"&&this.latestOfferId>0&&i>0&&i!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:i,latestOfferId:this.latestOfferId})),!1;let o;if(t.type==="offer"){let{stereoMids:l,nackMids:u}=p_(t);this.remoteStereoMids=l,this.remoteNackMids=u}else if(t.type==="answer"){const l=qi.parse((a=t.sdp)!==null&&a!==void 0?a:"");l.media.forEach(u=>{const d=Gh(u.mid);u.type==="audio"&&this.trackBitrates.some(f=>{if(!f.transceiver||d!=f.transceiver.mid)return!1;let m=0;if(u.rtp.some(v=>v.codec.toUpperCase()===f.codec.toUpperCase()?(m=v.payload,!0):!1),m===0)return!0;let g=!1;for(const v of u.fmtp)if(v.payload===m){v.config=v.config.split(";").filter(b=>!b.includes("maxaveragebitrate")).join(";"),f.maxbr>0&&(v.config+=";maxaveragebitrate=".concat(f.maxbr*1e3)),g=!0;break}return g||f.maxbr>0&&u.fmtp.push({payload:m,config:"maxaveragebitrate=".concat(f.maxbr*1e3)}),!0})}),o=qi.write(l)}return yield this.setMungedSDP(t,o,!0),this.pendingCandidates.forEach(l=>{this.pc.addIceCandidate(l)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(Os.NegotiationComplete),t.sdp&&qi.parse(t.sdp).media.forEach(u=>{u.type==="video"&&this.emit(Os.RTPVideoPayloadTypes,u.rtp)})),!0})}createAndSendOffer(t){return T(this,void 0,void 0,function*(){var i;const a=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(t!=null&&t.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const d=this._pc.remoteDescription;if(t!=null&&t.iceRestart&&d)yield this._pc.setRemoteDescription(d);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const o=this.latestOfferId+1;this.latestOfferId=o;const l=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:l.sdp},this.logContext));const u=qi.parse((i=l.sdp)!==null&&i!==void 0?i:"");if(u.media.forEach(d=>{hy(d),d.type==="audio"?dy(d,["all"],[]):d.type==="video"&&this.trackBitrates.some(f=>{if(!d.msid||!f.cid||!d.msid.includes(f.cid))return!1;let m=0;if(d.rtp.some(v=>v.codec.toUpperCase()===f.codec.toUpperCase()?(m=v.payload,!0):!1),m===0||(_n(f.codec)&&!Ra()&&this.ensureVideoDDExtensionForSVC(d,u),!_n(f.codec)))return!0;const g=Math.round(f.maxbr*f_);for(const v of d.fmtp)if(v.payload===m){v.config.includes("x-google-start-bitrate")||(v.config+=";x-google-start-bitrate=".concat(g));break}return!0})}),this.latestOfferId>o){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:o}));return}yield this.setMungedSDP(l,qi.write(u)),this.onOffer(l,this.latestOfferId)}finally{a()}})}createAndSetAnswer(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pc.createAnswer(),a=qi.parse((t=i.sdp)!==null&&t!==void 0?t:"");return a.media.forEach(o=>{hy(o),o.type==="audio"&&dy(o,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(i,qi.write(a)),i})}createDataChannel(t,i){return this.pc.createDataChannel(t,i)}addTransceiver(t,i){return this.pc.addTransceiver(t,i)}addTransceiverOfKind(t,i){return this.pc.addTransceiver(t,i)}addTrack(t){if(!this._pc)throw new yt("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var i;if(!this._pc)throw new yt("PC closed, cannot configure");return(i=this._pc)===null||i===void 0?void 0:i.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var i;return(i=this._pc)===null||i===void 0?void 0:i.removeTrack(t)}getConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&i!==void 0?i:"closed"}getICEConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&i!==void 0?i:"closed"}getSignallingState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&i!==void 0?i:"closed"}getTransceivers(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&i!==void 0?i:[]}getSenders(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&i!==void 0?i:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return T(this,void 0,void 0,function*(){var t;if(!this._pc)return;let i="";const a=new Map,o=new Map;if((yield this._pc.getStats()).forEach(d=>{switch(d.type){case"transport":i=d.selectedCandidatePairId;break;case"candidate-pair":i===""&&d.selected&&(i=d.id),a.set(d.id,d);break;case"remote-candidate":o.set(d.id,"".concat(d.address,":").concat(d.port));break}}),i==="")return;const u=(t=a.get(i))===null||t===void 0?void 0:t.remoteCandidateId;if(u!==void 0)return o.get(u)})}setMungedSDP(t,i,a){return T(this,void 0,void 0,function*(){if(i){const o=t.sdp;t.sdp=i;try{this.log.debug("setting munged ".concat(a?"remote":"local"," description"),this.logContext),a?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(l){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:i})),t.sdp=o}}try{a?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(o){let l="unknown error";o instanceof Error?l=o.message:typeof o=="string"&&(l=o);const u={error:l,sdp:t.sdp};throw!a&&this.pc.remoteDescription&&(u.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:u})),new ah(l)}})}ensureVideoDDExtensionForSVC(t,i){var a,o;if(!((a=t.ext)===null||a===void 0?void 0:a.some(u=>u.uri===Yv))){if(this.ddExtID===0){let u=0;i.media.forEach(d=>{var f;d.type==="video"&&((f=d.ext)===null||f===void 0||f.forEach(m=>{m.value>u&&(u=m.value)}))}),this.ddExtID=u+1}(o=t.ext)===null||o===void 0||o.push({value:this.ddExtID,uri:Yv})}}}function dy(s,t,i){const a=Gh(s.mid);let o=0;s.rtp.some(l=>l.codec==="opus"?(o=l.payload,!0):!1),o>0&&(s.rtcpFb||(s.rtcpFb=[]),i.includes(a)&&!s.rtcpFb.some(l=>l.payload===o&&l.type==="nack")&&s.rtcpFb.push({payload:o,type:"nack"}),(t.includes(a)||t.length===1&&t[0]==="all")&&s.fmtp.some(l=>l.payload===o?(l.config.includes("stereo=1")||(l.config+=";stereo=1"),!0):!1))}function p_(s){var t;const i=[],a=[],o=qi.parse((t=s.sdp)!==null&&t!==void 0?t:"");let l=0;return o.media.forEach(u=>{var d;const f=Gh(u.mid);u.type==="audio"&&(u.rtp.some(m=>m.codec==="opus"?(l=m.payload,!0):!1),!((d=u.rtcpFb)===null||d===void 0)&&d.some(m=>m.payload===l&&m.type==="nack")&&a.push(f),u.fmtp.some(m=>m.payload===l?(m.config.includes("sprop-stereo=1")&&i.push(f),!0):!1))}),{stereoMids:i,nackMids:a}}function hy(s){if(s.connection){const t=s.connection.ip.indexOf(":")>=0;(s.connection.version===4&&t||s.connection.version===6&&!t)&&(s.connection.ip="0.0.0.0",s.connection.version=4)}}function Gh(s){return typeof s=="number"?s.toFixed(0):s}const mh="vp8",g_={audioPreset:sh.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:zh.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:mh,backupCodec:!0,preConnectBuffer:!1},db={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},hb={deviceId:{ideal:"default"},resolution:Xr.h720.resolution},v_={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new QE,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Kh={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var st;(function(s){s[s.NEW=0]="NEW",s[s.CONNECTING=1]="CONNECTING",s[s.CONNECTED=2]="CONNECTED",s[s.FAILED=3]="FAILED",s[s.CLOSING=4]="CLOSING",s[s.CLOSED=5]="CLOSED"})(st||(st={}));class y_{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(t,i,a){var o;this.peerConnectionTimeout=Kh.peerConnectionTimeout,this.log=Re,this.updateState=()=>{var l,u;const d=this.state,f=this.requiredTransports.map(m=>m.getConnectionState());f.every(m=>m==="connected")?this.state=st.CONNECTED:f.some(m=>m==="failed")?this.state=st.FAILED:f.some(m=>m==="connecting")?this.state=st.CONNECTING:f.every(m=>m==="closed")?this.state=st.CLOSED:f.some(m=>m==="closed")?this.state=st.CLOSING:f.every(m=>m==="new")&&(this.state=st.NEW),d!==this.state&&(this.log.debug("pc state change: from ".concat(st[d]," to ").concat(st[this.state]),this.logContext),(l=this.onStateChange)===null||l===void 0||l.call(this,this.state,this.publisher.getConnectionState(),(u=this.subscriber)===null||u===void 0?void 0:u.getConnectionState()))},this.log=hi((o=a.loggerName)!==null&&o!==void 0?o:An.PCManager),this.loggerOptions=a,this.isPublisherConnectionRequired=i!=="subscriber-primary",this.isSubscriberConnectionRequired=i==="subscriber-primary",this.publisher=new uy(t,a),i!=="publisher-only"&&(this.subscriber=new uy(t,a),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=l=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,l,Rn.SUBSCRIBER)},this.subscriber.onDataChannel=l=>{var u;(u=this.onDataChannel)===null||u===void 0||u.call(this,l)},this.subscriber.onTrack=l=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,l)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=l=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,l,Rn.PUBLISHER)},this.publisher.onTrack=l=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,l)},this.publisher.onOffer=(l,u)=>{var d;(d=this.onPublisherOffer)===null||d===void 0||d.call(this,l,u)},this.state=st.NEW,this.connectionLock=new Ut,this.remoteOfferLock=new Ut}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t,i){return this.publisher.setRemoteDescription(t,i)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return T(this,void 0,void 0,function*(){var t;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const i=this.publisher;for(const a of i.getSenders())try{i.canRemoveTrack()&&i.removeTrack(a)}catch(o){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:o}))}}yield Promise.all([this.publisher.close(),(t=this.subscriber)===null||t===void 0?void 0:t.close()]),this.updateState()})}triggerIceRestart(){return T(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,i){return T(this,void 0,void 0,function*(){var a;i===Rn.PUBLISHER?yield this.publisher.addIceCandidate(t):yield(a=this.subscriber)===null||a===void 0?void 0:a.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t,i){return T(this,void 0,void 0,function*(){var a,o,l;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:(a=this.subscriber)===null||a===void 0?void 0:a.getSignallingState().toString()}));const u=yield this.remoteOfferLock.lock();try{return(yield(o=this.subscriber)===null||o===void 0?void 0:o.setRemoteDescription(t,i))?yield(l=this.subscriber)===null||l===void 0?void 0:l.createAndSetAnswer():void 0}finally{u()}})}updateConfiguration(t,i){var a;this.publisher.setConfiguration(t),(a=this.subscriber)===null||a===void 0||a.setConfiguration(t),i&&this.triggerIceRestart()}ensurePCTransportConnection(t,i){return T(this,void 0,void 0,function*(){var a;const o=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((a=this.requiredTransports)===null||a===void 0?void 0:a.map(l=>this.ensureTransportConnected(l,t,i)))}finally{o()}})}negotiate(t){return T(this,void 0,void 0,function*(){return new Promise((i,a)=>T(this,void 0,void 0,function*(){const o=setTimeout(()=>{a("negotiation timed out")},this.peerConnectionTimeout),l=()=>{clearTimeout(o),a("negotiation aborted")};t.signal.addEventListener("abort",l),this.publisher.once(Os.NegotiationStarted,()=>{t.signal.aborted||this.publisher.once(Os.NegotiationComplete,()=>{clearTimeout(o),i()})}),yield this.publisher.negotiate(u=>{clearTimeout(o),a(u)})}))})}addPublisherTransceiver(t,i){return this.publisher.addTransceiver(t,i)}addPublisherTransceiverOfKind(t,i){return this.publisher.addTransceiverOfKind(t,i)}getMidForReceiver(t){const a=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(o=>o.receiver===t);return a==null?void 0:a.mid}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,i){return this.publisher.createDataChannel(t,i)}getConnectedAddress(t){return t===Rn.PUBLISHER?this.publisher.getConnectedAddress():t===Rn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&t.push(this.subscriber),t}ensureTransportConnected(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(a.getConnectionState()!=="connected")return new Promise((f,m)=>T(l,void 0,void 0,function*(){const g=()=>{this.log.warn("abort transport connection",this.logContext),Mt.clearTimeout(v),m(be.cancelled("room connection has been cancelled"))};o!=null&&o.signal.aborted&&g(),o==null||o.signal.addEventListener("abort",g);const v=Mt.setTimeout(()=>{o==null||o.signal.removeEventListener("abort",g),m(be.internal("could not establish pc connection"))},u);for(;this.state!==st.CONNECTED;)if(yield wt(50),o!=null&&o.signal.aborted){m(be.cancelled("room connection has been cancelled"));return}Mt.clearTimeout(v),o==null||o.signal.removeEventListener("abort",g),f()}))})()})}}const fb=5e3,b_=3e4;class Ue{static fetchRegionSettings(t,i,a){return T(this,void 0,void 0,function*(){const o=yield Ue.fetchLock.lock();try{const l=yield fetch("".concat(S_(t),"/regions"),{headers:{authorization:"Bearer ".concat(i)},signal:a});if(l.ok){const u=FR(l.headers),d=u?u*1e3:fb;return{regionSettings:yield l.json(),updatedAtInMs:Date.now(),maxAgeInMs:d}}else throw l.status===401?be.notAllowed("Could not fetch region settings: ".concat(l.statusText),l.status):be.internal("Could not fetch region settings: ".concat(l.statusText))}catch(l){throw l instanceof be?l:a!=null&&a.aborted?be.cancelled("Region fetching was aborted"):be.serverUnreachable("Could not fetch region settings, ".concat(l instanceof Error?"".concat(l.name,": ").concat(l.message):l))}finally{o()}})}static scheduleRefetch(t,i,a){return T(this,void 0,void 0,function*(){const o=Ue.settingsTimeouts.get(t.hostname);clearTimeout(o),Ue.settingsTimeouts.set(t.hostname,setTimeout(()=>T(this,void 0,void 0,function*(){try{const l=yield Ue.fetchRegionSettings(t,i);Ue.updateCachedRegionSettings(t,i,l)}catch(l){if(l instanceof be&&l.reason===We.NotAllowed){Re.debug("token is not valid, cancelling auto region refresh");return}Re.debug("auto refetching of region settings failed",{error:l}),Ue.scheduleRefetch(t,i,a)}}),a))})}static updateCachedRegionSettings(t,i,a){Ue.cache.set(t.hostname,a),Ue.scheduleRefetch(t,i,a.maxAgeInMs)}static stopRefetch(t){const i=Ue.settingsTimeouts.get(t);i&&(clearTimeout(i),Ue.settingsTimeouts.delete(t))}static scheduleCleanup(t){let i=Ue.connectionTrackers.get(t);i&&(i.cleanupTimeout&&clearTimeout(i.cleanupTimeout),i.cleanupTimeout=setTimeout(()=>{const a=Ue.connectionTrackers.get(t);a&&a.connectionCount===0&&(Re.debug("stopping region refetch after disconnect delay",{hostname:t}),Ue.stopRefetch(t)),a&&(a.cleanupTimeout=void 0)},b_))}static cancelCleanup(t){const i=Ue.connectionTrackers.get(t);i!=null&&i.cleanupTimeout&&(clearTimeout(i.cleanupTimeout),i.cleanupTimeout=void 0)}notifyConnected(){const t=this.serverUrl.hostname;let i=Ue.connectionTrackers.get(t);i||(i={connectionCount:0},Ue.connectionTrackers.set(t,i)),i.connectionCount++,Ue.cancelCleanup(t)}notifyDisconnected(){const t=this.serverUrl.hostname,i=Ue.connectionTrackers.get(t);i&&(i.connectionCount=Math.max(0,i.connectionCount-1),i.connectionCount===0&&Ue.scheduleCleanup(t))}constructor(t,i){this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=i}updateToken(t){this.token=t}isCloud(){return Ds(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(t){return T(this,void 0,void 0,function*(){return Ue.fetchRegionSettings(this.serverUrl,this.token,t)})}getNextBestRegionUrl(t){return T(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let i=Ue.cache.get(this.serverUrl.hostname);(!i||Date.now()-i.updatedAtInMs>i.maxAgeInMs)&&(i=yield this.fetchRegionSettings(t),Ue.updateCachedRegionSettings(this.serverUrl,this.token,i));const a=i.regionSettings.regions.filter(o=>!this.attemptedRegions.find(l=>l.url===o.url));if(a.length>0){const o=a[0];return this.attemptedRegions.push(o),Re.debug("next region: ".concat(o.region)),o.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(t){Ue.updateCachedRegionSettings(this.serverUrl,this.token,t)}}Ue.cache=new Map;Ue.settingsTimeouts=new Map;Ue.connectionTrackers=new Map;Ue.fetchLock=new Ut;function S_(s){return"".concat(s.protocol.replace("ws","http"),"//").concat(s.host,"/settings")}class ot extends Error{constructor(t,i,a){super(i),this.code=t,this.message=fy(i,ot.MAX_MESSAGE_BYTES),this.data=a?fy(a,ot.MAX_DATA_BYTES):void 0}static fromProto(t){return new ot(t.code,t.message,t.data)}toProto(){return new a0({code:this.code,message:this.message,data:this.data})}static builtIn(t,i){return new ot(ot.ErrorCode[t],ot.ErrorMessage[t],i)}}ot.MAX_MESSAGE_BYTES=256;ot.MAX_DATA_BYTES=15360;ot.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};ot.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const mb=15360;function Yh(s){return new TextEncoder().encode(s).length}function fy(s,t){if(Yh(s)<=t)return s;let i=0,a=s.length;const o=new TextEncoder;for(;i<a;){const l=Math.floor((i+a+1)/2);o.encode(s.slice(0,l)).length<=t?i=l:a=l-1}return s.slice(0,i)}const Jh=2e3;function el(s,t){if(!t)return 0;let i,a;return"bytesReceived"in s?(i=s.bytesReceived,a=t.bytesReceived):"bytesSent"in s&&(i=s.bytesSent,a=t.bytesSent),i===void 0||a===void 0||s.timestamp===void 0||t.timestamp===void 0?0:(i-a)*8*1e3/(s.timestamp-t.timestamp)}const Qh=typeof MediaRecorder<"u";class T_{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const C_=Qh?MediaRecorder:T_;class k_ extends C_{constructor(t,i){if(!Qh)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([t.mediaStreamTrack]),i);let a,o;const l=()=>o===void 0,u=()=>{this.removeEventListener("dataavailable",a),this.removeEventListener("stop",u),this.removeEventListener("error",d),o==null||o.close(),o=void 0},d=f=>{o==null||o.error(f),this.removeEventListener("dataavailable",a),this.removeEventListener("stop",u),this.removeEventListener("error",d),o=void 0};this.byteStream=new ReadableStream({start:f=>{o=f,a=m=>T(this,void 0,void 0,function*(){let g;if(m.data.arrayBuffer){const v=yield m.data.arrayBuffer();g=new Uint8Array(v)}else if(m.data.byteArray)g=m.data.byteArray;else throw new Error("no data available!");l()||f.enqueue(g)}),this.addEventListener("dataavailable",a)},cancel:()=>{u()}}),this.addEventListener("stop",u),this.addEventListener("error",d)}}function E_(){return Qh}const R_=1e3,__=1e4;class pb extends J{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(t,i,a){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=arguments.length>4?arguments[4]:void 0;super(t,i,l),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Hh(()=>T(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>T(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(te.Ended,this)},this.reacquireTrack=!1,this.providedByUser=o,this.muteLock=new Ut,this.pauseUpstreamLock=new Ut,this.trackChangeLock=new Ut,this.trackChangeLock.lock().then(u=>T(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(t,!0)}finally{u()}})),this._constraints=t.getConstraints(),a&&(this._constraints=a)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==J.Kind.Video)return;const{width:t,height:i}=this._mediaStreamTrack.getSettings();if(t&&i)return{width:t,height:i}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,i;return(i=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&i!==void 0?i:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(t,i){return T(this,void 0,void 0,function*(){var a;if(t===this._mediaStreamTrack&&!i)return;this._mediaStreamTrack&&(this.attachedElements.forEach(l=>{Es(this._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let o;if(this.processor&&t){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(bs(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),o=this.processor.processedTrack}this.sender&&((a=this.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(yield this.sender.replaceTrack(o??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(l=>{bs(o??t,l)}))})}waitForDimensions(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:R_;return(function*(){var a;if(t.kind===J.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((a=Yt())===null||a===void 0?void 0:a.os)==="iOS"&&(yield wt(10));const o=Date.now();for(;Date.now()-o<i;){const l=t.dimensions;if(l)return l;yield wt(50)}throw new di("unable to get track dimensions after timeout")})()})}setDeviceId(t){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===Yi(t)||(this._constraints.deviceId=t,this.isMuted)?!0:(yield this.restartTrack(),Yi(t)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(t.source===J.Source.ScreenShare)return;const{deviceId:a,groupId:o}=t._mediaStreamTrack.getSettings(),l=t.kind===J.Kind.Audio?"audioinput":"videoinput";return i?kt.getInstance().normalizeDeviceId(l,a,o):a})()})}mute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,i){return T(this,void 0,void 0,function*(){const a=yield this.trackChangeLock.lock();try{if(!this.sender)throw new di("unable to replace an unpublished track");let o,l;return typeof i=="boolean"?o=i:i!==void 0&&(o=i.userProvidedTrack,l=i.stopProcessor),this.providedByUser=o??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),l&&this.processor&&(yield this.internalStopProcessor()),this}finally{a()}})}restart(t){return T(this,void 0,void 0,function*(){this.manuallyStopped=!1;const i=yield this.trackChangeLock.lock();try{t||(t=this._constraints);const{deviceId:a,facingMode:o}=t,l=XE(t,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const u={audio:!1,video:!1};this.kind===J.Kind.Video?u.video=a||o?{deviceId:a,facingMode:o}:!0:u.audio=a?Object.assign({deviceId:a},l):!0,this.attachedElements.forEach(m=>{Es(this.mediaStreamTrack,m)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const f=(yield navigator.mediaDevices.getUserMedia(u)).getTracks()[0];return this.kind===J.Kind.Video&&(yield f.applyConstraints(l)),f.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(f),this._constraints=t,this.emit(te.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{i()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?te.Muted:te.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),rb()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(te.UpstreamPaused,this);const a=Yt();if((a==null?void 0:a.name)==="Safari"&&In(a.version,"12.0")<0)throw new Bh("pauseUpstream is not supported on Safari < 12.");((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{i()}})}resumeUpstream(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(te.UpstreamResumed,this),((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{i()}})}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;const u=yield a.trackChangeLock.lock();try{a.log.debug("setting up processor",a.logContext);const d=document.createElement(a.kind),f={kind:a.kind,track:a._mediaStreamTrack,element:d,audioContext:a.audioContext};if(yield i.init(f),a.log.debug("processor initialized",a.logContext),a.processor&&(yield a.internalStopProcessor()),a.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(bs(a._mediaStreamTrack,d),d.muted=!0,d.play().catch(m=>{m instanceof DOMException&&m.name==="AbortError"?(a.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},a.logContext),{error:m})),setTimeout(()=>{d.play().catch(g=>{a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{err:g}))})},100)):a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{error:m}))}),a.processor=i,a.processorElement=d,a.processor.processedTrack){for(const m of a.attachedElements)m!==a.processorElement&&o&&(Es(a._mediaStreamTrack,m),bs(a.processor.processedTrack,m));yield(l=a.sender)===null||l===void 0?void 0:l.replaceTrack(a.processor.processedTrack)}a.emit(te.TrackProcessorUpdate,a.processor)}finally{u()}})()})}getProcessor(){return this.processor}stopProcessor(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const a=yield t.trackChangeLock.lock();try{yield t.internalStopProcessor(i)}finally{a()}})()})}internalStopProcessor(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var a,o;t.processor&&(t.log.debug("stopping processor",t.logContext),(a=t.processor.processedTrack)===null||a===void 0||a.stop(),yield t.processor.destroy(),t.processor=void 0,i||((o=t.processorElement)===null||o===void 0||o.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(te.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!E_()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let i="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(i)||(i="video/mp4"),this.localTrackRecorder=new k_(this,{mimeType:i})}this.localTrackRecorder.start(t),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},__)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.byteStream}getPreConnectBufferMimeType(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.mimeType}}class Fc extends pb{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;super(t,J.Kind.Audio,i,a,l),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let u;try{u=yield this.getSenderStats()}catch(d){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}u&&this.prevStats&&(this._currentBitrate=el(u,this.prevStats)),this.prevStats=u}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(te.AudioTrackFeatureUpdate,this,Ct.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(te.AudioTrackFeatureUpdate,this,Ct.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=o,this.checkForSilence()}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===J.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const a=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Yi(this._constraints.deviceId);return this.source===J.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||a)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this}finally{i()}})}restartTrack(t){return T(this,void 0,void 0,function*(){let i;if(t){const a=qh({audio:t});typeof a.audio!="boolean"&&(i=a.audio)}yield this.restart(i)})}restart(t){const i=Object.create(null,{restart:{get:()=>super.restart}});return T(this,void 0,void 0,function*(){const a=yield i.restart.call(this,t);return this.checkForSilence(),a})}startMonitor(){Kt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Jh)))}setProcessor(t){return T(this,void 0,void 0,function*(){var i;const a=yield this.trackChangeLock.lock();try{if(!Un()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const o={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(o),this.processor=t,this.processor.processedTrack&&(yield(i=this.sender)===null||i===void 0?void 0:i.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(te.TrackProcessorUpdate,this.processor)}finally{a()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return T(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const i=yield this.sender.getStats();let a;return i.forEach(o=>{o.type==="outbound-rtp"&&(a={type:"audio",streamId:o.id,packetsSent:o.packetsSent,packetsLost:o.packetsLost,bytesSent:o.bytesSent,timestamp:o.timestamp,roundTripTime:o.roundTripTime,jitter:o.jitter})}),a})}checkForSilence(){return T(this,void 0,void 0,function*(){const t=yield ib(this);return t&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(te.AudioSilenceDetected)),t})}}function O_(s,t,i){switch(s.kind){case"audio":return new Fc(s,t,!1,void 0,i);case"video":return new Hc(s,t,!1,i);default:throw new di("unsupported track type: ".concat(s.kind))}}const A_=Object.values(Xr),D_=Object.values(rh),M_=Object.values(zh),w_=[Xr.h180,Xr.h360],x_=[rh.h180,rh.h360],N_=s=>[{scaleResolutionDownBy:2,fps:s.encoding.maxFramerate}].map(i=>{var a,o;return new Ke(Math.floor(s.width/i.scaleResolutionDownBy),Math.floor(s.height/i.scaleResolutionDownBy),Math.max(15e4,Math.floor(s.encoding.maxBitrate/(Math.pow(i.scaleResolutionDownBy,2)*(((a=s.encoding.maxFramerate)!==null&&a!==void 0?a:30)/((o=i.fps)!==null&&o!==void 0?o:30))))),i.fps,s.encoding.priority)}),ph=["q","h","f"];function gh(s,t,i,a){var o,l;let u=a==null?void 0:a.videoEncoding;s&&(u=a==null?void 0:a.screenShareEncoding);const d=a==null?void 0:a.simulcast,f=a==null?void 0:a.scalabilityMode,m=a==null?void 0:a.videoCodec;if(!u&&!d&&!f||!t||!i)return[{}];u||(u=L_(s,t,i,m),Re.debug("using video encoding",u));const g=u.maxFramerate,v=new Ke(t,i,u.maxBitrate,u.maxFramerate,u.priority);if(f&&_n(m)){const M=new gb(f),O=[];if(M.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(f));const B=Yt();if(Zr()||Un()||(B==null?void 0:B.name)==="Chrome"&&In(B==null?void 0:B.version,"113")<0){const w=M.suffix=="h"?2:3,X=wR(B);for(let K=0;K<M.spatial;K+=1)O.push({rid:ph[2-K],maxBitrate:u.maxBitrate/Math.pow(w,K),maxFramerate:v.encoding.maxFramerate,scaleResolutionDownBy:X?Math.pow(2,K):void 0});O[0].scalabilityMode=f}else O.push({maxBitrate:u.maxBitrate,maxFramerate:v.encoding.maxFramerate,scalabilityMode:f});return v.encoding.priority&&(O[0].priority=v.encoding.priority,O[0].networkPriority=v.encoding.priority),Re.debug("using svc encoding",{encodings:O}),O}if(!d)return[u];let b=[];s?b=(o=py(a==null?void 0:a.screenShareSimulcastLayers))!==null&&o!==void 0?o:my(s,v):b=(l=py(a==null?void 0:a.videoSimulcastLayers))!==null&&l!==void 0?l:my(s,v);let C;if(b.length>0){const M=b[0];b.length>1&&([,C]=b);const O=Math.max(t,i);if(O>=960&&C)return Bd(t,i,[M,C,v],g);if(O>=480)return Bd(t,i,[M,v],g)}return Bd(t,i,[v])}function P_(s,t,i){var a,o,l,u;if(!i.backupCodec||i.backupCodec===!0||i.backupCodec.codec===i.videoCodec)return;t!==i.backupCodec.codec&&Re.warn("requested a different codec than specified as backup",{serverRequested:t,backup:i.backupCodec.codec}),i.videoCodec=t,i.videoEncoding=i.backupCodec.encoding;const d=s.mediaStreamTrack.getSettings(),f=(a=d.width)!==null&&a!==void 0?a:(o=s.dimensions)===null||o===void 0?void 0:o.width,m=(l=d.height)!==null&&l!==void 0?l:(u=s.dimensions)===null||u===void 0?void 0:u.height;return s.source===J.Source.ScreenShare&&i.simulcast&&(i.simulcast=!1),gh(s.source===J.Source.ScreenShare,f,m,i)}function L_(s,t,i,a){const o=U_(s,t,i);let{encoding:l}=o[0];const u=Math.max(t,i);for(let d=0;d<o.length;d+=1){const f=o[d];if(l=f.encoding,f.width>=u)break}if(a)switch(a){case"av1":case"h265":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.7;break;case"vp9":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.85;break}return l}function U_(s,t,i){if(s)return M_;const a=t>i?t/i:i/t;return Math.abs(a-16/9)<Math.abs(a-4/3)?A_:D_}function my(s,t){if(s)return N_(t);const{width:i,height:a}=t,o=i>a?i/a:a/i;return Math.abs(o-16/9)<Math.abs(o-4/3)?w_:x_}function Bd(s,t,i,a){const o=[];if(i.forEach((l,u)=>{if(u>=ph.length)return;const d=Math.min(s,t),m={rid:ph[u],scaleResolutionDownBy:Math.max(1,d/Math.min(l.width,l.height)),maxBitrate:l.encoding.maxBitrate},g=a&&l.encoding.maxFramerate?Math.min(a,l.encoding.maxFramerate):l.encoding.maxFramerate;g&&(m.maxFramerate=g);const v=Ea()||u===0;l.encoding.priority&&v&&(m.priority=l.encoding.priority,m.networkPriority=l.encoding.priority),o.push(m)}),Un()&&cb()==="ios"){let l;o.forEach(d=>{l?d.maxFramerate&&d.maxFramerate>l&&(l=d.maxFramerate):l=d.maxFramerate});let u=!0;o.forEach(d=>{var f;d.maxFramerate!=l&&(u&&(u=!1,Re.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Re.info('Setting framerate of encoding "'.concat((f=d.rid)!==null&&f!==void 0?f:"",'" to ').concat(l)),d.maxFramerate=l)})}return o}function py(s){if(s)return s.sort((t,i)=>{const{encoding:a}=t,{encoding:o}=i;return a.maxBitrate>o.maxBitrate?1:a.maxBitrate<o.maxBitrate?-1:a.maxBitrate===o.maxBitrate&&a.maxFramerate&&o.maxFramerate?a.maxFramerate>o.maxFramerate?1:-1:0})}class gb{constructor(t){const i=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!i)throw new Error("invalid scalability mode");if(this.spatial=parseInt(i[1]),this.temporal=parseInt(i[2]),i.length>3)switch(i[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=i[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function I_(s){return s.source===J.Source.ScreenShare||s.constraints.height&&Yi(s.constraints.height)>=1080?"maintain-resolution":"balanced"}const j_=5e3;class Hc extends pb{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0;super(t,J.Kind.Video,i,a,o),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(f){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:f}));return}const u=new Map(l.map(f=>[f.rid,f])),d=l.some(f=>f.qualityLimitationReason==="cpu");if(d!==this.isCpuConstrained&&(this.isCpuConstrained=d,this.isCpuConstrained&&this.emit(te.CpuConstrained)),this.prevStats){let f=0;u.forEach((m,g)=>{var v;const b=(v=this.prevStats)===null||v===void 0?void 0:v.get(g);f+=el(m,b)}),this._currentBitrate=f}this.prevStats=u}),this.senderLock=new Ut}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var i;if(this.signalClient=t,!Kt())return;const a=(i=this.sender)===null||i===void 0?void 0:i.getParameters();a&&(this.encodings=a.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Jh))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return T(this,void 0,void 0,function*(){var i,a,o,l,u;yield t.pauseUpstream.call(this);try{for(var d=!0,f=ui(this.simulcastCodecs.values()),m;m=yield f.next(),i=m.done,!i;d=!0)l=m.value,d=!1,yield(u=l.sender)===null||u===void 0?void 0:u.replaceTrack(null)}catch(g){a={error:g}}finally{try{!d&&!i&&(o=f.return)&&(yield o.call(f))}finally{if(a)throw a.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return T(this,void 0,void 0,function*(){var i,a,o,l,u;yield t.resumeUpstream.call(this);try{for(var d=!0,f=ui(this.simulcastCodecs.values()),m;m=yield f.next(),i=m.done,!i;d=!0){l=m.value,d=!1;const g=l;yield(u=g.sender)===null||u===void 0?void 0:u.replaceTrack(g.mediaStreamTrack)}}catch(g){a={error:g}}finally{try{!d&&!i&&(o=f.return)&&(yield o.call(f))}finally{if(a)throw a.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===J.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.source===J.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{i()}})}setTrackMuted(t){super.setTrackMuted(t);for(const i of this.simulcastCodecs.values())i.mediaStreamTrack.enabled=!t}getSenderStats(){return T(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const i=[],a=yield this.sender.getStats();return a.forEach(o=>{var l;if(o.type==="outbound-rtp"){const u={type:"video",streamId:o.id,frameHeight:o.frameHeight,frameWidth:o.frameWidth,framesPerSecond:o.framesPerSecond,framesSent:o.framesSent,firCount:o.firCount,pliCount:o.pliCount,nackCount:o.nackCount,packetsSent:o.packetsSent,bytesSent:o.bytesSent,qualityLimitationReason:o.qualityLimitationReason,qualityLimitationDurations:o.qualityLimitationDurations,qualityLimitationResolutionChanges:o.qualityLimitationResolutionChanges,rid:(l=o.rid)!==null&&l!==void 0?l:o.id,retransmittedPacketsSent:o.retransmittedPacketsSent,targetBitrate:o.targetBitrate,timestamp:o.timestamp},d=a.get(o.remoteId);d&&(u.jitter=d.jitter,u.packetsLost=d.packetsLost,u.roundTripTime=d.roundTripTime),i.push(u)}}),i.sort((o,l)=>{var u,d;return((u=l.frameWidth)!==null&&u!==void 0?u:0)-((d=o.frameWidth)!==null&&d!==void 0?d:0)}),i})}setPublishingQuality(t){const i=[];for(let a=sn.LOW;a<=sn.HIGH;a+=1)i.push(new Lh({quality:a,enabled:a<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(_n(this.codec),i)}restartTrack(t){return T(this,void 0,void 0,function*(){var i,a,o,l,u;let d;if(t){const v=qh({video:t});typeof v.video!="boolean"&&(d=v.video)}yield this.restart(d),this.isCpuConstrained=!1;try{for(var f=!0,m=ui(this.simulcastCodecs.values()),g;g=yield m.next(),i=g.done,!i;f=!0){l=g.value,f=!1;const v=l;v.sender&&((u=v.sender.transport)===null||u===void 0?void 0:u.state)!=="closed"&&(v.mediaStreamTrack=this.mediaStreamTrack.clone(),yield v.sender.replaceTrack(v.mediaStreamTrack))}}catch(v){a={error:v}}finally{try{!f&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(a)throw a.error}}})}setProcessor(t){const i=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return T(this,arguments,void 0,function(a){var o=this;let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var u,d,f,m,g,v;if(yield i.setProcessor.call(o,a,l),!((g=o.processor)===null||g===void 0)&&g.processedTrack)try{for(var b=!0,C=ui(o.simulcastCodecs.values()),M;M=yield C.next(),u=M.done,!u;b=!0)m=M.value,b=!1,yield(v=m.sender)===null||v===void 0?void 0:v.replaceTrack(o.processor.processedTrack)}catch(O){d={error:O}}finally{try{!b&&!u&&(f=C.return)&&(yield f.call(C))}finally{if(d)throw d.error}}})()})}setDegradationPreference(t){return T(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const i=this.sender.getParameters();i.degradationPreference=t,this.sender.setParameters(i)}catch(i){this.log.warn("failed to set degradationPreference",Object.assign({error:i},this.logContext))}})}addSimulcastTrack(t,i){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const a={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:i};return this.simulcastCodecs.set(t,a),a}setSimulcastTrackSender(t,i){const a=this.simulcastCodecs.get(t);a&&(a.sender=i,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},j_))}setPublishingCodecs(t){return T(this,void 0,void 0,function*(){var i,a,o,l,u,d,f;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(_n(t[0].codec),t[0].qualities),[];this.subscribedCodecs=t;const m=[];try{for(i=!0,a=ui(t);o=yield a.next(),l=o.done,!l;i=!0){f=o.value,i=!1;const g=f;if(!this.codec||this.codec===g.codec)yield this.setPublishingLayers(_n(g.codec),g.qualities);else{const v=this.simulcastCodecs.get(g.codec);if(this.log.debug("try setPublishingCodec for ".concat(g.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:v})),!v||!v.sender){for(const b of g.qualities)if(b.enabled){m.push(g.codec);break}}else v.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(g.codec),this.logContext),yield gy(v.sender,v.encodings,g.qualities,this.senderLock,_n(g.codec),this.log,this.logContext))}}}catch(g){u={error:g}}finally{try{!i&&!l&&(d=a.return)&&(yield d.call(a))}finally{if(u)throw u.error}}return m})}setPublishingLayers(t,i){return T(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:i}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:i})),!(!this.sender||!this.encodings)&&(yield gy(this.sender,this.encodings,i,this.senderLock,t,this.log,this.logContext))})}prioritizePerformance(){return T(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const t=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const i=this.sender.getParameters();i.encodings=i.encodings.map((a,o)=>{var l;return Object.assign(Object.assign({},a),{active:o===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((l=this.mediaStreamTrack.getSettings().height)!==null&&l!==void 0?l:360)/360)),scalabilityMode:o===0&&_n(this.codec)?"L1T3":void 0,maxFramerate:o===0?15:0,maxBitrate:o===0?a.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:i.encodings})),this.encodings=i.encodings,yield this.sender.setParameters(i)}catch(i){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:i})),this.optimizeForPerformance=!1}finally{t()}})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),rb()&&this.isInBackground&&this.source===J.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function gy(s,t,i,a,o,l,u){return T(this,void 0,void 0,function*(){const d=yield a.lock();l.debug("setPublishingLayersForSender",Object.assign(Object.assign({},u),{sender:s,qualities:i,senderEncodings:t}));try{const f=s.getParameters(),{encodings:m}=f;if(!m)return;if(m.length!==t.length){l.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},u),{encodings:m,senderEncodings:t}));return}let g=!1;!1&&m[0].scalabilityMode||(o&&i.some(C=>C.enabled)&&i.forEach(C=>C.enabled=!0),m.forEach((b,C)=>{var M;let O=(M=b.rid)!==null&&M!==void 0?M:"";O===""&&(O="q");const B=vb(O),w=i.find(X=>X.quality===B);w&&b.active!==w.enabled&&(g=!0,b.active=w.enabled,l.debug("setting layer ".concat(w.quality," to ").concat(b.active?"enabled":"disabled"),u),Ea()&&(w.enabled?(b.scaleResolutionDownBy=t[C].scaleResolutionDownBy,b.maxBitrate=t[C].maxBitrate,b.maxFrameRate=t[C].maxFrameRate):(b.scaleResolutionDownBy=4,b.maxBitrate=10,b.maxFrameRate=2)))})),g&&(f.encodings=m,l.debug("setting encodings",Object.assign(Object.assign({},u),{encodings:f.encodings})),yield s.setParameters(f))}finally{d()}})}function vb(s){switch(s){case"f":return sn.HIGH;case"h":return sn.MEDIUM;case"q":return sn.LOW;default:return sn.HIGH}}function vy(s,t,i,a){if(!i)return[new Ki({quality:sn.HIGH,width:s,height:t,bitrate:0,ssrc:0})];if(a){const o=i[0].scalabilityMode,l=new gb(o),u=[],d=l.suffix=="h"?1.5:2,f=l.suffix=="h"?2:3;for(let m=0;m<l.spatial;m+=1)u.push(new Ki({quality:Math.min(sn.HIGH,l.spatial-1)-m,width:Math.ceil(s/Math.pow(d,m)),height:Math.ceil(t/Math.pow(d,m)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(f,m)):0,ssrc:0}));return u}return i.map(o=>{var l,u,d;const f=(l=o.scaleResolutionDownBy)!==null&&l!==void 0?l:1;let m=vb((u=o.rid)!==null&&u!==void 0?u:"");return new Ki({quality:m,width:Math.ceil(s/f),height:Math.ceil(t/f),bitrate:(d=o.maxBitrate)!==null&&d!==void 0?d:0,ssrc:0})})}const yy="_lossy",by="_reliable",B_=2*1e3,zd="leave-reconnect",z_=3e4,q_=8*1024,V_=256*1024;var gn;(function(s){s[s.New=0]="New",s[s.Connected=1]="Connected",s[s.Disconnected=2]="Disconnected",s[s.Reconnecting=3]="Reconnecting",s[s.Closed=4]="Closed"})(gn||(gn={}));class F_ extends jn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var i;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=Kh.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=gn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Re,this.reliableDataSequence=1,this.reliableMessageBuffer=new sy,this.reliableReceivedState=new l_(z_),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=a=>T(this,[a],void 0,function(o){var l=this;let{channel:u}=o;return(function*(){if(u){if(u.label===by)l.reliableDCSub=u;else if(u.label===yy)l.lossyDCSub=u;else return;l.log.debug("on data channel ".concat(u.id,", ").concat(u.label),l.logContext),u.onmessage=l.handleDataMessage}})()}),this.handleDataMessage=a=>T(this,void 0,void 0,function*(){var o,l,u,d,f;const m=yield this.dataProcessLock.lock();try{let g;if(a.data instanceof ArrayBuffer)g=a.data;else if(a.data instanceof Blob)g=yield a.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:a.data}));return}const v=Lt.fromBinary(new Uint8Array(g));if(v.sequence>0&&v.participantSid!==""){const b=this.reliableReceivedState.get(v.participantSid);if(b&&v.sequence<=b)return;this.reliableReceivedState.set(v.participantSid,v.sequence)}if(((o=v.value)===null||o===void 0?void 0:o.case)==="speaker")this.emit(ie.ActiveSpeakersUpdate,v.value.value.speakers);else if(((l=v.value)===null||l===void 0?void 0:l.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const b=yield(u=this.e2eeManager)===null||u===void 0?void 0:u.handleEncryptedData(v.value.value.encryptedValue,v.value.value.iv,v.participantIdentity,v.value.value.keyIndex),C=t0.fromBinary(b.payload),M=new Lt({value:C.value,participantIdentity:v.participantIdentity,participantSid:v.participantSid});((d=M.value)===null||d===void 0?void 0:d.case)==="user"&&Sy(M,M.value.value),this.emit(ie.DataPacketReceived,M,v.value.value.encryptionType)}else((f=v.value)===null||f===void 0?void 0:f.case)==="user"&&Sy(v,v.value.value),this.emit(ie.DataPacketReceived,v,bt.NONE)}finally{m()}}),this.handleDataError=a=>{const l=a.currentTarget.maxRetransmits===0?"lossy":"reliable";if(a instanceof ErrorEvent&&a.error){const{error:u}=a.error;this.log.error("DataChannel error on ".concat(l,": ").concat(a.message),Object.assign(Object.assign({},this.logContext),{error:u}))}else this.log.error("Unknown DataChannel error on ".concat(l),Object.assign(Object.assign({},this.logContext),{event:a}))},this.handleBufferedAmountLow=a=>{const l=a.currentTarget.maxRetransmits===0?Oe.LOSSY:Oe.RELIABLE;this.updateAndEmitDCBufferStatus(l)},this.handleDisconnect=(a,o)=>{if(this._isClosed)return;this.log.warn("".concat(a," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const l=f=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(f,"ms. giving up"),this.logContext),this.emit(ie.Disconnected),this.close()},u=Date.now()-this.reconnectStart;let d=this.getNextRetryDelay({elapsedMs:u,retryCount:this.reconnectAttempts});if(d===null){l(u);return}a===zd&&(d=0),this.log.debug("reconnecting in ".concat(d,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Mt.setTimeout(()=>this.attemptReconnect(o).finally(()=>this.reconnectTimeout=void 0),d)},this.waitForRestarted=()=>new Promise((a,o)=>{this.pcState===gn.Connected&&a();const l=()=>{this.off(ie.Disconnected,u),a()},u=()=>{this.off(ie.Restarted,l),o()};this.once(ie.Restarted,l),this.once(ie.Disconnected,u)}),this.updateAndEmitDCBufferStatus=a=>{if(a===Oe.RELIABLE){const l=this.dataChannelForKind(a);l&&this.reliableMessageBuffer.alignBufferedAmount(l.bufferedAmount)}const o=this.isBufferStatusLow(a);typeof o<"u"&&o!==this.dcBufferStatus.get(a)&&(this.dcBufferStatus.set(a,o),this.emit(ie.DCBufferStatusChanged,o,a))},this.isBufferStatusLow=a=>{const o=this.dataChannelForKind(a);if(o)return o.bufferedAmount<=o.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>T(this,void 0,void 0,function*(){!this.url||!(yield fetch(Wr(this.url),{method:"HEAD"}).then(o=>o.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Qe.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Qe.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Ta.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>T(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Wr(this.url),{method:"HEAD"}),wt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=hi((i=t.loggerName)!==null&&i!==void 0?i:An.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new Vh(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Ut,this.dataProcessLock=new Ut,this.dcBufferStatus=new Map([[Oe.LOSSY,!0],[Oe.RELIABLE,!0]]),this.client.onParticipantUpdate=a=>this.emit(ie.ParticipantUpdate,a),this.client.onConnectionQuality=a=>this.emit(ie.ConnectionQualityUpdate,a),this.client.onRoomUpdate=a=>this.emit(ie.RoomUpdate,a),this.client.onSubscriptionError=a=>this.emit(ie.SubscriptionError,a),this.client.onSubscriptionPermissionUpdate=a=>this.emit(ie.SubscriptionPermissionUpdate,a),this.client.onSpeakersChanged=a=>this.emit(ie.SpeakersChanged,a),this.client.onStreamStateUpdate=a=>this.emit(ie.StreamStateChanged,a),this.client.onRequestResponse=a=>this.emit(ie.SignalRequestResponse,a)}get logContext(){var t,i,a,o,l,u;return{room:(i=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||i===void 0?void 0:i.name,roomID:(o=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.room)===null||o===void 0?void 0:o.sid,participant:(u=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||u===void 0?void 0:u.identity,pID:this.participantSid}}join(t,i,a,o){return T(this,void 0,void 0,function*(){this.url=t,this.token=i,this.signalOpts=a,this.maxJoinAttempts=a.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const l=yield this.client.join(t,i,a,o);return this._isClosed=!1,this.latestJoinResponse=l,this.subscriberPrimary=l.subscriberPrimary,this.pcManager||(yield this.configure(l)),(!this.subscriberPrimary||l.fastPublish)&&this.negotiate().catch(u=>{Re.error(u,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=l.clientConfiguration,this.emit(ie.SignalConnected,l),l}catch(l){if(l instanceof be&&l.reason===We.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(t,i,a,o);throw l}})}close(){return T(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(ie.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return T(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const i=a=>{a&&(a.close(),a.onbufferedamountlow=null,a.onclose=null,a.onclosing=null,a.onerror=null,a.onmessage=null,a.onopen=null)};i(this.lossyDC),i(this.lossyDCSub),i(this.reliableDC),i(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new sy,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return T(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new di("a track with the same ID has already been published");return new Promise((i,a)=>{const o=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],a(be.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:l=>{clearTimeout(o),i(l)},reject:()=>{clearTimeout(o),a(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:i}=this.pendingTrackResolvers[t.track.id];i&&i(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(i){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:i}))}return!1}updateMuteStatus(t,i){this.client.sendMuteTrack(t,i)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return T(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t){return T(this,void 0,void 0,function*(){var i,a;if(this.pcManager&&this.pcManager.currentState!==st.NEW)return;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid;const o=this.makeRTCConfiguration(t);this.pcManager=new y_(o,this.options.singlePeerConnection?"publisher-only":t.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(ie.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(l,u)=>{this.client.sendIceCandidate(l,u)},this.pcManager.onPublisherOffer=(l,u)=>{this.client.sendOffer(l,u)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(l,u,d)=>T(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(l),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),l===st.CONNECTED){const g=this.pcState===gn.New;this.pcState=gn.Connected,g&&this.emit(ie.Connected,t)}else l===st.FAILED&&(this.pcState===gn.Connected||this.pcState===gn.Reconnecting)&&(this.pcState=gn.Disconnected,this.handleDisconnect("peerconnection failed",d==="failed"?Ta.RR_SUBSCRIBER_FAILED:Ta.RR_PUBLISHER_FAILED));const f=this.client.isDisconnected||this.client.currentState===Qe.RECONNECTING,m=[st.FAILED,st.CLOSING,st.CLOSED].includes(l);f&&m&&!this._isClosed&&this.emit(ie.Offline)}),this.pcManager.onTrack=l=>{l.streams.length!==0&&this.emit(ie.MediaTrackAdded,l.track,l.streams[0],l.receiver)},H_((a=t.serverInfo)===null||a===void 0?void 0:a.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(t,i,a)=>T(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,midToTrackId:a})),this.midToTrackId=a,yield this.pcManager.setPublisherAnswer(t,i))}),this.client.onTrickle=(t,i)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:i})),this.pcManager.addIceCandidate(t,i))},this.client.onOffer=(t,i,a)=>T(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=i,!this.pcManager)return;this.midToTrackId=a;const o=yield this.pcManager.createSubscriberAnswerFromOffer(t,i);o&&this.client.sendAnswer(o,i)}),this.client.onLocalTrackPublished=t=>{var i;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(i=t.track)===null||i===void 0?void 0:i.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:a}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],a(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(ie.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(ie.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{var i;this.token=t,(i=this.regionUrlProvider)===null||i===void 0||i.updateToken(t)},this.client.onRemoteMuteChanged=(t,i)=>{this.emit(ie.RemoteMute,t,i)},this.client.onSubscribedQualityUpdate=t=>{this.emit(ie.SubscribedQualityUpdate,t)},this.client.onRoomMoved=t=>{var i;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=t.room),this.emit(ie.RoomMoved,t)},this.client.onMediaSectionsRequirement=t=>{var i,a;const o={direction:"recvonly"};for(let l=0;l<t.numAudios;l++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("audio",o);for(let l=0;l<t.numVideos;l++)(a=this.pcManager)===null||a===void 0||a.addPublisherTransceiverOfKind("video",o);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Ta.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t==null?void 0:t.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:fb,regionSettings:t.regions})),t.action){case Cs.DISCONNECT:this.emit(ie.Disconnected,t==null?void 0:t.reason),this.close();break;case Cs.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(zd);break;case Cs.RESUME:this.handleDisconnect(zd)}}}makeRTCConfiguration(t){var i;const a=Object.assign({},this.rtcConfig);if(!((i=this.signalOpts)===null||i===void 0)&&i.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),a.encodedInsertableStreams=!0),t.iceServers&&!a.iceServers){const o=[];t.iceServers.forEach(l=>{const u={urls:l.urls};l.username&&(u.username=l.username),l.credential&&(u.credential=l.credential),o.push(u)}),a.iceServers=o}return t.clientConfiguration&&t.clientConfiguration.forceRelay===Yr.ENABLED&&(a.iceTransportPolicy="relay"),a.sdpSemantics="unified-plan",a.continualGatheringPolicy="gather_continually",a}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(yy,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(by,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const t=this.dataChannelForKind(Oe.LOSSY);if(t){const i=this.lossyDataStatByterate/10;t.bufferedAmountLowThreshold=Math.min(Math.max(i,q_),V_)}},1e3))}createSender(t,i,a){return T(this,void 0,void 0,function*(){if(lh())return yield this.createTransceiverRTCRtpSender(t,i,a);if(uh())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new yt("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,i,a,o){return T(this,void 0,void 0,function*(){if(lh())return this.createSimulcastTransceiverSender(t,i,a,o);if(uh())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new yt("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,i,a){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new yt("publisher is closed");const o=[];t.mediaStream&&o.push(t.mediaStream),Wi(t)&&(t.codec=i.videoCodec);const l={direction:"sendonly",streams:o};return a&&(l.sendEncodings=a),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,l)).sender})}createSimulcastTransceiverSender(t,i,a,o){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new yt("publisher is closed");const l={direction:"sendonly"};o&&(l.sendEncodings=o);const u=yield this.pcManager.addPublisherTransceiver(i.mediaStreamTrack,l);if(a.videoCodec)return t.setSimulcastTrackSender(a.videoCodec,u.sender),u.sender})}createRTCRtpSender(t){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new yt("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return T(this,void 0,void 0,function*(){var i,a,o;if(!this._isClosed){if(this.attemptingReconnect){Re.warn("already attempting reconnect, returning early",this.logContext);return}(((i=this.clientConfiguration)===null||i===void 0?void 0:i.resumeConnection)===Yr.DISABLED||((o=(a=this.pcManager)===null||a===void 0?void 0:a.currentState)!==null&&o!==void 0?o:st.NEW)===st.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(l){this.reconnectAttempts+=1;let u=!0;l instanceof yt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:l})),u=!1):l instanceof vs||(this.fullReconnectOnNext=!0),u?this.handleDisconnect("reconnect",Ta.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(ie.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(i){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:i}))}return null}restartConnection(t){return T(this,void 0,void 0,function*(){var i,a,o;try{if(!this.url||!this.token)throw new yt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(ie.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let l;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new vs;l=yield this.join(t??this.url,this.token,this.signalOpts)}catch(u){throw u instanceof be&&u.reason===We.NotAllowed?new yt("could not reconnect, token might be expired"):new vs}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(ie.SignalRestarted,l),yield this.waitForPCReconnected(),this.client.currentState!==Qe.CONNECTED)throw new vs("Signal connection got severed during reconnect");(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),this.emit(ie.Restarted)}catch(l){const u=yield(a=this.regionUrlProvider)===null||a===void 0?void 0:a.getNextBestRegionUrl();if(u){yield this.restartConnection(u);return}else throw(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),l}})}resumeConnection(t){return T(this,void 0,void 0,function*(){var i;if(!this.url||!this.token)throw new yt("could not reconnect, url or token not saved");if(!this.pcManager)throw new yt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(ie.Resuming);let a;try{this.setupSignalClientCallbacks(),a=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(o){let l="";throw o instanceof Error&&(l=o.message,this.log.error(o.message,Object.assign(Object.assign({},this.logContext),{error:o}))),o instanceof be&&o.reason===We.NotAllowed?new yt("could not reconnect, token might be expired"):o instanceof be&&o.reason===We.LeaveRequest?o:new vs(l)}if(this.emit(ie.SignalResumed),a){const o=this.makeRTCConfiguration(a);this.pcManager.updateConfiguration(o),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=a.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Qe.CONNECTED)throw new vs("Signal connection got severed during reconnect");this.client.setReconnected(),((i=this.reliableDC)===null||i===void 0?void 0:i.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),a!=null&&a.lastMessageSeq&&this.resendReliableMessagesForResume(a.lastMessageSeq),this.emit(ie.Resumed)})}waitForPCInitialConnection(t,i){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new yt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(i,t)})}waitForPCReconnected(){return T(this,void 0,void 0,function*(){this.pcState=gn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield wt(B_),!this.pcManager)throw new yt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=gn.Connected}catch(t){throw this.pcState=gn.Disconnected,be.internal("could not establish PC connection, ".concat(t.message))}})}publishRpcResponse(t,i,a,o){return T(this,void 0,void 0,function*(){const l=new Lt({destinationIdentities:[t],kind:Oe.RELIABLE,value:{case:"rpcResponse",value:new wh({requestId:i,value:o?{case:"error",value:o.toProto()}:{case:"payload",value:a??""}})}});yield this.sendDataPacket(l,Oe.RELIABLE)})}publishRpcAck(t,i){return T(this,void 0,void 0,function*(){const a=new Lt({destinationIdentities:[t],kind:Oe.RELIABLE,value:{case:"rpcAck",value:new Mh({requestId:i})}});yield this.sendDataPacket(a,Oe.RELIABLE)})}sendDataPacket(t,i){return T(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(i),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const l=WR(t);if(l){const u=yield this.e2eeManager.encryptData(l.toBinary());t.value={case:"encryptedPacket",value:new e0({encryptedValue:u.payload,iv:u.iv,keyIndex:u.keyIndex})}}}i===Oe.RELIABLE&&(t.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const a=t.toBinary(),o=this.dataChannelForKind(i);if(o){if(i===Oe.RELIABLE)yield this.waitForBufferStatusLow(i),this.reliableMessageBuffer.push({data:a,sequence:t.sequence});else{if(!this.isBufferStatusLow(i)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=a.byteLength}if(this.attemptingReconnect)return;o.send(a)}this.updateAndEmitDCBufferStatus(i)})}resendReliableMessagesForResume(t){return T(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Oe.RELIABLE);const i=this.dataChannelForKind(Oe.RELIABLE);i&&(this.reliableMessageBuffer.popToSequence(t),this.reliableMessageBuffer.getAll().forEach(a=>{i.send(a.data)})),this.updateAndEmitDCBufferStatus(Oe.RELIABLE)})}waitForBufferStatusLow(t){return new Promise((i,a)=>T(this,void 0,void 0,function*(){if(this.isBufferStatusLow(t))i();else{const o=()=>a("Engine closed");for(this.once(ie.Closing,o);!this.dcBufferStatus.get(t);)yield wt(10);this.off(ie.Closing,o),i()}}))}ensureDataTransportConnected(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var l;if(!a.pcManager)throw new yt("PC manager is closed");const u=o?a.pcManager.subscriber:a.pcManager.publisher,d=o?"Subscriber":"Publisher";if(!u)throw be.internal("".concat(d," connection not set"));let f=!1;!o&&!a.dataChannelForKind(i,o)&&(a.createDataChannels(),f=!0),!f&&!o&&!a.pcManager.publisher.isICEConnected&&a.pcManager.publisher.getICEConnectionState()!=="checking"&&(f=!0),f&&a.negotiate().catch(v=>{Re.error(v,a.logContext)});const m=a.dataChannelForKind(i,o);if((m==null?void 0:m.readyState)==="open")return;const g=new Date().getTime()+a.peerConnectionTimeout;for(;new Date().getTime()<g;){if(u.isICEConnected&&((l=a.dataChannelForKind(i,o))===null||l===void 0?void 0:l.readyState)==="open")return;yield wt(50)}throw be.internal("could not establish ".concat(d," connection, state: ").concat(u.getICEConnectionState()))})()})}ensurePublisherConnected(t){return T(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==st.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return T(this,void 0,void 0,function*(){return new Promise((t,i)=>T(this,void 0,void 0,function*(){if(!this.pcManager){i(new ah("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const a=new AbortController,o=()=>{a.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&i("cannot negotiate on closed engine"),this.on(ie.Closing,o),this.pcManager.publisher.once(Os.RTPVideoPayloadTypes,l=>{const u=new Map;l.forEach(d=>{const f=d.codec.toLowerCase();UR(f)&&u.set(d.payload,f)}),this.emit(ie.RTPVideoMapUpdate,u)});try{yield this.pcManager.negotiate(a),t()}catch(l){l instanceof ah&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Ta.RR_UNKNOWN),i(l)}finally{this.off(ie.Closing,o)}}))})}dataChannelForKind(t,i){if(i){if(t===Oe.LOSSY)return this.lossyDCSub;if(t===Oe.RELIABLE)return this.reliableDCSub}else{if(t===Oe.LOSSY)return this.lossyDC;if(t===Oe.RELIABLE)return this.reliableDC}}sendSyncState(t,i){var a,o,l,u;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const d=this.pcManager.publisher.getLocalDescription(),f=this.pcManager.publisher.getRemoteDescription(),m=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getRemoteDescription(),g=(o=this.pcManager.subscriber)===null||o===void 0?void 0:o.getLocalDescription(),v=(u=(l=this.signalOpts)===null||l===void 0?void 0:l.autoSubscribe)!==null&&u!==void 0?u:!0,b=new Array,C=new Array;t.forEach(M=>{M.isDesired!==v&&b.push(M.trackSid),M.isEnabled||C.push(M.trackSid)}),this.client.sendSyncState(new Uh({answer:this.options.singlePeerConnection?f?Ss({sdp:f.sdp,type:f.type}):void 0:g?Ss({sdp:g.sdp,type:g.type}):void 0,offer:this.options.singlePeerConnection?d?Ss({sdp:d.sdp,type:d.type}):void 0:m?Ss({sdp:m.sdp,type:m.type}):void 0,subscription:new Zc({trackSids:b,subscribe:!v,participantTracks:[]}),publishTracks:bR(i),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:C,datachannelReceiveStates:this.reliableReceivedState.map((M,O)=>new S0({publisherSid:O,lastSeq:M}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],i=(a,o)=>{(a==null?void 0:a.id)!==void 0&&a.id!==null&&t.push(new T0({label:a.label,id:a.id,target:o}))};return i(this.dataChannelForKind(Oe.LOSSY),Rn.PUBLISHER),i(this.dataChannelForKind(Oe.RELIABLE),Rn.PUBLISHER),i(this.dataChannelForKind(Oe.LOSSY,!0),Rn.SUBSCRIBER),i(this.dataChannelForKind(Oe.RELIABLE,!0),Rn.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&Mt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Kt()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Kt()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(t){var i;const a=(i=this.pcManager)===null||i===void 0?void 0:i.getMidForReceiver(t);if(a){const o=Object.entries(this.midToTrackId).find(l=>{let[u]=l;return u===a});if(o)return o[1]}}}function H_(s){return s!==void 0&&s>13}function Sy(s,t){const i=s.participantIdentity?s.participantIdentity:t.participantIdentity;s.participantIdentity=i,t.participantIdentity=i;const a=s.destinationIdentities.length!==0?s.destinationIdentities:t.destinationIdentities;s.destinationIdentities=a,t.destinationIdentities=a}class yb{get info(){return this._info}validateBytesReceived(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(t&&this.bytesReceived<this.totalByteSize)throw new vn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Pt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new vn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Pt.LengthExceeded)}}constructor(t,i,a,o){this.reader=i,this.totalByteSize=a,this._info=t,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=o}}class G_ extends yb{handleChunkReceived(t){var i;this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const a=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,a)}[Symbol.asyncIterator](){const t=this.reader.getReader();let i=new yn,a=null,o=null;if(this.signal){const u=this.signal;o=()=>{var d;(d=i.reject)===null||d===void 0||d.call(i,u.reason)},u.addEventListener("abort",o),a=u}const l=()=>{t.releaseLock(),a&&o&&a.removeEventListener("abort",o),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var u,d;try{const{done:f,value:m}=yield Promise.race([t.read(),i.promise,(d=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&d!==void 0?d:new Promise(()=>{})]);return f?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(m),{done:!1,value:m.content})}catch(f){throw l(),f}}),return(){return T(this,void 0,void 0,function*(){return l(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,o,l,u;let d=new Set;const f=i.signal?t.withAbortSignal(i.signal):t;try{for(var m=!0,g=ui(f),v;v=yield g.next(),a=v.done,!a;m=!0){u=v.value,m=!1;const b=u;d.add(b)}}catch(b){o={error:b}}finally{try{!m&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}return Array.from(d)})()})}}class K_ extends yb{constructor(t,i,a,o){super(t,i,a,o),this.receivedChunks=new Map}handleChunkReceived(t){var i;const a=Nc(t.chunkIndex),o=this.receivedChunks.get(a);if(o&&o.version>t.version)return;this.receivedChunks.set(a,t),this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const l=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,l)}[Symbol.asyncIterator](){const t=this.reader.getReader(),i=new TextDecoder("utf-8",{fatal:!0});let a=new yn,o=null,l=null;if(this.signal){const d=this.signal;l=()=>{var f;(f=a.reject)===null||f===void 0||f.call(a,d.reason)},d.addEventListener("abort",l),o=d}const u=()=>{t.releaseLock(),o&&l&&o.removeEventListener("abort",l),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var d,f;try{const{done:m,value:g}=yield Promise.race([t.read(),a.promise,(f=(d=this.outOfBandFailureRejectingFuture)===null||d===void 0?void 0:d.promise)!==null&&f!==void 0?f:new Promise(()=>{})]);if(m)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(g);let v;try{v=i.decode(g.content)}catch(b){throw new vn("Cannot decode datastream chunk ".concat(g.chunkIndex," as text: ").concat(b),Pt.DecodeFailed)}return{done:!1,value:v}}}catch(m){throw u(),m}}),return(){return T(this,void 0,void 0,function*(){return u(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,o,l,u;let d="";const f=i.signal?t.withAbortSignal(i.signal):t;try{for(var m=!0,g=ui(f),v;v=yield g.next(),a=v.done,!a;m=!0)u=v.value,m=!1,d+=u}catch(b){o={error:b}}finally{try{!m&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}return d})()})}}class Y_{constructor(){this.log=Re,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(t,i){if(this.textStreamHandlers.has(t))throw new vn('A text stream handler for topic "'.concat(t,'" has already been set.'),Pt.HandlerAlreadyRegistered);this.textStreamHandlers.set(t,i)}unregisterTextStreamHandler(t){this.textStreamHandlers.delete(t)}registerByteStreamHandler(t,i){if(this.byteStreamHandlers.has(t))throw new vn('A byte stream handler for topic "'.concat(t,'" has already been set.'),Pt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(t,i)}unregisterByteStreamHandler(t){this.byteStreamHandlers.delete(t)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(t){var i,a,o,l;const u=Array.from(this.textStreamControllers.entries()).filter(f=>f[1].sendingParticipantIdentity===t),d=Array.from(this.byteStreamControllers.entries()).filter(f=>f[1].sendingParticipantIdentity===t);if(u.length>0||d.length>0){const f=new vn("Participant ".concat(t," unexpectedly disconnected in the middle of sending data"),Pt.AbnormalEnd);for(const[m,g]of d)(a=(i=g.outOfBandFailureRejectingFuture).reject)===null||a===void 0||a.call(i,f),this.byteStreamControllers.delete(m);for(const[m,g]of u)(l=(o=g.outOfBandFailureRejectingFuture).reject)===null||l===void 0||l.call(o,f),this.textStreamControllers.delete(m)}}handleDataStreamPacket(t,i){return T(this,void 0,void 0,function*(){switch(t.value.case){case"streamHeader":return this.handleStreamHeader(t.value.value,t.participantIdentity,i);case"streamChunk":return this.handleStreamChunk(t.value.value,i);case"streamTrailer":return this.handleStreamTrailer(t.value.value,i);default:throw new Error('DataPacket of value "'.concat(t.value.case,'" is not data stream related!'))}})}handleStreamHeader(t,i,a){return T(this,void 0,void 0,function*(){var o;if(t.contentHeader.case==="byteHeader"){const l=this.byteStreamHandlers.get(t.topic);if(!l){this.log.debug("ignoring incoming byte stream due to no handler for topic",t.topic);return}let u;const d=new yn;d.promise.catch(g=>{this.log.error(g)});const f={id:t.streamId,name:(o=t.contentHeader.value.name)!==null&&o!==void 0?o:"unknown",mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:Nc(t.timestamp),attributes:t.attributes,encryptionType:a},m=new ReadableStream({start:g=>{if(u=g,this.textStreamControllers.has(t.streamId))throw new vn("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Pt.AlreadyOpened);this.byteStreamControllers.set(t.streamId,{info:f,controller:u,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:d})}});l(new G_(f,m,Nc(t.totalLength),d),{identity:i})}else if(t.contentHeader.case==="textHeader"){const l=this.textStreamHandlers.get(t.topic);if(!l){this.log.debug("ignoring incoming text stream due to no handler for topic",t.topic);return}let u;const d=new yn;d.promise.catch(g=>{this.log.error(g)});const f={id:t.streamId,mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:Number(t.timestamp),attributes:t.attributes,encryptionType:a},m=new ReadableStream({start:g=>{if(u=g,this.textStreamControllers.has(t.streamId))throw new vn("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Pt.AlreadyOpened);this.textStreamControllers.set(t.streamId,{info:f,controller:u,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:d})}});l(new K_(f,m,Nc(t.totalLength),d),{identity:i})}})}handleStreamChunk(t,i){const a=this.byteStreamControllers.get(t.streamId);a&&(a.info.encryptionType!==i?(a.controller.error(new vn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),Pt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(t.streamId)):t.content.length>0&&a.controller.enqueue(t));const o=this.textStreamControllers.get(t.streamId);o&&(o.info.encryptionType!==i?(o.controller.error(new vn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(o.info.encryptionType),Pt.EncryptionTypeMismatch)),this.textStreamControllers.delete(t.streamId)):t.content.length>0&&o.controller.enqueue(t))}handleStreamTrailer(t,i){const a=this.textStreamControllers.get(t.streamId);a&&(a.info.encryptionType!==i?a.controller.error(new vn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),Pt.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),t.attributes),a.controller.close(),this.textStreamControllers.delete(t.streamId)));const o=this.byteStreamControllers.get(t.streamId);o&&(o.info.encryptionType!==i?o.controller.error(new vn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(o.info.encryptionType),Pt.EncryptionTypeMismatch)):(o.info.attributes=Object.assign(Object.assign({},o.info.attributes),t.attributes),o.controller.close()),this.byteStreamControllers.delete(t.streamId))}}class bb{constructor(t,i,a){this.writableStream=t,this.defaultWriter=t.getWriter(),this.onClose=a,this.info=i}write(t){return this.defaultWriter.write(t)}close(){return T(this,void 0,void 0,function*(){var t;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(t=this.onClose)===null||t===void 0||t.call(this)})}}class J_ extends bb{}class Q_ extends bb{}const Ty=15e3;class X_{constructor(t,i){this.engine=t,this.log=i}setupEngine(t){this.engine=t}sendText(t,i){return T(this,void 0,void 0,function*(){var a;const o=crypto.randomUUID(),u=new TextEncoder().encode(t).byteLength,d=(a=i==null?void 0:i.attachments)===null||a===void 0?void 0:a.map(()=>crypto.randomUUID()),f=new Array(d?d.length+1:1).fill(0),m=(v,b)=>{var C;f[b]=v;const M=f.reduce((O,B)=>O+B,0);(C=i==null?void 0:i.onProgress)===null||C===void 0||C.call(i,M)},g=yield this.streamText({streamId:o,totalSize:u,destinationIdentities:i==null?void 0:i.destinationIdentities,topic:i==null?void 0:i.topic,attachedStreamIds:d,attributes:i==null?void 0:i.attributes});return yield g.write(t),m(1,0),yield g.close(),i!=null&&i.attachments&&d&&(yield Promise.all(i.attachments.map((v,b)=>T(this,void 0,void 0,function*(){return this._sendFile(d[b],v,{topic:i.topic,mimeType:v.type,onProgress:C=>{m(C,b+1)}})})))),g.info})}streamText(t){return T(this,void 0,void 0,function*(){var i,a,o;const l=(i=t==null?void 0:t.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),u={id:l,mimeType:"text/plain",timestamp:Date.now(),topic:(a=t==null?void 0:t.topic)!==null&&a!==void 0?a:"",size:t==null?void 0:t.totalSize,attributes:t==null?void 0:t.attributes,encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?bt.GCM:bt.NONE},d=new Bc({streamId:l,mimeType:u.mimeType,topic:u.topic,timestamp:Ca(u.timestamp),totalLength:Ca(t==null?void 0:t.totalSize),attributes:u.attributes,contentHeader:{case:"textHeader",value:new h0({version:t==null?void 0:t.version,attachedStreamIds:t==null?void 0:t.attachedStreamIds,replyToStreamId:t==null?void 0:t.replyToStreamId,operationType:(t==null?void 0:t.type)==="update"?Jd.UPDATE:Jd.CREATE})}}),f=t==null?void 0:t.destinationIdentities,m=new Lt({destinationIdentities:f,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(m,Oe.RELIABLE);let g=0;const v=this.engine,b=new WritableStream({write(O){return T(this,void 0,void 0,function*(){for(const B of VR(O,Ty)){const w=new zc({content:B,streamId:l,chunkIndex:Ca(g)}),X=new Lt({destinationIdentities:f,value:{case:"streamChunk",value:w}});yield v.sendDataPacket(X,Oe.RELIABLE),g+=1}})},close(){return T(this,void 0,void 0,function*(){const O=new qc({streamId:l}),B=new Lt({destinationIdentities:f,value:{case:"streamTrailer",value:O}});yield v.sendDataPacket(B,Oe.RELIABLE)})},abort(O){console.log("Sink error:",O)}});let C=()=>T(this,void 0,void 0,function*(){yield M.close()});v.once(ie.Closing,C);const M=new J_(b,u,()=>this.engine.off(ie.Closing,C));return M})}sendFile(t,i){return T(this,void 0,void 0,function*(){const a=crypto.randomUUID();return yield this._sendFile(a,t,i),{id:a}})}_sendFile(t,i,a){return T(this,void 0,void 0,function*(){var o;const l=yield this.streamBytes({streamId:t,totalSize:i.size,name:i.name,mimeType:(o=a==null?void 0:a.mimeType)!==null&&o!==void 0?o:i.type,topic:a==null?void 0:a.topic,destinationIdentities:a==null?void 0:a.destinationIdentities}),u=i.stream().getReader();for(;;){const{done:d,value:f}=yield u.read();if(d)break;yield l.write(f)}return yield l.close(),l.info})}streamBytes(t){return T(this,void 0,void 0,function*(){var i,a,o,l,u,d;const f=(i=t==null?void 0:t.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),m=t==null?void 0:t.destinationIdentities,g={id:f,mimeType:(a=t==null?void 0:t.mimeType)!==null&&a!==void 0?a:"application/octet-stream",topic:(o=t==null?void 0:t.topic)!==null&&o!==void 0?o:"",timestamp:Date.now(),attributes:t==null?void 0:t.attributes,size:t==null?void 0:t.totalSize,name:(l=t==null?void 0:t.name)!==null&&l!==void 0?l:"unknown",encryptionType:!((u=this.engine.e2eeManager)===null||u===void 0)&&u.isDataChannelEncryptionEnabled?bt.GCM:bt.NONE},v=new Bc({totalLength:Ca((d=g.size)!==null&&d!==void 0?d:0),mimeType:g.mimeType,streamId:f,topic:g.topic,timestamp:Ca(Date.now()),attributes:g.attributes,contentHeader:{case:"byteHeader",value:new f0({name:g.name})}}),b=new Lt({destinationIdentities:m,value:{case:"streamHeader",value:v}});yield this.engine.sendDataPacket(b,Oe.RELIABLE);let C=0;const M=new Ut,O=this.engine,B=this.log,w=new WritableStream({write(K){return T(this,void 0,void 0,function*(){const A=yield M.lock();let _=0;try{for(;_<K.byteLength;){const I=K.slice(_,_+Ty),q=new Lt({destinationIdentities:m,value:{case:"streamChunk",value:new zc({content:I,streamId:f,chunkIndex:Ca(C)})}});yield O.sendDataPacket(q,Oe.RELIABLE),C+=1,_+=I.byteLength}}finally{A()}})},close(){return T(this,void 0,void 0,function*(){const K=new qc({streamId:f}),A=new Lt({destinationIdentities:m,value:{case:"streamTrailer",value:K}});yield O.sendDataPacket(A,Oe.RELIABLE)})},abort(K){B.error("Sink error:",K)}});return new Q_(w,g)})}}class Sb extends J{constructor(t,i,a,o,l){super(t,a,l),this.sid=i,this.receiver=o}get isLocal(){return!1}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?te.Muted:te.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const i=a=>{a.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",i),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(te.Ended,this))};t.addEventListener("removetrack",i)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Jh)),SR()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var i;this.timeSyncHandle=requestAnimationFrame(()=>t());const a=(i=this.receiver)===null||i===void 0?void 0:i.getSynchronizationSources()[0];if(a){const{timestamp:o,rtpTimestamp:l}=a;l&&this.rtpTimestamp!==l&&(this.emit(te.TimeSyncUpdate,{timestamp:o,rtpTimestamp:l}),this.rtpTimestamp=l)}};t()}}class Z_ extends Sb{constructor(t,i,a,o,l,u){super(t,i,J.Kind.Audio,a,u),this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const d=yield this.getReceiverStats();d&&this.prevStats&&this.receiver&&(this._currentBitrate=el(d,this.prevStats)),this.prevStats=d}),this.audioContext=o,this.webAudioPluginNodes=[],l&&(this.sinkId=l.deviceId)}setVolume(t){var i;for(const a of this.attachedElements)this.audioContext?(i=this.gainNode)===null||i===void 0||i.gain.setTargetAtTime(t,0,.1):a.volume=t;Un()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(Un())return 1;let t=0;return this.attachedElements.forEach(i=>{i.volume>t&&(t=i.volume)}),t}setSinkId(t){return T(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(i=>{if(dh(i))return i.setSinkId(t)}))})}attach(t){const i=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&dh(t)&&t.setSinkId(this.sinkId).catch(a=>{this.log.error("Failed to set sink id on remote audio track",a,this.logContext)}),this.audioContext&&i&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let i;return t?(i=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(i=super.detach(),this.disconnectWebAudio()),i}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,i){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(i.srcObject);let a=this.sourceNode;this.webAudioPluginNodes.forEach(o=>{a.connect(o),a=o}),this.gainNode=t.createGain(),a.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(te.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(o=>{this.emit(te.AudioPlaybackFailed,o)})}disconnectWebAudio(){var t,i;(t=this.gainNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i;return t.forEach(a=>{a.type==="inbound-rtp"&&(i={type:"audio",streamId:a.id,timestamp:a.timestamp,jitter:a.jitter,bytesReceived:a.bytesReceived,concealedSamples:a.concealedSamples,concealmentEvents:a.concealmentEvents,silentConcealedSamples:a.silentConcealedSamples,silentConcealmentEvents:a.silentConcealmentEvents,totalAudioEnergy:a.totalAudioEnergy,totalSamplesDuration:a.totalSamplesDuration})}),i})}}const qd=100;class W_ extends Sb{constructor(t,i,a,o,l){super(t,i,J.Kind.Video,a,l),this.elementInfos=[],this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=el(u,this.prevStats)),this.prevStats=u}),this.debouncedHandleResize=Hh(()=>{this.updateDimensions()},qd),this.adaptiveStreamSettings=o}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(t){super.setStreamState(t),this.log.debug("setStreamState",t),this.isAdaptiveStream&&t===J.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(i=>{t?Es(this._mediaStreamTrack,i):bs(this._mediaStreamTrack,i)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(i=>i.element===t)===void 0){const i=new $_(t);this.observeElementInfo(i)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(i=>i===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const i=this.elementInfos.filter(a=>a===t);for(const a of i)a.stopObserving();this.elementInfos=this.elementInfos.filter(a=>a!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let i=[];if(t)return this.stopObservingElement(t),super.detach(t);i=super.detach();for(const a of i)this.stopObservingElement(a);return i}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i,a="",o=new Map;return t.forEach(l=>{l.type==="inbound-rtp"?(a=l.codecId,i={type:"video",streamId:l.id,framesDecoded:l.framesDecoded,framesDropped:l.framesDropped,framesReceived:l.framesReceived,packetsReceived:l.packetsReceived,packetsLost:l.packetsLost,frameWidth:l.frameWidth,frameHeight:l.frameHeight,pliCount:l.pliCount,firCount:l.firCount,nackCount:l.nackCount,jitter:l.jitter,timestamp:l.timestamp,bytesReceived:l.bytesReceived,decoderImplementation:l.decoderImplementation}):l.type==="codec"&&o.set(l.id,l)}),i&&a!==""&&o.get(a)&&(i.mimeType=o.get(a).mimeType),i})}stopObservingElement(t){const i=this.elementInfos.filter(a=>a.element===t);for(const a of i)this.stopObservingElementInfo(a)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(t){var i,a;const o=this.elementInfos.reduce((f,m)=>Math.max(f,m.visibilityChangedAt||0),0),l=!((a=(i=this.adaptiveStreamSettings)===null||i===void 0?void 0:i.pauseVideoInBackground)!==null&&a!==void 0)||a?this.isInBackground:!1,u=this.elementInfos.some(f=>f.pictureInPicture),d=this.elementInfos.some(f=>f.visible)&&!l||u;if(!(this.lastVisible===d&&!t)){if(!d&&Date.now()-o<qd){Mt.setTimeout(()=>{this.updateVisibility()},qd);return}this.lastVisible=d,this.emit(te.VisibilityChanged,d,this)}}updateDimensions(){var t,i;let a=0,o=0;const l=this.getPixelDensity();for(const u of this.elementInfos){const d=u.width()*l,f=u.height()*l;d+f>a+o&&(a=d,o=f)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===a&&((i=this.lastDimensions)===null||i===void 0?void 0:i.height)===o||(this.lastDimensions={width:a,height:o},this.emit(te.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return i==="screen"?Qv():i||(Qv()>2?2:1)}}class $_{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,i){this.onVisibilityChanged=a=>{var o;const{target:l,isIntersecting:u}=a;l===this.element&&(this.isIntersecting=u,this.isPiP=jr(this.element),this.visibilityChangedAt=Date.now(),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this))},this.onEnterPiP=()=>{var a,o,l;(o=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||o===void 0||o.addEventListener("pagehide",this.onLeavePiP),this.isPiP=jr(this.element),(l=this.handleVisibilityChanged)===null||l===void 0||l.call(this)},this.onLeavePiP=()=>{var a;this.isPiP=jr(this.element),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this)},this.element=t,this.isIntersecting=i??vh(t),this.isPiP=Kt()&&jr(t),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var t,i,a;this.isIntersecting=vh(this.element),this.isPiP=jr(this.element),this.element.handleResize=()=>{var o;(o=this.handleResize)===null||o===void 0||o.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Zv().observe(this.element),Xv().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(t=window.documentPictureInPicture)===null||t===void 0||t.addEventListener("enter",this.onEnterPiP),(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var t,i,a,o,l;(t=Zv())===null||t===void 0||t.unobserve(this.element),(i=Xv())===null||i===void 0||i.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(a=window.documentPictureInPicture)===null||a===void 0||a.removeEventListener("enter",this.onEnterPiP),(l=(o=window.documentPictureInPicture)===null||o===void 0?void 0:o.window)===null||l===void 0||l.removeEventListener("pagehide",this.onLeavePiP)}}function jr(s){var t,i;return document.pictureInPictureElement===s?!0:!((t=window.documentPictureInPicture)===null||t===void 0)&&t.window?vh(s,(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window):!1}function vh(s,t){const i=t||window;let a=s.offsetTop,o=s.offsetLeft;const l=s.offsetWidth,u=s.offsetHeight,{hidden:d}=s,{display:f}=getComputedStyle(s);for(;s.offsetParent;)s=s.offsetParent,a+=s.offsetTop,o+=s.offsetLeft;return a<i.pageYOffset+i.innerHeight&&o<i.pageXOffset+i.innerWidth&&a+u>i.pageYOffset&&o+l>i.pageXOffset&&!d&&f!=="none"}class oi extends jn.EventEmitter{constructor(t,i,a,o){var l;super(),this.metadataMuted=!1,this.encryption=bt.NONE,this.log=Re,this.handleMuted=()=>{this.emit(te.Muted)},this.handleUnmuted=()=>{this.emit(te.Unmuted)},this.log=hi((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:An.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=i,this.trackName=a,this.source=J.Source.Unknown}setTrack(t){this.track&&(this.track.off(te.Muted,this.handleMuted),this.track.off(te.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(te.Muted,this.handleMuted),t.on(te.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),Me(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==bt.NONE}get audioTrack(){if(Ln(this.track))return this.track}get videoTrack(){if(Wi(this.track))return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=J.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===J.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(s){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(s.SubscriptionStatus||(s.SubscriptionStatus={})),(function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"})(s.PermissionStatus||(s.PermissionStatus={}))})(oi||(oi={}));class yh extends oi{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,i,a,o){super(t,i.sid,i.name,o),this.track=void 0,this.handleTrackEnded=()=>{this.emit(te.Ended)},this.handleCpuConstrained=()=>{this.track&&Wi(this.track)&&this.emit(te.CpuConstrained,this.track)},this.updateInfo(i),this.setTrack(a)}setTrack(t){this.track&&(this.track.off(te.Ended,this.handleTrackEnded),this.track.off(te.CpuConstrained,this.handleCpuConstrained)),super.setTrack(t),t&&(t.on(te.Ended,this.handleTrackEnded),t.on(te.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return T(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return T(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return T(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return T(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(Ln(this.track)){const i=this.track.getSourceTrackSettings(),a=new Set;return i.autoGainControl&&a.add(Ct.TF_AUTO_GAIN_CONTROL),i.echoCancellation&&a.add(Ct.TF_ECHO_CANCELLATION),i.noiseSuppression&&a.add(Ct.TF_NOISE_SUPPRESSION),i.channelCount&&i.channelCount>1&&a.add(Ct.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||a.add(Ct.TF_NO_DTX),this.track.enhancedNoiseCancellation&&a.add(Ct.TF_ENHANCED_NOISE_CANCELLATION),Array.from(a.values())}else return[]}}function tl(s,t){return T(this,void 0,void 0,function*(){s??(s={});let i=!1;const{audioProcessor:a,videoProcessor:o,optionsWithoutProcessor:l}=sb(s);let u=l.audio,d=l.video;if(a&&typeof l.audio=="object"&&(l.audio.processor=a),o&&typeof l.video=="object"&&(l.video.processor=o),s.audio&&typeof l.audio=="object"&&typeof l.audio.deviceId=="string"){const v=l.audio.deviceId;l.audio.deviceId={exact:v},i=!0,u=Object.assign(Object.assign({},l.audio),{deviceId:{ideal:v}})}if(l.video&&typeof l.video=="object"&&typeof l.video.deviceId=="string"){const v=l.video.deviceId;l.video.deviceId={exact:v},i=!0,d=Object.assign(Object.assign({},l.video),{deviceId:{ideal:v}})}l.audio===!0?l.audio={deviceId:"default"}:typeof l.audio=="object"&&l.audio!==null&&(l.audio=Object.assign(Object.assign({},l.audio),{deviceId:l.audio.deviceId||"default"})),l.video===!0?l.video={deviceId:"default"}:typeof l.video=="object"&&!l.video.deviceId&&(l.video.deviceId="default");const f=nb(l,db,hb),m=qh(f),g=navigator.mediaDevices.getUserMedia(m);l.audio&&(kt.userMediaPromiseMap.set("audioinput",g),g.catch(()=>kt.userMediaPromiseMap.delete("audioinput"))),l.video&&(kt.userMediaPromiseMap.set("videoinput",g),g.catch(()=>kt.userMediaPromiseMap.delete("videoinput")));try{const v=yield g;return yield Promise.all(v.getTracks().map(b=>T(this,void 0,void 0,function*(){const C=b.kind==="audio";let M=C?f.audio:f.video;(typeof M=="boolean"||!M)&&(M={});let O;const B=C?m.audio:m.video;typeof B!="boolean"&&(O=B);const w=b.getSettings().deviceId;O!=null&&O.deviceId&&Yi(O.deviceId)!==w?O.deviceId=w:O||(O={deviceId:w});const X=O_(b,O,t);return X.kind===J.Kind.Video?X.source=J.Source.Camera:X.kind===J.Kind.Audio&&(X.source=J.Source.Microphone),X.mediaStream=v,Ln(X)&&a?yield X.setProcessor(a):Wi(X)&&o&&(yield X.setProcessor(o)),X})))}catch(v){if(!i)throw v;return tl(Object.assign(Object.assign({},s),{audio:u,video:d}),t)}})}function e1(s){return T(this,void 0,void 0,function*(){return(yield tl({audio:!1,video:!0}))[0]})}function t1(s){return T(this,void 0,void 0,function*(){return(yield tl({audio:!0,video:!1}))[0]})}var Vi;(function(s){s.Excellent="excellent",s.Good="good",s.Poor="poor",s.Lost="lost",s.Unknown="unknown"})(Vi||(Vi={}));function n1(s){switch(s){case Br.EXCELLENT:return Vi.Excellent;case Br.GOOD:return Vi.Good;case Br.POOR:return Vi.Poor;case Br.LOST:return Vi.Lost;default:return Vi.Unknown}}class Tb extends jn.EventEmitter{get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===Jr.AGENT}get isActive(){var t;return((t=this.participantInfo)===null||t===void 0?void 0:t.state)===Ts.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,i,a,o,l,u){let d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Jr.STANDARD;var f;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Vi.Unknown,this.log=Re,this.log=hi((f=u==null?void 0:u.loggerName)!==null&&f!==void 0?f:An.Participant),this.loggerOptions=u,this.setMaxListeners(100),this.sid=t,this.identity=i,this.name=a,this.metadata=o,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=d,this._attributes=l??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,i]of this.trackPublications)if(i.source===t)return i}getTrackPublicationByName(t){for(const[,i]of this.trackPublications)if(i.trackName===t)return i}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new yn,this.once(se.Active,()=>{var t,i;(i=(t=this.activeFuture)===null||t===void 0?void 0:t.resolve)===null||i===void 0||i.call(t),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const i=this.getTrackPublication(J.Source.Camera);return!(!((t=i==null?void 0:i.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const i=this.getTrackPublication(J.Source.Microphone);return!(!((t=i==null?void 0:i.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(J.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){var i;return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.state===Ts.ACTIVE&&((i=this.participantInfo)===null||i===void 0?void 0:i.state)!==Ts.ACTIVE&&this.emit(se.Active),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,!0)}_setMetadata(t){const i=this.metadata!==t,a=this.metadata;this.metadata=t,i&&this.emit(se.ParticipantMetadataChanged,a)}_setName(t){const i=this.name!==t;this.name=t,i&&this.emit(se.ParticipantNameChanged,t)}_setAttributes(t){const i=TR(this.attributes,t);this._attributes=t,Object.keys(i).length>0&&this.emit(se.AttributesChanged,i)}setPermissions(t){var i,a,o,l,u,d;const f=this.permissions,m=t.canPublish!==((i=this.permissions)===null||i===void 0?void 0:i.canPublish)||t.canSubscribe!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribe)||t.canPublishData!==((o=this.permissions)===null||o===void 0?void 0:o.canPublishData)||t.hidden!==((l=this.permissions)===null||l===void 0?void 0:l.hidden)||t.recorder!==((u=this.permissions)===null||u===void 0?void 0:u.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((g,v)=>{var b;return g!==((b=this.permissions)===null||b===void 0?void 0:b.canPublishSources[v])})||t.canSubscribeMetrics!==((d=this.permissions)===null||d===void 0?void 0:d.canSubscribeMetrics);return this.permissions=t,m&&this.emit(se.ParticipantPermissionsChanged,f),m}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(se.IsSpeakingChanged,t))}setConnectionQuality(t){const i=this._connectionQuality;this._connectionQuality=n1(t),i!==this._connectionQuality&&this.emit(se.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var t,i;this.activeFuture&&((i=(t=this.activeFuture).reject)===null||i===void 0||i.call(t,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(i=>Ln(i.track)&&i.track.setAudioContext(t))}addTrackPublication(t){t.on(te.Muted,()=>{this.emit(se.TrackMuted,t)}),t.on(te.Unmuted,()=>{this.emit(se.TrackUnmuted,t)});const i=t;switch(i.track&&(i.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case J.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case J.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function i1(s){var t,i,a;if(!s.participantSid&&!s.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new y0({participantIdentity:(t=s.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(i=s.participantSid)!==null&&i!==void 0?i:"",allTracks:(a=s.allowAll)!==null&&a!==void 0?a:!1,trackSids:s.allowedTrackSids||[]})}class a1 extends Tb{constructor(t,i,a,o,l,u){super(t,i,void 0,void 0,void 0,{loggerName:o.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=bt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new yn)},this.handleReconnected=()=>{var d,f;(f=(d=this.reconnectFuture)===null||d===void 0?void 0:d.resolve)===null||f===void 0||f.call(d),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var d,f,m,g,v,b;this.reconnectFuture&&(this.reconnectFuture.promise.catch(C=>this.log.warn(C.message,this.logContext)),(f=(d=this.reconnectFuture)===null||d===void 0?void 0:d.reject)===null||f===void 0||f.call(d,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((g=(m=this.signalConnectedFuture).reject)===null||g===void 0||g.call(m,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(b=(v=this.activeAgentFuture)===null||v===void 0?void 0:v.reject)===null||b===void 0||b.call(v,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=d=>{var f,m;d.participant&&this.updateInfo(d.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new yn),(m=(f=this.signalConnectedFuture).resolve)===null||m===void 0||m.call(f)},this.handleSignalRequestResponse=d=>{const{requestId:f,reason:m,message:g}=d,v=this.pendingSignalRequests.get(f);v&&(m!==Ih.OK&&v.reject(new Hv(g,m)),this.pendingSignalRequests.delete(f))},this.handleDataPacket=d=>{switch(d.value.case){case"rpcResponse":let f=d.value.value,m=null,g=null;f.value.case==="payload"?m=f.value.value:f.value.case==="error"&&(g=ot.fromProto(f.value.value)),this.handleIncomingRpcResponse(f.requestId,m,g);break;case"rpcAck":let v=d.value.value;this.handleIncomingRpcAck(v.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(d=>i1(d)))},this.onTrackUnmuted=d=>{this.onTrackMuted(d,d.isUpstreamPaused)},this.onTrackMuted=(d,f)=>{if(f===void 0&&(f=!0),!d.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Me(d)));return}this.engine.updateMuteStatus(d.sid,f)},this.onTrackUpstreamPaused=d=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Me(d))),this.onTrackMuted(d,!0)},this.onTrackUpstreamResumed=d=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Me(d))),this.onTrackMuted(d,d.isMuted)},this.onTrackFeatureUpdate=d=>{const f=this.audioTrackPublications.get(d.sid);if(!f){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(d.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(f.trackSid,f.getTrackFeatures())},this.onTrackCpuConstrained=(d,f)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Me(f))),this.emit(se.LocalTrackCpuConstrained,d,f)},this.handleSubscribedQualityUpdate=d=>T(this,void 0,void 0,function*(){var f,m,g,v,b;if(!(!((b=this.roomOptions)===null||b===void 0)&&b.dynacast))return;const C=this.videoTrackPublications.get(d.trackSid);if(!C){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:d.trackSid}));return}if(!C.videoTrack)return;const M=yield C.videoTrack.setPublishingCodecs(d.subscribedCodecs);try{for(var O=!0,B=ui(M),w;w=yield B.next(),f=w.done,!f;O=!0){v=w.value,O=!1;const X=v;gR(X)&&(this.log.debug("publish ".concat(X," for ").concat(C.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Me(C))),yield this.publishAdditionalCodecForTrack(C.videoTrack,X,C.options))}}catch(X){m={error:X}}finally{try{!O&&!f&&(g=B.return)&&(yield g.call(B))}finally{if(m)throw m.error}}}),this.handleLocalTrackUnpublished=d=>{const f=this.trackPublications.get(d.trackSid);if(!f){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:d.trackSid}));return}this.unpublishTrack(f.track)},this.handleTrackEnded=d=>T(this,void 0,void 0,function*(){if(d.source===J.Source.ScreenShare||d.source===J.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Me(d))),this.unpublishTrack(d);else if(d.isUserProvided)yield d.mute();else if(ri(d)||zi(d))try{if(Kt())try{const f=yield navigator==null?void 0:navigator.permissions.query({name:d.source===J.Source.Camera?"camera":"microphone"});if(f&&f.state==="denied")throw this.log.warn("user has revoked access to ".concat(d.source),Object.assign(Object.assign({},this.logContext),Me(d))),f.onchange=()=>{f.state!=="denied"&&(d.isMuted||d.restartTrack(),f.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}d.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Me(d))),ri(d)?yield d.restartTrack({deviceId:"default"}):yield d.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Me(d))),yield d.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=a,this.roomOptions=o,this.setupEngine(a),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=l,this.roomOutgoingDataStreamManager=u}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==bt.NONE}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setupEngine(t){var i;this.engine=t,this.engine.on(ie.RemoteMute,(a,o)=>{const l=this.trackPublications.get(a);!l||!l.track||(o?l.mute():l.unmute())}),!((i=this.signalConnectedFuture)===null||i===void 0)&&i.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(ie.Connected,this.handleReconnected).on(ie.SignalConnected,this.handleSignalConnected).on(ie.SignalRestarted,this.handleReconnected).on(ie.SignalResumed,this.handleReconnected).on(ie.Restarting,this.handleReconnecting).on(ie.Resuming,this.handleReconnecting).on(ie.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(ie.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(ie.Closing,this.handleClosing).on(ie.SignalRequestResponse,this.handleSignalRequestResponse).on(ie.DataPacketReceived,this.handleDataPacket)}setMetadata(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return T(this,arguments,void 0,function(i){var a=this;let{metadata:o,name:l,attributes:u}=i;return(function*(){return new Promise((d,f)=>T(a,void 0,void 0,function*(){var m,g;try{let v=!1;const b=yield this.engine.client.sendUpdateLocalMetadata((m=o??this.metadata)!==null&&m!==void 0?m:"",(g=l??this.name)!==null&&g!==void 0?g:"",u),C=performance.now();for(this.pendingSignalRequests.set(b,{resolve:d,reject:M=>{f(M),v=!0},values:{name:l,metadata:o,attributes:u}});performance.now()-C<5e3&&!v;){if((!l||this.name===l)&&(!o||this.metadata===o)&&(!u||Object.entries(u).every(M=>{let[O,B]=M;return this.attributes[O]===B||B===""&&!this.attributes[O]}))){this.pendingSignalRequests.delete(b),d();return}yield wt(50)}f(new Hv("Request to update local metadata timed out","TimeoutError"))}catch(v){v instanceof Error&&f(v)}}))})()})}setCameraEnabled(t,i,a){return this.setTrackEnabled(J.Source.Camera,t,i,a)}setMicrophoneEnabled(t,i,a){return this.setTrackEnabled(J.Source.Microphone,t,i,a)}setScreenShareEnabled(t,i,a){return this.setTrackEnabled(J.Source.ScreenShare,t,i,a)}setE2EEEnabled(t){return T(this,void 0,void 0,function*(){this.encryptionType=t?bt.GCM:bt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,i,a,o){return T(this,void 0,void 0,function*(){var l,u;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:i})),this.republishPromise&&(yield this.republishPromise);let d=this.getTrackPublication(t);if(i)if(d)yield d.unmute();else{let f;if(this.pendingPublishing.has(t)){const m=yield this.waitForPendingPublicationOfSource(t);return m||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),yield m==null?void 0:m.unmute(),m}this.pendingPublishing.add(t);try{switch(t){case J.Source.Camera:f=yield this.createTracks({video:(l=a)!==null&&l!==void 0?l:!0});break;case J.Source.Microphone:f=yield this.createTracks({audio:(u=a)!==null&&u!==void 0?u:!0});break;case J.Source.ScreenShare:f=yield this.createScreenTracks(Object.assign({},a));break;default:throw new di(t)}}catch(m){throw f==null||f.forEach(g=>{g.stop()}),m instanceof Error&&this.emit(se.MediaDevicesError,m,ch(t)),this.pendingPublishing.delete(t),m}for(const m of f){const g=Object.assign(Object.assign({},this.roomOptions.publishDefaults),a);t===J.Source.Microphone&&Ln(m)&&g.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),m.startPreConnectBuffer())}try{const m=[];for(const v of f)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Me(v))),m.push(this.publishTrack(v,o));[d]=yield Promise.all(m)}catch(m){throw f==null||f.forEach(g=>{g.stop()}),m}finally{this.pendingPublishing.delete(t)}}else if(!(d!=null&&d.track)&&this.pendingPublishing.has(t)&&(d=yield this.waitForPendingPublicationOfSource(t),d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}))),d&&d.track)if(t===J.Source.ScreenShare){d=yield this.unpublishTrack(d.track);const f=this.getTrackPublication(J.Source.ScreenShareAudio);f&&f.track&&this.unpublishTrack(f.track)}else yield d.mute();return d})}enableCameraAndMicrophone(){return T(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(J.Source.Camera)||this.pendingPublishing.has(J.Source.Microphone))){this.pendingPublishing.add(J.Source.Camera),this.pendingPublishing.add(J.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(i=>this.publishTrack(i)))}finally{this.pendingPublishing.delete(J.Source.Camera),this.pendingPublishing.delete(J.Source.Microphone)}}})}createTracks(t){return T(this,void 0,void 0,function*(){var i,a;t??(t={});const o=nb(t,(i=this.roomOptions)===null||i===void 0?void 0:i.audioCaptureDefaults,(a=this.roomOptions)===null||a===void 0?void 0:a.videoCaptureDefaults);try{return(yield tl(o,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(d=>(Ln(d)&&(this.microphoneError=void 0,d.setAudioContext(this.audioContext),d.source=J.Source.Microphone,this.emit(se.AudioStreamAcquired)),Wi(d)&&(this.cameraError=void 0,d.source=J.Source.Camera),d))}catch(l){throw l instanceof Error&&(t.audio&&(this.microphoneError=l),t.video&&(this.cameraError=l)),l}})}createScreenTracks(t){return T(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Bh("getDisplayMedia not supported");t.resolution===void 0&&!MR()&&(t.resolution=zh.h1080fps30.resolution);const i=yR(t),a=yield navigator.mediaDevices.getDisplayMedia(i),o=a.getVideoTracks();if(o.length===0)throw new di("no video track found");const l=new Hc(o[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=J.Source.ScreenShare,t.contentHint&&(l.mediaStreamTrack.contentHint=t.contentHint);const u=[l];if(a.getAudioTracks().length>0){this.emit(se.AudioStreamAcquired);const d=new Fc(a.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});d.source=J.Source.ScreenShareAudio,u.push(d)}return u})}publishTrack(t,i){return T(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(t,i)})}publishOrRepublishTrack(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var d,f,m,g;ri(a)&&a.setAudioContext(l.audioContext),yield(d=l.reconnectFuture)===null||d===void 0?void 0:d.promise,l.republishPromise&&!u&&(yield l.republishPromise),Rs(a)&&l.pendingPublishPromises.has(a)&&(yield l.pendingPublishPromises.get(a));let v;if(a instanceof MediaStreamTrack)v=a.getConstraints();else{v=a.constraints;let w;switch(a.source){case J.Source.Microphone:w="audioinput";break;case J.Source.Camera:w="videoinput"}w&&l.activeDeviceMap.has(w)&&(v=Object.assign(Object.assign({},v),{deviceId:l.activeDeviceMap.get(w)}))}if(a instanceof MediaStreamTrack)switch(a.kind){case"audio":a=new Fc(a,v,!0,l.audioContext,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;case"video":a=new Hc(a,v,!0,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;default:throw new di("unsupported MediaStreamTrack kind ".concat(a.kind))}else a.updateLoggerOptions({loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});let b;if(l.trackPublications.forEach(w=>{w.track&&w.track===a&&(b=w)}),b)return l.log.warn("track has already been published, skipping",Object.assign(Object.assign({},l.logContext),Me(b))),b;const C=Object.assign(Object.assign({},l.roomOptions.publishDefaults),o),M="channelCount"in a.mediaStreamTrack.getSettings()&&a.mediaStreamTrack.getSettings().channelCount===2||a.mediaStreamTrack.getConstraints().channelCount===2,O=(f=C.forceStereo)!==null&&f!==void 0?f:M;O&&(C.dtx===void 0&&l.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},l.logContext),Me(a))),C.red===void 0&&l.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(m=C.dtx)!==null&&m!==void 0||(C.dtx=!1),(g=C.red)!==null&&g!==void 0||(C.red=!1)),!xR()&&l.roomOptions.e2ee&&(l.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},l.logContext)),C.simulcast=!1),C.source&&(a.source=C.source);const B=new Promise((w,X)=>T(l,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Qe.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Me(a)}));let K=!1;const A=setTimeout(()=>{K=!0,a.stop(),X(new Fv("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(A),K)return;const _=yield this.publish(a,C,O);w(_)}else try{const K=yield this.publish(a,C,O);w(K)}catch(K){X(K)}}catch(K){X(K)}}));l.pendingPublishPromises.set(a,B);try{return yield B}catch(w){throw w}finally{l.pendingPublishPromises.delete(a)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new yn),this.signalConnectedFuture.promise}hasPermissionsToPublish(t){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Me(t))),!1;const{canPublish:i,canPublishSources:a}=this.permissions;return i&&(a.length===0||a.map(o=>CR(o)).includes(t.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Me(t))),!1)}publish(t,i,a){return T(this,void 0,void 0,function*(){var o,l,u,d,f,m,g,v,b,C;if(!this.hasPermissionsToPublish(t))throw new Fv("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(oe=>Rs(t)&&oe.source===t.source)&&t.source!==J.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),Me(t))),i.stopMicTrackOnMute&&Ln(t)&&(t.stopOnMute=!0),t.source===J.Source.ScreenShare&&Ea()&&(i.simulcast=!1),i.videoCodec==="av1"&&!OR()&&(i.videoCodec=void 0),i.videoCodec==="vp9"&&!AR()&&(i.videoCodec=void 0),i.videoCodec===void 0&&(i.videoCodec=mh),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(oe=>i.videoCodec===Fr(oe.mime))||(i.videoCodec=Fr(this.enabledPublishVideoCodecs[0].mime)));const O=i.videoCodec;t.on(te.Muted,this.onTrackMuted),t.on(te.Unmuted,this.onTrackUnmuted),t.on(te.Ended,this.handleTrackEnded),t.on(te.UpstreamPaused,this.onTrackUpstreamPaused),t.on(te.UpstreamResumed,this.onTrackUpstreamResumed),t.on(te.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const B=[],w=!(!((o=i.dtx)!==null&&o!==void 0)||o),X=t.getSourceTrackSettings();X.autoGainControl&&B.push(Ct.TF_AUTO_GAIN_CONTROL),X.echoCancellation&&B.push(Ct.TF_ECHO_CANCELLATION),X.noiseSuppression&&B.push(Ct.TF_NOISE_SUPPRESSION),X.channelCount&&X.channelCount>1&&B.push(Ct.TF_STEREO),w&&B.push(Ct.TF_NO_DTX),ri(t)&&t.hasPreConnectBuffer&&B.push(Ct.TF_PRECONNECT_BUFFER);const K=new Qr({cid:t.mediaStreamTrack.id,name:i.name,type:J.kindToProto(t.kind),muted:t.isMuted,source:J.sourceToProto(t.source),disableDtx:w,encryption:this.encryptionType,stereo:a,disableRed:this.isE2EEEnabled||!(!((l=i.red)!==null&&l!==void 0)||l),stream:i==null?void 0:i.stream,backupCodecPolicy:i==null?void 0:i.backupCodecPolicy,audioFeatures:B});let A;if(t.kind===J.Kind.Video){let oe={width:0,height:0};try{oe=yield t.waitForDimensions()}catch{const ce=(d=(u=this.roomOptions.videoCaptureDefaults)===null||u===void 0?void 0:u.resolution)!==null&&d!==void 0?d:Xr.h720.resolution;oe={width:ce.width,height:ce.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Me(t)),{dims:oe}))}K.width=oe.width,K.height=oe.height,zi(t)&&(_n(O)&&(t.source===J.Source.ScreenShare&&(i.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Me(t))))),i.scalabilityMode=(f=i.scalabilityMode)!==null&&f!==void 0?f:"L3T3_KEY"),K.simulcastCodecs=[new Xd({codec:O,cid:t.mediaStreamTrack.id})],i.backupCodec===!0&&(i.backupCodec={codec:mh}),i.backupCodec&&O!==i.backupCodec.codec&&K.encryption===bt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),K.simulcastCodecs.push(new Xd({codec:i.backupCodec.codec,cid:""})))),A=gh(t.source===J.Source.ScreenShare,K.width,K.height,i),K.layers=vy(K.width,K.height,A,_n(i.videoCodec))}else t.kind===J.Kind.Audio&&(A=[{maxBitrate:(m=i.audioPreset)===null||m===void 0?void 0:m.maxBitrate,priority:(v=(g=i.audioPreset)===null||g===void 0?void 0:g.priority)!==null&&v!==void 0?v:"high",networkPriority:(C=(b=i.audioPreset)===null||b===void 0?void 0:b.priority)!==null&&C!==void 0?C:"high"}]);if(!this.engine||this.engine.isClosed)throw new yt("cannot publish track when not connected");const _=()=>T(this,void 0,void 0,function*(){var oe,re,ce;if(!this.engine.pcManager)throw new yt("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,i,A),this.emit(se.LocalSenderCreated,t.sender,t),zi(t)&&((oe=i.degradationPreference)!==null&&oe!==void 0||(i.degradationPreference=I_(t)),t.setDegradationPreference(i.degradationPreference)),A)if(Ea()&&t.kind===J.Kind.Audio){let pe;for(const Ve of this.engine.pcManager.publisher.getTransceivers())if(Ve.sender===t.sender){pe=Ve;break}pe&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:pe,codec:"opus",maxbr:!((re=A[0])===null||re===void 0)&&re.maxBitrate?A[0].maxBitrate/1e3:0})}else t.codec&&_n(t.codec)&&(!((ce=A[0])===null||ce===void 0)&&ce.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:K.cid,codec:t.codec,maxbr:A[0].maxBitrate/1e3});yield this.engine.negotiate()});let I;const q=new Promise((oe,re)=>T(this,void 0,void 0,function*(){var ce;try{I=yield this.engine.addTrack(K),oe(I)}catch(pe){t.sender&&(!((ce=this.engine.pcManager)===null||ce===void 0)&&ce.publisher)&&(this.engine.pcManager.publisher.removeTrack(t.sender),yield this.engine.negotiate().catch(Ve=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Me(t)),{error:Ve}))})),re(pe)}}));if(this.enabledPublishVideoCodecs.length>0)I=(yield Promise.all([q,_()]))[0];else{I=yield q;let oe;if(I.codecs.forEach(re=>{oe===void 0&&(oe=re.mimeType)}),oe&&t.kind===J.Kind.Video){const re=Fr(oe);re!==O&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Me(t)),{codec:re})),i.videoCodec=re,A=gh(t.source===J.Source.ScreenShare,K.width,K.height,i))}yield _()}const W=new yh(t.kind,I,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(W.on(te.CpuConstrained,oe=>this.onTrackCpuConstrained(oe,W)),W.options=i,t.sid=I.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:A,trackInfo:I})),zi(t)?t.startMonitor(this.engine.client):ri(t)&&t.startMonitor(),this.addTrackPublication(W),this.emit(se.LocalTrackPublished,W),ri(t)&&I.audioFeatures.includes(Ct.TF_PRECONNECT_BUFFER)){const oe=t.getPreConnectBuffer(),re=t.getPreConnectBufferMimeType();this.on(se.LocalTrackSubscribed,ce=>{if(ce.trackSid===I.sid){if(!t.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Me(t))),t.stopPreConnectBuffer()}}),oe&&new Promise((pe,Ve)=>T(this,void 0,void 0,function*(){var nt,ae,x,$,ue,le;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Me(t)));const ne=setTimeout(()=>{Ve(new Error("agent not active within 10 seconds"))},1e4),ee=yield this.waitUntilActiveAgentPresent();clearTimeout(ne),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Me(t)));const he=yield this.streamBytes({name:"preconnect-buffer",mimeType:re,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[ee.identity],attributes:{trackId:W.trackSid,sampleRate:String((ue=X.sampleRate)!==null&&ue!==void 0?ue:"48000"),channels:String((le=X.channelCount)!==null&&le!==void 0?le:"1")}});try{for(var ye=!0,E=ui(oe),F;F=yield E.next(),nt=F.done,!nt;ye=!0){$=F.value,ye=!1;const Se=$;yield he.write(Se)}}catch(Se){ae={error:Se}}finally{try{!ye&&!nt&&(x=E.return)&&(yield x.call(E))}finally{if(ae)throw ae.error}}yield he.close(),pe()}catch(ne){Ve(ne)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Me(t)))}).catch(pe=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Me(t)),{error:pe}))})}return W})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,i,a){return T(this,void 0,void 0,function*(){var o;if(this.encryptionType!==bt.NONE)return;let l;if(this.trackPublications.forEach(C=>{C.track&&C.track===t&&(l=C)}),!l)throw new di("track is not published");if(!zi(t))throw new di("track is not a video track");const u=Object.assign(Object.assign({},(o=this.roomOptions)===null||o===void 0?void 0:o.publishDefaults),a),d=P_(t,i,u);if(!d){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Me(t)));return}const f=t.addSimulcastTrack(i,d);if(!f)return;const m=new Qr({cid:f.mediaStreamTrack.id,type:J.kindToProto(t.kind),muted:t.isMuted,source:J.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:u.videoCodec,cid:f.mediaStreamTrack.id}]});if(m.layers=vy(m.width,m.height,d),!this.engine||this.engine.isClosed)throw new yt("cannot publish track when not connected");const g=()=>T(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(t,f,u,d),yield this.engine.negotiate()}),b=(yield Promise.all([this.engine.addTrack(m),g()]))[0];this.log.debug("published ".concat(i," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:d,trackInfo:b}))})}unpublishTrack(t,i){return T(this,void 0,void 0,function*(){var a,o;if(Rs(t)){const m=this.pendingPublishPromises.get(t);m&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Me(t))),yield m)}const l=this.getPublicationForTrack(t),u=l?Me(l):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),u)),!l||!l.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),u));return}t=l.track,t.off(te.Muted,this.onTrackMuted),t.off(te.Unmuted,this.onTrackUnmuted),t.off(te.Ended,this.handleTrackEnded),t.off(te.UpstreamPaused,this.onTrackUpstreamPaused),t.off(te.UpstreamResumed,this.onTrackUpstreamResumed),t.off(te.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),i===void 0&&(i=(o=(a=this.roomOptions)===null||a===void 0?void 0:a.stopLocalTrackOnUnpublish)!==null&&o!==void 0?o:!0),i?t.stop():t.stopMonitor();let d=!1;const f=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<st.FAILED&&f)try{for(const m of this.engine.pcManager.publisher.getTransceivers())m.sender===f&&(m.direction="inactive",d=!0);if(this.engine.removeTrack(f)&&(d=!0),zi(t)){for(const[,m]of t.simulcastCodecs)m.sender&&(this.engine.removeTrack(m.sender)&&(d=!0),m.sender=void 0);t.simulcastCodecs.clear()}}catch(m){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),u),{error:m}))}switch(this.trackPublications.delete(l.trackSid),l.kind){case J.Kind.Audio:this.audioTrackPublications.delete(l.trackSid);break;case J.Kind.Video:this.videoTrackPublications.delete(l.trackSid);break}return this.emit(se.LocalTrackUnpublished,l),l.setTrack(void 0),d&&(yield this.engine.negotiate()),l})}unpublishTracks(t){return T(this,void 0,void 0,function*(){return(yield Promise.all(t.map(a=>this.unpublishTrack(a)))).filter(a=>!!a)})}republishAllTracks(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){a.republishPromise&&(yield a.republishPromise),a.republishPromise=new Promise((l,u)=>T(a,void 0,void 0,function*(){try{const d=[];this.trackPublications.forEach(f=>{f.track&&(i&&(f.options=Object.assign(Object.assign({},f.options),i)),d.push(f))}),yield Promise.all(d.map(f=>T(this,void 0,void 0,function*(){const m=f.track;yield this.unpublishTrack(m,!1),o&&!m.isMuted&&m.source!==J.Source.ScreenShare&&m.source!==J.Source.ScreenShareAudio&&(ri(m)||zi(m))&&!m.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:f.trackSid})),yield m.restartTrack()),yield this.publishOrRepublishTrack(m,f.options,!0)}))),l()}catch(d){u(d)}finally{this.republishPromise=void 0}})),yield a.republishPromise})()})}publishData(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const l=o.reliable?Oe.RELIABLE:Oe.LOSSY,u=o.destinationIdentities,d=o.topic;let f=new Ah({participantIdentity:a.identity,payload:i,destinationIdentities:u,topic:d});const m=new Lt({kind:l,value:{case:"user",value:f}});yield a.engine.sendDataPacket(m,l)})()})}publishDtmf(t,i){return T(this,void 0,void 0,function*(){const a=new Lt({kind:Oe.RELIABLE,value:{case:"sipDtmf",value:new i0({code:t,digit:i})}});yield this.engine.sendDataPacket(a,Oe.RELIABLE)})}sendChatMessage(t,i){return T(this,void 0,void 0,function*(){const a={id:crypto.randomUUID(),message:t,timestamp:Date.now(),attachedFiles:i==null?void 0:i.attachments},o=new Lt({value:{case:"chatMessage",value:new jc(Object.assign(Object.assign({},a),{timestamp:et.parse(a.timestamp)}))}});return yield this.engine.sendDataPacket(o,Oe.RELIABLE),this.emit(se.ChatMessage,a),a})}editChatMessage(t,i){return T(this,void 0,void 0,function*(){const a=Object.assign(Object.assign({},i),{message:t,editTimestamp:Date.now()}),o=new Lt({value:{case:"chatMessage",value:new jc(Object.assign(Object.assign({},a),{timestamp:et.parse(a.timestamp),editTimestamp:et.parse(a.editTimestamp)}))}});return yield this.engine.sendDataPacket(o,Oe.RELIABLE),this.emit(se.ChatMessage,a),a})}sendText(t,i){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(t,i)})}streamText(t){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(t)})}sendFile(t,i){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(t,i)})}streamBytes(t){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(t)})}performRpc(t){return T(this,arguments,void 0,function(i){var a=this;let{destinationIdentity:o,method:l,payload:u,responseTimeout:d=15e3}=i;return(function*(){return new Promise((g,v)=>T(a,void 0,void 0,function*(){var b,C,M,O;if(Yh(u)>mb){v(ot.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((C=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||C===void 0)&&C.version&&In((O=(M=this.engine.latestJoinResponse)===null||M===void 0?void 0:M.serverInfo)===null||O===void 0?void 0:O.version,"1.8.0")<0){v(ot.builtIn("UNSUPPORTED_SERVER"));return}const B=Math.max(d,8e3),w=crypto.randomUUID();yield this.publishRpcRequest(o,w,l,u,B);const X=setTimeout(()=>{this.pendingAcks.delete(w),v(ot.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(w),clearTimeout(K)},7e3);this.pendingAcks.set(w,{resolve:()=>{clearTimeout(X)},participantIdentity:o});const K=setTimeout(()=>{this.pendingResponses.delete(w),v(ot.builtIn("RESPONSE_TIMEOUT"))},d);this.pendingResponses.set(w,{resolve:(A,_)=>{clearTimeout(K),this.pendingAcks.has(w)&&(this.log.warn("RPC response received before ack",w),this.pendingAcks.delete(w),clearTimeout(X)),_?v(_):g(A??"")},participantIdentity:o})}))})()})}registerRpcMethod(t,i){this.rpcHandlers.has(t)&&this.log.warn("you're overriding the RPC handler for method ".concat(t,", in the future this will throw an error")),this.rpcHandlers.set(t,i)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setTrackSubscriptionPermissions(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=i,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(t){const i=this.pendingAcks.get(t);i?(i.resolve(),this.pendingAcks.delete(t)):console.error("Ack received for unexpected RPC request",t)}handleIncomingRpcResponse(t,i,a){const o=this.pendingResponses.get(t);o?(o.resolve(i,a),this.pendingResponses.delete(t)):console.error("Response received for unexpected RPC request",t)}publishRpcRequest(t,i,a,o,l){return T(this,void 0,void 0,function*(){const u=new Lt({destinationIdentities:[t],kind:Oe.RELIABLE,value:{case:"rpcRequest",value:new Dh({id:i,method:a,payload:o,responseTimeoutMs:l,version:1})}});yield this.engine.sendDataPacket(u,Oe.RELIABLE)})}handleParticipantDisconnected(t){for(const[i,{participantIdentity:a}]of this.pendingAcks)a===t&&this.pendingAcks.delete(i);for(const[i,{participantIdentity:a,resolve:o}]of this.pendingResponses)a===t&&(o(null,ot.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(i))}setEnabledPublishCodecs(t){this.enabledPublishVideoCodecs=t.filter(i=>i.mime.split("/")[0].toLowerCase()==="video")}updateInfo(t){return super.updateInfo(t)?(t.tracks.forEach(i=>{var a,o;const l=this.trackPublications.get(i.sid);if(l){const u=l.isMuted||((o=(a=l.track)===null||a===void 0?void 0:a.isUpstreamPaused)!==null&&o!==void 0?o:!1);u!==i.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Me(l)),{mutedOnServer:u})),this.engine.client.sendMuteTrack(i.sid,u))}}),!0):!1}setActiveAgent(t){var i,a,o,l;this.firstActiveAgent=t,t&&!this.firstActiveAgent&&(this.firstActiveAgent=t),t?(a=(i=this.activeAgentFuture)===null||i===void 0?void 0:i.resolve)===null||a===void 0||a.call(i,t):(l=(o=this.activeAgentFuture)===null||o===void 0?void 0:o.reject)===null||l===void 0||l.call(o,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new yn),this.activeAgentFuture.promise)}getPublicationForTrack(t){let i;return this.trackPublications.forEach(a=>{const o=a.track;o&&(t instanceof MediaStreamTrack?(ri(o)||zi(o))&&o.mediaStreamTrack===t&&(i=a):t===o&&(i=a))}),i}waitForPendingPublicationOfSource(t){return T(this,void 0,void 0,function*(){const a=Date.now();for(;Date.now()<a+1e4;){const o=Array.from(this.pendingPublishPromises.entries()).find(l=>{let[u]=l;return u.source===t});if(o)return o[1];yield wt(20)}})}}class s1 extends oi{constructor(t,i,a,o){super(t,i.sid,i.name,o),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=l=>{this.setTrack(void 0),this.emit(te.Ended,l)},this.handleVisibilityChange=l=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(l),this.logContext),this.visible=l,this.emitTrackUpdate()},this.handleVideoDimensionsChange=l=>{this.log.debug("adaptivestream video dimensions ".concat(l.width,"x").concat(l.height),this.logContext),this.videoDimensionsAdaptiveStream=l,this.emitTrackUpdate()},this.subscribed=a,this.updateInfo(i)}setSubscribed(t){const i=this.subscriptionStatus,a=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const o=new Zc({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new s0({participantSid:"",trackSids:[this.trackSid]})]});this.emit(te.UpdateSubscription,o),this.emitSubscriptionUpdateIfChanged(i),this.emitPermissionUpdateIfChanged(a)}get subscriptionStatus(){return this.subscribed===!1?oi.SubscriptionStatus.Unsubscribed:super.isSubscribed?oi.SubscriptionStatus.Subscribed:oi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?oi.PermissionStatus.Allowed:oi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(t){!this.isManualOperationAllowed()||this.requestedDisabled===!t||(this.requestedDisabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.requestedMaxQuality===t||(this.requestedMaxQuality=t,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var i,a;this.isManualOperationAllowed()&&(((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.width)===t.width&&((a=this.requestedVideoDimensions)===null||a===void 0?void 0:a.height)===t.height||(Pd(this.track)&&(this.requestedVideoDimensions=t),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&Pd(this.track)&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){var t;return(t=this.requestedMaxQuality)!==null&&t!==void 0?t:sn.HIGH}setTrack(t){const i=this.subscriptionStatus,a=this.permissionStatus,o=this.track;o!==t&&(o&&(o.off(te.VideoDimensionsChanged,this.handleVideoDimensionsChange),o.off(te.VisibilityChanged,this.handleVisibilityChange),o.off(te.Ended,this.handleEnded),o.detach(),o.stopMonitor(),this.emit(te.Unsubscribed,o)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(te.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(te.VisibilityChanged,this.handleVisibilityChange),t.on(te.Ended,this.handleEnded),this.emit(te.Subscribed,t)),this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i))}setAllowed(t){const i=this.subscriptionStatus,a=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i)}setSubscriptionError(t){this.emit(te.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const i=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):i!==t.muted&&this.emit(t.muted?te.Muted:te.Unmuted)}emitSubscriptionUpdateIfChanged(t){const i=this.subscriptionStatus;t!==i&&this.emit(te.SubscriptionStatusChanged,i,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(te.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Pd(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new m0({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===J.Kind.Video){let i=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(i)Kv(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const a=kR(this.trackInfo,this.requestedMaxQuality);a&&Kv(this.videoDimensionsAdaptiveStream,a)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream;i?(t.width=Math.ceil(i.width),t.height=Math.ceil(i.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),t.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:sn.HIGH})),t.quality=sn.HIGH)}this.emit(te.UpdateSettings,t)}}class Gc extends Tb{static fromParticipantInfo(t,i,a){return new Gc(t,i.sid,i.identity,i.name,i.metadata,i.attributes,a,i.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,i,a,o,l,u,d){let f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Jr.STANDARD;super(i,a||"",o,l,u,d,f),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(te.UpdateSettings,i=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Me(t)),{settings:i})),this.signalClient.sendUpdateTrackSettings(i)}),t.on(te.UpdateSubscription,i=>{i.participantTracks.forEach(a=>{a.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(i)}),t.on(te.SubscriptionPermissionChanged,i=>{this.emit(se.TrackSubscriptionPermissionChanged,t,i)}),t.on(te.SubscriptionStatusChanged,i=>{this.emit(se.TrackSubscriptionStatusChanged,t,i)}),t.on(te.Subscribed,i=>{this.emit(se.TrackSubscribed,i,t)}),t.on(te.Unsubscribed,i=>{this.emit(se.TrackUnsubscribed,i,t)}),t.on(te.SubscriptionFailed,i=>{this.emit(se.TrackSubscriptionFailed,t.trackSid,i)})}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setVolume(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:J.Source.Microphone;this.volumeMap.set(i,t);const a=this.getTrackPublication(i);a&&a.track&&a.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:J.Source.Microphone;const i=this.getTrackPublication(t);return i&&i.track?i.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,i,a,o,l,u){let d=this.getTrackPublicationBySid(i);if(d||i.startsWith("TR")||this.trackPublications.forEach(g=>{!d&&t.kind===g.kind.toString()&&(d=g)}),!d){if(u===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:i})),this.emit(se.TrackSubscriptionFailed,i);return}u===void 0&&(u=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,i,a,o,l,u-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Me(d))),this.emit(se.TrackSubscriptionFailed,i);return}const f=t.kind==="video";let m;return f?m=new W_(t,i,o,l):m=new Z_(t,i,o,this.audioContext,this.audioOutput),m.source=d.source,m.isMuted=d.isMuted,m.setMediaStream(a),m.start(),d.setTrack(m),this.volumeMap.has(d.source)&&hh(m)&&Ln(m)&&m.setVolume(this.volumeMap.get(d.source)),d}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const i=new Map,a=new Map;return t.tracks.forEach(o=>{var l,u;let d=this.getTrackPublicationBySid(o.sid);if(d)d.updateInfo(o);else{const f=J.kindFromProto(o.type);if(!f)return;d=new s1(f,o,(l=this.signalClient.connectOptions)===null||l===void 0?void 0:l.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(u=this.loggerOptions)===null||u===void 0?void 0:u.loggerName}),d.updateInfo(o),a.set(o.sid,d);const m=Array.from(this.trackPublications.values()).find(g=>g.source===(d==null?void 0:d.source));m&&d.source!==J.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(d.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Me(m),newTrack:Me(d)})),this.addTrackPublication(d)}i.set(o.sid,d)}),this.trackPublications.forEach(o=>{i.has(o.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Me(o))),this.unpublishTrack(o.trackSid,!0))}),a.forEach(o=>{this.emit(se.TrackPublished,o)}),!0}unpublishTrack(t,i){const a=this.trackPublications.get(t);if(!a)return;const{track:o}=a;switch(o&&(o.stop(),a.setTrack(void 0)),this.trackPublications.delete(t),a.kind){case J.Kind.Audio:this.audioTrackPublications.delete(t);break;case J.Kind.Video:this.videoTrackPublications.delete(t);break}i&&this.emit(se.TrackUnpublished,a)}setAudioOutput(t){return T(this,void 0,void 0,function*(){this.audioOutput=t;const i=[];this.audioTrackPublications.forEach(a=>{var o;Ln(a.track)&&hh(a.track)&&i.push(a.track.setSinkId((o=t.deviceId)!==null&&o!==void 0?o:"default"))}),yield Promise.all(i)})}emit(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:a})),super.emit(t,...a)}}var _e;(function(s){s.Disconnected="disconnected",s.Connecting="connecting",s.Connected="connected",s.Reconnecting="reconnecting",s.SignalReconnecting="signalReconnecting"})(_e||(_e={}));const r1=4*1e3;class Ms extends jn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(t){var i,a,o,l;if(super(),i=this,this.state=_e.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Re,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(u,d,f)=>T(this,void 0,void 0,function*(){var m;if(!DR())throw Un()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const g=yield this.disconnectLock.lock();if(this.state===_e.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),g(),Promise.resolve();if(this.connectFuture)return g(),this.connectFuture.promise;this.setAndEmitConnectionState(_e.Connecting),((m=this.regionUrlProvider)===null||m===void 0?void 0:m.getServerUrl().toString())!==lb(u)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Ds(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Ue(u,d):this.regionUrlProvider.updateToken(d),this.regionUrlProvider.fetchRegionSettings().then(C=>{var M;(M=this.regionUrlProvider)===null||M===void 0||M.setServerReportedRegions(C)}).catch(C=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:C}))}));const v=(C,M,O)=>T(this,void 0,void 0,function*(){var B,w;this.abortController&&this.abortController.abort();const X=new AbortController;this.abortController=X,g==null||g();try{if(yield _s.getInstance().getBackOffPromise(u),X.signal.aborted)throw be.cancelled("Connection attempt aborted");yield this.attemptConnection(O??u,d,f,X),this.abortController=void 0,C()}catch(K){if(this.regionUrlProvider&&K instanceof be&&K.reason!==We.Cancelled&&K.reason!==We.NotAllowed){let A=null;try{this.log.debug("Fetching next region"),A=yield this.regionUrlProvider.getNextBestRegionUrl((B=this.abortController)===null||B===void 0?void 0:B.signal)}catch(_){if(_ instanceof be&&(_.status===401||_.reason===We.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),M(_);return}}[We.InternalError,We.ServerUnreachable,We.Timeout].includes(K.reason)&&(this.log.debug("Adding failed connection attempt to back off"),_s.getInstance().addFailedConnectionAttempt(u)),A&&!(!((w=this.abortController)===null||w===void 0)&&w.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(K.message,". Retrying with another region: ").concat(A),this.logContext),this.recreateEngine(),yield v(C,M,A)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,$v(K)),M(K))}else{let A=On.UNKNOWN_REASON;K instanceof be&&(A=$v(K)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,A),M(K)}}}),b=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new yn((C,M)=>{v(C,M,b)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,d,f,m,g,v)=>T(this,void 0,void 0,function*(){var b,C,M;const O=yield f.join(u,d,{autoSubscribe:m.autoSubscribe,adaptiveStream:typeof g.adaptiveStream=="object"?!0:g.adaptiveStream,maxRetries:m.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:m.websocketTimeout,singlePeerConnection:g.singlePeerConnection},v.signal);let B=O.serverInfo;if(B||(B={version:O.serverVersion,region:O.serverRegion}),this.serverInfo=B,this.log.debug("connected to Livekit Server ".concat(Object.entries(B).map(w=>{let[X,K]=w;return"".concat(X,": ").concat(K)}).join(", ")),{room:(b=O.room)===null||b===void 0?void 0:b.name,roomSid:(C=O.room)===null||C===void 0?void 0:C.sid,identity:(M=O.participant)===null||M===void 0?void 0:M.identity}),!B.version)throw new dR("unknown server version");return B.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),g.dynacast=!1),O}),this.applyJoinResponse=u=>{const d=u.participant;if(this.localParticipant.sid=d.sid,this.localParticipant.identity=d.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(f){this.log.error(f instanceof Error?f.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:f}))}this.handleParticipantUpdates([d,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,d,f,m)=>T(this,void 0,void 0,function*(){var g,v;this.state===_e.Reconnecting||this.isResuming||!((g=this.engine)===null||g===void 0)&&g.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((v=this.regionUrlProvider)===null||v===void 0)&&v.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Kh),f),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const b=yield this.connectSignal(u,d,this.engine,this.connOptions,this.options,m);this.applyJoinResponse(b),this.setupLocalParticipantEvents(),this.emit(Z.SignalConnected)}catch(b){yield this.engine.close(),this.recreateEngine();const C=m.signal.aborted?be.cancelled("Signal connection aborted"):be.serverUnreachable("could not establish signal connection");throw b instanceof Error&&(C.message="".concat(C.message,": ").concat(b.message)),b instanceof be&&(C.reason=b.reason,C.status=b.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:b})),C}if(m.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),be.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,m)}catch(b){throw yield this.engine.close(),this.recreateEngine(),b}Kt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Kt()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(_e.Connected),this.emit(Z.Connected),_s.getInstance().resetFailedConnectionAttempts(u),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var u=arguments.length,d=new Array(u),f=0;f<u;f++)d[f]=arguments[f];return T(i,[...d],void 0,function(){var m=this;let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var v,b,C;const M=yield m.disconnectLock.lock();try{if(m.state===_e.Disconnected){m.log.debug("already disconnected",m.logContext);return}if(m.log.info("disconnect from room",Object.assign({},m.logContext)),m.state===_e.Connecting||m.state===_e.Reconnecting||m.isResuming){const O="Abort connection attempt due to user initiated disconnect";m.log.warn(O,m.logContext),(v=m.abortController)===null||v===void 0||v.abort(O),(C=(b=m.connectFuture)===null||b===void 0?void 0:b.reject)===null||C===void 0||C.call(b,be.cancelled("Client initiated disconnect")),m.connectFuture=void 0}m.engine&&(m.engine.client.isDisconnected||(yield m.engine.client.sendLeave()),yield m.engine.close()),m.handleDisconnect(g,On.CLIENT_INITIATED),m.engine=void 0}finally{M()}})()})},this.onPageLeave=()=>T(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>T(this,void 0,void 0,function*(){const u=[],d=Yt();if(d&&d.os==="iOS"){const f="livekit-dummy-audio-el";let m=document.getElementById(f);if(!m){m=document.createElement("audio"),m.id=f,m.autoplay=!0,m.hidden=!0;const g=Nd();g.enabled=!0;const v=new MediaStream([g]);m.srcObject=v,document.addEventListener("visibilitychange",()=>{m&&(m.srcObject=document.hidden?null:v,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(m),this.once(Z.Disconnected,()=>{m==null||m.remove(),m=null})}u.push(m)}this.remoteParticipants.forEach(f=>{f.audioTrackPublications.forEach(m=>{m.track&&m.track.attachedElements.forEach(g=>{u.push(g)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(f=>(f.muted=!1,f.play()))]),this.handleAudioPlaybackStarted()}catch(f){throw this.handleAudioPlaybackFailed(f),f}}),this.startVideo=()=>T(this,void 0,void 0,function*(){const u=[];for(const d of this.remoteParticipants.values())d.videoTrackPublications.forEach(f=>{var m;(m=f.track)===null||m===void 0||m.attachedElements.forEach(g=>{u.includes(g)||u.push(g)})});yield Promise.all(u.map(d=>d.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(d=>{d.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(_e.Reconnecting)&&this.emit(Z.Reconnecting)},this.handleSignalRestarted=u=>T(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(d){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:d}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(_e.Connected),this.emit(Z.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(d=>{var f;if(d.identity===this.localParticipant.identity){this.localParticipant.updateInfo(d);return}d.identity===""&&(d.identity=(f=this.sidToIdentity.get(d.sid))!==null&&f!==void 0?f:"");let m=this.remoteParticipants.get(d.identity);d.state===Ts.DISCONNECTED?this.handleParticipantDisconnected(d.identity,m):m=this.getOrCreateParticipant(d.identity,d)})},this.handleActiveSpeakersUpdate=u=>{const d=[],f={};u.forEach(m=>{if(f[m.sid]=!0,m.sid===this.localParticipant.sid)this.localParticipant.audioLevel=m.level,this.localParticipant.setIsSpeaking(!0),d.push(this.localParticipant);else{const g=this.getRemoteParticipantBySid(m.sid);g&&(g.audioLevel=m.level,g.setIsSpeaking(!0),d.push(g))}}),f[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(m=>{f[m.sid]||(m.audioLevel=0,m.setIsSpeaking(!1))}),this.activeSpeakers=d,this.emitWhenConnected(Z.ActiveSpeakersChanged,d)},this.handleSpeakersChanged=u=>{const d=new Map;this.activeSpeakers.forEach(m=>{const g=this.remoteParticipants.get(m.identity);g&&g.sid!==m.sid||d.set(m.sid,m)}),u.forEach(m=>{let g=this.getRemoteParticipantBySid(m.sid);m.sid===this.localParticipant.sid&&(g=this.localParticipant),g&&(g.audioLevel=m.level,g.setIsSpeaking(m.active),m.active?d.set(m.sid,g):d.delete(m.sid))});const f=Array.from(d.values());f.sort((m,g)=>g.audioLevel-m.audioLevel),this.activeSpeakers=f,this.emitWhenConnected(Z.ActiveSpeakersChanged,f)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(d=>{const f=this.getRemoteParticipantBySid(d.participantSid);if(!f)return;const m=f.getTrackPublicationBySid(d.trackSid);if(!m||!m.track)return;const g=J.streamStateFromProto(d.state);m.track.setStreamState(g),g!==m.track.streamState&&(f.emit(se.TrackStreamStateChanged,m,m.track.streamState),this.emitWhenConnected(Z.TrackStreamStateChanged,m,m.track.streamState,f))})},this.handleSubscriptionPermissionUpdate=u=>{const d=this.getRemoteParticipantBySid(u.participantSid);if(!d)return;const f=d.getTrackPublicationBySid(u.trackSid);f&&f.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const d=Array.from(this.remoteParticipants.values()).find(m=>m.trackPublications.has(u.trackSid));if(!d)return;const f=d.getTrackPublicationBySid(u.trackSid);f&&f.setSubscriptionError(u.err)},this.handleDataPacket=(u,d)=>{const f=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(f,u.value.value,u.kind,d);else if(u.value.case==="transcription")this.handleTranscription(f,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(f,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(f,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,f);else if(u.value.case==="streamHeader"||u.value.case==="streamChunk"||u.value.case==="streamTrailer")this.handleDataStream(u,d);else if(u.value.case==="rpcRequest"){const m=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,m.id,m.method,m.payload,m.responseTimeoutMs,m.version)}},this.handleUserPacket=(u,d,f,m)=>{this.emit(Z.DataReceived,d.payload,u,f,d.topic,m),u==null||u.emit(se.DataReceived,d.payload,f,m)},this.handleSipDtmf=(u,d)=>{this.emit(Z.SipDTMFReceived,d,u),u==null||u.emit(se.SipDTMFReceived,d)},this.handleTranscription=(u,d)=>{const f=d.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(d.transcribedParticipantIdentity),m=f==null?void 0:f.trackPublications.get(d.trackId),g=jR(d,this.transcriptionReceivedTimes);m==null||m.emit(te.TranscriptionReceived,g),f==null||f.emit(se.TranscriptionReceived,g,m),this.emit(Z.TranscriptionReceived,g,f,m)},this.handleChatMessage=(u,d)=>{const f=BR(d);this.emit(Z.ChatMessage,f,u)},this.handleMetrics=(u,d)=>{this.emit(Z.MetricsReceived,u,d)},this.handleDataStream=(u,d)=>{this.incomingDataStreamManager.handleDataStreamPacket(u,d)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Z.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Z.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Z.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Z.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>T(this,void 0,void 0,function*(){var u;((u=Yt())===null||u===void 0?void 0:u.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(Z.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const d=this.roomInfo;this.roomInfo=u,d&&d.metadata!==u.metadata&&this.emitWhenConnected(Z.RoomMetadataChanged,u.metadata),(d==null?void 0:d.activeRecording)!==u.activeRecording&&this.emitWhenConnected(Z.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(d=>{if(d.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(d.quality);return}const f=this.getRemoteParticipantBySid(d.participantSid);f&&f.setConnectionQuality(d.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(Z.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(Z.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(Z.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(Z.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(Z.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var d;(d=u==null?void 0:u.onPublish)===null||d===void 0||d.call(u,this)},this.onLocalTrackPublished=u=>T(this,void 0,void 0,function*(){var d,f,m,g,v,b;(d=u.track)===null||d===void 0||d.on(te.TrackProcessorUpdate,this.onTrackProcessorUpdate),(f=u.track)===null||f===void 0||f.on(te.Restarted,this.onLocalTrackRestarted),(v=(g=(m=u.track)===null||m===void 0?void 0:m.getProcessor())===null||g===void 0?void 0:g.onPublish)===null||v===void 0||v.call(g,this),this.emit(Z.LocalTrackPublished,u,this.localParticipant),ri(u.track)&&(yield u.track.checkForSilence())&&this.emit(Z.LocalAudioSilenceDetected,u);const C=yield(b=u.track)===null||b===void 0?void 0:b.getDeviceId(!1),M=ch(u.source);M&&C&&C!==this.localParticipant.activeDeviceMap.get(M)&&(this.localParticipant.activeDeviceMap.set(M,C),this.emit(Z.ActiveDeviceChanged,M,C))}),this.onLocalTrackUnpublished=u=>{var d,f;(d=u.track)===null||d===void 0||d.off(te.TrackProcessorUpdate,this.onTrackProcessorUpdate),(f=u.track)===null||f===void 0||f.off(te.Restarted,this.onLocalTrackRestarted),this.emit(Z.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>T(this,void 0,void 0,function*(){const d=yield u.getDeviceId(!1),f=ch(u.source);f&&d&&d!==this.localParticipant.activeDeviceMap.get(f)&&(this.log.debug("local track restarted, setting ".concat(f," ").concat(d," active"),this.logContext),this.localParticipant.activeDeviceMap.set(f,d),this.emit(Z.ActiveDeviceChanged,f,d))}),this.onLocalConnectionQualityChanged=u=>{this.emit(Z.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=(u,d)=>{this.emit(Z.MediaDevicesError,u,d)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(Z.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(Z.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},v_),t),this.log=hi((a=this.options.loggerName)!==null&&a!==void 0?a:An.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},db),t==null?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},hb),t==null?void 0:t.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},g_),t==null?void 0:t.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new Y_,this.outgoingDataStreamManager=new X_(this.engine,this.log),this.disconnectLock=new Ut,this.localParticipant=new a1("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Yi(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Yi(this.options.audioCaptureDefaults.deviceId)),!((o=this.options.audioOutput)===null||o===void 0)&&o.deviceId&&this.switchActiveDevice("audiooutput",Yi(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),Kt()){const u=new AbortController;(l=navigator.mediaDevices)===null||l===void 0||l.addEventListener("devicechange",this.handleDeviceChange,{signal:u.signal}),Ms.cleanupRegistry&&Ms.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(t,i){return this.incomingDataStreamManager.registerTextStreamHandler(t,i)}unregisterTextStreamHandler(t){return this.incomingDataStreamManager.unregisterTextStreamHandler(t)}registerByteStreamHandler(t,i){return this.incomingDataStreamManager.registerByteStreamHandler(t,i)}unregisterByteStreamHandler(t){return this.incomingDataStreamManager.unregisterByteStreamHandler(t)}registerRpcMethod(t,i){if(this.rpcHandlers.has(t))throw Error("RPC handler already registered for method ".concat(t,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(t,i)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setE2EEEnabled(t){return T(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;const i=!!this.options.encryption,a=this.options.encryption||this.options.e2ee;a&&("e2eeManager"in a?(this.e2eeManager=a.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=i):this.e2eeManager=new $R(a,i),this.e2eeManager.on(Hi.ParticipantEncryptionStatusChanged,(o,l)=>{qR(l)&&(this.isE2EEEnabled=o),this.emit(Z.ParticipantEncryptionStatusChanged,o,l)}),this.e2eeManager.on(Hi.EncryptionError,(o,l)=>{const u=l?this.getParticipantByIdentity(l):void 0;this.emit(Z.EncryptionError,o,u)}),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&i!==void 0?i:!1}getSid(){return T(this,void 0,void 0,function*(){return this.state===_e.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((t,i)=>{const a=o=>{o.sid!==""&&(this.engine.off(ie.RoomUpdate,a),t(o.sid))};this.engine.on(ie.RoomUpdate,a),this.once(Z.Disconnected,()=>{this.engine.off(ie.RoomUpdate,a),i("Room disconnected before room server id was available")})})})}get name(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&i!==void 0?i:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&i!==void 0?i:0}get numPublishers(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&i!==void 0?i:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new F_(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(ie.ParticipantUpdate,this.handleParticipantUpdates).on(ie.RoomUpdate,this.handleRoomUpdate).on(ie.SpeakersChanged,this.handleSpeakersChanged).on(ie.StreamStateChanged,this.handleStreamStateUpdate).on(ie.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(ie.SubscriptionError,this.handleSubscriptionError).on(ie.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(ie.MediaTrackAdded,(t,i,a)=>{this.onTrackAdded(t,i,a)}).on(ie.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(ie.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(ie.DataPacketReceived,this.handleDataPacket).on(ie.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(_e.SignalReconnecting)&&this.emit(Z.SignalReconnecting)}).on(ie.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(_e.Connected)&&this.emit(Z.Reconnected)}).on(ie.SignalResumed,()=>{this.bufferedEvents=[],(this.state===_e.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(ie.Restarting,this.handleRestarting).on(ie.SignalRestarted,this.handleSignalRestarted).on(ie.Offline,()=>{this.setAndEmitConnectionState(_e.Reconnecting)&&this.emit(Z.Reconnecting)}).on(ie.DCBufferStatusChanged,(t,i)=>{this.emit(Z.DCBufferStatusChanged,t,i)}).on(ie.LocalTrackSubscribed,t=>{const i=this.localParticipant.getTrackPublications().find(a=>{let{trackSid:o}=a;return o===t});if(!i){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(se.LocalTrackSubscribed,i),this.emitWhenConnected(Z.LocalTrackSubscribed,i,this.localParticipant)}).on(ie.RoomMoved,t=>{this.log.debug("room moved",t),t.room&&this.handleRoomUpdate(t.room),this.remoteParticipants.forEach((i,a)=>{this.handleParticipantDisconnected(a,i)}),this.emit(Z.Moved,t.room.name),t.participant?this.handleParticipantUpdates([t.participant,...t.otherParticipants]):this.handleParticipantUpdates(t.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return kt.getInstance().getDevices(t,i)}prepareConnection(t,i){return T(this,void 0,void 0,function*(){if(this.state===_e.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(Ds(new URL(t))&&i){this.regionUrlProvider=new Ue(t,i);const a=yield this.regionUrlProvider.getNextBestRegionUrl();a&&this.state===_e.Disconnected&&(this.regionUrl=a,yield fetch(Wr(a),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(a),this.logContext))}else yield fetch(Wr(t),{method:"HEAD"})}catch(a){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:a}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,i){return T(this,void 0,void 0,function*(){let a=()=>T(this,void 0,void 0,function*(){}),o;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":o=new Nn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":o=new Nn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":o=new Nn({scenario:{case:"serverLeave",value:!0}});break;case"migration":o=new Nn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":a=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new Nn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":a=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new Nn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":o=new Nn({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),a=()=>T(this,void 0,void 0,function*(){const l=this.engine.client.onLeave;l&&l(new Wc({reason:On.CLIENT_INITIATED,action:Cs.RECONNECT}))});break;case"subscriber-bandwidth":if(i===void 0||typeof i!="number")throw new Error("subscriber-bandwidth requires a number as argument");o=new Nn({scenario:{case:"subscriberBandwidth",value:Ca(i)}});break;case"leave-full-reconnect":o=new Nn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}o&&(yield this.engine.client.sendSimulateScenario(o),yield a())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var d,f,m,g,v,b,C;let M=!0,O=!1;const B=u?{exact:o}:o;if(a==="audioinput"){O=l.localParticipant.audioTrackPublications.size===0;const w=(d=l.getActiveDevice(a))!==null&&d!==void 0?d:l.options.audioCaptureDefaults.deviceId;l.options.audioCaptureDefaults.deviceId=B;const X=Array.from(l.localParticipant.audioTrackPublications.values()).filter(A=>A.source===J.Source.Microphone);try{M=(yield Promise.all(X.map(A=>{var _;return(_=A.audioTrack)===null||_===void 0?void 0:_.setDeviceId(B)}))).every(A=>A===!0)}catch(A){throw l.options.audioCaptureDefaults.deviceId=w,A}const K=X.some(A=>{var _,I;return(I=(_=A.track)===null||_===void 0?void 0:_.isMuted)!==null&&I!==void 0?I:!1});M&&K&&(O=!0)}else if(a==="videoinput"){O=l.localParticipant.videoTrackPublications.size===0;const w=(f=l.getActiveDevice(a))!==null&&f!==void 0?f:l.options.videoCaptureDefaults.deviceId;l.options.videoCaptureDefaults.deviceId=B;const X=Array.from(l.localParticipant.videoTrackPublications.values()).filter(A=>A.source===J.Source.Camera);try{M=(yield Promise.all(X.map(A=>{var _;return(_=A.videoTrack)===null||_===void 0?void 0:_.setDeviceId(B)}))).every(A=>A===!0)}catch(A){throw l.options.videoCaptureDefaults.deviceId=w,A}const K=X.some(A=>{var _,I;return(I=(_=A.track)===null||_===void 0?void 0:_.isMuted)!==null&&I!==void 0?I:!1});M&&K&&(O=!0)}else if(a==="audiooutput"){if(O=!0,!dh()&&!l.options.webAudioMix||l.options.webAudioMix&&l.audioContext&&!("setSinkId"in l.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");l.options.webAudioMix&&(o=(m=yield kt.getInstance().normalizeDeviceId("audiooutput",o))!==null&&m!==void 0?m:""),(g=(C=l.options).audioOutput)!==null&&g!==void 0||(C.audioOutput={});const w=(v=l.getActiveDevice(a))!==null&&v!==void 0?v:l.options.audioOutput.deviceId;l.options.audioOutput.deviceId=o;try{l.options.webAudioMix&&((b=l.audioContext)===null||b===void 0||b.setSinkId(o)),yield Promise.all(Array.from(l.remoteParticipants.values()).map(X=>X.setAudioOutput({deviceId:o})))}catch(X){throw l.options.audioOutput.deviceId=w,X}}return O&&(l.localParticipant.activeDeviceMap.set(a,o),l.emit(Z.ActiveDeviceChanged,a,o)),M})()})}setupLocalParticipantEvents(){this.localParticipant.on(se.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(se.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(se.AttributesChanged,this.onLocalAttributesChanged).on(se.TrackMuted,this.onLocalTrackMuted).on(se.TrackUnmuted,this.onLocalTrackUnmuted).on(se.LocalTrackPublished,this.onLocalTrackPublished).on(se.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(se.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(se.MediaDevicesError,this.onMediaDevicesError).on(se.AudioStreamAcquired,this.startAudio).on(se.ChatMessage,this.onLocalChatMessageSent).on(se.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,i,a){if(this.state===_e.Connecting||this.state===_e.Reconnecting){const v=()=>{this.log.debug("deferring on track for later",{mediaTrackId:t.id,mediaStreamId:i.id,tracksInStream:i.getTracks().map(C=>C.id)}),this.onTrackAdded(t,i,a),b()},b=()=>{this.off(Z.Reconnected,v),this.off(Z.Connected,v),this.off(Z.Disconnected,b)};this.once(Z.Reconnected,v),this.once(Z.Connected,v),this.once(Z.Disconnected,b);return}if(this.state===_e.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(t.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const o=_R(i.id),l=o[0];let u=o[1],d=t.id;if(u&&u.startsWith("TR")&&(d=u),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const f=Array.from(this.remoteParticipants.values()).find(v=>v.sid===l);if(!f){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}if(!d.startsWith("TR")){const v=this.engine.getTrackIdForReceiver(a);if(!v){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(l),this.logContext);return}d=v}d.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(l,", streamId: ").concat(u,", trackId: ").concat(d),Object.assign(Object.assign({},this.logContext),{rpID:l,streamId:u,trackId:d}));let m;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?m=this.options.adaptiveStream:m={});const g=f.addSubscribedMediaTrack(t,d,i,a,m);g!=null&&g.isEncrypted&&!this.e2eeManager&&this.emit(Z.EncryptionError,new Error("Encrypted ".concat(g.source," track received from participant ").concat(f.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1?arguments[1]:void 0;var a;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==_e.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{o.unpublishTrack(l.trackSid)})}),this.localParticipant.trackPublications.forEach(o=>{var l,u,d;o.track&&this.localParticipant.unpublishTrack(o.track,t),t?((l=o.track)===null||l===void 0||l.detach(),(u=o.track)===null||u===void 0||u.stop()):(d=o.track)===null||d===void 0||d.stopMonitor()}),this.localParticipant.off(se.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(se.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(se.AttributesChanged,this.onLocalAttributesChanged).off(se.TrackMuted,this.onLocalTrackMuted).off(se.TrackUnmuted,this.onLocalTrackUnmuted).off(se.LocalTrackPublished,this.onLocalTrackPublished).off(se.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(se.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(se.MediaDevicesError,this.onMediaDevicesError).off(se.AudioStreamAcquired,this.startAudio).off(se.ChatMessage,this.onLocalChatMessageSent).off(se.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Kt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(a=navigator.mediaDevices)===null||a===void 0||a.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(_e.Disconnected),this.emit(Z.Disconnected,i)}}}handleParticipantDisconnected(t,i){var a;this.remoteParticipants.delete(t),i&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(t),i.trackPublications.forEach(o=>{i.unpublishTrack(o.trackSid,!0)}),this.emit(Z.ParticipantDisconnected,i),i.setDisconnected(),(a=this.localParticipant)===null||a===void 0||a.handleParticipantDisconnected(i.identity))}handleIncomingRpcRequest(t,i,a,o,l,u){return T(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(t,i),u!==1){yield this.engine.publishRpcResponse(t,i,null,ot.builtIn("UNSUPPORTED_VERSION"));return}const d=this.rpcHandlers.get(a);if(!d){yield this.engine.publishRpcResponse(t,i,null,ot.builtIn("UNSUPPORTED_METHOD"));return}let f=null,m=null;try{const g=yield d({requestId:i,callerIdentity:t,payload:o,responseTimeout:l});Yh(g)>mb?(f=ot.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(a))):m=g}catch(g){g instanceof ot?f=g:(this.log.warn("Uncaught error returned by RPC handler for ".concat(a,". Returning APPLICATION_ERROR instead."),g),f=ot.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(t,i,m,f)})}selectDefaultDevices(){return T(this,void 0,void 0,function*(){var t,i,a;const o=kt.getInstance().previousDevices,l=yield kt.getInstance().getDevices(void 0,!1),u=Yt();if((u==null?void 0:u.name)==="Chrome"&&u.os!=="iOS")for(let f of l){const m=o.find(g=>g.deviceId===f.deviceId);m&&m.label!==""&&m.kind===f.kind&&m.label!==f.label&&this.getActiveDevice(f.kind)==="default"&&this.emit(Z.ActiveDeviceChanged,f.kind,f.deviceId)}const d=["audiooutput","audioinput","videoinput"];for(let f of d){const m=vR(f),g=this.localParticipant.getTrackPublication(m);if(g&&(!((t=g.track)===null||t===void 0)&&t.isUserProvided))continue;const v=l.filter(C=>C.kind===f),b=this.getActiveDevice(f);if(b===((i=o.filter(C=>C.kind===f)[0])===null||i===void 0?void 0:i.deviceId)&&v.length>0&&((a=v[0])===null||a===void 0?void 0:a.deviceId)!==b){yield this.switchActiveDevice(f,v[0].deviceId);continue}f==="audioinput"&&!Zr()||f==="videoinput"||v.length>0&&!v.find(C=>C.deviceId===this.getActiveDevice(f))&&(f!=="audiooutput"||!Zr())&&(yield this.switchActiveDevice(f,v[0].deviceId))}})}acquireAudioContext(){return T(this,void 0,void 0,function*(){var t,i;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=ab())!==null&&t!==void 0?t:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(o=>o.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),wt(200)])}catch(o){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:o}))}const a=((i=this.audioContext)===null||i===void 0?void 0:i.state)==="running";a!==this.canPlaybackAudio&&(this.audioEnabled=a,this.emit(Z.AudioPlaybackStatusChanged,a))})}createParticipant(t,i){var a;let o;return i?o=Gc.fromParticipantInfo(this.engine.client,i,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):o=new Gc(this.engine.client,"",t,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&o.setAudioContext(this.audioContext),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&o.setAudioOutput(this.options.audioOutput).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),o}getOrCreateParticipant(t,i){if(this.remoteParticipants.has(t)){const o=this.remoteParticipants.get(t);return i&&o.updateInfo(i)&&this.sidToIdentity.set(i.sid,i.identity),o}const a=this.createParticipant(t,i);return this.remoteParticipants.set(t,a),this.sidToIdentity.set(i.sid,i.identity),this.emitWhenConnected(Z.ParticipantConnected,a),a.on(se.TrackPublished,o=>{this.emitWhenConnected(Z.TrackPublished,o,a)}).on(se.TrackSubscribed,(o,l)=>{o.kind===J.Kind.Audio?(o.on(te.AudioPlaybackStarted,this.handleAudioPlaybackStarted),o.on(te.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):o.kind===J.Kind.Video&&(o.on(te.VideoPlaybackFailed,this.handleVideoPlaybackFailed),o.on(te.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Z.TrackSubscribed,o,l,a)}).on(se.TrackUnpublished,o=>{this.emit(Z.TrackUnpublished,o,a)}).on(se.TrackUnsubscribed,(o,l)=>{this.emit(Z.TrackUnsubscribed,o,l,a)}).on(se.TrackMuted,o=>{this.emitWhenConnected(Z.TrackMuted,o,a)}).on(se.TrackUnmuted,o=>{this.emitWhenConnected(Z.TrackUnmuted,o,a)}).on(se.ParticipantMetadataChanged,o=>{this.emitWhenConnected(Z.ParticipantMetadataChanged,o,a)}).on(se.ParticipantNameChanged,o=>{this.emitWhenConnected(Z.ParticipantNameChanged,o,a)}).on(se.AttributesChanged,o=>{this.emitWhenConnected(Z.ParticipantAttributesChanged,o,a)}).on(se.ConnectionQualityChanged,o=>{this.emitWhenConnected(Z.ConnectionQualityChanged,o,a)}).on(se.ParticipantPermissionsChanged,o=>{this.emitWhenConnected(Z.ParticipantPermissionsChanged,o,a)}).on(se.TrackSubscriptionStatusChanged,(o,l)=>{this.emitWhenConnected(Z.TrackSubscriptionStatusChanged,o,l,a)}).on(se.TrackSubscriptionFailed,(o,l)=>{this.emit(Z.TrackSubscriptionFailed,o,a,l)}).on(se.TrackSubscriptionPermissionChanged,(o,l)=>{this.emitWhenConnected(Z.TrackSubscriptionPermissionChanged,o,l,a)}).on(se.Active,()=>{this.emitWhenConnected(Z.ParticipantActive,a),a.kind===Jr.AGENT&&this.localParticipant.setActiveAgent(a)}),i&&a.updateInfo(i),a}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((a,o)=>(a.push(...o.getTrackPublications()),a),[]),i=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,i)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const i of t.videoTrackPublications.values())i.isSubscribed&&zR(i)&&i.emitTrackUpdate()}getRemoteParticipantBySid(t){const i=this.sidToIdentity.get(t);if(i)return this.remoteParticipants.get(i)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=Mt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,On.STATE_MISMATCH))):t=0},r1)}clearConnectionReconcile(){this.connectionReconcileInterval&&Mt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(Z.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[i,a]=t;this.emit(i,...a)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(this.state===_e.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,a]);else if(this.state===_e.Connected)return this.emit(t,...a);return!1}simulateParticipants(t){return T(this,void 0,void 0,function*(){var i,a;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),l=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Jc({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:et.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ka({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Z.SignalConnected),this.emit(Z.Connected),this.setAndEmitConnectionState(_e.Connected),o.video){const u=new yh(J.Kind.Video,new ys({source:gt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:En.AUDIO,name:"video-dummy"}),new Hc(o.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Wv(160*((i=l.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(se.LocalTrackPublished,u)}if(o.audio){const u=new yh(J.Kind.Audio,new ys({source:gt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:En.AUDIO}),new Fc(o.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Nd(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(se.LocalTrackPublished,u)}for(let u=0;u<l.count-1;u+=1){let d=new ka({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(u),state:Ts.ACTIVE,tracks:[],joinedAt:et.parse(Date.now())});const f=this.getOrCreateParticipant(d.identity,d);if(l.video){const m=Wv(160*((a=l.aspectRatios[u%l.aspectRatios.length])!==null&&a!==void 0?a:1),160,!1,!0),g=new ys({source:gt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:En.AUDIO});f.addSubscribedMediaTrack(m,g.sid,new MediaStream([m]),new RTCRtpReceiver),d.tracks=[...d.tracks,g]}if(l.audio){const m=Nd(),g=new ys({source:gt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:En.AUDIO});f.addSubscribedMediaTrack(m,g.sid,new MediaStream([m]),new RTCRtpReceiver),d.tracks=[...d.tracks,g]}f.updateInfo(d)}})}emit(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(t!==Z.ActiveSpeakersChanged&&t!==Z.TranscriptionReceived){const l=Cb(a).filter(u=>u!==void 0);(t===Z.TrackSubscribed||t===Z.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:l})),this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:l}))}return super.emit(t,...a)}}Ms.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(s=>{s()});function Cb(s){return s.map(t=>{if(t)return Array.isArray(t)?Cb(t):typeof t=="object"?"logContext"in t?t.logContext:void 0:t})}var kn;(function(s){s[s.IDLE=0]="IDLE",s[s.RUNNING=1]="RUNNING",s[s.SKIPPED=2]="SKIPPED",s[s.SUCCESS=3]="SUCCESS",s[s.FAILED=4]="FAILED"})(kn||(kn={}));class $i extends jn.EventEmitter{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=kn.IDLE,this.logs=[],this.options={},this.url=t,this.token=i,this.name=this.constructor.name,this.room=new Ms(a.roomOptions),this.connectOptions=a.connectOptions,this.options=a}run(t){return T(this,void 0,void 0,function*(){if(this.status!==kn.IDLE)throw Error("check is running already");this.setStatus(kn.RUNNING);try{yield this.perform()}catch(i){i instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(i.message):this.appendError(i.message))}return yield this.disconnect(),yield new Promise(i=>setTimeout(i,500)),this.status!==kn.SKIPPED&&this.setStatus(this.isSuccess()?kn.SUCCESS:kn.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(t){return T(this,void 0,void 0,function*(){return this.room.state===_e.Connected?this.room:(t||(t=this.url),yield this.room.connect(t,this.token,this.connectOptions),this.room)})}disconnect(){return T(this,void 0,void 0,function*(){this.room&&this.room.state!==_e.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(kn.SKIPPED)}switchProtocol(t){return T(this,void 0,void 0,function*(){let i=!1,a=!1;if(this.room.on(Z.Reconnecting,()=>{i=!0}),this.room.once(Z.Reconnected,()=>{a=!0}),this.room.simulateScenario("force-".concat(t)),yield new Promise(l=>setTimeout(l,1e3)),!i)return;const o=Date.now()+1e4;for(;Date.now()<o;){if(a)return;yield wt(100)}throw new Error("Could not reconnect using ".concat(t," protocol after 10 seconds"))})}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class o1 extends $i{get description(){return"Cloud regions"}perform(){return T(this,void 0,void 0,function*(){const t=new Ue(this.url,this.token);if(!t.isCloud()){this.skip();return}const i=[],a=new Set;for(let l=0;l<3;l++){const u=yield t.getNextBestRegionUrl();if(!u)break;if(a.has(u))continue;a.add(u);const d=yield this.checkCloudRegion(u);this.appendMessage("".concat(d.region," RTT: ").concat(d.rtt,"ms, duration: ").concat(d.duration,"ms")),i.push(d)}i.sort((l,u)=>(l.duration-u.duration)*.5+(l.rtt-u.rtt)*.5);const o=i[0];this.bestStats=o,this.appendMessage("best Cloud region: ".concat(o.region))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkCloudRegion(t){return T(this,void 0,void 0,function*(){var i,a;yield this.connect(t),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const o=(i=this.room.serverInfo)===null||i===void 0?void 0:i.region;if(!o)throw new Error("Region not found");const l=yield this.room.localParticipant.streamText({topic:"test"}),u=1e3,f=1e6/u,m="A".repeat(u),g=Date.now();for(let M=0;M<f;M++)yield l.write(m);yield l.close();const v=Date.now(),b=yield(a=this.room.engine.pcManager)===null||a===void 0?void 0:a.publisher.getStats(),C={region:o,rtt:1e4,duration:v-g};return b==null||b.forEach(M=>{M.type==="candidate-pair"&&M.nominated&&(C.rtt=M.currentRoundTripTime*1e3)}),yield this.disconnect(),C})}}const Vd=1e4;class c1 extends $i{get description(){return"Connection via UDP vs TCP"}perform(){return T(this,void 0,void 0,function*(){const t=yield this.checkConnectionProtocol("udp"),i=yield this.checkConnectionProtocol("tcp");this.bestStats=t,t.qualityLimitationDurations.bandwidth-i.qualityLimitationDurations.bandwidth>.5||(t.packetsLost-i.packetsLost)/t.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=i):this.appendMessage("best connection quality via udp");const a=this.bestStats;this.appendMessage("upstream bitrate: ".concat((a.bitrateTotal/a.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((a.rttTotal/a.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((a.jitterTotal/a.count*1e3).toFixed(2)," ms")),a.packetsLost>0&&this.appendWarning("packets lost: ".concat((a.packetsLost/a.packetsSent*100).toFixed(2),"%")),a.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((a.qualityLimitationDurations.bandwidth/(Vd/1e3)*100).toFixed(2),"%")),a.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((a.qualityLimitationDurations.cpu/(Vd/1e3)*100).toFixed(2),"%"))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkConnectionProtocol(t){return T(this,void 0,void 0,function*(){yield this.connect(),t==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const i=document.createElement("canvas");i.width=1280,i.height=720;const a=i.getContext("2d");if(!a)throw new Error("Could not get canvas context");let o=0;const l=()=>{o=(o+1)%360,a.fillStyle="hsl(".concat(o,", 100%, 50%)"),a.fillRect(0,0,i.width,i.height),requestAnimationFrame(l)};l();const d=i.captureStream(30).getVideoTracks()[0],m=(yield this.room.localParticipant.publishTrack(d,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,g={protocol:t,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},v=setInterval(()=>T(this,void 0,void 0,function*(){const b=yield m.getRTCStatsReport();b==null||b.forEach(C=>{C.type==="outbound-rtp"?(g.packetsSent=C.packetsSent,g.qualityLimitationDurations=C.qualityLimitationDurations,g.bitrateTotal+=C.targetBitrate,g.count++):C.type==="remote-inbound-rtp"&&(g.packetsLost=C.packetsLost,g.rttTotal+=C.roundTripTime,g.jitterTotal+=C.jitter)})}),1e3);return yield new Promise(b=>setTimeout(b,Vd)),clearInterval(v),d.stop(),i.remove(),yield this.disconnect(),g})}}class l1 extends $i{get description(){return"Can publish audio"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect(),a=yield t1();if(yield ib(a,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),i.localParticipant.publishTrack(a),yield new Promise(d=>setTimeout(d,3e3));const l=yield(t=a.sender)===null||t===void 0?void 0:t.getStats();if(!l)throw new Error("Could not get RTCStats");let u=0;if(l.forEach(d=>{d.type==="outbound-rtp"&&(d.kind==="audio"||!d.kind&&d.mediaType==="audio")&&(u=d.packetsSent)}),u===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(u," audio packets"))})}}class u1 extends $i{get description(){return"Can publish video"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect(),a=yield e1();yield this.checkForVideo(a.mediaStreamTrack),i.localParticipant.publishTrack(a),yield new Promise(u=>setTimeout(u,5e3));const o=yield(t=a.sender)===null||t===void 0?void 0:t.getStats();if(!o)throw new Error("Could not get RTCStats");let l=0;if(o.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="video"||!u.kind&&u.mediaType==="video")&&(l+=u.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," video packets"))})}checkForVideo(t){return T(this,void 0,void 0,function*(){const i=new MediaStream;i.addTrack(t.clone());const a=document.createElement("video");a.srcObject=i,a.muted=!0,a.autoplay=!0,a.playsInline=!0,a.setAttribute("playsinline","true"),document.body.appendChild(a),yield new Promise(o=>{a.onplay=()=>{setTimeout(()=>{var l,u,d,f;const m=document.createElement("canvas"),g=t.getSettings(),v=(u=(l=g.width)!==null&&l!==void 0?l:a.videoWidth)!==null&&u!==void 0?u:1280,b=(f=(d=g.height)!==null&&d!==void 0?d:a.videoHeight)!==null&&f!==void 0?f:720;m.width=v,m.height=b;const C=m.getContext("2d");C.drawImage(a,0,0);const O=C.getImageData(0,0,m.width,m.height).data;let B=!0;for(let w=0;w<O.length;w+=4)if(O[w]!==0||O[w+1]!==0||O[w+2]!==0){B=!1;break}B?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),o()},1e3)},a.play()}),i.getTracks().forEach(o=>o.stop()),a.remove()})}}class d1 extends $i{get description(){return"Resuming connection after interruption"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect();let a=!1,o=!1,l;const u=new Promise(m=>{setTimeout(m,5e3),l=m}),d=()=>{a=!0};i.on(Z.SignalReconnecting,d).on(Z.Reconnecting,d).on(Z.Reconnected,()=>{o=!0,l(!0)}),(t=i.engine.client.ws)===null||t===void 0||t.close();const f=i.engine.client.onClose;if(f&&f(""),yield u,a){if(!o||i.state!==_e.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class h1 extends $i{get description(){return"Can connect via TURN"}perform(){return T(this,void 0,void 0,function*(){var t,i,a;Ds(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(t=yield new Ue(this.url,this.token).getNextBestRegionUrl())!==null&&t!==void 0?t:this.url);const o=new Vh,l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let u=!1,d=!1,f=!1;for(let m of l.iceServers)for(let g of m.urls)g.startsWith("turn:")?(d=!0,f=!0):g.startsWith("turns:")&&(d=!0,f=!0,u=!0),g.startsWith("stun:")&&(f=!0);f?d&&!u&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield o.close(),!((a=(i=this.connectOptions)===null||i===void 0?void 0:i.rtcConfig)===null||a===void 0)&&a.iceServers||d?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(m=>setTimeout(m,0)))})}}class f1 extends $i{get description(){return"Establishing WebRTC connection"}perform(){return T(this,void 0,void 0,function*(){let t=!1,i=!1;this.room.on(Z.SignalConnected,()=>{var a;const o=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(l,u)=>{if(l.candidate){const d=new RTCIceCandidate(l);let f="".concat(d.protocol," ").concat(d.address,":").concat(d.port," ").concat(d.type);d.address&&(m1(d.address)?f+=" (private)":d.protocol==="tcp"&&d.tcpType==="passive"?(t=!0,f+=" (passive)"):d.protocol==="udp"&&(i=!0)),this.appendMessage(f)}o&&o(l,u)},!((a=this.room.engine.pcManager)===null||a===void 0)&&a.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=l=>{l instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(l.errorCode," ").concat(l.errorText," ").concat(l.url))})});try{yield this.connect(),Re.info("now the room is connected")}catch(a){throw this.appendWarning("ports need to be open on firewall in order to connect."),a}t||this.appendWarning("Server is not configured for ICE/TCP"),i||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function m1(s){const t=s.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const i=parseInt(t[1],10);if(i>=16&&i<=31)return!0}}return!1}class p1 extends $i{get description(){return"Connecting to signal connection via WebSocket"}perform(){return T(this,void 0,void 0,function*(){var t,i,a;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let o=new Vh,l;try{l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(u){if(Ds(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(u.message,". Retrying with region fallback"));const f=yield new Ue(this.url,this.token).getNextBestRegionUrl();f&&(l=yield o.join(f,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}l?(this.appendMessage("Connected to server, version ".concat(l.serverVersion,".")),((t=l.serverInfo)===null||t===void 0?void 0:t.edition)===o0.Cloud&&(!((i=l.serverInfo)===null||i===void 0)&&i.region)&&this.appendMessage("LiveKit Cloud: ".concat((a=l.serverInfo)===null||a===void 0?void 0:a.region))):this.appendError("Websocket connection could not be established"),yield o.close()})}}class K1 extends jn.EventEmitter{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=i,this.options=a}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:kn.IDLE,name:"",description:""}),t}updateCheck(t,i){this.checkResults.set(t,i),this.emit("checkUpdate",t,i)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==kn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return T(this,void 0,void 0,function*(){const i=this.getNextCheckId(),a=new t(this.url,this.token,this.options),o=u=>{this.updateCheck(i,u)};a.on("update",o);const l=yield a.run();return a.off("update",o),l})}checkWebsocket(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(p1)})}checkWebRTC(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(f1)})}checkTURN(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(h1)})}checkReconnect(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(d1)})}checkPublishAudio(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(l1)})}checkPublishVideo(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(u1)})}checkConnectionProtocol(){return T(this,void 0,void 0,function*(){const t=yield this.createAndRunCheck(c1);if(t.data&&"protocol"in t.data){const i=t.data;this.options.protocol=i.protocol}return t})}checkCloudRegion(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(o1)})}}function we(s,t,i){return(t=v1(t))in s?Object.defineProperty(s,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[t]=i,s}function g1(s,t){if(typeof s!="object"||!s)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var a=i.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function v1(s){var t=g1(s,"string");return typeof t=="symbol"?t:t+""}new TextEncoder;new TextDecoder;class It extends Error{constructor(t,i){var a;super(t,i),we(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(a=Error.captureStackTrace)===null||a===void 0||a.call(Error,this,this.constructor)}}we(It,"code","ERR_JOSE_GENERIC");class y1 extends It{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:a,reason:o,payload:i}}),we(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),we(this,"claim",void 0),we(this,"reason",void 0),we(this,"payload",void 0),this.claim=a,this.reason=o,this.payload=i}}we(y1,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class b1 extends It{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:a,reason:o,payload:i}}),we(this,"code","ERR_JWT_EXPIRED"),we(this,"claim",void 0),we(this,"reason",void 0),we(this,"payload",void 0),this.claim=a,this.reason=o,this.payload=i}}we(b1,"code","ERR_JWT_EXPIRED");class S1 extends It{constructor(){super(...arguments),we(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}we(S1,"code","ERR_JOSE_ALG_NOT_ALLOWED");class T1 extends It{constructor(){super(...arguments),we(this,"code","ERR_JOSE_NOT_SUPPORTED")}}we(T1,"code","ERR_JOSE_NOT_SUPPORTED");class C1 extends It{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",i=arguments.length>1?arguments[1]:void 0;super(t,i),we(this,"code","ERR_JWE_DECRYPTION_FAILED")}}we(C1,"code","ERR_JWE_DECRYPTION_FAILED");class k1 extends It{constructor(){super(...arguments),we(this,"code","ERR_JWE_INVALID")}}we(k1,"code","ERR_JWE_INVALID");class E1 extends It{constructor(){super(...arguments),we(this,"code","ERR_JWS_INVALID")}}we(E1,"code","ERR_JWS_INVALID");class R1 extends It{constructor(){super(...arguments),we(this,"code","ERR_JWT_INVALID")}}we(R1,"code","ERR_JWT_INVALID");class _1 extends It{constructor(){super(...arguments),we(this,"code","ERR_JWK_INVALID")}}we(_1,"code","ERR_JWK_INVALID");class O1 extends It{constructor(){super(...arguments),we(this,"code","ERR_JWKS_INVALID")}}we(O1,"code","ERR_JWKS_INVALID");class A1 extends It{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(t,i),we(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}we(A1,"code","ERR_JWKS_NO_MATCHING_KEY");class D1 extends It{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(t,i),we(this,Symbol.asyncIterator,void 0),we(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}we(D1,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class M1 extends It{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",i=arguments.length>1?arguments[1]:void 0;super(t,i),we(this,"code","ERR_JWKS_TIMEOUT")}}we(M1,"code","ERR_JWKS_TIMEOUT");class w1 extends It{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",i=arguments.length>1?arguments[1]:void 0;super(t,i),we(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}we(w1,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function x1(s){const[t,i]=z.useState({level:0}),a=z.useRef(null);return z.useEffect(()=>{if(!s){i({level:0});return}const o=new(window.AudioContext||window.webkitAudioContext),l=o.createAnalyser();l.fftSize=256;const u=o.createMediaStreamSource(s);u.connect(l);const d=new Uint8Array(l.frequencyBinCount),f=()=>{l.getByteTimeDomainData(d);let m=0;for(let v=0;v<d.length;v++){const b=(d[v]-128)/128;m+=b*b}const g=Math.sqrt(m/d.length);i({level:Math.min(1,Math.max(0,g))}),a.current=window.requestAnimationFrame(f)};return a.current=window.requestAnimationFrame(f),()=>{a.current&&window.cancelAnimationFrame(a.current),u.disconnect(),l.disconnect(),o.close().catch(()=>{})}},[s]),t}function N1({stream:s=null,size:t=140,label:i="Orb"}){const{level:a}=x1(s),o=z.useMemo(()=>10+a*30,[a]),l=z.useMemo(()=>1+a*.12,[a]);return N.jsx("div",{"aria-label":i,style:{width:t,height:t,borderRadius:"9999px",background:"radial-gradient(circle at 30% 30%, rgba(99,102,241,0.9), rgba(6,182,212,0.25) 55%, rgba(15,23,42,0.9) 100%)",boxShadow:`0 0 ${o}px rgba(99,102,241,0.55), 0 0 ${o*.6}px rgba(6,182,212,0.35)`,transform:`scale(${l})`,transition:"transform 80ms linear, box-shadow 80ms linear"}})}function P1(s){const{url:t,token:i,onConnected:a,onDisconnected:o,onParticipantJoined:l,onParticipantLeft:u,onError:d,onDataReceived:f}=s,m=z.useRef({onConnected:a,onDisconnected:o,onParticipantJoined:l,onParticipantLeft:u,onError:d,onDataReceived:f});z.useEffect(()=>{m.current={onConnected:a,onDisconnected:o,onParticipantJoined:l,onParticipantLeft:u,onError:d,onDataReceived:f}},[a,o,l,u,d,f]);const g=z.useRef(null),v=z.useRef(!1),[b,C]=z.useState(_e.Disconnected),[M,O]=z.useState(null),[B,w]=z.useState(new Map),[X,K]=z.useState(!0),[A,_]=z.useState(!0),I=z.useCallback((ae,x)=>{let $=null,ue=null;return ae.trackPublications.forEach(le=>{le.track&&(le.track.kind===J.Kind.Audio?$=le.track.mediaStreamTrack:le.track.kind===J.Kind.Video&&(ue=le.track.mediaStreamTrack))}),{identity:ae.identity,name:ae.name||ae.identity,isSpeaking:ae.isSpeaking,audioTrack:$,videoTrack:ue,isLocal:x,metadata:ae.metadata}},[]),q=z.useCallback(()=>{if(!g.current)return;const ae=new Map;g.current.remoteParticipants.forEach(x=>{ae.set(x.identity,I(x,!1))}),w(ae)},[I]),W=z.useCallback(()=>{g.current&&(console.log("[LiveKit] Disconnecting..."),g.current.disconnect(),g.current=null),v.current=!1,C(_e.Disconnected),O(null),w(new Map),K(!1),_(!1)},[]),oe=z.useCallback(async()=>{var x,$,ue;if(!t||!i){console.log("[LiveKit] Missing url or token");return}if(v.current){console.log("[LiveKit] Already connecting, skipping...");return}if(((x=g.current)==null?void 0:x.state)===_e.Connected){console.log("[LiveKit] Already connected");return}g.current&&(console.log("[LiveKit] Cleaning up existing room before reconnect"),g.current.disconnect(),g.current=null),v.current=!0,console.log("[LiveKit] Connecting to:",t);const ae=new Ms({adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:{width:640,height:480,frameRate:24}},audioCaptureDefaults:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});g.current=ae,ae.on(Z.ConnectionStateChanged,le=>{var ye,E,F,ne;console.log("[LiveKit] Connection state:",le),C(le),le===_e.Connected?(v.current=!1,(E=(ye=m.current).onConnected)==null||E.call(ye)):le===_e.Disconnected&&(v.current=!1,(ne=(F=m.current).onDisconnected)==null||ne.call(F))}),ae.on(Z.ParticipantConnected,le=>{var ye,E;console.log("[LiveKit] Participant joined:",le.identity),q(),(E=(ye=m.current).onParticipantJoined)==null||E.call(ye,I(le,!1))}),ae.on(Z.ParticipantDisconnected,le=>{var ye,E;console.log("[LiveKit] Participant left:",le.identity),q(),(E=(ye=m.current).onParticipantLeft)==null||E.call(ye,le.identity)}),ae.on(Z.TrackSubscribed,(le,ye,E)=>{if(console.log("[LiveKit] Track subscribed from",E.identity,{kind:le.kind,sid:le.sid,hasMediaStreamTrack:!!le.mediaStreamTrack}),le.kind===J.Kind.Audio){const F=le.attachedElements;(!F||F.length===0)&&(console.log("[LiveKit]  Attaching audio track from",E.identity),le.attach())}setTimeout(()=>{q()},100)}),ae.on(Z.TrackUnsubscribed,(le,ye,E)=>{console.log("[LiveKit] Track unsubscribed from",E.identity),q()}),ae.on(Z.ActiveSpeakersChanged,()=>{q(),ae.localParticipant&&O(I(ae.localParticipant,!0))}),ae.on(Z.LocalTrackPublished,()=>{ae.localParticipant&&O(I(ae.localParticipant,!0))}),ae.on(Z.DataReceived,(le,ye)=>{var E,F;(F=(E=m.current).onDataReceived)==null||F.call(E,le,ye)});try{console.log("[LiveKit] Attempting connection..."),await ae.connect(t,i,{autoSubscribe:!0}),console.log("[LiveKit] Connected to room:",ae.name);try{await ae.localParticipant.enableCameraAndMicrophone(),console.log("[LiveKit] Camera and microphone enabled")}catch(le){console.warn("[LiveKit] Could not enable camera/mic:",le)}K(ae.localParticipant.isMicrophoneEnabled),_(ae.localParticipant.isCameraEnabled),O(I(ae.localParticipant,!0)),q()}catch(le){console.error("[LiveKit] Connection error:",le),v.current=!1,g.current=null,ae.disconnect(),O(null),w(new Map),(ue=($=m.current).onError)==null||ue.call($,le)}},[t,i,I,q]),re=z.useCallback(async()=>{var x;if(!((x=g.current)!=null&&x.localParticipant))return;const ae=g.current.localParticipant.isMicrophoneEnabled;await g.current.localParticipant.setMicrophoneEnabled(!ae),K(!ae)},[]),ce=z.useCallback(async()=>{var x;if(!((x=g.current)!=null&&x.localParticipant))return;const ae=g.current.localParticipant.isCameraEnabled;await g.current.localParticipant.setCameraEnabled(!ae),_(!ae)},[]),pe=z.useRef(new Map),Ve=z.useCallback(ae=>{var le,ye;if(!g.current)return console.log("[LiveKit] getParticipantAudioStream: no room"),null;const x=pe.current.get(ae);if(x&&x.active)return x;const $=ae===((le=g.current.localParticipant)==null?void 0:le.identity)?g.current.localParticipant:g.current.remoteParticipants.get(ae);if(!$)return console.log("[LiveKit] getParticipantAudioStream: participant not found:",ae),null;const ue=[];$.trackPublications.forEach(E=>{var F;((F=E.track)==null?void 0:F.kind)===J.Kind.Audio&&ue.push({track:E.track,isSubscribed:E.isSubscribed})});for(const E of ue){if(!E.track)continue;const F=E.track;if(console.log("[LiveKit] getParticipantAudioStream: checking audio track",{identity:ae,isSubscribed:E.isSubscribed,hasMediaStreamTrack:!!F.mediaStreamTrack,trackSid:F.sid,attachedElementsCount:((ye=F.attachedElements)==null?void 0:ye.length)??0}),F.mediaStreamTrack){console.log("[LiveKit]  Method 1: Using mediaStreamTrack for",ae);const ee=new MediaStream([F.mediaStreamTrack]);return pe.current.set(ae,ee),ee}const ne=F.attachedElements;if(ne&&ne.length>0){const ee=ne[0];if(ee.srcObject instanceof MediaStream)return console.log("[LiveKit]  Method 2: Using attached element srcObject for",ae),pe.current.set(ae,ee.srcObject),ee.srcObject;if("captureStream"in ee)try{const he=ee.captureStream();if(he&&he.getAudioTracks().length>0)return console.log("[LiveKit]  Method 3: Using captureStream() for",ae),pe.current.set(ae,he),he}catch(he){console.log("[LiveKit] captureStream() failed:",he)}}console.log("[LiveKit]  Method 4: Creating new audio element for",ae);try{const ee=F.attach();if(ee.srcObject instanceof MediaStream)return console.log("[LiveKit]  Method 4 success: Got stream from new attachment"),pe.current.set(ae,ee.srcObject),ee.srcObject;if("captureStream"in ee){ee.play().catch(()=>{});const he=ee.captureStream();if(he)return console.log("[LiveKit]  Method 4 success: Got stream via captureStream"),pe.current.set(ae,he),he}}catch(ee){console.log("[LiveKit] Method 4 failed:",ee)}}return console.log("[LiveKit]  No audio stream available for",ae),null},[]),nt=z.useCallback((ae,x)=>{var ue;if(!((ue=g.current)!=null&&ue.localParticipant))return;const $=typeof ae=="string"?new TextEncoder().encode(ae):ae;g.current.localParticipant.publishData($,{reliable:(x==null?void 0:x.reliable)??!0})},[]);return z.useEffect(()=>()=>{W()},[W]),{room:g.current,connectionState:b,localParticipant:M,remoteParticipants:B,connect:oe,disconnect:W,toggleAudio:re,toggleVideo:ce,isAudioEnabled:X,isVideoEnabled:A,getParticipantAudioStream:Ve,publishData:nt}}function L1(){return""}function U1(){return localStorage.getItem("auth_token")}function I1(){const{protocol:s,hostname:t}=window.location;return`${s}//${t}:3700/login`}function j1(s){const t=Math.floor(s/60),i=s%60;return`${String(t).padStart(2,"0")}:${String(i).padStart(2,"0")}`}function B1(){const{roomId:s}=DC(),t=Ps(),[i,a]=z.useState(null),[o,l]=z.useState(null),[u,d]=z.useState(null),[f,m]=z.useState("unknown"),[g,v]=z.useState(null),[b,C]=z.useState(null),[M,O]=z.useState(0),[B,w]=z.useState(!1),[X,K]=z.useState(""),[A,_]=z.useState([{id:crypto.randomUUID(),kind:"system",speaker:"System",text:"Session initialized. Waiting for participants to join..."}]),I=z.useRef(null),q=z.useRef(null),W=z.useRef(null),oe=z.useRef(null),re=z.useRef(!0),ce=z.useRef(`coach-${crypto.randomUUID().slice(0,8)}`),pe=z.useRef(!1),Ve=z.useRef(!1),nt=z.useMemo(()=>(s??"").slice(0,8),[s]),ae=z.useMemo(()=>`http://${window.location.hostname}:3702/room/${s??""}`,[s]),x=z.useCallback((me,Ce,Jt)=>{_(qn=>[...qn,{id:crypto.randomUUID(),kind:me,speaker:Ce,text:Jt}])},[]),$=z.useCallback(()=>{const me=W.current;if(!me)return;const Ce=120,Jt=me.scrollHeight-(me.scrollTop+me.clientHeight);re.current=Jt<=Ce},[]);z.useEffect(()=>{var me;re.current&&((me=oe.current)==null||me.scrollIntoView({block:"end"}))},[A.length]);const ue=z.useCallback(me=>{try{const Ce=JSON.parse(new TextDecoder().decode(me));Ce.type==="transcript"&&x(Ce.role==="assistant"?"ai":"client",Ce.role==="assistant"?"AI Coach":"User",Ce.content)}catch(Ce){console.error("[Room] Failed to parse data message:",Ce)}},[x]),le=z.useCallback(()=>{x("system","System","Connected to room")},[x]),ye=z.useCallback(me=>{console.log("[Room] Participant joined:",me.identity),me.identity.startsWith("ai-")?(v(me),x("system","System","AI Coach connected")):me.identity.startsWith("client-")&&(C(me),x("system","System","Client joined the session"))},[x]),E=z.useCallback(me=>{console.log("[Room] Participant left:",me),me.startsWith("ai-")?(v(null),x("system","System","AI Coach disconnected")):me.startsWith("client-")&&(C(null),x("system","System","Client left the session"))},[x]),F=z.useCallback(me=>{console.error("[Room] LiveKit error:",me),d(me.message)},[]),{connectionState:ne,localParticipant:ee,remoteParticipants:he,connect:Se,disconnect:Le,toggleAudio:Et,toggleVideo:tt,isAudioEnabled:ea,isVideoEnabled:Oa,getParticipantAudioStream:Aa,publishData:ta}=P1({url:o||"",token:i||"",onConnected:le,onParticipantJoined:ye,onParticipantLeft:E,onDataReceived:ue,onError:F});z.useEffect(()=>{if(!s||Ve.current)return;Ve.current=!0;async function me(){var Ce,Jt;try{const qn=U1();if(!qn){window.location.href=I1();return}console.log("[Room] Fetching LiveKit token...");const wa=await fetch(`${L1()}/api/livekit/token`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${qn}`},body:JSON.stringify({roomName:s,participantName:"Coach",participantIdentity:ce.current,role:"coach",spawnAgent:!0})}),Ye=await wa.json().catch(()=>null);if(!wa.ok){d((Ye==null?void 0:Ye.error)??`Failed to get token (HTTP ${wa.status})`);return}if(console.log("[Room] Token response:",Ye!=null&&Ye.success?"success":Ye==null?void 0:Ye.error),Ye!=null&&Ye.success){const eo=((Ce=Ye==null?void 0:Ye.data)==null?void 0:Ce.url)||void 0;if(!eo){d("LiveKit URL missing (server did not return url and VITE_LIVEKIT_URL is not set)");return}a(Ye.data.token),l(eo),m(String(((Jt=Ye==null?void 0:Ye.data)==null?void 0:Jt.agentStatus)??"unknown"))}else d((Ye==null?void 0:Ye.error)||"Failed to get token")}catch(qn){d("Network error"),console.error(qn)}}me()},[s]),z.useEffect(()=>{!i||!o||pe.current||(pe.current=!0,console.log("[Room] Token ready, connecting to LiveKit..."),Se())},[i,o,Se]),z.useEffect(()=>{const me=window.setInterval(()=>O(Ce=>Ce+1),1e3);return()=>window.clearInterval(me)},[]),z.useEffect(()=>{ee!=null&&ee.videoTrack&&I.current&&(I.current.srcObject=new MediaStream([ee.videoTrack]))},[ee==null?void 0:ee.videoTrack]),z.useEffect(()=>{b!=null&&b.videoTrack&&q.current&&(q.current.srcObject=new MediaStream([b.videoTrack]))},[b==null?void 0:b.videoTrack]),z.useEffect(()=>{let me,Ce;he.forEach(Jt=>{Jt.identity.startsWith("ai-")?me=Jt:Jt.identity.startsWith("client-")&&(Ce=Jt)}),me!==void 0?((!g||g.identity!==me.identity)&&m("connected"),v(me)):g&&v(null),Ce!==void 0?C(Ce):b&&C(null)},[he]);const zn=z.useMemo(()=>{let me=null;if(he.forEach(Ce=>{Ce.identity.startsWith("ai-")&&(me=Ce.identity)}),me){const Ce=Aa(me);return console.log("[CoachRoom]  AI audio stream:",Ce?"available":"null","for",me),Ce}return null},[he,Aa]),Ls=z.useCallback(()=>{const me=!B;w(me),ta(JSON.stringify({type:"coach_mute",muted:me,coachIdentity:ce.current})),x("coach","Coach",me?"Muted from AI":"Unmuted from AI")},[B,ta,x]),Da=z.useCallback(()=>{X.trim()&&(ta(JSON.stringify({type:"coach_whisper",text:X.trim()})),x("coach","Coach (whisper)",X.trim()),K(""))},[X,ta,x]),nl=z.useCallback(()=>{confirm("End this coaching session?")&&(Le(),t("/dashboard"))},[Le,t]),$r=z.useCallback(async()=>{try{await navigator.clipboard.writeText(ae),x("system","System","Copied client join link to clipboard.")}catch{x("system","System","Could not copy invite link (clipboard permission).")}},[ae,x]),Ma=ne===_e.Connected,Us=Ma?"":ne===_e.Connecting?"warn":"err",Is=Ma?"Ready":ne===_e.Connecting?"Connecting...":"Error",il=z.useMemo(()=>B?"AI Muted (from you)":g?g.isSpeaking?"AI Speaking":"AI Coach Ready":f==="spawning"?"Starting AI Coach...":f==="failed"?"AI failed to start":"AI Offline",[f,g,B]);return u?N.jsx("div",{className:"coach-room",children:N.jsx("div",{className:"coach-room-shell",children:N.jsxs("div",{style:{padding:"2rem"},children:[N.jsxs("div",{className:"alert alert-error",children:[N.jsx("strong",{children:"Error"}),N.jsx("div",{style:{marginTop:"0.5rem"},children:u})]}),N.jsx("button",{className:"btn btn-primary",onClick:()=>t("/dashboard"),children:"Back to Dashboard"})]})})}):N.jsx("div",{className:"coach-room",children:N.jsxs("div",{className:"coach-room-shell",children:[N.jsxs("section",{className:"coach-room-left",children:[N.jsxs("header",{className:"coach-room-header",children:[N.jsxs("div",{children:[N.jsx("h2",{children:"Coach Room"}),N.jsxs("div",{className:"coach-room-subtitle",children:["Room: ",nt,"..."]}),N.jsxs("div",{className:"coach-room-subtitle",children:["Client link: ",N.jsx("a",{href:ae,target:"_blank",rel:"noreferrer",children:ae})]})]}),N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[N.jsxs("div",{className:"coach-room-status",children:[N.jsx("span",{className:`coach-room-status-dot ${Us}`}),N.jsx("span",{children:Is})]}),N.jsx("button",{className:"btn btn-primary",type:"button",onClick:$r,children:"Copy client invite"}),N.jsx("button",{className:"btn btn-primary",type:"button",onClick:()=>t("/dashboard"),children:"Exit"})]})]}),N.jsxs("div",{className:"coach-room-video-grid",children:[N.jsxs("div",{className:"coach-room-tile",children:[N.jsx("video",{ref:I,autoPlay:!0,playsInline:!0,muted:!0}),N.jsx("div",{className:"coach-room-tile-label",children:"You (Coach)"})]}),N.jsxs("div",{className:"coach-room-tile",children:[b!=null&&b.videoTrack?N.jsx("video",{ref:q,autoPlay:!0,playsInline:!0}):N.jsx("div",{className:"coach-room-tile-placeholder",children:"Waiting for client..."}),N.jsx("div",{className:"coach-room-tile-label",children:"Client"})]}),N.jsxs("div",{className:"coach-room-tile",children:[N.jsxs("div",{className:"coach-room-tile-placeholder",style:{flexDirection:"column",gap:16},children:[N.jsx(N1,{label:"AI Orb",stream:zn??void 0}),N.jsx("div",{children:il})]}),N.jsx("div",{className:"coach-room-tile-label",children:"AI Coach"})]}),N.jsxs("div",{className:"coach-room-tile",children:[N.jsxs("div",{className:"coach-room-tile-placeholder",children:["Participants: ",1+(b?1:0)+(g?1:0)]}),N.jsx("div",{className:"coach-room-tile-label",children:"Session"})]})]}),N.jsxs("div",{className:"coach-room-controls",children:[N.jsx("button",{className:"btn btn-primary",type:"button",onClick:tt,children:Oa?" Video":" Video Off"}),N.jsx("button",{className:"btn btn-primary",type:"button",onClick:Et,children:ea?" Audio":" Muted"})]})]}),N.jsxs("aside",{className:"coach-room-right",children:[N.jsxs("div",{className:"coach-ai-panel-header",children:[N.jsx("h3",{children:"AI Coach Controls"}),N.jsxs("div",{className:"coach-ai-controls",children:[N.jsx("button",{className:`btn ${B?"btn-warning":"btn-primary"}`,type:"button",onClick:Ls,children:B?" Unmute from AI":" Mute from AI"}),N.jsx("button",{className:"btn btn-danger",type:"button",onClick:nl,children:"End Session"})]}),N.jsxs("div",{style:{marginTop:"1rem"},children:[N.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,opacity:.8},children:"Whisper to AI (silent context)"}),N.jsxs("div",{style:{display:"flex",gap:8},children:[N.jsx("input",{type:"text",placeholder:"e.g., Focus on breathing exercises...",value:X,onChange:me=>K(me.target.value),onKeyDown:me=>me.key==="Enter"&&Da(),style:{flex:1,padding:"0.5rem",borderRadius:4,border:"1px solid #444",background:"#1e1e1e",color:"white"}}),N.jsx("button",{className:"btn btn-primary",onClick:Da,children:"Send"})]})]})]}),N.jsxs("div",{className:"coach-transcript",children:[N.jsxs("div",{className:"coach-transcript-header",children:[N.jsx("div",{style:{fontWeight:700},children:"Live Transcript"}),N.jsxs("div",{style:{fontSize:12,opacity:.7},children:["AI: ",g?"connected":"offline","  Client: ",b?"connected":"waiting"]})]}),N.jsxs("div",{className:"coach-transcript-body",ref:W,onScroll:$,children:[A.map(me=>N.jsxs("div",{className:`coach-transcript-item ${me.kind}`,children:[N.jsx("div",{className:"coach-transcript-speaker",children:me.speaker}),N.jsx("div",{children:me.text})]},me.id)),N.jsx("div",{ref:oe})]})]}),N.jsxs("div",{className:"coach-session-timer",children:[N.jsx("div",{className:"time",children:j1(M)}),N.jsx("div",{style:{fontSize:12,opacity:.75},children:"Session Duration"})]})]}),Array.from(he.values()).map(me=>me.audioTrack&&N.jsx("audio",{autoPlay:!0,ref:Ce=>{Ce&&me.audioTrack&&(Ce.srcObject=new MediaStream([me.audioTrack]))}},me.identity))]})})}function z1(){const{protocol:s,hostname:t}=window.location;return`${s}//${t}:3700/login`}function q1(){return localStorage.getItem("auth_token")}function V1(){const s=Ps();return z.useEffect(()=>{(async()=>{const t=q1();if(!t){window.location.href=z1();return}const i=await fetch("/api/rooms/create",{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${t}`}}),a=await i.json().catch(()=>null);if(!i.ok||!a||!a.success){s("/dashboard",{replace:!0});return}s(`/room/${a.data.roomId}`,{replace:!0})})()},[s]),null}function F1(){return N.jsxs(GC,{children:[N.jsx(Sa,{path:"/",element:N.jsx(uv,{to:"/dashboard",replace:!0})}),N.jsx(Sa,{path:"/dashboard",element:N.jsx(dk,{})}),N.jsx(Sa,{path:"/auth/callback",element:N.jsx(rk,{})}),N.jsx(Sa,{path:"/room/create",element:N.jsx(V1,{})}),N.jsx(Sa,{path:"/room/:roomId",element:N.jsx(B1,{})}),N.jsx(Sa,{path:"*",element:N.jsx(uv,{to:"/dashboard",replace:!0})})]})}const H1="/coach";WT.createRoot(document.getElementById("root")).render(N.jsx(ky.StrictMode,{children:N.jsx($C,{basename:H1,children:N.jsx(F1,{})})}));
