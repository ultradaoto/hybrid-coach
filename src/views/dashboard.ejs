<section>
  <h2>Welcome, <%= user.displayName %></h2>
  <p>Your email: <%= user.email ?? 'N/A' %></p>

  <% if (user.role === 'coach') { %>
    <!-- Auto-refresh for coaches every 10 seconds -->
    <script>
      setTimeout(() => {
        window.location.reload();
      }, 10000);
    </script>
    
    <h3>Coach Tools</h3>
    <% if (!user.googleTokens) { %>
      <a href="/coach/calendar/connect" class="btn">Connect Calendar</a>
    <% } else { %>
      <p>Calendar connected âœ”ï¸</p>
    <% } %>
    <h4>Upcoming Meetings</h4>
    <% if (meetings && meetings.length) { %>
      <ul>
        <% meetings.forEach(m => { %>
          <li><%= m.start %> â€“ <%= m.summary %></li>
        <% }) %>
      </ul>
    <% } else { %>
      <p>No upcoming meetings.</p>
    <% } %>
  <% } else { %>
    <h3>Schedule Your Hybrid Coaching Call</h3>
    <% if (slots && slots.length) { %>
      <form method="post" action="/schedule">
        <label for="slot">Choose a slot:</label>
        <select name="slot" id="slot">
          <% slots.forEach(s => { %>
            <option value="<%= s.iso %>"><%= s.label %></option>
          <% }) %>
        </select>
        <button type="submit">Book</button>
      </form>
    <% } else { %>
      <p>Click below to create a test room immediately:</p>
      <a href="/room/create" class="btn" style="background: #28a745; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 4px; display: inline-block;">Create Instant Room</a>
    <% } %>
  <% } %>

  <h3>
    Upcoming Appointments
    <% if (user.role === 'coach') { %>
      <span style="font-size: 0.8em; color: #666;">(Auto-refreshing every 10 seconds)</span>
    <% } %>
  </h3>
  <% if (appointments && appointments.length) { %>
    <ul style="list-style: none; padding: 0;">
      <% appointments.forEach(a => { %>
        <li style="margin-bottom: 1rem; padding: 1rem; background: #f5f5f5; border-radius: 8px; border-left: 4px solid <%= user.role === 'coach' ? '#007bff' : '#28a745' %>;">
          <strong>ğŸ“… <%= new Date(a.scheduledFor).toLocaleString() %></strong>
          <% if (user.role === 'coach' && a.client) { %>
            <br>ğŸ‘¤ Client: <%= a.client.displayName || a.client.email %>
          <% } else if (user.role === 'client' && a.coach) { %>
            <br>ğŸ“ Coach: <%= a.coach.displayName || a.coach.email %>
          <% } %>
          <br>
          <span style="color: #666; font-size: 0.9em;">Room ID: <%= a.roomId.substring(0, 8) %>...</span>
          <div style="margin-top: 0.5rem;">
            <a href="/room/<%= a.roomId %>/simple" class="btn" style="background: #28a745; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 4px; display: inline-block;">âœ… Join Room (Simple)</a>
            <a href="/room/<%= a.roomId %>" class="btn" style="background: #6c757d; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 4px; display: inline-block; margin-left: 0.5rem;">ğŸ”§ Advanced Mode</a>
          </div>
        </li>
      <% }) %>
    </ul>
  <% } else { %>
    <p style="color: #666;">No upcoming appointments. 
      <% if (user.role === 'client') { %>
        Schedule one above or create an instant room.
      <% } else { %>
        Waiting for clients to book appointments...
      <% } %>
    </p>
  <% } %>

  <% if (user.role === 'coach') { %>
    <div style="margin-top:1rem">
      <a href="/room/create" class="btn" style="background: #17a2b8; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 4px;">ğŸ§ª Launch Test Room</a>
    </div>
  <% } %>

  <p style="margin-top:2rem"><a href="/auth/logout">Logout</a></p>
</section> 